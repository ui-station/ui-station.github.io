{"pageProps":{"post":{"title":"Terraform으로 AWS 자원을 올바르게 태깅하는 방법","description":"","date":"2024-06-23 22:28","slug":"2024-06-23-TaggingAWSresourcestherightwayusingTerraform","content":"\n![Tagging AWS resources the right way using Terraform](/assets/img/2024-06-23-TaggingAWSresourcestherightwayusingTerraform_0.png)\n\n# 🔖 소개:\n\nAWS 리소스를 조직화하고 비용을 추적하는 것은 특히 인프라가 확장됨에 따라 어려울 수 있습니다.\n\n리소스에 태그를 붙이는 것은 간단하지만 효과적으로 수행하려면 최선의 방법을 따라야 합니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n이 블로그 포스트에서는 인프라스트럭처 코드(IaC) 도구 Terraform을 사용하여 AWS 리소스에 태그를 달는 방법을 안내해 드리겠습니다.\n\n# AWS 리소스에 태그 붙이기 소개:\n\nAWS 리소스에 태그를 붙이는 것은 조직화되고 비용 효율적인 클라우드 인프라를 유지하는 데 중요합니다.\n\n태그는 환경, 애플리케이션, 팀 등과 같은 기준에 따라 리소스를 분류하고 관리하는 키-값 쌍입니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n일관된 태깅은 리소스 조직, 비용 할당, 자동화, 보안 및 라이프사이클 관리와 같은 혜택을 제공합니다.\n\nTerraform에서는 프로비저닝하는 동안 리소스에 태그를 달 수 있습니다. 예를 들어, 환경 및 팀 태그와 함께 S3 버킷에 태그를 달기 위해 다음과 같이 할 수 있습니다:\n\n```js\nresource \"aws_s3_bucket\" \"example\" {\n  bucket = \"my-bucket\"\n  tags = {\n    Environment = \"Production\"\n    Team = \"DevOps\"\n  }\n}\n```\n\n또한 모든 리소스에 적용되는 공급자 수준의 기본 태그를 정의할 수도 있습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\n공급자 \"aws\" {\n  default_tags {\n    tags = {\n      Environment = \"Production\"\n      ManagedBy = \"Terraform\"\n    }\n  }\n}\n```\n\n# 리소스 레벨에서 기본 태그 재정의하기:\n\ndefault_tags 블록을 사용하여 공급자 수준에서 기본 태그를 정의하면 모든 리소스에 자동으로 일반적인 태그가 적용되어 일관성을 유지하고 수동 작업을 줄일 수 있습니다.\n\n기본 태그의 장점\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- 일관성: 모든 리소스에 일관된 태그가 적용되도록 보장합니다.\n- 수동 작업 최소화: 리소스 간 반복되는 태그 정의를 피합니다.\n\n예를 들어 AWS 프로바이더에서 기본 태그를 설정하는 방법:\n\n```js\nprovider \"aws\" {\n  default_tags {\n    tags = {\n      Environment = \"Production\"\n      ManagedBy   = \"Terraform\"\n    }\n  }\n}\n```\n\n기본 태그를 재정의하거나 추가 태그를 추가하는 방법은 리소스 레벨에서 태그 인수를 지정하여 수행할 수 있습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n이 인수는 제공자 수준에서 정의된 기본 태그보다 우선합니다.\n\n```js\nresource \"aws_s3_bucket\" \"example\" {\n  bucket = \"my-bucket\"\n\n  # 기본 환경 태그를 재정의하고 목적 태그 추가하기\n  tags = {\n    Environment = \"Staging\"\n    Purpose     = \"Data Processing\"\n  }\n}\n```\n\n이 예제에서는 환경 태그가 Staging 값으로 재정의되고, 목적 태그가 특히 해당 S3 버킷 리소스에 추가됩니다.\n\nManagedBy 기본 태그는 여전히 적용됩니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n자원 수준 태그 사용 사례\n\n- 환경별 태그 (dev, staging, prod 등)\n- 애플리케이션/프로젝트별 태그\n- 자원별 메타데이터 태그 (예: 목적, 소유자, 만료일)\n- 데이터 민감성에 따른 규정 준수 또는 규제 태그\n- 특정 자원에 대한 비용 할당 태그\n\n자원 수준에서 태그 재정의를 허용함으로써 기본 태그의 이점을 유지하면서 각 자원의 특정 요구 사항에 따라 태그를 유연하게 사용할 수 있습니다.\n\n# 유연한 태깅을 위한 변수와 함수 사용:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n테라폼을 사용하면 태그를 변수로 정의하고 merge()와 같은 함수를 사용하여 다른 태그와 결합하여 재사용성과 유연성을 높일 수 있습니다.\n\n변수로 태그를 정의하기:\n\n```js\nvariable \"default_tags\" {\n  default = {\n    Environment = \"Production\"\n    ManagedBy   = \"Terraform\"\n  }\n}\n```\n\nmerge() 함수를 사용하여 태그를 결합하는 방법:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```kotlin\nresource \"aws_instance\" \"example\" {\n  ami           = \"ami-0c94855ba95c71c99\"\n  instance_type = \"t2.micro\"\n\n  tags = merge(\n    var.default_tags,\n    {\n      Name    = \"ExampleInstance\"\n      Project = \"MyApp\"\n    }\n  )\n}\n```\n\nmerge() 함수는 default_tags 변수와 추가적인 리소스별 태그를 결합하여 모든 네 가지 태그가 EC2 인스턴스에 적용되도록 합니다.\n\n# 특별한 경우 처리:\n\n일부 AWS 리소스는 특정한 태깅 구성이 필요하거나 태그 적용 방법에 제한이 있는 경우가 있습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n태깅 자동 스케일링 그룹:\n\n자동 스케일링 그룹 ASG 및 시작 템플릿 LT를 올바르게 태그 지정하는 것이 까다로울 수 있습니다.\n\n올바른 구성이 없으면 ASG 및 LT에 의해 시작된 EC2 인스턴스 및 연결된 저장소 볼륨에는 기본 태그가 첨부되지 않을 수 있습니다.\n\nASG는 propagate_at_launch 태그 구성이 필요합니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\n리소스 \"aws_autoscaling_group\" \"example\" {\n  # ...\n  tag {\n    key                 = \"Environment\"\n    value               = \"Production\"\n    propagate_at_launch = true\n  }\n}\n```\n\n런치 템플릿 태깅:\n\n런치 템플릿은 tag_specifications 구성을 필요로 합니다:\n\n```js\n리소스 \"aws_launch_template\" \"example\" {\n  # ...\n\n tag_specifications {\n    resource_type = \"instance\"\n    tags = {\n      Environment = \"Production\"\n      ManagedBy   = \"Terraform\"\n    }\n  }\n  tag_specifications {\n    resource_type = \"volume\"\n    tags = {\n      Persistence = \"Permanent\"\n    }\n  }\n}\n```\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nEBS 볼륨 태그 설정하기:\n\n테라폼을 사용하여 Elastic Compute (EC2) 인스턴스를 생성할 때, EC2에 연결된 Elastic Block Store (EBS) 볼륨은 자동으로 태그가 되지 않습니다. 태그되지 않은 EBS 볼륨은 관리가 어렵습니다.\n\n연결된 EBS 스토리지 볼륨에 EC2 기본 태그를 할당하려면 aws_instance의 volume_tags를 사용하세요.\n\n```js\nresource \"aws_instance\" \"example\" {\n  # ...\n\n volume_tags = {\n    Name        = \"DataVolume\"\n    Persistence = \"Permanent\"\n  }\n}\n```\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n기타 특수 사례:\n\n일부 리소스는 AMI, NAT 게이트웨이 또는 VPC 엔드포인트와 같이 특정 태그 지정 요구 사항이나 제한 사항이 있을 수 있습니다.\n\n다양한 리소스 유형에 대한 태그 구성에 대한 최신 지침은 항상 Terraform 제공 업체 문서를 참조하십시오.\n\n# 흔한 실수 피하기:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n일관되지 않은 태그 명명 규칙:\n\nappid, app_role 및 AppPurpose과 같은 일관되지 않은 태그 키를 사용하면 태그를 사용하고 관리하기 어려워집니다.\n\n```js\nresource \"aws_s3_bucket\" \"example\" {\n  bucket = \"my-bucket\"\n  tags = {\n    appid     = \"myapp\"\n    app_role  = \"data-processing\"\n    AppPurpose = \"logs\"\n  }\n}\n```\n\n대신, 태그 키 명명을 명확히 정의하고 그 규칙을 준수하도록 유도하세요.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n모든 AWS 리소스를 태그하지 않는 경우, EBS 볼륨과 같은 보조 또는 보완 리소스를 포함해서 태그하지 않는 것은 완전한 시각성과 비용 추적을 할 수 없게 됩니다.\n\n```js\nresource \"aws_instance\" \"example\" {\n  ami           = \"ami-0c94855ba95c71c99\"\n  instance_type = \"t2.micro\"\n  tags = {\n    Environment = \"Production\"\n  }\n}\n```\n\n동일한 기본 및 리소스 태그 문제:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\ndefault_tags 및 리소스 tags에 동일한 tag 키 및 값이 있는 경우, Terraform에서 오류가 발생하여 태그를 중복으로 지우거나 우회 방법을 사용해야 합니다.\n\n```js\nprovider \"aws\" {\n  default_tags {\n    tags = {\n      Name = \"Example\"\n    }\n  }\n}\n\nresource \"aws_vpc\" \"example\" {\n  tags = {\n    Name = \"Example\" # 오류: 태그가 동일함\n    }\n}\n```\n\n부분적인 태그 일치를 위한 영구 차이:\n\ndefault_tags 및 리소스 tags가 일부 일치하고 다른 태그가 있는 경우, Terraform은 일치하는 태그를 업데이트하려고 계획할 때마다 영구적인 차이를 표시하여 우회 방법이 필요합니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nprovider \"aws\" {\n  default_tags {\n    tags = {\n      Match1 = \"A\"\n      Match2 = \"B\"\n      NoMatch = \"X\"\n    }\n  }\n}\n\nresource \"aws_vpc\" \"example\" {\n  tags = {\n    Match1 = \"A\" # Perpetual diff trying\n    Match2 = \"B\" # to update these\n    NoMatch = \"Y\"\n  }\n}\n```\n\n인프라스트럭처 드리프트와 태그 손실:\n\n외부에서 Terraform 이외의 방법을 사용하여 리소스를 수정할 때 인프라스트럭처 드리프트로 인해 태그가 손실됩니다. IaC를 일관되게 사용하면이 문제를 완화할 수 있습니다.\n\n# Best Practices and Tips:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n명확한 태깅 전략과 명명 규칙을 수립해야 합니다:\n\n인프라 전반에 걸쳐 사용할 일관된 태그 키와 명명 규칙을 정의하세요.\n\n```js\nvariable \"tag_names\" {\n  default = {\n    environment = \"환경\"\n    application = \"응용 프로그램\"\n    team        = \"팀\"\n    costcenter  = \"비용 센터\"\n  }\n}\n```\n\n리소스를 프로비저닝할 때 (나중에가 아니라) 태그를 추가하세요:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n리소스를 프로비저닝하는 과정에서 태그를 적용하세요. 이렇게 하면 시작부터 일관된 태깅이 가능합니다.\n\n```js\nresource \"aws_s3_bucket\" \"example\" {\n  bucket = \"my-bucket\"\n  tags = {\n    (var.tag_names.environment) = \"Production\"\n    (var.tag_names.application) = \"MyApp\"\n  }\n}\n```\n\n태그를 정기적으로 검토하고 감사하세요:\n\n주기적으로 리소스 태그를 검토하고 감사하여 태깅 전략을 준수하며 누락된 태그 또는 잘못된 태그를 식별합니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n프로비저닝 중에 가능한 경우 태그 자동 적용을 자동화하세요:\n\n테라폼의 default_tags, 변수, 및 기능과 같은 기능을 활용하여 프로비저닝 중에 태그를 자동으로 적용하여 수동 노력을 줄이고 일관성을 유지하세요.\n\n# AWS 리소스 그룹 및 태그 편집기:\n\n모든 리전에 있는 모든 AWS 리소스에서 team=`platform engineering` 태그가 있는 리소스를 찾아볼 수 있다면 어떨까요?\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nAWS 리소스 그룹 및 태그 편집기는 여러 AWS 리소스 및 지역에 걸쳐 태그를 효과적으로 관리할 수 있는 강력한 도구입니다.\n\n리소스 그룹:\n\n리소스 그룹은 공유된 태그를 기반으로 AWS 리소스 모음을 구성하고 관리할 수 있는 중앙화된 방법을 제공합니다. 리소스 그룹을 사용하면 다음과 같은 작업을 수행할 수 있습니다:\n\n- 특정 태그(예: team=`platform engineering`)가 적용된 지역 전체의 리소스를 찾을 수 있습니다.\n- 태그가 누락되었거나 잘못된 태그 값이 있는 리소스를 식별할 수 있습니다.\n- 리소스 그룹 멤버십에 따라 인스턴스 시작/중지 또는 구성 적용과 같은 작업을 자동화할 수 있습니다.\n- 그룹 내에서 리소스 상태, 비용 및 구성에 대한 종합적인 정보를 확인할 수 있습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n태그 편집기:\n\n태그 편집기는 지원되는 AWS 서비스 및 지역 전체에 걸쳐 대량 태깅 작업을 가능하게 하는 리소스 그룹의 구성 요소입니다. 태그 편집기를 사용하면 다음을 수행할 수 있습니다:\n\n- 리소스 유형 및 기존 태그에 기반한 리소스 검색을 통해 \"팀=`플랫폼 엔지니어링`인 모든 EC2 인스턴스 찾기\"와 같은 쿼리를 실행할 수 있습니다.\n- 여러 리소스에 대해 태그를 추가, 수정 또는 제거하여 태깅 노력을 효율화할 수 있습니다.\n- 변경 사항을 적용하기 전에 미리 보기를 통해 정확성을 확인하고 의도하지 않은 수정을 피할 수 있습니다.\n- 태그 기반의 액세스 제어 정책을 사용하여 태그 값에 기반한 리소스 액세스를 관리할 수 있습니다.\n\n# 🔚 결론:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n마크다운 형식으로 테이블 태그를 써야 해요.\n\nAWS 설정이 조직적이고 비용 효율적으로 이루어지려면, Terraform의 태깅 도구를 사용하는 방법과 일반적인 실수를 피하는 법을 꼭 숙지해야 해요.\n\n읽어주셔서 감사해요! AWS 리소스에 태깅하는 방법에 대해 무언가 배웠으면 좋겠네요!\n\n다음에 또 만나요 🇵🇸 🎉\n\n<img src=\"/assets/img/2024-06-23-TaggingAWSresourcestherightwayusingTerraform_1.png\" />\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n읽어 주셔서 감사합니다!! 🙌🏻😁📃 다음 블로그에서 만나요.🤘🇵🇸\n\n🚀 끝까지 함께해 줘서 감사합니다. 이 블로그에 대한 질문/피드백이 있으시면 언제든지 연락해 주세요:\n\n♻️ 🇵🇸LinkedIn: https://www.linkedin.com/in/rajhi-saif/\n\n♻️🇵🇸 Twitter: https://twitter.com/rajhisaifeddine\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n제공해주셔서 감사합니다 ✌🏻\n\n# 🔰 계속해서 학습해요!! 지식을 나눠요 !! 🔰\n\n# 참고 문헌:\n","ogImage":{"url":"/assets/img/2024-06-23-TaggingAWSresourcestherightwayusingTerraform_0.png"},"coverImage":"/assets/img/2024-06-23-TaggingAWSresourcestherightwayusingTerraform_0.png","tag":["Tech"],"readingTime":14},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p><img src=\"/assets/img/2024-06-23-TaggingAWSresourcestherightwayusingTerraform_0.png\" alt=\"Tagging AWS resources the right way using Terraform\"></p>\n<h1>🔖 소개:</h1>\n<p>AWS 리소스를 조직화하고 비용을 추적하는 것은 특히 인프라가 확장됨에 따라 어려울 수 있습니다.</p>\n<p>리소스에 태그를 붙이는 것은 간단하지만 효과적으로 수행하려면 최선의 방법을 따라야 합니다.</p>\n<p></p>\n<p>이 블로그 포스트에서는 인프라스트럭처 코드(IaC) 도구 Terraform을 사용하여 AWS 리소스에 태그를 달는 방법을 안내해 드리겠습니다.</p>\n<h1>AWS 리소스에 태그 붙이기 소개:</h1>\n<p>AWS 리소스에 태그를 붙이는 것은 조직화되고 비용 효율적인 클라우드 인프라를 유지하는 데 중요합니다.</p>\n<p>태그는 환경, 애플리케이션, 팀 등과 같은 기준에 따라 리소스를 분류하고 관리하는 키-값 쌍입니다.</p>\n<p></p>\n<p>일관된 태깅은 리소스 조직, 비용 할당, 자동화, 보안 및 라이프사이클 관리와 같은 혜택을 제공합니다.</p>\n<p>Terraform에서는 프로비저닝하는 동안 리소스에 태그를 달 수 있습니다. 예를 들어, 환경 및 팀 태그와 함께 S3 버킷에 태그를 달기 위해 다음과 같이 할 수 있습니다:</p>\n<pre><code class=\"hljs language-js\">resource <span class=\"hljs-string\">\"aws_s3_bucket\"</span> <span class=\"hljs-string\">\"example\"</span> {\n  bucket = <span class=\"hljs-string\">\"my-bucket\"</span>\n  tags = {\n    <span class=\"hljs-title class_\">Environment</span> = <span class=\"hljs-string\">\"Production\"</span>\n    <span class=\"hljs-title class_\">Team</span> = <span class=\"hljs-string\">\"DevOps\"</span>\n  }\n}\n</code></pre>\n<p>또한 모든 리소스에 적용되는 공급자 수준의 기본 태그를 정의할 수도 있습니다.</p>\n<p></p>\n<pre><code class=\"hljs language-js\">공급자 <span class=\"hljs-string\">\"aws\"</span> {\n  default_tags {\n    tags = {\n      <span class=\"hljs-title class_\">Environment</span> = <span class=\"hljs-string\">\"Production\"</span>\n      <span class=\"hljs-title class_\">ManagedBy</span> = <span class=\"hljs-string\">\"Terraform\"</span>\n    }\n  }\n}\n</code></pre>\n<h1>리소스 레벨에서 기본 태그 재정의하기:</h1>\n<p>default_tags 블록을 사용하여 공급자 수준에서 기본 태그를 정의하면 모든 리소스에 자동으로 일반적인 태그가 적용되어 일관성을 유지하고 수동 작업을 줄일 수 있습니다.</p>\n<p>기본 태그의 장점</p>\n<p></p>\n<ul>\n<li>일관성: 모든 리소스에 일관된 태그가 적용되도록 보장합니다.</li>\n<li>수동 작업 최소화: 리소스 간 반복되는 태그 정의를 피합니다.</li>\n</ul>\n<p>예를 들어 AWS 프로바이더에서 기본 태그를 설정하는 방법:</p>\n<pre><code class=\"hljs language-js\">provider <span class=\"hljs-string\">\"aws\"</span> {\n  default_tags {\n    tags = {\n      <span class=\"hljs-title class_\">Environment</span> = <span class=\"hljs-string\">\"Production\"</span>\n      <span class=\"hljs-title class_\">ManagedBy</span>   = <span class=\"hljs-string\">\"Terraform\"</span>\n    }\n  }\n}\n</code></pre>\n<p>기본 태그를 재정의하거나 추가 태그를 추가하는 방법은 리소스 레벨에서 태그 인수를 지정하여 수행할 수 있습니다.</p>\n<p></p>\n<p>이 인수는 제공자 수준에서 정의된 기본 태그보다 우선합니다.</p>\n<pre><code class=\"hljs language-js\">resource <span class=\"hljs-string\">\"aws_s3_bucket\"</span> <span class=\"hljs-string\">\"example\"</span> {\n  bucket = <span class=\"hljs-string\">\"my-bucket\"</span>\n\n  # 기본 환경 태그를 재정의하고 목적 태그 추가하기\n  tags = {\n    <span class=\"hljs-title class_\">Environment</span> = <span class=\"hljs-string\">\"Staging\"</span>\n    <span class=\"hljs-title class_\">Purpose</span>     = <span class=\"hljs-string\">\"Data Processing\"</span>\n  }\n}\n</code></pre>\n<p>이 예제에서는 환경 태그가 Staging 값으로 재정의되고, 목적 태그가 특히 해당 S3 버킷 리소스에 추가됩니다.</p>\n<p>ManagedBy 기본 태그는 여전히 적용됩니다.</p>\n<p></p>\n<p>자원 수준 태그 사용 사례</p>\n<ul>\n<li>환경별 태그 (dev, staging, prod 등)</li>\n<li>애플리케이션/프로젝트별 태그</li>\n<li>자원별 메타데이터 태그 (예: 목적, 소유자, 만료일)</li>\n<li>데이터 민감성에 따른 규정 준수 또는 규제 태그</li>\n<li>특정 자원에 대한 비용 할당 태그</li>\n</ul>\n<p>자원 수준에서 태그 재정의를 허용함으로써 기본 태그의 이점을 유지하면서 각 자원의 특정 요구 사항에 따라 태그를 유연하게 사용할 수 있습니다.</p>\n<h1>유연한 태깅을 위한 변수와 함수 사용:</h1>\n<p></p>\n<p>테라폼을 사용하면 태그를 변수로 정의하고 merge()와 같은 함수를 사용하여 다른 태그와 결합하여 재사용성과 유연성을 높일 수 있습니다.</p>\n<p>변수로 태그를 정의하기:</p>\n<pre><code class=\"hljs language-js\">variable <span class=\"hljs-string\">\"default_tags\"</span> {\n  <span class=\"hljs-keyword\">default</span> = {\n    <span class=\"hljs-title class_\">Environment</span> = <span class=\"hljs-string\">\"Production\"</span>\n    <span class=\"hljs-title class_\">ManagedBy</span>   = <span class=\"hljs-string\">\"Terraform\"</span>\n  }\n}\n</code></pre>\n<p>merge() 함수를 사용하여 태그를 결합하는 방법:</p>\n<p></p>\n<pre><code class=\"hljs language-kotlin\">resource <span class=\"hljs-string\">\"aws_instance\"</span> <span class=\"hljs-string\">\"example\"</span> {\n  ami           = <span class=\"hljs-string\">\"ami-0c94855ba95c71c99\"</span>\n  instance_type = <span class=\"hljs-string\">\"t2.micro\"</span>\n\n  tags = merge(\n    <span class=\"hljs-keyword\">var</span>.default_tags,\n    {\n      Name    = <span class=\"hljs-string\">\"ExampleInstance\"</span>\n      Project = <span class=\"hljs-string\">\"MyApp\"</span>\n    }\n  )\n}\n</code></pre>\n<p>merge() 함수는 default_tags 변수와 추가적인 리소스별 태그를 결합하여 모든 네 가지 태그가 EC2 인스턴스에 적용되도록 합니다.</p>\n<h1>특별한 경우 처리:</h1>\n<p>일부 AWS 리소스는 특정한 태깅 구성이 필요하거나 태그 적용 방법에 제한이 있는 경우가 있습니다.</p>\n<p></p>\n<p>태깅 자동 스케일링 그룹:</p>\n<p>자동 스케일링 그룹 ASG 및 시작 템플릿 LT를 올바르게 태그 지정하는 것이 까다로울 수 있습니다.</p>\n<p>올바른 구성이 없으면 ASG 및 LT에 의해 시작된 EC2 인스턴스 및 연결된 저장소 볼륨에는 기본 태그가 첨부되지 않을 수 있습니다.</p>\n<p>ASG는 propagate_at_launch 태그 구성이 필요합니다.</p>\n<p></p>\n<pre><code class=\"hljs language-js\">리소스 <span class=\"hljs-string\">\"aws_autoscaling_group\"</span> <span class=\"hljs-string\">\"example\"</span> {\n  # ...\n  tag {\n    key                 = <span class=\"hljs-string\">\"Environment\"</span>\n    value               = <span class=\"hljs-string\">\"Production\"</span>\n    propagate_at_launch = <span class=\"hljs-literal\">true</span>\n  }\n}\n</code></pre>\n<p>런치 템플릿 태깅:</p>\n<p>런치 템플릿은 tag_specifications 구성을 필요로 합니다:</p>\n<pre><code class=\"hljs language-js\">리소스 <span class=\"hljs-string\">\"aws_launch_template\"</span> <span class=\"hljs-string\">\"example\"</span> {\n  # ...\n\n tag_specifications {\n    resource_type = <span class=\"hljs-string\">\"instance\"</span>\n    tags = {\n      <span class=\"hljs-title class_\">Environment</span> = <span class=\"hljs-string\">\"Production\"</span>\n      <span class=\"hljs-title class_\">ManagedBy</span>   = <span class=\"hljs-string\">\"Terraform\"</span>\n    }\n  }\n  tag_specifications {\n    resource_type = <span class=\"hljs-string\">\"volume\"</span>\n    tags = {\n      <span class=\"hljs-title class_\">Persistence</span> = <span class=\"hljs-string\">\"Permanent\"</span>\n    }\n  }\n}\n</code></pre>\n<p></p>\n<p>EBS 볼륨 태그 설정하기:</p>\n<p>테라폼을 사용하여 Elastic Compute (EC2) 인스턴스를 생성할 때, EC2에 연결된 Elastic Block Store (EBS) 볼륨은 자동으로 태그가 되지 않습니다. 태그되지 않은 EBS 볼륨은 관리가 어렵습니다.</p>\n<p>연결된 EBS 스토리지 볼륨에 EC2 기본 태그를 할당하려면 aws_instance의 volume_tags를 사용하세요.</p>\n<pre><code class=\"hljs language-js\">resource <span class=\"hljs-string\">\"aws_instance\"</span> <span class=\"hljs-string\">\"example\"</span> {\n  # ...\n\n volume_tags = {\n    <span class=\"hljs-title class_\">Name</span>        = <span class=\"hljs-string\">\"DataVolume\"</span>\n    <span class=\"hljs-title class_\">Persistence</span> = <span class=\"hljs-string\">\"Permanent\"</span>\n  }\n}\n</code></pre>\n<p></p>\n<p>기타 특수 사례:</p>\n<p>일부 리소스는 AMI, NAT 게이트웨이 또는 VPC 엔드포인트와 같이 특정 태그 지정 요구 사항이나 제한 사항이 있을 수 있습니다.</p>\n<p>다양한 리소스 유형에 대한 태그 구성에 대한 최신 지침은 항상 Terraform 제공 업체 문서를 참조하십시오.</p>\n<h1>흔한 실수 피하기:</h1>\n<p></p>\n<p>일관되지 않은 태그 명명 규칙:</p>\n<p>appid, app_role 및 AppPurpose과 같은 일관되지 않은 태그 키를 사용하면 태그를 사용하고 관리하기 어려워집니다.</p>\n<pre><code class=\"hljs language-js\">resource <span class=\"hljs-string\">\"aws_s3_bucket\"</span> <span class=\"hljs-string\">\"example\"</span> {\n  bucket = <span class=\"hljs-string\">\"my-bucket\"</span>\n  tags = {\n    appid     = <span class=\"hljs-string\">\"myapp\"</span>\n    app_role  = <span class=\"hljs-string\">\"data-processing\"</span>\n    <span class=\"hljs-title class_\">AppPurpose</span> = <span class=\"hljs-string\">\"logs\"</span>\n  }\n}\n</code></pre>\n<p>대신, 태그 키 명명을 명확히 정의하고 그 규칙을 준수하도록 유도하세요.</p>\n<p></p>\n<p>모든 AWS 리소스를 태그하지 않는 경우, EBS 볼륨과 같은 보조 또는 보완 리소스를 포함해서 태그하지 않는 것은 완전한 시각성과 비용 추적을 할 수 없게 됩니다.</p>\n<pre><code class=\"hljs language-js\">resource <span class=\"hljs-string\">\"aws_instance\"</span> <span class=\"hljs-string\">\"example\"</span> {\n  ami           = <span class=\"hljs-string\">\"ami-0c94855ba95c71c99\"</span>\n  instance_type = <span class=\"hljs-string\">\"t2.micro\"</span>\n  tags = {\n    <span class=\"hljs-title class_\">Environment</span> = <span class=\"hljs-string\">\"Production\"</span>\n  }\n}\n</code></pre>\n<p>동일한 기본 및 리소스 태그 문제:</p>\n<p></p>\n<p>default_tags 및 리소스 tags에 동일한 tag 키 및 값이 있는 경우, Terraform에서 오류가 발생하여 태그를 중복으로 지우거나 우회 방법을 사용해야 합니다.</p>\n<pre><code class=\"hljs language-js\">provider <span class=\"hljs-string\">\"aws\"</span> {\n  default_tags {\n    tags = {\n      <span class=\"hljs-title class_\">Name</span> = <span class=\"hljs-string\">\"Example\"</span>\n    }\n  }\n}\n\nresource <span class=\"hljs-string\">\"aws_vpc\"</span> <span class=\"hljs-string\">\"example\"</span> {\n  tags = {\n    <span class=\"hljs-title class_\">Name</span> = <span class=\"hljs-string\">\"Example\"</span> # 오류: 태그가 동일함\n    }\n}\n</code></pre>\n<p>부분적인 태그 일치를 위한 영구 차이:</p>\n<p>default_tags 및 리소스 tags가 일부 일치하고 다른 태그가 있는 경우, Terraform은 일치하는 태그를 업데이트하려고 계획할 때마다 영구적인 차이를 표시하여 우회 방법이 필요합니다.</p>\n<p></p>\n<pre><code class=\"hljs language-js\">provider <span class=\"hljs-string\">\"aws\"</span> {\n  default_tags {\n    tags = {\n      <span class=\"hljs-title class_\">Match1</span> = <span class=\"hljs-string\">\"A\"</span>\n      <span class=\"hljs-title class_\">Match2</span> = <span class=\"hljs-string\">\"B\"</span>\n      <span class=\"hljs-title class_\">NoMatch</span> = <span class=\"hljs-string\">\"X\"</span>\n    }\n  }\n}\n\nresource <span class=\"hljs-string\">\"aws_vpc\"</span> <span class=\"hljs-string\">\"example\"</span> {\n  tags = {\n    <span class=\"hljs-title class_\">Match1</span> = <span class=\"hljs-string\">\"A\"</span> # <span class=\"hljs-title class_\">Perpetual</span> diff trying\n    <span class=\"hljs-title class_\">Match2</span> = <span class=\"hljs-string\">\"B\"</span> # to update these\n    <span class=\"hljs-title class_\">NoMatch</span> = <span class=\"hljs-string\">\"Y\"</span>\n  }\n}\n</code></pre>\n<p>인프라스트럭처 드리프트와 태그 손실:</p>\n<p>외부에서 Terraform 이외의 방법을 사용하여 리소스를 수정할 때 인프라스트럭처 드리프트로 인해 태그가 손실됩니다. IaC를 일관되게 사용하면이 문제를 완화할 수 있습니다.</p>\n<h1>Best Practices and Tips:</h1>\n<p></p>\n<p>명확한 태깅 전략과 명명 규칙을 수립해야 합니다:</p>\n<p>인프라 전반에 걸쳐 사용할 일관된 태그 키와 명명 규칙을 정의하세요.</p>\n<pre><code class=\"hljs language-js\">variable <span class=\"hljs-string\">\"tag_names\"</span> {\n  <span class=\"hljs-keyword\">default</span> = {\n    environment = <span class=\"hljs-string\">\"환경\"</span>\n    application = <span class=\"hljs-string\">\"응용 프로그램\"</span>\n    team        = <span class=\"hljs-string\">\"팀\"</span>\n    costcenter  = <span class=\"hljs-string\">\"비용 센터\"</span>\n  }\n}\n</code></pre>\n<p>리소스를 프로비저닝할 때 (나중에가 아니라) 태그를 추가하세요:</p>\n<p></p>\n<p>리소스를 프로비저닝하는 과정에서 태그를 적용하세요. 이렇게 하면 시작부터 일관된 태깅이 가능합니다.</p>\n<pre><code class=\"hljs language-js\">resource <span class=\"hljs-string\">\"aws_s3_bucket\"</span> <span class=\"hljs-string\">\"example\"</span> {\n  bucket = <span class=\"hljs-string\">\"my-bucket\"</span>\n  tags = {\n    (<span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">tag_names</span>.<span class=\"hljs-property\">environment</span>) = <span class=\"hljs-string\">\"Production\"</span>\n    (<span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">tag_names</span>.<span class=\"hljs-property\">application</span>) = <span class=\"hljs-string\">\"MyApp\"</span>\n  }\n}\n</code></pre>\n<p>태그를 정기적으로 검토하고 감사하세요:</p>\n<p>주기적으로 리소스 태그를 검토하고 감사하여 태깅 전략을 준수하며 누락된 태그 또는 잘못된 태그를 식별합니다.</p>\n<p></p>\n<p>프로비저닝 중에 가능한 경우 태그 자동 적용을 자동화하세요:</p>\n<p>테라폼의 default_tags, 변수, 및 기능과 같은 기능을 활용하여 프로비저닝 중에 태그를 자동으로 적용하여 수동 노력을 줄이고 일관성을 유지하세요.</p>\n<h1>AWS 리소스 그룹 및 태그 편집기:</h1>\n<p>모든 리전에 있는 모든 AWS 리소스에서 team=<code>platform engineering</code> 태그가 있는 리소스를 찾아볼 수 있다면 어떨까요?</p>\n<p></p>\n<p>AWS 리소스 그룹 및 태그 편집기는 여러 AWS 리소스 및 지역에 걸쳐 태그를 효과적으로 관리할 수 있는 강력한 도구입니다.</p>\n<p>리소스 그룹:</p>\n<p>리소스 그룹은 공유된 태그를 기반으로 AWS 리소스 모음을 구성하고 관리할 수 있는 중앙화된 방법을 제공합니다. 리소스 그룹을 사용하면 다음과 같은 작업을 수행할 수 있습니다:</p>\n<ul>\n<li>특정 태그(예: team=<code>platform engineering</code>)가 적용된 지역 전체의 리소스를 찾을 수 있습니다.</li>\n<li>태그가 누락되었거나 잘못된 태그 값이 있는 리소스를 식별할 수 있습니다.</li>\n<li>리소스 그룹 멤버십에 따라 인스턴스 시작/중지 또는 구성 적용과 같은 작업을 자동화할 수 있습니다.</li>\n<li>그룹 내에서 리소스 상태, 비용 및 구성에 대한 종합적인 정보를 확인할 수 있습니다.</li>\n</ul>\n<p></p>\n<p>태그 편집기:</p>\n<p>태그 편집기는 지원되는 AWS 서비스 및 지역 전체에 걸쳐 대량 태깅 작업을 가능하게 하는 리소스 그룹의 구성 요소입니다. 태그 편집기를 사용하면 다음을 수행할 수 있습니다:</p>\n<ul>\n<li>리소스 유형 및 기존 태그에 기반한 리소스 검색을 통해 \"팀=<code>플랫폼 엔지니어링</code>인 모든 EC2 인스턴스 찾기\"와 같은 쿼리를 실행할 수 있습니다.</li>\n<li>여러 리소스에 대해 태그를 추가, 수정 또는 제거하여 태깅 노력을 효율화할 수 있습니다.</li>\n<li>변경 사항을 적용하기 전에 미리 보기를 통해 정확성을 확인하고 의도하지 않은 수정을 피할 수 있습니다.</li>\n<li>태그 기반의 액세스 제어 정책을 사용하여 태그 값에 기반한 리소스 액세스를 관리할 수 있습니다.</li>\n</ul>\n<h1>🔚 결론:</h1>\n<p></p>\n<p>마크다운 형식으로 테이블 태그를 써야 해요.</p>\n<p>AWS 설정이 조직적이고 비용 효율적으로 이루어지려면, Terraform의 태깅 도구를 사용하는 방법과 일반적인 실수를 피하는 법을 꼭 숙지해야 해요.</p>\n<p>읽어주셔서 감사해요! AWS 리소스에 태깅하는 방법에 대해 무언가 배웠으면 좋겠네요!</p>\n<p>다음에 또 만나요 🇵🇸 🎉</p>\n<p></p>\n<p>읽어 주셔서 감사합니다!! 🙌🏻😁📃 다음 블로그에서 만나요.🤘🇵🇸</p>\n<p>🚀 끝까지 함께해 줘서 감사합니다. 이 블로그에 대한 질문/피드백이 있으시면 언제든지 연락해 주세요:</p>\n<p>♻️ 🇵🇸LinkedIn: <a href=\"https://www.linkedin.com/in/rajhi-saif/\" rel=\"nofollow\" target=\"_blank\">https://www.linkedin.com/in/rajhi-saif/</a></p>\n<p>♻️🇵🇸 Twitter: <a href=\"https://twitter.com/rajhisaifeddine\" rel=\"nofollow\" target=\"_blank\">https://twitter.com/rajhisaifeddine</a></p>\n<p></p>\n<p>제공해주셔서 감사합니다 ✌🏻</p>\n<h1>🔰 계속해서 학습해요!! 지식을 나눠요 !! 🔰</h1>\n<h1>참고 문헌:</h1>\n</body>\n</html>\n"},"__N_SSG":true}