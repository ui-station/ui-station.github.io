{"pageProps":{"post":{"title":"OCI에서 Active Directory 게임을 실행하는 방법  1부","description":"","date":"2024-06-19 13:32","slug":"2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1","content":"\n제가 정말 즐겁게 즐겼던 프로젝트 중 하나는 GOAD입니다. 게임 오브 스로운즈 팬으로서 사이버 지식을 시험하고 동시에 즐길 수 있는 수단이었습니다. 만약 여러분이 스로운즈의 팬이라면, 이 Windows/AD/SCCM 랩은 여러분을 위한 것입니다.\n\n처음에는 중첩 가상화 서버를 만들려고 했는데, 테라폼과 앤서블 지식이 거의 없어서 어려움을 겪었습니다. 하지만 저는 자동화로 나아가기로 결정했습니다. 일상적인 작업에서 시간을 절약하고, 올바르게 구현된다면 인간 에러를 줄일 수 있기 때문에 자동화가 많은 도움이 된다는 점에 동의합니다.\n\n`Game of Active Directory (GOAD)` 프로젝트는 현실적이고 실용적인 경험을 통해 사이버 보안 기술을 향상시키는 포괄적인 랩 환경입니다. Oracle Cloud Infrastructure (OCI)에서 호스팅되며, 다양한 OCI 서비스와 통합하여 현실 세계의 보안 시나리오를 모의할 수 있습니다.\n\nhttps://github.com/adibirzu/GOAD/blob/main/docs/install_with_oci.md\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n랩 환경으로서 VCN 보안 목록에서 엄격한 ACL을 구현하지는 않았어요. 그러나 모든 포트에서 192.168.0.0/16에서의 액세스는 허용했어요.\n\n1- 우리는 OCI의 Windows Server/Ubuntu 이미지를 사용할 거에요. 이 선택은 PAYG 요금제를 사용해. Windows Server 평가판을 사용할 계획이라면, 자체 이미지를 빌드하고 테라폼 스크립트를 사용자 정의 이미지 OCID로 설정해야 해요:\n\nOracle Cloud Infrastructure 이미지\n\n2- 테라폼 스크립트와 PowerShell 스크립트는 ad →GOAD →providers →OCI 하위에 추가됐어요.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n![Screenshot](/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_0.png)\n\n```js\n./goad.sh -t check -l GOAD -p oci -m local\n```\n\n3- 서로 다른 공급업체에서 사용자들이 알고 있는 동일한 워크플로를 제공하기 위해 goad.sh 스크립트에 제공자로 oci를 추가했습니다.\n\n![Screenshot](/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_1.png)\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nOCI에서 우분투의 기본 사용자는 ubuntu이므로 goad.sh의 모든 참조는 ubuntu 사용자를 사용할 것입니다:\n\n![2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_2](/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_2.png)\n\n4. 스크립트 아래에, 저는 설치 후 우분투 서버의 선행 조건을 설치하기 위해 setup_oci.sh 스크립트를 만들었습니다.\n\n![2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_3](/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_3.png)\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n5- 오라클 클라우드 인프라에서 랩을 프로비저닝하는 방법을 설명하는 docs/install_with_oci.md를 업데이트했습니다.\n\n6- ad →GOAD →providers →oci →ssh_keys →ubuntu-jumpox.pem에 개인 키를 배치하여 Ubuntu 인스턴스에 연결을 테스트했습니다.\n\n!!!! 이 키를 매우 주의해서 다루고, git에 공개하지 마세요.\n\n![이미지](/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_4.png)\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n테이블 태그를 마크다운 형식으로 변경하였습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n9- ad → GOAD → providers → oci → terraform 폴더에 Terraform/PowerShell 파일을 만들어주세요:\n\n- windows_cloud_init.ps1\n\n```powershell\n# 변수\n$adminUsername = “ansible”\n$adminPassword = ConvertTo-SecureString “YourSecurePassword123!” -AsPlainText -Force\n\n# ansible 사용자 생성\nNew-LocalUser $adminUsername -Password $adminPassword -FullName $adminUsername -Description “Ansible admin user”\nAdd-LocalGroupMember -Group “Administrators” -Member $adminUsername\n\n# WinRM 활성화\nwinrm quickconfig -q\nwinrm set winrm/config/service/auth @{Basic=”true”}\nwinrm set winrm/config/service @{AllowUnencrypted=”true”}\nwinrm set winrm/config/service @{EnableCompatibilityHttpsListener=”true”}\nwinrm set winrm/config/service @{EnableCompatibilityHttpListener=”true”}\n$cert = New-SelfSignedCertificate -DnsName $(hostname) -CertStoreLocation Cert:\\LocalMachine\\My\nwinrm create winrm/config/Listener?Address=*+Transport=HTTPS @{Hostname=$(hostname); CertificateThumbprint=$($cert.Thumbprint)}\nSet-Service -Name winrm -StartupType Automatic\nStart-Service -Name winrm\n\n# WinRM을 위한 기본 인증 및 암호화 트래픽 활성화\nSet-Item -Path WSMan:\\localhost\\Service\\Auth\\Basic -Value $true\nSet-Item -Path WSMan:\\localhost\\Service\\AllowUnencrypted -Value $true\n\n# WinRM 방화벽 예외 설정\nNew-NetFirewallRule -Name \"WinRM-HTTP\" -DisplayName \"WinRM (HTTP-In)\" -Protocol TCP -LocalPort 5985 -Action Allow -Enabled True\nNew-NetFirewallRule -Name \"WinRM-HTTPS\" -DisplayName \"WinRM (HTTPS-In)\" -Protocol TCP -LocalPort 5986 -Action Allow -Enabled True\n\n# TLS 1.2 프로토콜 설정\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\n\n# NuGet 공급자 설치 및 PowerShellGet 업데이트\nInstall-PackageProvider -Name NuGet -Force -Confirm:$false\nUpdate-Module -Name PowerShellGet -Force -AllowClobber -Confirm:$false\n```\n\n- profile.tf\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nprovider \"oci\" {\n  tenancy_ocid      = var.tenancy_ocid\n  user_ocid         = var.user_ocid\n  fingerprint       = var.fingerprint\n  private_key_path  = var.private_key_path\n  region            = var.region\n}\n```\n\nvariables.tf\n\n```js\nvariable \"tenancy_ocid\" {\n  description = \"The OCID of your tenancy.\"\n  type        = string\n}\n\nvariable \"user_ocid\" {\n  description = \"The OCID of the user calling the API.\"\n  type        = string\n}\n\nvariable \"fingerprint\" {\n  description = \"The fingerprint of the API key.\"\n  type        = string\n}\n\nvariable \"private_key_path\" {\n  description = \"The path to the private key.\"\n  type        = string\n  default     = \"/Users/abirzu/.ssh/newpemkey.pem\"\n}\n\nvariable \"region\" {\n  description = \"The region to use.\"\n  type        = string\n  default     = \"eu-frankfurt-1\"\n}\n\nvariable \"compartment_ocid\" {\n  description = \"The OCID of the compartment to use.\"\n  type        = string\n}\n\nvariable \"availability_domain\" {\n  description = \"The availability domain to use.\"\n  type        = string\n  default     = \"NoEK:EU-FRANKFURT-1-AD-1\"\n}\n\nvariable \"shape\" {\n  description = \"The shape of the instance to be created.\"\n  type        = string\n  default     = \"VM.Standard.E5.Flex\"\n}\n\nvariable \"ocpus\" {\n  description = \"The number of OCPUs to allocate.\"\n  type        = number\n  default     = 1\n}\n\nvariable \"memory_in_gbs\" {\n  description = \"The amount of memory in GBs.\"\n  type        = number\n  default     = 12\n}\n\nvariable \"ssh_authorized_keys\" {\n  description = \"The public key for SSH access to the instances.\"\n  type        = string\n}\n\nvariable \"image_ocid\" {\n  description = \"The OCID of the image to use.\"\n  type        = string\n}\n\nvariable \"windows2016_image_ocid\" {\n  description = \"The OCID of the Windows Server 2016 image.\"\n  type        = string\n}\n\nvariable \"windows2019_image_ocid\" {\n  description = \"The OCID of the Windows Server 2019 image.\"\n  type        = string\n}\n```\n\nnetwork.tf\n\n```js\n\n```\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nresource “oci_core_vcn” “generated_oci_core_vcn” {\n cidr_block = “192.168.0.0/16”\n compartment_id = var.compartment_ocid\n display_name = “goad-virtual-network”\n dns_label = “goadvcn”\n}\nresource “oci_core_subnet” “public_subnet” {\n cidr_block = “192.168.57.0/24”\n compartment_id = var.compartment_ocid\n display_name = “public-subnet”\n dns_label = “publicsubnet”\n vcn_id = oci_core_vcn.generated_oci_core_vcn.id\n route_table_id = oci_core_route_table.public_route_table.id\n}\nresource “oci_core_subnet” “private_subnet” {\n cidr_block = “192.168.56.0/24”\n compartment_id = var.compartment_ocid\n display_name = “private-subnet”\n dns_label = “privatesubnet”\n vcn_id = oci_core_vcn.generated_oci_core_vcn.id\n route_table_id = oci_core_route_table.private_route_table.id\n prohibit_internet_ingress = true\n prohibit_public_ip_on_vnic = true\n security_list_ids = [oci_core_security_list.winrm_rdp_security_list.id]\n}\nresource “oci_core_internet_gateway” “generated_oci_core_internet_gateway” {\n compartment_id = var.compartment_ocid\n display_name = “Internet Gateway goad-virtual-network”\n enabled = true\n vcn_id = oci_core_vcn.generated_oci_core_vcn.id\n}\nresource “oci_core_nat_gateway” “generated_oci_core_nat_gateway” {\n compartment_id = var.compartment_ocid\n display_name = “NAT Gateway goad-virtual-network”\n vcn_id = oci_core_vcn.generated_oci_core_vcn.id\n}\nresource “oci_core_route_table” “public_route_table” {\n compartment_id = var.compartment_ocid\n vcn_id = oci_core_vcn.generated_oci_core_vcn.id\n display_name = “public-route-table”\nroute_rules {\n destination = “0.0.0.0/0”\n destination_type = “CIDR_BLOCK”\n network_entity_id = oci_core_internet_gateway.generated_oci_core_internet_gateway.id\n }\n}\nresource “oci_core_route_table” “private_route_table” {\n compartment_id = var.compartment_ocid\n vcn_id = oci_core_vcn.generated_oci_core_vcn.id\n display_name = “private-route-table”\nroute_rules {\n destination = “0.0.0.0/0”\n destination_type = “CIDR_BLOCK”\n network_entity_id = oci_core_nat_gateway.generated_oci_core_nat_gateway.id\n }\n}\n  options {\n    type                  = \"DomainNameServer\"\n    server_type           = \"CustomDnsServer\"\n    custom_dns_servers    = [\"192.168.56.10\",\"8.8.8.8\"]\n  }\n options {\n        type = \"SearchDomain\"\n        search_domain_names = [ \"sevenkingdoms.local\" ]\n    }\n}\nresource “oci_core_security_list” “winrm_rdp_security_list” {\n compartment_id = var.compartment_ocid\n vcn_id = oci_core_vcn.generated_oci_core_vcn.id\n display_name = “winrm_rdp_security_list”\negress_security_rules {\n protocol = “all”\n destination = “0.0.0.0/0”\n stateless = false\n }\ningress_security_rules {\n protocol = “all”\n source = “192.168.0.0/16”\n stateless = false\n }\n}\n```\n\n```js\nresource “oci_core_default_dhcp_options” “default_dhcp_options” {\n manage_default_resource_id = oci_core_vcn.generated_oci_core_vcn.default_dhcp_options_id\noptions {\n type = “DomainNameServer”\n server_type = “CustomDnsServer”\n custom_dns_servers = [“192.168.56.10”]\n search_domain_names = [“sevenkingdoms.local”]\n }\n```\n\nThe DHCP configuration part is essential, as if it’s not properly configured, it will result in the failure of the ansible jobs. If the terraform variable will not add the search domain, you need to do this manually:\n\nGo to the VCN → DHCP Options:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n<img src=\"/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_7.png\" />\n\n화면 오른쪽 상단에 있는 3 점을 클릭한 후 편집을 선택하세요. 여기에서 외부 DNS 서버를 추가하고 사용자 정의 검색 도메인인 Seven Kingdoms를 추가할 수 있습니다.\n\n<img src=\"/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_8.png\" />\n\n이 부분에서 DNS 문제를 해결해야합니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\noptions {\ntype = \"도메인 네임 서버\"\nserver_type = \"사용자 정의 DNS 서버\"\ncustom_dns_servers = [\"192.168.56.10\",\"8.8.8.8\"]\n}\noptions {\ntype = \"검색 도메인\"\nsearch_domain_names = [\"seven kingdoms.local\"]\n}\n```\n\njumpbox.tf\n\n```js\nresource \"oci_core_instance\" \"jumpbox\" {\n availability_domain = var.availability_domain\n compartment_id = var.compartment_ocid\n display_name = \"jumpbox\"\n shape = var.shape\nshape_config {\n baseline_ocpu_utilization = \"BASELINE_1_1\"\n memory_in_gbs = var.memory_in_gbs\n ocpus = var.ocpus\n }\nsource_details {\n source_id = var.image_ocid\n source_type = \"이미지\"\n }\n#이미지 OCID’S https://docs.oracle.com/en-us/iaas/images/image/bd616d0a-fae4-490e-bd31-a9406095b844/\n create_vnic_details {\n assign_ipv6ip = false\n assign_private_dns_record = true\n assign_public_ip = true\n subnet_id = oci_core_subnet.public_subnet.id\n }\nmetadata = {\n ssh_authorized_keys = var.ssh_authorized_keys\n }\nagent_config {\n is_management_disabled = false\n is_monitoring_disabled = false\nplugins_config {\n desired_state = \"사용 안 함\"\n name = \"취약점 스캐닝\"\n }\n plugins_config {\n desired_state = \"사용 안 함\"\n name = \"관리 에이전트\"\n }\n plugins_config {\n desired_state = \"사용함\"\n name = \"사용자 지정 로그 모니터링\"\n }\n plugins_config {\n desired_state = \"사용 안 함\"\n name = \"컴퓨팅 RDMA GPU 모니터링\"\n }\n plugins_config {\n desired_state = \"사용함\"\n name = \"컴퓨팅 인스턴스 모니터링\"\n }\n plugins_config {\n desired_state = \"사용 안 함\"\n name = \"컴퓨팅 HPC RDMA 자동 구성\"\n }\n plugins_config {\n desired_state = \"사용 안 함\"\n name = \"컴퓨팅 HPC RDMA 인증\"\n }\n plugins_config {\n desired_state = \"사용함\"\n name = \"클라우드 가드 워크로드 보호\"\n }\n plugins_config {\n desired_state = \"사용 안 함\"\n name = \"블록 볼륨 관리\"\n }\n plugins_config {\n desired_state = \"사용 안 함\"\n name = \"바스천\"\n }\n }\navailability_config {\n is_live_migration_preferred = true\n recovery_action = \"인스턴스 복원\"\n }\nplatform_config {\n is_symmetric_multi_threading_enabled = true\n type = \"AMD_VM\"\n }\ninstance_options {\n are_legacy_imds_endpoints_disabled = false\n }\n}\n```\n\nwindowsvm.tf\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\n리소스 \"oci_core_instance\" \"windows_instance\" {\n for_each = {\n kingslanding = {\n name = \"kingslanding\"\n private_ip_address = \"192.168.56.10\"\n admin_username = \"ansible\"\n admin_password = \"8dCT-DJjgScp\"\n image_ocid = var.windows2019_image_ocid\n }\n winterfell = {\n name = \"winterfell\"\n private_ip_address = \"192.168.56.11\"\n admin_username = \"ansible\"\n admin_password = \"NgtI75cKV+Pu\"\n image_ocid = var.windows2019_image_ocid\n }\n castelblack = {\n name = \"castelblack\"\n private_ip_address = \"192.168.56.22\"\n admin_username = \"ansible\"\n admin_password = \"NgtI75cKV+Pu\"\n image_ocid = var.windows2019_image_ocid\n }\n meereen = {\n name = \"meereen\"\n private_ip_address = \"192.168.56.12\"\n admin_username = \"ansible\"\n admin_password = \"Ufe-bVXSx9rk\"\n image_ocid = var.windows2016_image_ocid\n }\n braavos = {\n name = \"braavos\"\n private_ip_address = \"192.168.56.23\"\n admin_username = \"ansible\"\n admin_password = \"978i2pF43UJ-\"\n image_ocid = var.windows2016_image_ocid\n }\n }\navailability_domain = var.availability_domain\n compartment_id = var.compartment_ocid\n display_name = each.value.name\n shape = \"VM.Standard.E5.Flex\"\nshape_config {\n ocpus = 2\n memory_in_gbs = 32\n }\nsource_details {\n source_id = each.value.image_ocid\n source_type = \"image\"\n }\ncreate_vnic_details {\n assign_ipv6ip = false\n assign_private_dns_record = true\n assign_public_ip = false\n subnet_id = oci_core_subnet.private_subnet.id\n hostname_label = each.value.name\n private_ip = each.value.private_ip_address\n }\nmetadata = {\n user_data = base64encode(file(\"${path.module}/windows_cloud_init.ps1\"))\n admin_password = each.value.admin_password\n }\n}\n```\n\noutputs.tf\n\n```js\noutput \"ubuntu_jumpbox_ip\" {\n value = oci_core_instance.jumpbox.public_ip\n}\noutput \"windows_instance_opc_passwords\" {\n value = { for k, v in oci_core_instance.windows_instance : k => v.metadata.admin_password }\n sensitive = true\n}\n```\n\n프로비저닝 중 발생한 일반적인 오류입니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n다음과 같이 Markdown 형식에 맞게 표 태그를 변경하십시오.\n\n![이미지](/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_9.png)\n\n모든 TF가 생성된 후, GOAD git 저장소가 정상적으로 동기화된 경우 다음을 실행해야 합니다:\n\nabirzu@abirzu-mac GOAD % ./goad.sh -t destroy -l GOAD -p oci -m local\n\n모든 서버가 가동되고 작동 중인 것을 확인할 수 있습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n<img src=\"/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_10.png\" />\n\n축하합니다! 환경이 작동 중에 있습니다.\n\n# 서버\n\n이 랩은 실제로 다섯 개의 가상 머신으로 구성되어 있습니다:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- kingslanding: DC01는 Windows Server 2019에서 실행 중입니다(기본으로 windefender가 활성화됨)\n- winterfell: DC02는 Windows Server 2019에서 실행 중입니다(기본으로 windefender가 활성화됨)\n- castelblack: SRV02는 Windows Server 2019에서 실행 중입니다(windefender가 기본적으로 비활성화됨)\n- meereen: DC03은 Windows Server 2016에서 실행 중입니다(기본으로 windefender가 활성화됨)\n- braavos: SRV03은 Windows Server 2016에서 실행 중입니다(기본으로 windefender가 활성화됨)\n\n도메인: north.sevenkingdoms.local\n\n- winterfell: DC01\n- castelblack: SRV02: MSSQL / IIS\n\n도메인: sevenkingdoms.local\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- kingslanding: DC02\n- castelrock: SRV01 (자원 부족으로 비활성화됨)\n\n# 도메인: essos.local\n\n- braavos: DC03\n- meeren: SRV03: MSSQL / ADCS\n\n인터넷에서 몇 가지 가이드를 따르거나 자신만의 방법을 찾아 시작할 수 있습니다!\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nAD | Mayfly (mayfly277.github.io)\n\nSolving Game of Active Directory (GOAD) by Orange Cyberdefense Part-1 | by n00🔑 | Medium\n\n제1부에서는 OCI에서 GOAD 랩을 만드는 방법을 소개했고, 다음 부분에서는 다음에 초점을 맞출 것입니다:\n\nOCI 통합:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n1. OCI Management Agent:\n\n- 설명: 클라우드 작업을 자동화하고 모니터링합니다.\n- 통합: GOAD 환경 내 자원의 배포 및 관리를 간소화합니다.\n\n2. Sysmon 및 로깅 분석:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n• 설명: Sysmon은 시스템 활동을 기록하여 침입 탐지를 지원합니다.\n\n• 통합: Sysmon 이벤트를 수집하고 OCI Logging Analytics로 전송하여 고급 로그 분석 및 시각화를 지원합니다. 자세한 내용은 여기에서 확인하세요.\n\n3. Arkime 통합:\n\n• 설명: Arkime은 오픈 소스 패킷 캡처 및 검색 도구입니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n• 통합: 효율적인 데이터 색인 및 검색을 위해 OCI OpenSearch를 활용합니다. 자세한 내용은 여기에서 확인할 수 있습니다.\n\n4. 클라우드 가드 인스턴스 보안:\n\n• 설명: 클라우드 가드는 포괄적인 클라우드 보안 관리를 제공합니다.\n\n• 통합: 로깅 분석을 활용하여 인스턴스 보안을 강화하며 실시간 위협 감지 및 대응이 가능합니다. 더 많은 정보는 여기에서 확인할 수 있습니다.\n","ogImage":{"url":"/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_0.png"},"coverImage":"/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_0.png","tag":["Tech"],"readingTime":20},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p>제가 정말 즐겁게 즐겼던 프로젝트 중 하나는 GOAD입니다. 게임 오브 스로운즈 팬으로서 사이버 지식을 시험하고 동시에 즐길 수 있는 수단이었습니다. 만약 여러분이 스로운즈의 팬이라면, 이 Windows/AD/SCCM 랩은 여러분을 위한 것입니다.</p>\n<p>처음에는 중첩 가상화 서버를 만들려고 했는데, 테라폼과 앤서블 지식이 거의 없어서 어려움을 겪었습니다. 하지만 저는 자동화로 나아가기로 결정했습니다. 일상적인 작업에서 시간을 절약하고, 올바르게 구현된다면 인간 에러를 줄일 수 있기 때문에 자동화가 많은 도움이 된다는 점에 동의합니다.</p>\n<p><code>Game of Active Directory (GOAD)</code> 프로젝트는 현실적이고 실용적인 경험을 통해 사이버 보안 기술을 향상시키는 포괄적인 랩 환경입니다. Oracle Cloud Infrastructure (OCI)에서 호스팅되며, 다양한 OCI 서비스와 통합하여 현실 세계의 보안 시나리오를 모의할 수 있습니다.</p>\n<p><a href=\"https://github.com/adibirzu/GOAD/blob/main/docs/install_with_oci.md\" rel=\"nofollow\" target=\"_blank\">https://github.com/adibirzu/GOAD/blob/main/docs/install_with_oci.md</a></p>\n<p></p>\n<p>랩 환경으로서 VCN 보안 목록에서 엄격한 ACL을 구현하지는 않았어요. 그러나 모든 포트에서 192.168.0.0/16에서의 액세스는 허용했어요.</p>\n<p>1- 우리는 OCI의 Windows Server/Ubuntu 이미지를 사용할 거에요. 이 선택은 PAYG 요금제를 사용해. Windows Server 평가판을 사용할 계획이라면, 자체 이미지를 빌드하고 테라폼 스크립트를 사용자 정의 이미지 OCID로 설정해야 해요:</p>\n<p>Oracle Cloud Infrastructure 이미지</p>\n<p>2- 테라폼 스크립트와 PowerShell 스크립트는 ad →GOAD →providers →OCI 하위에 추가됐어요.</p>\n<p></p>\n<p><img src=\"/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_0.png\" alt=\"Screenshot\"></p>\n<pre><code class=\"hljs language-js\">./goad.<span class=\"hljs-property\">sh</span> -t check -l <span class=\"hljs-variable constant_\">GOAD</span> -p oci -m local\n</code></pre>\n<p>3- 서로 다른 공급업체에서 사용자들이 알고 있는 동일한 워크플로를 제공하기 위해 goad.sh 스크립트에 제공자로 oci를 추가했습니다.</p>\n<p><img src=\"/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_1.png\" alt=\"Screenshot\"></p>\n<p></p>\n<p>OCI에서 우분투의 기본 사용자는 ubuntu이므로 goad.sh의 모든 참조는 ubuntu 사용자를 사용할 것입니다:</p>\n<p><img src=\"/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_2.png\" alt=\"2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_2\"></p>\n<ol start=\"4\">\n<li>스크립트 아래에, 저는 설치 후 우분투 서버의 선행 조건을 설치하기 위해 setup_oci.sh 스크립트를 만들었습니다.</li>\n</ol>\n<p><img src=\"/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_3.png\" alt=\"2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_3\"></p>\n<p></p>\n<p>5- 오라클 클라우드 인프라에서 랩을 프로비저닝하는 방법을 설명하는 docs/install_with_oci.md를 업데이트했습니다.</p>\n<p>6- ad →GOAD →providers →oci →ssh_keys →ubuntu-jumpox.pem에 개인 키를 배치하여 Ubuntu 인스턴스에 연결을 테스트했습니다.</p>\n<p>!!!! 이 키를 매우 주의해서 다루고, git에 공개하지 마세요.</p>\n<p><img src=\"/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_4.png\" alt=\"이미지\"></p>\n<p></p>\n<p>테이블 태그를 마크다운 형식으로 변경하였습니다.</p>\n<p></p>\n<p>9- ad → GOAD → providers → oci → terraform 폴더에 Terraform/PowerShell 파일을 만들어주세요:</p>\n<ul>\n<li>windows_cloud_init.ps1</li>\n</ul>\n<pre><code class=\"hljs language-powershell\"><span class=\"hljs-comment\"># 변수</span>\n<span class=\"hljs-variable\">$adminUsername</span> = “ansible”\n<span class=\"hljs-variable\">$adminPassword</span> = <span class=\"hljs-built_in\">ConvertTo-SecureString</span> “YourSecurePassword123!” <span class=\"hljs-literal\">-AsPlainText</span> <span class=\"hljs-literal\">-Force</span>\n\n<span class=\"hljs-comment\"># ansible 사용자 생성</span>\n<span class=\"hljs-built_in\">New-LocalUser</span> <span class=\"hljs-variable\">$adminUsername</span> <span class=\"hljs-literal\">-Password</span> <span class=\"hljs-variable\">$adminPassword</span> <span class=\"hljs-literal\">-FullName</span> <span class=\"hljs-variable\">$adminUsername</span> <span class=\"hljs-literal\">-Description</span> “Ansible admin user”\n<span class=\"hljs-built_in\">Add-LocalGroupMember</span> <span class=\"hljs-literal\">-Group</span> “Administrators” <span class=\"hljs-literal\">-Member</span> <span class=\"hljs-variable\">$adminUsername</span>\n\n<span class=\"hljs-comment\"># WinRM 활성화</span>\nwinrm quickconfig <span class=\"hljs-literal\">-q</span>\nwinrm <span class=\"hljs-built_in\">set</span> winrm/config/service/auth <span class=\"hljs-selector-tag\">@</span>{Basic=”true”}\nwinrm <span class=\"hljs-built_in\">set</span> winrm/config/service <span class=\"hljs-selector-tag\">@</span>{AllowUnencrypted=”true”}\nwinrm <span class=\"hljs-built_in\">set</span> winrm/config/service <span class=\"hljs-selector-tag\">@</span>{EnableCompatibilityHttpsListener=”true”}\nwinrm <span class=\"hljs-built_in\">set</span> winrm/config/service <span class=\"hljs-selector-tag\">@</span>{EnableCompatibilityHttpListener=”true”}\n<span class=\"hljs-variable\">$cert</span> = <span class=\"hljs-built_in\">New-SelfSignedCertificate</span> <span class=\"hljs-literal\">-DnsName</span> <span class=\"hljs-variable\">$</span>(hostname) <span class=\"hljs-literal\">-CertStoreLocation</span> Cert:\\LocalMachine\\My\nwinrm create winrm/config/Listener?Address=*+Transport=HTTPS <span class=\"hljs-selector-tag\">@</span>{Hostname=<span class=\"hljs-variable\">$</span>(hostname); CertificateThumbprint=<span class=\"hljs-variable\">$</span>(<span class=\"hljs-variable\">$cert</span>.Thumbprint)}\n<span class=\"hljs-built_in\">Set-Service</span> <span class=\"hljs-literal\">-Name</span> winrm <span class=\"hljs-literal\">-StartupType</span> Automatic\n<span class=\"hljs-built_in\">Start-Service</span> <span class=\"hljs-literal\">-Name</span> winrm\n\n<span class=\"hljs-comment\"># WinRM을 위한 기본 인증 및 암호화 트래픽 활성화</span>\n<span class=\"hljs-built_in\">Set-Item</span> <span class=\"hljs-literal\">-Path</span> WSMan:\\localhost\\Service\\Auth\\Basic <span class=\"hljs-literal\">-Value</span> <span class=\"hljs-variable\">$true</span>\n<span class=\"hljs-built_in\">Set-Item</span> <span class=\"hljs-literal\">-Path</span> WSMan:\\localhost\\Service\\AllowUnencrypted <span class=\"hljs-literal\">-Value</span> <span class=\"hljs-variable\">$true</span>\n\n<span class=\"hljs-comment\"># WinRM 방화벽 예외 설정</span>\n<span class=\"hljs-built_in\">New-NetFirewallRule</span> <span class=\"hljs-literal\">-Name</span> <span class=\"hljs-string\">\"WinRM-HTTP\"</span> <span class=\"hljs-literal\">-DisplayName</span> <span class=\"hljs-string\">\"WinRM (HTTP-In)\"</span> <span class=\"hljs-literal\">-Protocol</span> TCP <span class=\"hljs-literal\">-LocalPort</span> <span class=\"hljs-number\">5985</span> <span class=\"hljs-literal\">-Action</span> Allow <span class=\"hljs-literal\">-Enabled</span> True\n<span class=\"hljs-built_in\">New-NetFirewallRule</span> <span class=\"hljs-literal\">-Name</span> <span class=\"hljs-string\">\"WinRM-HTTPS\"</span> <span class=\"hljs-literal\">-DisplayName</span> <span class=\"hljs-string\">\"WinRM (HTTPS-In)\"</span> <span class=\"hljs-literal\">-Protocol</span> TCP <span class=\"hljs-literal\">-LocalPort</span> <span class=\"hljs-number\">5986</span> <span class=\"hljs-literal\">-Action</span> Allow <span class=\"hljs-literal\">-Enabled</span> True\n\n<span class=\"hljs-comment\"># TLS 1.2 프로토콜 설정</span>\n[<span class=\"hljs-type\">Net.ServicePointManager</span>]::SecurityProtocol = [<span class=\"hljs-type\">Net.SecurityProtocolType</span>]::Tls12\n\n<span class=\"hljs-comment\"># NuGet 공급자 설치 및 PowerShellGet 업데이트</span>\n<span class=\"hljs-built_in\">Install-PackageProvider</span> <span class=\"hljs-literal\">-Name</span> NuGet <span class=\"hljs-literal\">-Force</span> <span class=\"hljs-literal\">-Confirm</span>:<span class=\"hljs-variable\">$false</span>\n<span class=\"hljs-built_in\">Update-Module</span> <span class=\"hljs-literal\">-Name</span> PowerShellGet <span class=\"hljs-literal\">-Force</span> <span class=\"hljs-literal\">-AllowClobber</span> <span class=\"hljs-literal\">-Confirm</span>:<span class=\"hljs-variable\">$false</span>\n</code></pre>\n<ul>\n<li>profile.tf</li>\n</ul>\n<p></p>\n<pre><code class=\"hljs language-js\">provider <span class=\"hljs-string\">\"oci\"</span> {\n  tenancy_ocid      = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">tenancy_ocid</span>\n  user_ocid         = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">user_ocid</span>\n  fingerprint       = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">fingerprint</span>\n  private_key_path  = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">private_key_path</span>\n  region            = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">region</span>\n}\n</code></pre>\n<p>variables.tf</p>\n<pre><code class=\"hljs language-js\">variable <span class=\"hljs-string\">\"tenancy_ocid\"</span> {\n  description = <span class=\"hljs-string\">\"The OCID of your tenancy.\"</span>\n  type        = string\n}\n\nvariable <span class=\"hljs-string\">\"user_ocid\"</span> {\n  description = <span class=\"hljs-string\">\"The OCID of the user calling the API.\"</span>\n  type        = string\n}\n\nvariable <span class=\"hljs-string\">\"fingerprint\"</span> {\n  description = <span class=\"hljs-string\">\"The fingerprint of the API key.\"</span>\n  type        = string\n}\n\nvariable <span class=\"hljs-string\">\"private_key_path\"</span> {\n  description = <span class=\"hljs-string\">\"The path to the private key.\"</span>\n  type        = string\n  <span class=\"hljs-keyword\">default</span>     = <span class=\"hljs-string\">\"/Users/abirzu/.ssh/newpemkey.pem\"</span>\n}\n\nvariable <span class=\"hljs-string\">\"region\"</span> {\n  description = <span class=\"hljs-string\">\"The region to use.\"</span>\n  type        = string\n  <span class=\"hljs-keyword\">default</span>     = <span class=\"hljs-string\">\"eu-frankfurt-1\"</span>\n}\n\nvariable <span class=\"hljs-string\">\"compartment_ocid\"</span> {\n  description = <span class=\"hljs-string\">\"The OCID of the compartment to use.\"</span>\n  type        = string\n}\n\nvariable <span class=\"hljs-string\">\"availability_domain\"</span> {\n  description = <span class=\"hljs-string\">\"The availability domain to use.\"</span>\n  type        = string\n  <span class=\"hljs-keyword\">default</span>     = <span class=\"hljs-string\">\"NoEK:EU-FRANKFURT-1-AD-1\"</span>\n}\n\nvariable <span class=\"hljs-string\">\"shape\"</span> {\n  description = <span class=\"hljs-string\">\"The shape of the instance to be created.\"</span>\n  type        = string\n  <span class=\"hljs-keyword\">default</span>     = <span class=\"hljs-string\">\"VM.Standard.E5.Flex\"</span>\n}\n\nvariable <span class=\"hljs-string\">\"ocpus\"</span> {\n  description = <span class=\"hljs-string\">\"The number of OCPUs to allocate.\"</span>\n  type        = number\n  <span class=\"hljs-keyword\">default</span>     = <span class=\"hljs-number\">1</span>\n}\n\nvariable <span class=\"hljs-string\">\"memory_in_gbs\"</span> {\n  description = <span class=\"hljs-string\">\"The amount of memory in GBs.\"</span>\n  type        = number\n  <span class=\"hljs-keyword\">default</span>     = <span class=\"hljs-number\">12</span>\n}\n\nvariable <span class=\"hljs-string\">\"ssh_authorized_keys\"</span> {\n  description = <span class=\"hljs-string\">\"The public key for SSH access to the instances.\"</span>\n  type        = string\n}\n\nvariable <span class=\"hljs-string\">\"image_ocid\"</span> {\n  description = <span class=\"hljs-string\">\"The OCID of the image to use.\"</span>\n  type        = string\n}\n\nvariable <span class=\"hljs-string\">\"windows2016_image_ocid\"</span> {\n  description = <span class=\"hljs-string\">\"The OCID of the Windows Server 2016 image.\"</span>\n  type        = string\n}\n\nvariable <span class=\"hljs-string\">\"windows2019_image_ocid\"</span> {\n  description = <span class=\"hljs-string\">\"The OCID of the Windows Server 2019 image.\"</span>\n  type        = string\n}\n</code></pre>\n<p>network.tf</p>\n<pre><code class=\"hljs language-js\"></code></pre>\n<p></p>\n<pre><code class=\"hljs language-js\">resource “oci_core_vcn” “generated_oci_core_vcn” {\n cidr_block = “<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">16</span>”\n compartment_id = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">compartment_ocid</span>\n display_name = “goad-virtual-network”\n dns_label = “goadvcn”\n}\nresource “oci_core_subnet” “public_subnet” {\n cidr_block = “<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.57</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">24</span>”\n compartment_id = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">compartment_ocid</span>\n display_name = “public-subnet”\n dns_label = “publicsubnet”\n vcn_id = oci_core_vcn.<span class=\"hljs-property\">generated_oci_core_vcn</span>.<span class=\"hljs-property\">id</span>\n route_table_id = oci_core_route_table.<span class=\"hljs-property\">public_route_table</span>.<span class=\"hljs-property\">id</span>\n}\nresource “oci_core_subnet” “private_subnet” {\n cidr_block = “<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">24</span>”\n compartment_id = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">compartment_ocid</span>\n display_name = “private-subnet”\n dns_label = “privatesubnet”\n vcn_id = oci_core_vcn.<span class=\"hljs-property\">generated_oci_core_vcn</span>.<span class=\"hljs-property\">id</span>\n route_table_id = oci_core_route_table.<span class=\"hljs-property\">private_route_table</span>.<span class=\"hljs-property\">id</span>\n prohibit_internet_ingress = <span class=\"hljs-literal\">true</span>\n prohibit_public_ip_on_vnic = <span class=\"hljs-literal\">true</span>\n security_list_ids = [oci_core_security_list.<span class=\"hljs-property\">winrm_rdp_security_list</span>.<span class=\"hljs-property\">id</span>]\n}\nresource “oci_core_internet_gateway” “generated_oci_core_internet_gateway” {\n compartment_id = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">compartment_ocid</span>\n display_name = “<span class=\"hljs-title class_\">Internet</span> <span class=\"hljs-title class_\">Gateway</span> goad-virtual-network”\n enabled = <span class=\"hljs-literal\">true</span>\n vcn_id = oci_core_vcn.<span class=\"hljs-property\">generated_oci_core_vcn</span>.<span class=\"hljs-property\">id</span>\n}\nresource “oci_core_nat_gateway” “generated_oci_core_nat_gateway” {\n compartment_id = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">compartment_ocid</span>\n display_name = “<span class=\"hljs-variable constant_\">NAT</span> <span class=\"hljs-title class_\">Gateway</span> goad-virtual-network”\n vcn_id = oci_core_vcn.<span class=\"hljs-property\">generated_oci_core_vcn</span>.<span class=\"hljs-property\">id</span>\n}\nresource “oci_core_route_table” “public_route_table” {\n compartment_id = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">compartment_ocid</span>\n vcn_id = oci_core_vcn.<span class=\"hljs-property\">generated_oci_core_vcn</span>.<span class=\"hljs-property\">id</span>\n display_name = “public-route-table”\nroute_rules {\n destination = “<span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">0</span>”\n destination_type = “<span class=\"hljs-variable constant_\">CIDR_BLOCK</span>”\n network_entity_id = oci_core_internet_gateway.<span class=\"hljs-property\">generated_oci_core_internet_gateway</span>.<span class=\"hljs-property\">id</span>\n }\n}\nresource “oci_core_route_table” “private_route_table” {\n compartment_id = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">compartment_ocid</span>\n vcn_id = oci_core_vcn.<span class=\"hljs-property\">generated_oci_core_vcn</span>.<span class=\"hljs-property\">id</span>\n display_name = “private-route-table”\nroute_rules {\n destination = “<span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">0</span>”\n destination_type = “<span class=\"hljs-variable constant_\">CIDR_BLOCK</span>”\n network_entity_id = oci_core_nat_gateway.<span class=\"hljs-property\">generated_oci_core_nat_gateway</span>.<span class=\"hljs-property\">id</span>\n }\n}\n  options {\n    type                  = <span class=\"hljs-string\">\"DomainNameServer\"</span>\n    server_type           = <span class=\"hljs-string\">\"CustomDnsServer\"</span>\n    custom_dns_servers    = [<span class=\"hljs-string\">\"192.168.56.10\"</span>,<span class=\"hljs-string\">\"8.8.8.8\"</span>]\n  }\n options {\n        type = <span class=\"hljs-string\">\"SearchDomain\"</span>\n        search_domain_names = [ <span class=\"hljs-string\">\"sevenkingdoms.local\"</span> ]\n    }\n}\nresource “oci_core_security_list” “winrm_rdp_security_list” {\n compartment_id = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">compartment_ocid</span>\n vcn_id = oci_core_vcn.<span class=\"hljs-property\">generated_oci_core_vcn</span>.<span class=\"hljs-property\">id</span>\n display_name = “winrm_rdp_security_list”\negress_security_rules {\n protocol = “all”\n destination = “<span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">0</span>”\n stateless = <span class=\"hljs-literal\">false</span>\n }\ningress_security_rules {\n protocol = “all”\n source = “<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">16</span>”\n stateless = <span class=\"hljs-literal\">false</span>\n }\n}\n</code></pre>\n<pre><code class=\"hljs language-js\">resource “oci_core_default_dhcp_options” “default_dhcp_options” {\n manage_default_resource_id = oci_core_vcn.<span class=\"hljs-property\">generated_oci_core_vcn</span>.<span class=\"hljs-property\">default_dhcp_options_id</span>\noptions {\n type = “<span class=\"hljs-title class_\">DomainNameServer</span>”\n server_type = “<span class=\"hljs-title class_\">CustomDnsServer</span>”\n custom_dns_servers = [“<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.10</span>”]\n search_domain_names = [“sevenkingdoms.<span class=\"hljs-property\">local</span>”]\n }\n</code></pre>\n<p>The DHCP configuration part is essential, as if it’s not properly configured, it will result in the failure of the ansible jobs. If the terraform variable will not add the search domain, you need to do this manually:</p>\n<p>Go to the VCN → DHCP Options:</p>\n<p></p>\n<p>화면 오른쪽 상단에 있는 3 점을 클릭한 후 편집을 선택하세요. 여기에서 외부 DNS 서버를 추가하고 사용자 정의 검색 도메인인 Seven Kingdoms를 추가할 수 있습니다.</p>\n<p>이 부분에서 DNS 문제를 해결해야합니다.</p>\n<p></p>\n<pre><code class=\"hljs language-js\">options {\ntype = <span class=\"hljs-string\">\"도메인 네임 서버\"</span>\nserver_type = <span class=\"hljs-string\">\"사용자 정의 DNS 서버\"</span>\ncustom_dns_servers = [<span class=\"hljs-string\">\"192.168.56.10\"</span>,<span class=\"hljs-string\">\"8.8.8.8\"</span>]\n}\noptions {\ntype = <span class=\"hljs-string\">\"검색 도메인\"</span>\nsearch_domain_names = [<span class=\"hljs-string\">\"seven kingdoms.local\"</span>]\n}\n</code></pre>\n<p>jumpbox.tf</p>\n<pre><code class=\"hljs language-js\">resource <span class=\"hljs-string\">\"oci_core_instance\"</span> <span class=\"hljs-string\">\"jumpbox\"</span> {\n availability_domain = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">availability_domain</span>\n compartment_id = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">compartment_ocid</span>\n display_name = <span class=\"hljs-string\">\"jumpbox\"</span>\n shape = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">shape</span>\nshape_config {\n baseline_ocpu_utilization = <span class=\"hljs-string\">\"BASELINE_1_1\"</span>\n memory_in_gbs = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">memory_in_gbs</span>\n ocpus = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">ocpus</span>\n }\nsource_details {\n source_id = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">image_ocid</span>\n source_type = <span class=\"hljs-string\">\"이미지\"</span>\n }\n#이미지 <span class=\"hljs-variable constant_\">OCID</span>’S <span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//docs.oracle.com/en-us/iaas/images/image/bd616d0a-fae4-490e-bd31-a9406095b844/</span>\n create_vnic_details {\n assign_ipv6ip = <span class=\"hljs-literal\">false</span>\n assign_private_dns_record = <span class=\"hljs-literal\">true</span>\n assign_public_ip = <span class=\"hljs-literal\">true</span>\n subnet_id = oci_core_subnet.<span class=\"hljs-property\">public_subnet</span>.<span class=\"hljs-property\">id</span>\n }\nmetadata = {\n ssh_authorized_keys = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">ssh_authorized_keys</span>\n }\nagent_config {\n is_management_disabled = <span class=\"hljs-literal\">false</span>\n is_monitoring_disabled = <span class=\"hljs-literal\">false</span>\nplugins_config {\n desired_state = <span class=\"hljs-string\">\"사용 안 함\"</span>\n name = <span class=\"hljs-string\">\"취약점 스캐닝\"</span>\n }\n plugins_config {\n desired_state = <span class=\"hljs-string\">\"사용 안 함\"</span>\n name = <span class=\"hljs-string\">\"관리 에이전트\"</span>\n }\n plugins_config {\n desired_state = <span class=\"hljs-string\">\"사용함\"</span>\n name = <span class=\"hljs-string\">\"사용자 지정 로그 모니터링\"</span>\n }\n plugins_config {\n desired_state = <span class=\"hljs-string\">\"사용 안 함\"</span>\n name = <span class=\"hljs-string\">\"컴퓨팅 RDMA GPU 모니터링\"</span>\n }\n plugins_config {\n desired_state = <span class=\"hljs-string\">\"사용함\"</span>\n name = <span class=\"hljs-string\">\"컴퓨팅 인스턴스 모니터링\"</span>\n }\n plugins_config {\n desired_state = <span class=\"hljs-string\">\"사용 안 함\"</span>\n name = <span class=\"hljs-string\">\"컴퓨팅 HPC RDMA 자동 구성\"</span>\n }\n plugins_config {\n desired_state = <span class=\"hljs-string\">\"사용 안 함\"</span>\n name = <span class=\"hljs-string\">\"컴퓨팅 HPC RDMA 인증\"</span>\n }\n plugins_config {\n desired_state = <span class=\"hljs-string\">\"사용함\"</span>\n name = <span class=\"hljs-string\">\"클라우드 가드 워크로드 보호\"</span>\n }\n plugins_config {\n desired_state = <span class=\"hljs-string\">\"사용 안 함\"</span>\n name = <span class=\"hljs-string\">\"블록 볼륨 관리\"</span>\n }\n plugins_config {\n desired_state = <span class=\"hljs-string\">\"사용 안 함\"</span>\n name = <span class=\"hljs-string\">\"바스천\"</span>\n }\n }\navailability_config {\n is_live_migration_preferred = <span class=\"hljs-literal\">true</span>\n recovery_action = <span class=\"hljs-string\">\"인스턴스 복원\"</span>\n }\nplatform_config {\n is_symmetric_multi_threading_enabled = <span class=\"hljs-literal\">true</span>\n type = <span class=\"hljs-string\">\"AMD_VM\"</span>\n }\ninstance_options {\n are_legacy_imds_endpoints_disabled = <span class=\"hljs-literal\">false</span>\n }\n}\n</code></pre>\n<p>windowsvm.tf</p>\n<p></p>\n<pre><code class=\"hljs language-js\">리소스 <span class=\"hljs-string\">\"oci_core_instance\"</span> <span class=\"hljs-string\">\"windows_instance\"</span> {\n for_each = {\n kingslanding = {\n name = <span class=\"hljs-string\">\"kingslanding\"</span>\n private_ip_address = <span class=\"hljs-string\">\"192.168.56.10\"</span>\n admin_username = <span class=\"hljs-string\">\"ansible\"</span>\n admin_password = <span class=\"hljs-string\">\"8dCT-DJjgScp\"</span>\n image_ocid = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">windows2019_image_ocid</span>\n }\n winterfell = {\n name = <span class=\"hljs-string\">\"winterfell\"</span>\n private_ip_address = <span class=\"hljs-string\">\"192.168.56.11\"</span>\n admin_username = <span class=\"hljs-string\">\"ansible\"</span>\n admin_password = <span class=\"hljs-string\">\"NgtI75cKV+Pu\"</span>\n image_ocid = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">windows2019_image_ocid</span>\n }\n castelblack = {\n name = <span class=\"hljs-string\">\"castelblack\"</span>\n private_ip_address = <span class=\"hljs-string\">\"192.168.56.22\"</span>\n admin_username = <span class=\"hljs-string\">\"ansible\"</span>\n admin_password = <span class=\"hljs-string\">\"NgtI75cKV+Pu\"</span>\n image_ocid = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">windows2019_image_ocid</span>\n }\n meereen = {\n name = <span class=\"hljs-string\">\"meereen\"</span>\n private_ip_address = <span class=\"hljs-string\">\"192.168.56.12\"</span>\n admin_username = <span class=\"hljs-string\">\"ansible\"</span>\n admin_password = <span class=\"hljs-string\">\"Ufe-bVXSx9rk\"</span>\n image_ocid = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">windows2016_image_ocid</span>\n }\n braavos = {\n name = <span class=\"hljs-string\">\"braavos\"</span>\n private_ip_address = <span class=\"hljs-string\">\"192.168.56.23\"</span>\n admin_username = <span class=\"hljs-string\">\"ansible\"</span>\n admin_password = <span class=\"hljs-string\">\"978i2pF43UJ-\"</span>\n image_ocid = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">windows2016_image_ocid</span>\n }\n }\navailability_domain = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">availability_domain</span>\n compartment_id = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">compartment_ocid</span>\n display_name = each.<span class=\"hljs-property\">value</span>.<span class=\"hljs-property\">name</span>\n shape = <span class=\"hljs-string\">\"VM.Standard.E5.Flex\"</span>\nshape_config {\n ocpus = <span class=\"hljs-number\">2</span>\n memory_in_gbs = <span class=\"hljs-number\">32</span>\n }\nsource_details {\n source_id = each.<span class=\"hljs-property\">value</span>.<span class=\"hljs-property\">image_ocid</span>\n source_type = <span class=\"hljs-string\">\"image\"</span>\n }\ncreate_vnic_details {\n assign_ipv6ip = <span class=\"hljs-literal\">false</span>\n assign_private_dns_record = <span class=\"hljs-literal\">true</span>\n assign_public_ip = <span class=\"hljs-literal\">false</span>\n subnet_id = oci_core_subnet.<span class=\"hljs-property\">private_subnet</span>.<span class=\"hljs-property\">id</span>\n hostname_label = each.<span class=\"hljs-property\">value</span>.<span class=\"hljs-property\">name</span>\n private_ip = each.<span class=\"hljs-property\">value</span>.<span class=\"hljs-property\">private_ip_address</span>\n }\nmetadata = {\n user_data = <span class=\"hljs-title function_\">base64encode</span>(<span class=\"hljs-title function_\">file</span>(<span class=\"hljs-string\">\"${path.module}/windows_cloud_init.ps1\"</span>))\n admin_password = each.<span class=\"hljs-property\">value</span>.<span class=\"hljs-property\">admin_password</span>\n }\n}\n</code></pre>\n<p>outputs.tf</p>\n<pre><code class=\"hljs language-js\">output <span class=\"hljs-string\">\"ubuntu_jumpbox_ip\"</span> {\n value = oci_core_instance.<span class=\"hljs-property\">jumpbox</span>.<span class=\"hljs-property\">public_ip</span>\n}\noutput <span class=\"hljs-string\">\"windows_instance_opc_passwords\"</span> {\n value = { <span class=\"hljs-keyword\">for</span> k, v <span class=\"hljs-keyword\">in</span> oci_core_instance.<span class=\"hljs-property\">windows_instance</span> : <span class=\"hljs-function\"><span class=\"hljs-params\">k</span> =></span> v.<span class=\"hljs-property\">metadata</span>.<span class=\"hljs-property\">admin_password</span> }\n sensitive = <span class=\"hljs-literal\">true</span>\n}\n</code></pre>\n<p>프로비저닝 중 발생한 일반적인 오류입니다.</p>\n<p></p>\n<p>다음과 같이 Markdown 형식에 맞게 표 태그를 변경하십시오.</p>\n<p><img src=\"/assets/img/2024-06-19-HowtorunGameofActiveDirectoryinOCIPart1_9.png\" alt=\"이미지\"></p>\n<p>모든 TF가 생성된 후, GOAD git 저장소가 정상적으로 동기화된 경우 다음을 실행해야 합니다:</p>\n<p>abirzu@abirzu-mac GOAD % ./goad.sh -t destroy -l GOAD -p oci -m local</p>\n<p>모든 서버가 가동되고 작동 중인 것을 확인할 수 있습니다.</p>\n<p></p>\n<p>축하합니다! 환경이 작동 중에 있습니다.</p>\n<h1>서버</h1>\n<p>이 랩은 실제로 다섯 개의 가상 머신으로 구성되어 있습니다:</p>\n<p></p>\n<ul>\n<li>kingslanding: DC01는 Windows Server 2019에서 실행 중입니다(기본으로 windefender가 활성화됨)</li>\n<li>winterfell: DC02는 Windows Server 2019에서 실행 중입니다(기본으로 windefender가 활성화됨)</li>\n<li>castelblack: SRV02는 Windows Server 2019에서 실행 중입니다(windefender가 기본적으로 비활성화됨)</li>\n<li>meereen: DC03은 Windows Server 2016에서 실행 중입니다(기본으로 windefender가 활성화됨)</li>\n<li>braavos: SRV03은 Windows Server 2016에서 실행 중입니다(기본으로 windefender가 활성화됨)</li>\n</ul>\n<p>도메인: north.sevenkingdoms.local</p>\n<ul>\n<li>winterfell: DC01</li>\n<li>castelblack: SRV02: MSSQL / IIS</li>\n</ul>\n<p>도메인: sevenkingdoms.local</p>\n<p></p>\n<ul>\n<li>kingslanding: DC02</li>\n<li>castelrock: SRV01 (자원 부족으로 비활성화됨)</li>\n</ul>\n<h1>도메인: essos.local</h1>\n<ul>\n<li>braavos: DC03</li>\n<li>meeren: SRV03: MSSQL / ADCS</li>\n</ul>\n<p>인터넷에서 몇 가지 가이드를 따르거나 자신만의 방법을 찾아 시작할 수 있습니다!</p>\n<p></p>\n<p>AD | Mayfly (mayfly277.github.io)</p>\n<p>Solving Game of Active Directory (GOAD) by Orange Cyberdefense Part-1 | by n00🔑 | Medium</p>\n<p>제1부에서는 OCI에서 GOAD 랩을 만드는 방법을 소개했고, 다음 부분에서는 다음에 초점을 맞출 것입니다:</p>\n<p>OCI 통합:</p>\n<p></p>\n<ol>\n<li>OCI Management Agent:</li>\n</ol>\n<ul>\n<li>설명: 클라우드 작업을 자동화하고 모니터링합니다.</li>\n<li>통합: GOAD 환경 내 자원의 배포 및 관리를 간소화합니다.</li>\n</ul>\n<ol start=\"2\">\n<li>Sysmon 및 로깅 분석:</li>\n</ol>\n<p></p>\n<p>• 설명: Sysmon은 시스템 활동을 기록하여 침입 탐지를 지원합니다.</p>\n<p>• 통합: Sysmon 이벤트를 수집하고 OCI Logging Analytics로 전송하여 고급 로그 분석 및 시각화를 지원합니다. 자세한 내용은 여기에서 확인하세요.</p>\n<ol start=\"3\">\n<li>Arkime 통합:</li>\n</ol>\n<p>• 설명: Arkime은 오픈 소스 패킷 캡처 및 검색 도구입니다.</p>\n<p></p>\n<p>• 통합: 효율적인 데이터 색인 및 검색을 위해 OCI OpenSearch를 활용합니다. 자세한 내용은 여기에서 확인할 수 있습니다.</p>\n<ol start=\"4\">\n<li>클라우드 가드 인스턴스 보안:</li>\n</ol>\n<p>• 설명: 클라우드 가드는 포괄적인 클라우드 보안 관리를 제공합니다.</p>\n<p>• 통합: 로깅 분석을 활용하여 인스턴스 보안을 강화하며 실시간 위협 감지 및 대응이 가능합니다. 더 많은 정보는 여기에서 확인할 수 있습니다.</p>\n</body>\n</html>\n"},"__N_SSG":true}