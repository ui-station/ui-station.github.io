{"pageProps":{"post":{"title":"탐색적 데이터 분석 런던 교통 수속에 잃어버린 물품","description":"","date":"2024-05-20 18:36","slug":"2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon","content":"\n\n<img src=\"/assets/img/2024-05-20-런던 교통수단에서 분실물 품목의 탐색 데이터 분석_0.png\" />\n\n여러분께서도 짐을 버스에 두고 내려온 적이 있을 것 같아요. 다섯 분 뒤에 짐이 없어진 것을 깨닫지만 이미 버스가 떠났어요. 집에 돌아온 후 버스 회사 웹사이트를 확인해보니 분실한 짐을 청구할 수 있는 가능성이 있었고, 며칠 후 운종사에게 운종사에게 연락을 해서 짐을 다시 받을 수 있었어요. 저는 암스테르담에 살고 있는데, 여기의 대중교통은 iLost사와 협력 관계에 있어요. 누군가 분실한 물품을 청구할 수 있는 곳이랍니다. 이 사이트는 꽤 명확한 구조를 갖고 있으며 다른 사람들이 잊어버린 물품들을 볼 때에는 심지어 등록할 필요가 없어요 (개인 정보는 물론 숨겨져 있겠죠). 이런 데이터 지향적 사고방식이 있는 저는 ‘유레카’라는 순간을 겪었죠 — 이런 종류의 데이터는 문화 인류학적 관점에서 훌륭하다고 생각해서 대중교통 및 다른 장소에서 분실될 수 있는 물품에 대해 많은 것을 배울 수 있다고 생각했어요. 그러나 iLost의 라이선스 계약은 서면 동의 없이 데이터를 사용하는 것을 허가하지 않았기 때문에 제 질문에 아무도 답변하지 않았어요. 그럼에도 불구하고 이 아이디어를 마음에 품고 있던 저는 온라인에서 대안 소스를 찾기 시작했고 다음과 같은 것을 알게 되었어요:\n\n- 런던 교통 (TfL)도 분실물 품목을 청구하기 위한 좋은 서비스를 갖고 있어요.\n- 영국에는 공공 당국이 보유한 정보에 대한 공공 \"접근 권리\"를 만드는 정보의 자유법이 있어요. 모든 사람은 무료로 요청을 제기할 권리가 있으며 20일 이내에 응답을 받을 수 있어요. 그래서 가능하다면 TfL에게 \"분실 물품의 원시 데이터\"가 담긴 CSV 파일을 보내달라고 요청했고 2~3주 후에 (약속된 것처럼 빠르지 않았지만:) 파일을 받을 수 있었어요. 또한 TfL에게 이 데이터를 제 TDS 출판물에 사용할 수 있는지 물어봤고 긍정적인 답변을 받았죠.\n\n이것은 좋은 서비스인 것 같아요 (그런데 미국은 1967년 이후로 비슷한 법을 가지고 있어요) 그리고 과학자와 데이터 애호가들에게 연구에 공개 데이터를 활용할 수 있는 좋은 기회인 것 같아요. 그러니 말이 많지 않게, 우리가 어떤 정보를 얻을 수 있는지 한번 살펴봅시다. 원본 파일을 얻어 결과를 재현하고 싶은 분들은 아래에 댓글을 남겨주시면 링크를 공유해드릴게요.\n\n<div class=\"content-ad\"></div>\n\n## 데이터 로딩\n\n우선 데이터를 로드하고 차원 및 유형을 확인해봅시다:\n\n```python\nimport pandas as pd\n\ndf = pd.read_csv(\"tfl.csv\")\ndisplay(df.head())\ndisplay(df.info(verbose=True)\n```\n\n출력 결과는 다음과 같습니다:\n\n<div class=\"content-ad\"></div>\n\n마크다운 형식으로 변경하면 다음과 같습니다:\n\n\n![Exploratory Data Analysis Lost Property Items on the Transport of London](/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_1.png)\n\n아래에서 볼 수 있듯이 총 5245개의 항목이 있고 데이터프레임에는 NULL 항목이 없습니다. 날짜 형식이 표준이 아닌 것으로 보이므로 변환해보겠습니다:\n\n```python\ndf[\"Date Found\"] = pd.to_datetime(df[\"Date Found\"], format=\"%d/%m/%Y\")\n```\n\n다음 단계로 어떤 종류의 카테고리가 있는지 알아보겠습니다:\n\n\n<div class=\"content-ad\"></div>\n\n```js\ndisplay(df[\"Category\"].unique())\n```\n\n위 결과에서 숫자가 그리 크지 않다는 것을 보여줍니다:\n\n```js\narray(['Bags', 'Electronics & Technology', 'Wallets & Purses',\n       'Baby & Nursery', 'ID & Personal Documents', 'Health & Beauty',\n       'Tools / Garden / DIY', 'Jewellery', 'Travel Cards & Ticket',\n       'Household & General Items', 'Keys', 'Sports & Leisure', 'Eyewear',\n       'Currency (cash)', 'Stationery & Books', 'Clothing',\n       'Financial Documents'], dtype=object)\n```\n\n시각화를 더 잘 보이게 하기 위해 \"Electronics & Technology\" 카테고리를 \"Electronics\"로 변경하고 모든 \"Document\" 카테고리를 한 가지로 결합하기로 결정했습니다:\n\n<div class=\"content-ad\"></div>\n\n```js\ndef update_category(name: str) -> str:\n    \"\"\"카테고리 이름 업데이트\"\"\"\n    if \"문서\" in name:\n        return \"문서\"\n    if \"전자제품\" in name:\n        return \"전자제품\"\n    return name\n\ndf[\"Category\"] = df[\"Category\"].map(update_category)\n```\n\n날짜와 카테고리 변환을 마친 후, 최종 데이터프레임은 다음과 같습니다:\n\n<img src=\"/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_2.png\" />\n\n## 하루 평균 아이템\n\n\n<div class=\"content-ad\"></div>\n\n이제 재미를 봐봅시다. 모든 항목을 날짜별로 그룹화하고 막대 차트를 그려봅시다:\n\n```js\nimport plotly.express as px\n\ngr_day = df[[\"Date Found\"]].groupby([\"Date Found\"], as_index=False).size()\n\nfig = px.bar(gr_day, x=\"Date Found\", y=\"size\",\n             title=\"<span style='font-size:18px;'><b>TfL, Lost Items Per Day</b></span><b></b>\",\n             width=1280, height=500)\nfig.update_xaxes(tickformat=\"%a, %d-%m-%Y\", showline=True, linecolor=\"black\")\nfig.update_layout(xaxis_title=None, yaxis_title=None, plot_bgcolor=\"#F5F5F5\",\n                  margin=dict(l=50, r=50, t=30, b=50))\nfig.show()\n```\n\n여기서는 오픈 소스 라이브러리 Plotly를 사용하여 차트를 작성했습니다. 이 라이브러리는 plotly.js를 기반으로 하므로 HTML 형식을 사용하여 스타일을 변경할 수 있습니다. 또한 출력물은 대화형이기 때문에 노트북에서 이미지를 바로 확대 또는 이동할 수 있습니다.\n\n출력물은 다음과 같습니다:\n\n<div class=\"content-ad\"></div>\n\n![이미지](/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_3.png)\n\n이 결과를 보면 대중교통에서 물건을 분실할 확률을 계산하는 것이 흥미로울 것 같아요. 이 특정 날짜의 승객 수는 정확히 모르지만, 일반적으로 런던의 대중교통은 하루에 약 600만 명의 승객을 처리한다는 것을 알고 있습니다. 그래프에서 볼 수 있듯이, 분실 물품의 수는 꽤 일정합니다. 간단한 계산을 통해 대중교통에서 물건을 분실할 확률이 약 0.01% 정도라는 것을 알 수 있습니다. 이 값 자체는 크지 않지만, 매일 적어도 10,000 명의 사람 중 한 명은 이러한 사건을 겪을 수 있습니다.\n\n또 다른 흥미로운 발견은 목요일에 뾰족한 부분이 있습니다. 왜 이렇게 발생하는지는 모르겠지만, 다른 TfL 보도자료에서도 목요일을 가장 많은 승객이 있는 날로 언급했어요. 이에 대한 사회적 설명이 있는지 알지 못하지만, 흥미롭게 보입니다.\n\n## 카테고리\n\n<div class=\"content-ad\"></div>\n\n다음 단계로 카테고리와 하위 카테고리별로 모든 상품을 그룹화해 보겠습니다:\n\n```js\ngr_cat = df[[\"Category\",\n             \"Sub-Category\"]].groupby([\"Category\",\n                                       \"Sub-Category\"], as_index=False).size()\n```\n\n다양한 종류의 시각화를 시도해 보았고, 그 중에서도 가장 유익하다고 생각되는 두 가지를 소개하겠습니다. 먼저, 2차원 원형 차트와 같은 선버스트 차트를 그려보겠습니다:\n\n```js\nfig = px.sunburst(gr_cat, width=1280, height=800,\n                  path=[\"Category\", \"Sub-Category\"], values=\"size\",\n                  color=\"Category\",\n                  title=\"<span style='font-size:18px;'><b>TfL, Lost Items Chart</b></span><b></b>\"\n                  )\nfig.update_layout(font_size=10, margin=dict(l=10, r=10, t=30, b=50))\nfig.update_traces(textinfo=\"label+percent parent\")\nfig.show()\n```\n\n<div class=\"content-ad\"></div>\n\n다음처럼 출력됩니다:\n\n![이미지](/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_4.png)\n\n다양한 세그먼트를 쉽게 비교할 수 있습니다. 예를 들어, “가방”과 “전자제품”이 “유실 차트”의 상단에 있음을 확인할 수 있습니다(각각 19%와 15%). “가방” 카테고리에서는 승객들이 가장 자주(36%) 배낭을 잃어버립니다. 이는 배낭을 가지고 서거나 앉는 것이 불편하고, 사람들이 벗어 두기 때문에 이해할 수 있습니다. “전자제품” 카테고리에서는 모바일 폰이 가장 많습니다(58%). 다른 카테고리에서는 10%의 불운한 승객이 문서를 분실했고, 4%가 열쇠를 분실했습니다.\n\n선셋 차트가 흥미로워 보이지만, 좁은 세그먼트를 읽기 어려울 수 있습니다. 다른 대안은 트리맵 차트입니다:\n\n<div class=\"content-ad\"></div>\n\n```python\nfig = px.treemap(gr_cat, width=1280, height=800,\n                 path=['Category', 'Sub-Category'], values='size',\n                 color='Category')\nfig.update_traces(textinfo=\"label+percent parent\")\nfig.show()\n```\n\n위의 코드를 실행하면 이와 같은 출력물이 나옵니다:\n\n<img src=\"/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_5.png\" />\n\n이 경우, 마우스를 호버하여 작은 하위 카테고리의 데이터를 쉽게 읽을 수 있습니다. 반면, 파이 차트를 사용하면 다른 카테고리 간의 상대적인 크기를 더 쉽게 이해할 수 있습니다.\n\n<div class=\"content-ad\"></div>\n\n## 하위 카테고리\n\n\"전자제품\" 카테고리를 자세히 살펴보겠습니다. 이를 위해 데이터프레임을 필터링하고, 모든 항목을 하위 카테고리별로 그룹화하여 막대 그래프를 그릴 수 있습니다:\n\n```js\ndf_ = df[df[\"Category\"] == \"전자제품\"]\ngr_electronics = df_[[\"하위 카테고리\"]].groupby([\"하위 카테고리\"], as_index=False).size().sort_values(by=\"size\", ascending=True)\n\nfig = px.bar(gr_electronics, width=1280, height=600, \n             title=\"<span style='font-size:18px;'><b>TfL, 분실물 주간별 전자제품</b></span><b></b>\",\n             x=\"size\", y=\"하위 카테고리\", orientation=\"h\")\nfig.update_layout(xaxis_title=\"수량\", yaxis_title=None,\n                  plot_bgcolor=\"#F5F5F5\",\n                  margin=dict(l=50, r=50, t=30, b=50))\nfig.show()\n```\n\n여기에서는 라벨을 읽기 쉽게하기 위해 가로 막대 차트를 사용했습니다. 결과는 다음과 같습니다:\n\n<div class=\"content-ad\"></div>\n\n\n![image](/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_6.png)\n\n우리가 볼 수 있듯이, 대부분의 승객이 핸드폰이나 핸드폰 액세서리를 분실한 것이 분명합니다. 어떤 사람들은 노트북, 태블릿 또는 e-리더를 분실했으며, 한 명의 승객이 MP3 플레이어를 분실했습니다(요즘에는 조금 특이한 장치입니다). 놀랍게도 숫자가 상당히 많습니다. 데이터 집합은 일주일 동안의 데이터를 나타내며, 우리가 보기로는 이 기간 동안 총 467명의 승객이 핸드폰을 분실했습니다.\n\n## 위치\n\n간단한 연습으로 데이터를 위치별로 그룹화하고 어떤 물품이 발견된 상위 10곳을 확인해 봅시다:\n\n\n<div class=\"content-ad\"></div>\n\n```js\ngr_location = df[[\"Location\"]].groupby(['Location'], as_index=False).size().sort_values(by=\"size\", ascending=False)\ndisplay(gr_location[:10])\n```\n\nThe output looks like this:\n\n![Map Image](/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_7.png)\n\nI have been to London several times, but my knowledge of London stations is not that good. Let’s draw all locations on the map, so it will be easier to see the places. I will use a Python geopy library to get the coordinates:\n\n<div class=\"content-ad\"></div>\n\n```python\nfrom geopy.geocoders import Nominatim\n\ngeolocator = Nominatim(user_agent=\"Python3.9\")\n\n@lru_cache(maxsize=None)\ndef get_coord_lat_lon(full_addr: str) -> Tuple[float, float]:\n    \"\"\" Get coordinates for address \"\"\"\n    pt = geolocator.geocode(full_addr + \", London, UK\")\n    return (pt.latitude, pt.longitude) if pt else (None, None)\n```\n\n여기서는 여러 번 코드를 실행하고 싶을 때 도움이 될 수 있는 lru_cache 데코레이터를 사용했어요. 데이터는 새로운 API 호출 대신 캐시에서 가져옵니다. 또한 처리 중에 진행률 표시줄을 볼 수 있게 해주는 tqdm Python 라이브러리를 사용했어요. 이는 처리가 몇 분 정도 걸리기 때문에 유용해요.\n\n처리가 완료된 후에 데이터프레임은 다음과 같이 보입니다:\n\n\n<div class=\"content-ad\"></div>\n\n\n![map](/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_9.png)\n\nNow, we're ready to draw a map. I will use the folium Python library for that:\n\n```python\nimport folium\nfrom branca.element import Figure\n\nfig = Figure(width=1024, height=600)\nfmap = folium.Map(location=(51.5, -0.104), tiles=\"openstreetmap\", zoom_start=12)\n\nfor _, row in gr_location.iterrows():\n    point = row[\"Coordinates\"]\n    name, amount = row[\"Location\"], row[\"size\"]\n    if point[0] is not None or point[1] is not None:\n        add_to_map(fmap, name, point, amount)\n\nfig.add_child(fmap)\ndisplay(fig)\n```\n\nI also created `add_to_map` and `value_to_color` methods, which help to add a station to the map:\n\n\n<div class=\"content-ad\"></div>\n\n```python\ndef value_to_color(value: int) -> str:\n    \"\"\" 값을 HTML 색상으로 변환합니다 \"\"\"\n    norm = matplotlib.colors.Normalize(vmin=0, vmax=255, clip=True)\n    mapper = colormap.ScalarMappable(norm=norm, cmap=colormap.inferno)\n    r, g, b, _ = mapper.to_rgba(value, alpha=None, bytes=True)\n    return \"#\" + f\"{(r << 16) + (g << 8) + b:#08x}\"[2:]\n\n\ndef add_to_map(fmap: folium.Map, name: str,\n               location: Tuple[float, float],\n               value: int):\n    \"\"\" 지도에 점을 추가합니다 \"\"\"\n    color_str = value_to_color(value)\n    folium.Circle(\n        location=location,\n        radius=10*value//2,\n        popup = name + \": \" + str(value),\n        color=color_str,\n        fill=True,\n        fill_color=color_str\n    ).add_to(fmap)\n```\n\n결과는 다음과 같습니다:\n\n<img src=\"/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_10.png\" />\n\n이 지도는 물건이 발견된 장소를 보여줍니다. 물건을 분실한 장소에 대해서는 알 수 없습니다 (특히 빠르게 이동하는 기차에서), 하지만 결과를 보는 것은 여전히 흥미로울 것입니다. 지도의 가장 큰 원들은 마지막 기차나 버스 정류장인 것으로 보입니다. 그러나 다른 역에서도 많은 물건들이 발견되었습니다. 독자들은 색상 맵 (제가 \"Inferno\" 팔레트를 사용했습니다) 및 원 크기와 같은 매개변수를 변경하여 더 나은 시각화를 얻을 수도 있습니다.\n\n\n<div class=\"content-ad\"></div>\n\n## 결론\n\n본 글에서는 공식 기관에게 공공 데이터를 요청하는 가능성과 이를 분석하여 런던 교통 수단에서 잃어버린 물품에 대한 흥미로운 결과를 얻을 수 있었습니다. 일반적으로 대중에게 공공 정보에 액세스할 수 있는 기회를 제공하는 것은 연구원과 데이터 애호가들이 흥미로운 데이터 조각을 찾는 데 도움이 되는 좋은 아이디어입니다. 어쨌든 통계는 우리에 관한 과학이죠. 결과적으로, 대중 교통에서 무언가를 분실할 확률은 0.01%에 해당한다는 것을 알 수 있었고, 앞으로 이 통계의 일부로 포함되지 않기를 바라며 모든 독자분들께 간청합니다 ;)\n\n사회 데이터 분석에 관심 있는 분들은 다음 기사들도 읽어보세요:\n\n- 데이터 탐색적 분석: 유튜브 채널에 대해 우리가 아는 것은 무엇인가\n- 독일 주택 임대 시장: Python으로 수행하는 데이터 탐색적 분석\n- 기후에 관해 사람들이 무엇을 쓰는지: Python에서 트위터 데이터 클러스터링\n- 트위터 글에서 시간적인 패턴 찾기: Python을 사용한 데이터 탐색적 분석\n- Python 데이터 분석: 팝송에 대해 우리가 아는 것은 무엇인가?\n\n<div class=\"content-ad\"></div>\n\n만약 이 이야기를 즐겼다면 Medium을 구독해보세요. 그러면 새 글이 올라올 때 알림을 받을 수 있을 뿐만 아니라 다른 작가들의 수천 개 이야기에도 완전한 액세스 권한을 얻을 수 있어요. LinkedIn을 통해 연락하셔도 좋고요. 이와 다른 포스트들의 전체 소스 코드를 얻고 싶으시다면 제 Patreon 페이지를 방문해주세요.\n\n읽어주셔서 감사합니다.","ogImage":{"url":"/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_0.png"},"coverImage":"/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_0.png","tag":["Tech"],"readingTime":11},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p>여러분께서도 짐을 버스에 두고 내려온 적이 있을 것 같아요. 다섯 분 뒤에 짐이 없어진 것을 깨닫지만 이미 버스가 떠났어요. 집에 돌아온 후 버스 회사 웹사이트를 확인해보니 분실한 짐을 청구할 수 있는 가능성이 있었고, 며칠 후 운종사에게 운종사에게 연락을 해서 짐을 다시 받을 수 있었어요. 저는 암스테르담에 살고 있는데, 여기의 대중교통은 iLost사와 협력 관계에 있어요. 누군가 분실한 물품을 청구할 수 있는 곳이랍니다. 이 사이트는 꽤 명확한 구조를 갖고 있으며 다른 사람들이 잊어버린 물품들을 볼 때에는 심지어 등록할 필요가 없어요 (개인 정보는 물론 숨겨져 있겠죠). 이런 데이터 지향적 사고방식이 있는 저는 ‘유레카’라는 순간을 겪었죠 — 이런 종류의 데이터는 문화 인류학적 관점에서 훌륭하다고 생각해서 대중교통 및 다른 장소에서 분실될 수 있는 물품에 대해 많은 것을 배울 수 있다고 생각했어요. 그러나 iLost의 라이선스 계약은 서면 동의 없이 데이터를 사용하는 것을 허가하지 않았기 때문에 제 질문에 아무도 답변하지 않았어요. 그럼에도 불구하고 이 아이디어를 마음에 품고 있던 저는 온라인에서 대안 소스를 찾기 시작했고 다음과 같은 것을 알게 되었어요:</p>\n<ul>\n<li>런던 교통 (TfL)도 분실물 품목을 청구하기 위한 좋은 서비스를 갖고 있어요.</li>\n<li>영국에는 공공 당국이 보유한 정보에 대한 공공 \"접근 권리\"를 만드는 정보의 자유법이 있어요. 모든 사람은 무료로 요청을 제기할 권리가 있으며 20일 이내에 응답을 받을 수 있어요. 그래서 가능하다면 TfL에게 \"분실 물품의 원시 데이터\"가 담긴 CSV 파일을 보내달라고 요청했고 2~3주 후에 (약속된 것처럼 빠르지 않았지만:) 파일을 받을 수 있었어요. 또한 TfL에게 이 데이터를 제 TDS 출판물에 사용할 수 있는지 물어봤고 긍정적인 답변을 받았죠.</li>\n</ul>\n<p>이것은 좋은 서비스인 것 같아요 (그런데 미국은 1967년 이후로 비슷한 법을 가지고 있어요) 그리고 과학자와 데이터 애호가들에게 연구에 공개 데이터를 활용할 수 있는 좋은 기회인 것 같아요. 그러니 말이 많지 않게, 우리가 어떤 정보를 얻을 수 있는지 한번 살펴봅시다. 원본 파일을 얻어 결과를 재현하고 싶은 분들은 아래에 댓글을 남겨주시면 링크를 공유해드릴게요.</p>\n<h2>데이터 로딩</h2>\n<p>우선 데이터를 로드하고 차원 및 유형을 확인해봅시다:</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd\n\ndf = pd.read_csv(<span class=\"hljs-string\">\"tfl.csv\"</span>)\ndisplay(df.head())\ndisplay(df.info(verbose=<span class=\"hljs-literal\">True</span>)\n</code></pre>\n<p>출력 결과는 다음과 같습니다:</p>\n<p>마크다운 형식으로 변경하면 다음과 같습니다:</p>\n<p><img src=\"/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_1.png\" alt=\"Exploratory Data Analysis Lost Property Items on the Transport of London\"></p>\n<p>아래에서 볼 수 있듯이 총 5245개의 항목이 있고 데이터프레임에는 NULL 항목이 없습니다. 날짜 형식이 표준이 아닌 것으로 보이므로 변환해보겠습니다:</p>\n<pre><code class=\"hljs language-python\">df[<span class=\"hljs-string\">\"Date Found\"</span>] = pd.to_datetime(df[<span class=\"hljs-string\">\"Date Found\"</span>], <span class=\"hljs-built_in\">format</span>=<span class=\"hljs-string\">\"%d/%m/%Y\"</span>)\n</code></pre>\n<p>다음 단계로 어떤 종류의 카테고리가 있는지 알아보겠습니다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-title function_\">display</span>(df[<span class=\"hljs-string\">\"Category\"</span>].<span class=\"hljs-title function_\">unique</span>())\n</code></pre>\n<p>위 결과에서 숫자가 그리 크지 않다는 것을 보여줍니다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-title function_\">array</span>([<span class=\"hljs-string\">'Bags'</span>, <span class=\"hljs-string\">'Electronics &#x26; Technology'</span>, <span class=\"hljs-string\">'Wallets &#x26; Purses'</span>,\n       <span class=\"hljs-string\">'Baby &#x26; Nursery'</span>, <span class=\"hljs-string\">'ID &#x26; Personal Documents'</span>, <span class=\"hljs-string\">'Health &#x26; Beauty'</span>,\n       <span class=\"hljs-string\">'Tools / Garden / DIY'</span>, <span class=\"hljs-string\">'Jewellery'</span>, <span class=\"hljs-string\">'Travel Cards &#x26; Ticket'</span>,\n       <span class=\"hljs-string\">'Household &#x26; General Items'</span>, <span class=\"hljs-string\">'Keys'</span>, <span class=\"hljs-string\">'Sports &#x26; Leisure'</span>, <span class=\"hljs-string\">'Eyewear'</span>,\n       <span class=\"hljs-string\">'Currency (cash)'</span>, <span class=\"hljs-string\">'Stationery &#x26; Books'</span>, <span class=\"hljs-string\">'Clothing'</span>,\n       <span class=\"hljs-string\">'Financial Documents'</span>], dtype=object)\n</code></pre>\n<p>시각화를 더 잘 보이게 하기 위해 \"Electronics &#x26; Technology\" 카테고리를 \"Electronics\"로 변경하고 모든 \"Document\" 카테고리를 한 가지로 결합하기로 결정했습니다:</p>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">update_category</span>(<span class=\"hljs-attr\">name</span>: str) -> <span class=\"hljs-attr\">str</span>:\n    <span class=\"hljs-string\">\"\"</span><span class=\"hljs-string\">\"카테고리 이름 업데이트\"</span><span class=\"hljs-string\">\"\"</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">\"문서\"</span> <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">name</span>:\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"문서\"</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">\"전자제품\"</span> <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">name</span>:\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"전자제품\"</span>\n    <span class=\"hljs-keyword\">return</span> name\n\ndf[<span class=\"hljs-string\">\"Category\"</span>] = df[<span class=\"hljs-string\">\"Category\"</span>].<span class=\"hljs-title function_\">map</span>(update_category)\n</code></pre>\n<p>날짜와 카테고리 변환을 마친 후, 최종 데이터프레임은 다음과 같습니다:</p>\n<h2>하루 평균 아이템</h2>\n<p>이제 재미를 봐봅시다. 모든 항목을 날짜별로 그룹화하고 막대 차트를 그려봅시다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> plotly.<span class=\"hljs-property\">express</span> <span class=\"hljs-keyword\">as</span> px\n\ngr_day = df[[<span class=\"hljs-string\">\"Date Found\"</span>]].<span class=\"hljs-title function_\">groupby</span>([<span class=\"hljs-string\">\"Date Found\"</span>], as_index=<span class=\"hljs-title class_\">False</span>).<span class=\"hljs-title function_\">size</span>()\n\nfig = px.<span class=\"hljs-title function_\">bar</span>(gr_day, x=<span class=\"hljs-string\">\"Date Found\"</span>, y=<span class=\"hljs-string\">\"size\"</span>,\n             title=<span class=\"hljs-string\">\"&#x3C;span style='font-size:18px;'>&#x3C;b>TfL, Lost Items Per Day&#x3C;/b>&#x3C;/span>&#x3C;b>&#x3C;/b>\"</span>,\n             width=<span class=\"hljs-number\">1280</span>, height=<span class=\"hljs-number\">500</span>)\nfig.<span class=\"hljs-title function_\">update_xaxes</span>(tickformat=<span class=\"hljs-string\">\"%a, %d-%m-%Y\"</span>, showline=<span class=\"hljs-title class_\">True</span>, linecolor=<span class=\"hljs-string\">\"black\"</span>)\nfig.<span class=\"hljs-title function_\">update_layout</span>(xaxis_title=<span class=\"hljs-title class_\">None</span>, yaxis_title=<span class=\"hljs-title class_\">None</span>, plot_bgcolor=<span class=\"hljs-string\">\"#F5F5F5\"</span>,\n                  margin=<span class=\"hljs-title function_\">dict</span>(l=<span class=\"hljs-number\">50</span>, r=<span class=\"hljs-number\">50</span>, t=<span class=\"hljs-number\">30</span>, b=<span class=\"hljs-number\">50</span>))\nfig.<span class=\"hljs-title function_\">show</span>()\n</code></pre>\n<p>여기서는 오픈 소스 라이브러리 Plotly를 사용하여 차트를 작성했습니다. 이 라이브러리는 plotly.js를 기반으로 하므로 HTML 형식을 사용하여 스타일을 변경할 수 있습니다. 또한 출력물은 대화형이기 때문에 노트북에서 이미지를 바로 확대 또는 이동할 수 있습니다.</p>\n<p>출력물은 다음과 같습니다:</p>\n<p><img src=\"/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_3.png\" alt=\"이미지\"></p>\n<p>이 결과를 보면 대중교통에서 물건을 분실할 확률을 계산하는 것이 흥미로울 것 같아요. 이 특정 날짜의 승객 수는 정확히 모르지만, 일반적으로 런던의 대중교통은 하루에 약 600만 명의 승객을 처리한다는 것을 알고 있습니다. 그래프에서 볼 수 있듯이, 분실 물품의 수는 꽤 일정합니다. 간단한 계산을 통해 대중교통에서 물건을 분실할 확률이 약 0.01% 정도라는 것을 알 수 있습니다. 이 값 자체는 크지 않지만, 매일 적어도 10,000 명의 사람 중 한 명은 이러한 사건을 겪을 수 있습니다.</p>\n<p>또 다른 흥미로운 발견은 목요일에 뾰족한 부분이 있습니다. 왜 이렇게 발생하는지는 모르겠지만, 다른 TfL 보도자료에서도 목요일을 가장 많은 승객이 있는 날로 언급했어요. 이에 대한 사회적 설명이 있는지 알지 못하지만, 흥미롭게 보입니다.</p>\n<h2>카테고리</h2>\n<p>다음 단계로 카테고리와 하위 카테고리별로 모든 상품을 그룹화해 보겠습니다:</p>\n<pre><code class=\"hljs language-js\">gr_cat = df[[<span class=\"hljs-string\">\"Category\"</span>,\n             <span class=\"hljs-string\">\"Sub-Category\"</span>]].<span class=\"hljs-title function_\">groupby</span>([<span class=\"hljs-string\">\"Category\"</span>,\n                                       <span class=\"hljs-string\">\"Sub-Category\"</span>], as_index=<span class=\"hljs-title class_\">False</span>).<span class=\"hljs-title function_\">size</span>()\n</code></pre>\n<p>다양한 종류의 시각화를 시도해 보았고, 그 중에서도 가장 유익하다고 생각되는 두 가지를 소개하겠습니다. 먼저, 2차원 원형 차트와 같은 선버스트 차트를 그려보겠습니다:</p>\n<pre><code class=\"hljs language-js\">fig = px.<span class=\"hljs-title function_\">sunburst</span>(gr_cat, width=<span class=\"hljs-number\">1280</span>, height=<span class=\"hljs-number\">800</span>,\n                  path=[<span class=\"hljs-string\">\"Category\"</span>, <span class=\"hljs-string\">\"Sub-Category\"</span>], values=<span class=\"hljs-string\">\"size\"</span>,\n                  color=<span class=\"hljs-string\">\"Category\"</span>,\n                  title=<span class=\"hljs-string\">\"&#x3C;span style='font-size:18px;'>&#x3C;b>TfL, Lost Items Chart&#x3C;/b>&#x3C;/span>&#x3C;b>&#x3C;/b>\"</span>\n                  )\nfig.<span class=\"hljs-title function_\">update_layout</span>(font_size=<span class=\"hljs-number\">10</span>, margin=<span class=\"hljs-title function_\">dict</span>(l=<span class=\"hljs-number\">10</span>, r=<span class=\"hljs-number\">10</span>, t=<span class=\"hljs-number\">30</span>, b=<span class=\"hljs-number\">50</span>))\nfig.<span class=\"hljs-title function_\">update_traces</span>(textinfo=<span class=\"hljs-string\">\"label+percent parent\"</span>)\nfig.<span class=\"hljs-title function_\">show</span>()\n</code></pre>\n<p>다음처럼 출력됩니다:</p>\n<p><img src=\"/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_4.png\" alt=\"이미지\"></p>\n<p>다양한 세그먼트를 쉽게 비교할 수 있습니다. 예를 들어, “가방”과 “전자제품”이 “유실 차트”의 상단에 있음을 확인할 수 있습니다(각각 19%와 15%). “가방” 카테고리에서는 승객들이 가장 자주(36%) 배낭을 잃어버립니다. 이는 배낭을 가지고 서거나 앉는 것이 불편하고, 사람들이 벗어 두기 때문에 이해할 수 있습니다. “전자제품” 카테고리에서는 모바일 폰이 가장 많습니다(58%). 다른 카테고리에서는 10%의 불운한 승객이 문서를 분실했고, 4%가 열쇠를 분실했습니다.</p>\n<p>선셋 차트가 흥미로워 보이지만, 좁은 세그먼트를 읽기 어려울 수 있습니다. 다른 대안은 트리맵 차트입니다:</p>\n<pre><code class=\"hljs language-python\">fig = px.treemap(gr_cat, width=<span class=\"hljs-number\">1280</span>, height=<span class=\"hljs-number\">800</span>,\n                 path=[<span class=\"hljs-string\">'Category'</span>, <span class=\"hljs-string\">'Sub-Category'</span>], values=<span class=\"hljs-string\">'size'</span>,\n                 color=<span class=\"hljs-string\">'Category'</span>)\nfig.update_traces(textinfo=<span class=\"hljs-string\">\"label+percent parent\"</span>)\nfig.show()\n</code></pre>\n<p>위의 코드를 실행하면 이와 같은 출력물이 나옵니다:</p>\n<p>이 경우, 마우스를 호버하여 작은 하위 카테고리의 데이터를 쉽게 읽을 수 있습니다. 반면, 파이 차트를 사용하면 다른 카테고리 간의 상대적인 크기를 더 쉽게 이해할 수 있습니다.</p>\n<h2>하위 카테고리</h2>\n<p>\"전자제품\" 카테고리를 자세히 살펴보겠습니다. 이를 위해 데이터프레임을 필터링하고, 모든 항목을 하위 카테고리별로 그룹화하여 막대 그래프를 그릴 수 있습니다:</p>\n<pre><code class=\"hljs language-js\">df_ = df[df[<span class=\"hljs-string\">\"Category\"</span>] == <span class=\"hljs-string\">\"전자제품\"</span>]\ngr_electronics = df_[[<span class=\"hljs-string\">\"하위 카테고리\"</span>]].<span class=\"hljs-title function_\">groupby</span>([<span class=\"hljs-string\">\"하위 카테고리\"</span>], as_index=<span class=\"hljs-title class_\">False</span>).<span class=\"hljs-title function_\">size</span>().<span class=\"hljs-title function_\">sort_values</span>(by=<span class=\"hljs-string\">\"size\"</span>, ascending=<span class=\"hljs-title class_\">True</span>)\n\nfig = px.<span class=\"hljs-title function_\">bar</span>(gr_electronics, width=<span class=\"hljs-number\">1280</span>, height=<span class=\"hljs-number\">600</span>, \n             title=<span class=\"hljs-string\">\"&#x3C;span style='font-size:18px;'>&#x3C;b>TfL, 분실물 주간별 전자제품&#x3C;/b>&#x3C;/span>&#x3C;b>&#x3C;/b>\"</span>,\n             x=<span class=\"hljs-string\">\"size\"</span>, y=<span class=\"hljs-string\">\"하위 카테고리\"</span>, orientation=<span class=\"hljs-string\">\"h\"</span>)\nfig.<span class=\"hljs-title function_\">update_layout</span>(xaxis_title=<span class=\"hljs-string\">\"수량\"</span>, yaxis_title=<span class=\"hljs-title class_\">None</span>,\n                  plot_bgcolor=<span class=\"hljs-string\">\"#F5F5F5\"</span>,\n                  margin=<span class=\"hljs-title function_\">dict</span>(l=<span class=\"hljs-number\">50</span>, r=<span class=\"hljs-number\">50</span>, t=<span class=\"hljs-number\">30</span>, b=<span class=\"hljs-number\">50</span>))\nfig.<span class=\"hljs-title function_\">show</span>()\n</code></pre>\n<p>여기에서는 라벨을 읽기 쉽게하기 위해 가로 막대 차트를 사용했습니다. 결과는 다음과 같습니다:</p>\n<p><img src=\"/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_6.png\" alt=\"image\"></p>\n<p>우리가 볼 수 있듯이, 대부분의 승객이 핸드폰이나 핸드폰 액세서리를 분실한 것이 분명합니다. 어떤 사람들은 노트북, 태블릿 또는 e-리더를 분실했으며, 한 명의 승객이 MP3 플레이어를 분실했습니다(요즘에는 조금 특이한 장치입니다). 놀랍게도 숫자가 상당히 많습니다. 데이터 집합은 일주일 동안의 데이터를 나타내며, 우리가 보기로는 이 기간 동안 총 467명의 승객이 핸드폰을 분실했습니다.</p>\n<h2>위치</h2>\n<p>간단한 연습으로 데이터를 위치별로 그룹화하고 어떤 물품이 발견된 상위 10곳을 확인해 봅시다:</p>\n<pre><code class=\"hljs language-js\">gr_location = df[[<span class=\"hljs-string\">\"Location\"</span>]].<span class=\"hljs-title function_\">groupby</span>([<span class=\"hljs-string\">'Location'</span>], as_index=<span class=\"hljs-title class_\">False</span>).<span class=\"hljs-title function_\">size</span>().<span class=\"hljs-title function_\">sort_values</span>(by=<span class=\"hljs-string\">\"size\"</span>, ascending=<span class=\"hljs-title class_\">False</span>)\n<span class=\"hljs-title function_\">display</span>(gr_location[:<span class=\"hljs-number\">10</span>])\n</code></pre>\n<p>The output looks like this:</p>\n<p><img src=\"/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_7.png\" alt=\"Map Image\"></p>\n<p>I have been to London several times, but my knowledge of London stations is not that good. Let’s draw all locations on the map, so it will be easier to see the places. I will use a Python geopy library to get the coordinates:</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> geopy.geocoders <span class=\"hljs-keyword\">import</span> Nominatim\n\ngeolocator = Nominatim(user_agent=<span class=\"hljs-string\">\"Python3.9\"</span>)\n\n<span class=\"hljs-meta\">@lru_cache(<span class=\"hljs-params\">maxsize=<span class=\"hljs-literal\">None</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_coord_lat_lon</span>(<span class=\"hljs-params\">full_addr: <span class=\"hljs-built_in\">str</span></span>) -> <span class=\"hljs-type\">Tuple</span>[<span class=\"hljs-built_in\">float</span>, <span class=\"hljs-built_in\">float</span>]:\n    <span class=\"hljs-string\">\"\"\" Get coordinates for address \"\"\"</span>\n    pt = geolocator.geocode(full_addr + <span class=\"hljs-string\">\", London, UK\"</span>)\n    <span class=\"hljs-keyword\">return</span> (pt.latitude, pt.longitude) <span class=\"hljs-keyword\">if</span> pt <span class=\"hljs-keyword\">else</span> (<span class=\"hljs-literal\">None</span>, <span class=\"hljs-literal\">None</span>)\n</code></pre>\n<p>여기서는 여러 번 코드를 실행하고 싶을 때 도움이 될 수 있는 lru_cache 데코레이터를 사용했어요. 데이터는 새로운 API 호출 대신 캐시에서 가져옵니다. 또한 처리 중에 진행률 표시줄을 볼 수 있게 해주는 tqdm Python 라이브러리를 사용했어요. 이는 처리가 몇 분 정도 걸리기 때문에 유용해요.</p>\n<p>처리가 완료된 후에 데이터프레임은 다음과 같이 보입니다:</p>\n<p><img src=\"/assets/img/2024-05-20-ExploratoryDataAnalysisLostPropertyItemsontheTransportofLondon_9.png\" alt=\"map\"></p>\n<p>Now, we're ready to draw a map. I will use the folium Python library for that:</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> folium\n<span class=\"hljs-keyword\">from</span> branca.element <span class=\"hljs-keyword\">import</span> Figure\n\nfig = Figure(width=<span class=\"hljs-number\">1024</span>, height=<span class=\"hljs-number\">600</span>)\nfmap = folium.Map(location=(<span class=\"hljs-number\">51.5</span>, -<span class=\"hljs-number\">0.104</span>), tiles=<span class=\"hljs-string\">\"openstreetmap\"</span>, zoom_start=<span class=\"hljs-number\">12</span>)\n\n<span class=\"hljs-keyword\">for</span> _, row <span class=\"hljs-keyword\">in</span> gr_location.iterrows():\n    point = row[<span class=\"hljs-string\">\"Coordinates\"</span>]\n    name, amount = row[<span class=\"hljs-string\">\"Location\"</span>], row[<span class=\"hljs-string\">\"size\"</span>]\n    <span class=\"hljs-keyword\">if</span> point[<span class=\"hljs-number\">0</span>] <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span> <span class=\"hljs-keyword\">or</span> point[<span class=\"hljs-number\">1</span>] <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-literal\">None</span>:\n        add_to_map(fmap, name, point, amount)\n\nfig.add_child(fmap)\ndisplay(fig)\n</code></pre>\n<p>I also created <code>add_to_map</code> and <code>value_to_color</code> methods, which help to add a station to the map:</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">value_to_color</span>(<span class=\"hljs-params\">value: <span class=\"hljs-built_in\">int</span></span>) -> <span class=\"hljs-built_in\">str</span>:\n    <span class=\"hljs-string\">\"\"\" 값을 HTML 색상으로 변환합니다 \"\"\"</span>\n    norm = matplotlib.colors.Normalize(vmin=<span class=\"hljs-number\">0</span>, vmax=<span class=\"hljs-number\">255</span>, clip=<span class=\"hljs-literal\">True</span>)\n    mapper = colormap.ScalarMappable(norm=norm, cmap=colormap.inferno)\n    r, g, b, _ = mapper.to_rgba(value, alpha=<span class=\"hljs-literal\">None</span>, <span class=\"hljs-built_in\">bytes</span>=<span class=\"hljs-literal\">True</span>)\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"#\"</span> + <span class=\"hljs-string\">f\"<span class=\"hljs-subst\">{(r &#x3C;&#x3C; <span class=\"hljs-number\">16</span>) + (g &#x3C;&#x3C; <span class=\"hljs-number\">8</span>) + b:#08x}</span>\"</span>[<span class=\"hljs-number\">2</span>:]\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">add_to_map</span>(<span class=\"hljs-params\">fmap: folium.Map, name: <span class=\"hljs-built_in\">str</span>,\n               location: <span class=\"hljs-type\">Tuple</span>[<span class=\"hljs-built_in\">float</span>, <span class=\"hljs-built_in\">float</span>],\n               value: <span class=\"hljs-built_in\">int</span></span>):\n    <span class=\"hljs-string\">\"\"\" 지도에 점을 추가합니다 \"\"\"</span>\n    color_str = value_to_color(value)\n    folium.Circle(\n        location=location,\n        radius=<span class=\"hljs-number\">10</span>*value//<span class=\"hljs-number\">2</span>,\n        popup = name + <span class=\"hljs-string\">\": \"</span> + <span class=\"hljs-built_in\">str</span>(value),\n        color=color_str,\n        fill=<span class=\"hljs-literal\">True</span>,\n        fill_color=color_str\n    ).add_to(fmap)\n</code></pre>\n<p>결과는 다음과 같습니다:</p>\n<p>이 지도는 물건이 발견된 장소를 보여줍니다. 물건을 분실한 장소에 대해서는 알 수 없습니다 (특히 빠르게 이동하는 기차에서), 하지만 결과를 보는 것은 여전히 흥미로울 것입니다. 지도의 가장 큰 원들은 마지막 기차나 버스 정류장인 것으로 보입니다. 그러나 다른 역에서도 많은 물건들이 발견되었습니다. 독자들은 색상 맵 (제가 \"Inferno\" 팔레트를 사용했습니다) 및 원 크기와 같은 매개변수를 변경하여 더 나은 시각화를 얻을 수도 있습니다.</p>\n<h2>결론</h2>\n<p>본 글에서는 공식 기관에게 공공 데이터를 요청하는 가능성과 이를 분석하여 런던 교통 수단에서 잃어버린 물품에 대한 흥미로운 결과를 얻을 수 있었습니다. 일반적으로 대중에게 공공 정보에 액세스할 수 있는 기회를 제공하는 것은 연구원과 데이터 애호가들이 흥미로운 데이터 조각을 찾는 데 도움이 되는 좋은 아이디어입니다. 어쨌든 통계는 우리에 관한 과학이죠. 결과적으로, 대중 교통에서 무언가를 분실할 확률은 0.01%에 해당한다는 것을 알 수 있었고, 앞으로 이 통계의 일부로 포함되지 않기를 바라며 모든 독자분들께 간청합니다 ;)</p>\n<p>사회 데이터 분석에 관심 있는 분들은 다음 기사들도 읽어보세요:</p>\n<ul>\n<li>데이터 탐색적 분석: 유튜브 채널에 대해 우리가 아는 것은 무엇인가</li>\n<li>독일 주택 임대 시장: Python으로 수행하는 데이터 탐색적 분석</li>\n<li>기후에 관해 사람들이 무엇을 쓰는지: Python에서 트위터 데이터 클러스터링</li>\n<li>트위터 글에서 시간적인 패턴 찾기: Python을 사용한 데이터 탐색적 분석</li>\n<li>Python 데이터 분석: 팝송에 대해 우리가 아는 것은 무엇인가?</li>\n</ul>\n<p>만약 이 이야기를 즐겼다면 Medium을 구독해보세요. 그러면 새 글이 올라올 때 알림을 받을 수 있을 뿐만 아니라 다른 작가들의 수천 개 이야기에도 완전한 액세스 권한을 얻을 수 있어요. LinkedIn을 통해 연락하셔도 좋고요. 이와 다른 포스트들의 전체 소스 코드를 얻고 싶으시다면 제 Patreon 페이지를 방문해주세요.</p>\n<p>읽어주셔서 감사합니다.</p>\n</body>\n</html>\n"},"__N_SSG":true}