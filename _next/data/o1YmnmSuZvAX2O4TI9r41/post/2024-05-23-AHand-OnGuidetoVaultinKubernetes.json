{"pageProps":{"post":{"title":" ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ Vault ì‚¬ìš© ë°©ë²• ì•ˆë‚´ ","description":"","date":"2024-05-23 14:19","slug":"2024-05-23-AHand-OnGuidetoVaultinKubernetes","content":"\n## â‡¢ ì‹¤ìš©ì ì¸ ì˜ˆì œë¡œ HashiCorp Vaultë¥¼ ì‚¬ìš©í•˜ì—¬ k8s Secrets ê´€ë¦¬í•˜ê¸°\n\n![image](/assets/img/2024-05-23-AHand-OnGuidetoVaultinKubernetes_0.png)\n\nì¿ ë²„ë„¤í‹°ìŠ¤ ì„¸ê³„ì—ì„œ API í‚¤, ë¹„ë°€ë²ˆí˜¸ ë° ê¸°íƒ€ ì¤‘ìš” ì •ë³´ì™€ ê°™ì€ ë³´ì•ˆ ì •ë³´ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì€ ë§¤ìš° ì¤‘ìš”í•œ ì‘ì—…ì…ë‹ˆë‹¤. ì¿ ë²„ë„¤í‹°ìŠ¤ì—ëŠ” ë‚´ì¥ëœ ë³´ì•ˆ ì •ë³´ ê´€ë¦¬ ë©”ì»¤ë‹ˆì¦˜ì´ ìˆì§€ë§Œ, ëª¨ë“  ì¡°ì§ì˜ ë³´ì•ˆ ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±ì‹œí‚¤ì§€ ëª»í•  ìˆ˜ë„ ìˆëŠ” íŠ¹ì • ì œí•œ ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì¿ ë²„ë„¤í‹°ìŠ¤ ë³´ì•ˆ ì •ë³´ëŠ” etcdì— ì €ì¥ë˜ë©°, ì´ëŠ” íœ´ì‹ ì¤‘ ì•”í˜¸í™”ë˜ì–´ ìˆì§€ë§Œ, ë§¤ìš° ì¤‘ìš”í•œ ì •ë³´ì— í•„ìš”í•œ ë³´ì•ˆ ìˆ˜ì¤€ê³¼ ì ‘ê·¼ ì œì–´ë¥¼ ì œê³µí•˜ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì´ë•Œ HashiCorp Vaultê°€ ë“±ì¥í•©ë‹ˆë‹¤. VaultëŠ” ì¤‘ìš”í•œ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì„¤ê³„ëœ ë„êµ¬ì…ë‹ˆë‹¤. ë™ì  ë³´ì•ˆ ì •ë³´, ì„œë¹„ìŠ¤ë¡œì˜ ì•”í˜¸í™” ë° ì ‘ê·¼ ì œì–´ë¥¼ ìœ„í•œ ê²¬ê³ í•œ ë©”ì»¤ë‹ˆì¦˜ì„ ì œê³µí•˜ì—¬, ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì—ì„œ ë³´ì•ˆ ì •ë³´ë¥¼ ê´€ë¦¬í•˜ê¸°ì— ì´ìƒì ì¸ ì†”ë£¨ì…˜ì…ë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\nì´ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” Helmì„ ì‚¬ìš©í•˜ì—¬ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— Vaultë¥¼ ì„¤ì¹˜í•˜ê³  êµ¬ì„±í•˜ëŠ” ë‹¨ê³„ë¥¼ ì•ˆë‚´í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  Podë¥¼ ë°°í¬í•˜ì—¬ Vaultì—ì„œ ë¹„ë°€ì„ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡í•©ë‹ˆë‹¤. ì´ ì•ˆë‚´ì„œë¥¼ ë§ˆì¹˜ë©´ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— ì‘ë™í•˜ëŠ” Vault ì„¤ì •ì´ ì™„ë£Œë˜ì–´ ì‘ìš© í”„ë¡œê·¸ë¨ ë¹„ë°€ì„ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n# ì „ì œ ì¡°ê±´\n\nì‹œì‘í•˜ê¸° ì „ì— ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”:\n\n- ì‹¤í–‰ ì¤‘ì¸ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.\n- í´ëŸ¬ìŠ¤í„°ì™€ ìƒí˜¸ ì‘ìš©í•˜ë„ë¡ êµ¬ì„±ëœ kubectlì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.\n- ë¡œì»¬ ë¨¸ì‹ ì— Helmì´ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\n<img src=\"https://miro.medium.com/v2/resize:fit:1400/1*jmt8bsoEGeVHv5ZUP7XY_Q.gif\" />\n\n# ë³´ë¥´íŠ¸(Namespace) ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„±í•˜ê¸°\n\nìš°ì„ , ë³´ë¥´íŠ¸(Vault)ë¥¼ ìœ„í•œ ë³„ë„ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë³´ë¥´íŠ¸ì— íŠ¹í™”ëœ ë¦¬ì†ŒìŠ¤ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```js\n$ kubectl create ns vault\n```\n\n<div class=\"content-ad\"></div>\n\n# Vault ì„¤ì¹˜\n\nìš°ë¦¬ëŠ” HashiCorpê°€ ì œê³µí•˜ëŠ” Helm ì°¨íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ Vaultì˜ ìµœì‹  ë²„ì „ì„ ì„¤ì¹˜í•  ê²ƒì…ë‹ˆë‹¤. ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë‘ ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤: 1. HashiCorp Helm ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ Helm ì„¤ì¹˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê±°ë‚˜ 2. Helm ì°¨íŠ¸ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë¡œì»¬ë¡œ ì„¤ì¹˜í•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.\n\n## 1. HashiCorp Helm ë¦¬í¬ì§€í† ë¦¬ ì¶”ê°€\n\nHashiCorp Helm ë¦¬í¬ì§€í† ë¦¬ë¥¼ Helm êµ¬ì„±ì— ì¶”ê°€í•´ë³´ì„¸ìš”.\n\n<div class=\"content-ad\"></div>\n\n```js\nhelm repo add hashicorp https://helm.releases.hashicorp.com\n```\n\n## 2. ì„¤ì¹˜ ë°©ë²•\n\n1. ì§ì ‘ Helm ì„¤ì¹˜ ì‹¤í–‰í•˜ê¸°\n\në‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ HashiCorp ì €ì¥ì†Œì—ì„œ Helm ì°¨íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ Vaultë¥¼ ì§ì ‘ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n```js\nhelm install vault hashicorp/vault \\\n       --set='server.dev.enabled=true' \\\n       --set='ui.enabled=true' \\\n       --set='ui.serviceType=LoadBalancer' \\\n       --namespace vault\n```\n\n2. Helm ì°¨íŠ¸ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜\n\nëŒ€ì•ˆìœ¼ë¡œ Helm ì°¨íŠ¸ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ë¡œì»¬ë¡œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n```js\n# Helm ì°¨íŠ¸ ë‹¤ìš´ë¡œë“œ\nhelm pull hashicorp/vault --untar\n\n# ë‹¤ìš´ë¡œë“œí•œ ì°¨íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ Vault ì„¤ì¹˜\nhelm install vault \\\n       --set='server.dev.enabled=true' \\\n       --set='ui.enabled=true' \\\n       --set='ui.serviceType=LoadBalancer' \\\n       --namespace vault \\\n       ./vault-chart\n```\n\n<div class=\"content-ad\"></div>\n\nì´ ì„¤ì •ì„ ì‚¬ìš©í•˜ì—¬ UIê°€ í™œì„±í™”ëœ Vaultë¥¼ ê°œë°œ ëª¨ë“œë¡œ ì„¤ì¹˜í•˜ê³  ì™¸ë¶€ì—ì„œ ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ LoadBalancer ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ë…¸ì¶œí•©ë‹ˆë‹¤. ì´ ì„¤ì •ì€ í…ŒìŠ¤íŠ¸ ë° ê°œë°œ ëª©ì ìœ¼ë¡œ ì´ìƒì ì…ë‹ˆë‹¤.\n\nê²°ê³¼:\n\n```js\n$ kubectl get all -n vault\nNAME                                        READY   STATUS    RESTARTS   AGE\npod/vault-0                                 1/1     Running   0          2m39s\npod/vault-agent-injector-8497dd4457-8jgcm   1/1     Running   0          2m39s\n\nNAME                               TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)             AGE\nservice/vault                      ClusterIP      10.245.225.169   <none>         8200/TCP,8201/TCP   2m40s\nservice/vault-agent-injector-svc   ClusterIP      10.245.32.56     <none>         443/TCP             2m40s\nservice/vault-internal             ClusterIP      None             <none>         8200/TCP,8201/TCP   2m40s\nservice/vault-ui                   LoadBalancer   10.245.103.246   24.132.59.59   8200:31764/TCP      2m40s\n\nNAME                                   READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/vault-agent-injector   1/1     1            1           2m40s\n\nNAME                                              DESIRED   CURRENT   READY   AGE\nreplicaset.apps/vault-agent-injector-8497dd4457   1         1         1       2m40s\n\nNAME                     READY   AGE\nstatefulset.apps/vault   1/1     2m40s\n```\n\n# Vault êµ¬ì„±\n\n<div class=\"content-ad\"></div>\n\nì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” Kubernetes í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ì•ˆì „í•˜ê²Œ ë¹„ë°€ì„ ê´€ë¦¬í•˜ê³  ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ Vault ì •ì±…ê³¼ ì¸ì¦ ë°©ë²•ì„ ì„¤ì •í•  ê²ƒì…ë‹ˆë‹¤. ì´ êµ¬ì„±ì€ ì¸ì¦ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ë§Œ Vaultì—ì„œ ë¯¼ê°í•œ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.\n\n## 1. Vault Podì— ì—°ê²°í•˜ê¸°\n\nì„¤ì¹˜ê°€ ì™„ë£Œëœ í›„ Vault podì— ì—°ê²°í•˜ì—¬ ì´ˆê¸° êµ¬ì„±ì„ ìˆ˜í–‰í•˜ì„¸ìš”:\n\n```js\nkubectl exec -it vault-0 -- /bin/sh\n```\n\n<div class=\"content-ad\"></div>\n\n## 2. ì •ì±… ìƒì„± ë° ì ìš©í•˜ê¸°\n\nì´ì œ ë¹„ë°€ì„ ì½ì„ ìˆ˜ ìˆëŠ” ì •ì±…ì„ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤. ì´ ì •ì±…ì€ ì—­í• ì— ì²¨ë¶€ë˜ì–´ íŠ¹ì • Kubernetes ì„œë¹„ìŠ¤ ê³„ì •ì— ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì •ì±… íŒŒì¼ì„ ìƒì„±í•˜ì„¸ìš”:\n\n```js\ncat <<EOF > /home/vault/read-policy.hcl\npath \"secret*\" {\n  capabilities = [\"read\"]\n}\nEOF\n```\n\n<div class=\"content-ad\"></div>\n\nì•„ë˜ì™€ ê°™ì´ ì •ì±…ì„ ì ìš©í•´ì£¼ì„¸ìš”:\n\n```js\n# ë¬¸ë²•\n$ vault policy write <ì •ì±…ëª…> /ì •ì±…/ê²½ë¡œ/ì—¬ê¸°ì—.hcl\n\n# ì˜ˆì‹œ\n$ vault policy write read-policy /home/vault/read-policy.hcl\n```\n\n## 3. Kubernetes ì¸ì¦ í™œì„±í™”\n\nVaultì—ì„œ Kubernetes ì¸ì¦ ë°©ë²•ì„ í™œì„±í™”í•˜ì„¸ìš”.\n\n<div class=\"content-ad\"></div>\n\n```js\nvault auth enable kubernetes\n```\n\n## 4. Kubernetes ì¸ì¦ ì„¤ì •\n\nVaultê°€ Kubernetes API ì„œë²„ì™€ í†µì‹ í•˜ë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤:\n\n```js\nvault write auth/kubernetes/config \\\n   token_reviewer_jwt=\"$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\" \\\n   kubernetes_host=https://${KUBERNETES_PORT_443_TCP_ADDR}:443 \\\n   kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n```\n\n<div class=\"content-ad\"></div>\n\n## 5. ì—­í•  ìƒì„±\n\níŠ¹ì • ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ìˆëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤ ê³„ì •(vault-serviceaccount)ì— ìœ„ì—ì„œ ë§Œë“  ì •ì±…ì„ ë°”ì¸ë”©í•˜ëŠ” ì—­í• (vault-role)ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ ê³„ì •ì´ Vaultì— ì €ì¥ëœ ì‹œí¬ë¦¿ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤:\n\n```js\nvault write auth/kubernetes/role/vault-role \\\n   bound_service_account_names=vault-serviceaccount \\\n   bound_service_account_namespaces=vault \\\n   policies=read-policy \\\n   ttl=1h\n```\n\nì—¬ê¸°ì„œ ì—¬ëŸ¬ ê°œì˜ ì„œë¹„ìŠ¤ ê³„ì •ê³¼ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n```bash\nvault write auth/kubernetes/role/<my-role> \\\n   bound_service_account_names=sa1, sa2 \\\n   bound_service_account_namespaces=namespace1, namespace2 \\\n   policies=<policy-name> \\\n   ttl=1h\n```\n\n# ë³´ì•ˆ ì •ë³´ ë§Œë“¤ê¸°\n\nì´ì œ Vaultì— ì¼ë¶€ ë³´ì•ˆ ì •ë³´ë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤:\n\nìš°ë¦¬ëŠ” ë‘ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ë³´ì•ˆ ì •ë³´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”:\n\n<div class=\"content-ad\"></div>\n\n- Vault CLIë¥¼ ì‚¬ìš©í•˜ê¸°\n\n## 1. Vault CLI ì‚¬ìš©í•˜ê¸°\n\nì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œí¬ë¦¿ì„ ìƒì„±í•˜ì„¸ìš”\n\n```js\n$ vault kv put secret/login pattoken=ytbuytbytbf765rb65u56rv\n```\n\n<div class=\"content-ad\"></div>\n\nì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œí¬ë¦¿ì„ ë‚˜ì—´í•˜ì—¬ ë¹„ë°€ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n```js\n$ vault kv list secret\nKeys\n----\nlogin\n```\n\n## 2. Vault UI ì‚¬ìš© ë°©ë²•\n\nVault ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ì„œë¹„ìŠ¤ë¥¼ ë‚˜ì—´í•˜ì—¬ ë¡œë“œ ë°¸ëŸ°ì„œì˜ ì™¸ë¶€ IPë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\n```js\n$ kubectl get svc -n vault\nNAME                       TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)             AGE\nvault                      ClusterIP      10.245.139.117   <none>         8200/TCP,8201/TCP   28h\nvault-agent-injector-svc   ClusterIP      10.245.58.140    <none>         443/TCP             28h\nvault-internal             ClusterIP      None             <none>         8200/TCP,8201/TCP   28h\nvault-ui                   LoadBalancer   10.245.11.13     24.123.49.59   8200:32273/TCP      26h\n```\n\nìœ„ì˜ ë¡œë“œë°¸ëŸ°ì„œì˜ ì™¸ë¶€ IPë¥¼ ì‚¬ìš©í•˜ì—¬ Vault UIì— ì•¡ì„¸ìŠ¤í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì˜ˆ: `external-ip`:8200\n\nì œ ê²½ìš°: 24.123.49.59:8200\n\n\n\n<div class=\"content-ad\"></div>\n\n\n\n<img src=\"/assets/img/2024-05-23-AHand-OnGuidetoVaultinKubernetes_1.png\" />\n\nì´ì œ í† í° ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ Vaultì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ˆê¸°ì—ëŠ” Token=rootë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸í•˜ì‹­ì‹œì˜¤.\n\nì´ì œ Vault UIì—ì„œ ì‹œí¬ë¦¿ ëŒ€ì‹œë³´ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œí¬ë¦¿ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì‹œí¬ë¦¿ ì—”ì§„ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš” '` ì‹œí¬ë¦¿`\n\n\n<div class=\"content-ad\"></div>\n\n<img src=\"/assets/img/2024-05-23-AHand-OnGuidetoVaultinKubernetes_2.png\" />\n\nê·¸ëŸ° ë‹¤ìŒ ì˜¤ë¥¸ìª½ ìƒë‹¨ì˜ \"ë¹„ë°€ ìƒì„±(Create Secret)\"ì„ í´ë¦­í•˜ì„¸ìš”.\n\n<img src=\"/assets/img/2024-05-23-AHand-OnGuidetoVaultinKubernetes_3.png\" />\n\nì´ì œ ë¹„ë°€ì„ ë§Œë“¤ê¸° ìœ„í•´ ì›í•˜ëŠ” í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.\n\n<div class=\"content-ad\"></div>\n\nì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ Vault CLIì—ì„œ ìœ„ì˜ ë¹„ë°€ì„ ì•¡ì„¸ìŠ¤í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n```js\n$ vault kv list secret\nKeys\n----\nlogin\nmy-first-secret\n```\n\nì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— Vaultë¥¼ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜í•˜ê³  êµ¬ì„±í–ˆìŠµë‹ˆë‹¤. ì´ì œ Vaultë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì‘ìš© í”„ë¡œê·¸ë¨ì˜ ë¹„ë°€ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n# ì¿ ë²„ë„¤í‹°ìŠ¤ Podì—ì„œ ë¹„ë°€ ì•¡ì„¸ìŠ¤\n\nìœ„ ë‹¨ê³„ë¥¼ ì‚¬ìš©í•˜ì—¬ Vaultë¥¼ ì„¤ì¹˜í•˜ê³  Vault ì—­í• (vault-role)ì„ êµ¬ì„±í•˜ì—¬ ì„œë¹„ìŠ¤ ê³„ì •(vault-serviceaccount)ì´ Vaultì— ì €ì¥ëœ ë¹„ë°€ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\në˜í•œ, loginê³¼ my-first-secretì´ë¼ëŠ” í‚¤-ê°’ ìŒì„ ê°€ì§„ ë‘ ê°œì˜ ì‹œí¬ë¦¿ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤. ì´ì œ ê°„ë‹¨í•œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë°°í¬ë¥¼ ìƒì„±í•˜ê³  ì´ëŸ¬í•œ ì‹œí¬ë¦¿ì— ì•¡ì„¸ìŠ¤í•´ ë³´ê² ìŠµë‹ˆë‹¤.\n\në¨¼ì €, vault ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— vault-serviceaccountë¼ëŠ” ì„œë¹„ìŠ¤ ê³„ì •ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ ê³„ì •ì€ ìœ„ì—ì„œ ì •ì˜í•œ \"Role ìƒì„±\" ë‹¨ê³„ì—ì„œ ì •ì˜ëœ Vault ì—­í• ì— ëŒ€í•œ ê¶Œí•œì´ ë¶€ì—¬ë©ë‹ˆë‹¤.\n\nì•„ë˜ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì„ vault-sa.yamlë¡œ ì €ì¥í•©ë‹ˆë‹¤.\n\n```yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: vault-serviceaccount\n  labels:\n    app: read-vault-secret\n```\n\n<div class=\"content-ad\"></div>\n\nìœ„ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ìœ„ì— ì œê³µëœ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ ì ìš©í•˜ì„¸ìš”.\n\n```js\nkubectl apply -f vault-sa.yaml\n```\n\nì´ì œ ì•„ë˜ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ê°„ë‹¨í•œ ë°°í¬(vault-secret-test-deploy.yaml)ë¥¼ ìƒì„±í•´ ë´…ì‹œë‹¤.\n\nì´ ë°°í¬ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ëŠ” Vaultì—ì„œ ì‹œí¬ë¦¿ì„ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜¤ë„ë¡ êµ¬ì„±ëœ Nginx íŒŒë“œì˜ ë‹¨ì¼ ë ˆí”Œë¦¬ì¹´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. Vault ì—ì´ì „íŠ¸ëŠ” ì§€ì •ëœ í…œí”Œë¦¿ì— ë”°ë¼ ì‹œí¬ë¦¿ì¸ login ë° my-first-secretì„ íŒŒë“œì— ì£¼ì…í•©ë‹ˆë‹¤. ì‹œí¬ë¦¿ì€ íŒŒë“œ íŒŒì¼ ì‹œìŠ¤í…œì— ì €ì¥ë˜ì–´ ì»¨í…Œì´ë„ˆì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Vaultì™€ ì¸ì¦í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ê¶Œí•œì„ ê°–ê³  ìˆëŠ” vault-serviceaccount ì„œë¹„ìŠ¤ ì–´ì¹´ìš´íŠ¸ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\nì–´ë…¸í…Œì´ì…˜ ì„¹ì…˜ì„ ìì„¸íˆ ì‚´í´ë³´ë©´ ê·¸ ëª©ì ê³¼ ê¸°ëŠ¥ì„ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```js\nannotations:\n        vault.hashicorp.com/agent-inject: \"true\"\n        vault.hashicorp.com/agent-inject-status: \"update\"\n        vault.hashicorp.com/agent-inject-secret-login: \"secret/login\"\n        vault.hashicorp.com/agent-inject-template-login: |\n          {- with secret \"secret/login\" -}\n          pattoken={ .Data.data.pattoken }\n          {- end }\n        vault.hashicorp.com/agent-inject-secret-my-first-secret: \"secret/my-first-secret\"\n        vault.hashicorp.com/agent-inject-template-my-first-secret: |\n          {- with secret \"secret/my-first-secret\" -}\n          username={ .Data.data.username }\n          password={ .Data.data.password }\n          {- end }\n        vault.hashicorp.com/role: \"vault-role\"\n```\n\nì´ëŸ¬í•œ ì–´ë…¸í…Œì´ì…˜ì€ Vault ì—ì´ì „íŠ¸ë¥¼ êµ¬ì„±í•˜ì—¬ ì‹œí¬ë¦¿ì„ íŒŒë“œ ë³¼ë¥¨ì— ì£¼ì…í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.\n\n- vault.hashicorp.com/agent-inject: â€œtrueâ€: ì´ íŒŒë“œì— ëŒ€í•œ Vault ì—ì´ì „íŠ¸ ì£¼ì…ì„ í™œì„±í™”í•©ë‹ˆë‹¤.\n- vault.hashicorp.com/agent-inject-status: â€œupdateâ€: ì‹œí¬ë¦¿ ì£¼ì… ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.\n- vault.hashicorp.com/agent-inject-secret-login: â€œsecret/loginâ€: Vaultì— ì €ì¥ëœ secret/loginì˜ ì‹œí¬ë¦¿ì„ ì£¼ì…í•´ì•¼ í•¨ì„ ì§€ì •í•©ë‹ˆë‹¤.\n- vault.hashicorp.com/agent-inject-template-login: ì£¼ì…ëœ ë¡œê·¸ì¸ ì‹œí¬ë¦¿ì˜ í…œí”Œë¦¿ì„ ì •ì˜í•˜ì—¬ ì‹œí¬ë¦¿ì´ ê¸°ë¡ë  í˜•ì‹ì„ ì§€ì •í•©ë‹ˆë‹¤.\n- vault.hashicorp.com/agent-inject-secret-my-first-secret: â€œsecret/my-first-secretâ€: Vaultì— ì €ì¥ëœ secret/my-first-secretì˜ ì‹œí¬ë¦¿ì„ ì£¼ì…í•´ì•¼ í•¨ì„ ì§€ì •í•©ë‹ˆë‹¤.\n- vault.hashicorp.com/agent-inject-template-my-first-secret: ì£¼ì…ëœ my-first-secretì— ëŒ€í•œ í…œí”Œë¦¿ì„ ì •ì˜í•˜ì—¬ ì‹œí¬ë¦¿ì´ ê¸°ë¡ë  í˜•ì‹ì„ ì§€ì •í•©ë‹ˆë‹¤.\n- vault.hashicorp.com/role: â€œvault-roleâ€: ì¸ì¦ì— ì‚¬ìš©ë  Vault ì—­í• ì„ ì§€ì •í•©ë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\nì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ pod ë³¼ë¥¨ì—ì„œ Vault ì‹œí¬ë¦¿ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\n```js\n$ kubectl exec -it vault-test-84d9dc9986-gcxfv -- sh -c \"cat /vault/secrets/login && cat /vault/secrets/my-first-secret\" -n vault\n```\n\n```js\n$ kubectl exec -it vault-test-84d9dc9986-gcxfv -- sh -c \"cat /vault/secrets/login && cat /vault/secrets/my-first-secret\" -n vault\n\nDefaulted container \"nginx\" out of: nginx, vault-agent, vault-agent-init (init)\npattoken=ytbuytbytbf765rb65u56rv\nusername=anvesh\npassword=anveshpassword\n```\n\nì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! Vaultì— ì‹œí¬ë¦¿ì„ ì„±ê³µì ìœ¼ë¡œ ìƒì„±í•˜ê³  í•´ë‹¹ ì‹œí¬ë¦¿ì„ íŒŸ ë‚´ì—ì„œ í™œìš©í–ˆìŠµë‹ˆë‹¤.\n\n# ì†ŒìŠ¤ ì½”ë“œ\n\n\n\n<div class=\"content-ad\"></div>\n\nìœ„ì˜ í…ìŠ¤íŠ¸ë¥¼ í•œêµ­ì–´ë¡œ ë²ˆì—­í•˜ì˜€ìŠµë‹ˆë‹¤.\n\nì¹œêµ¬ì•¼! ë‹¹ì‹ ì„ ìš°ë¦¬ì˜ GitHub ì €ì¥ì†Œë¡œ ì´ˆëŒ€í•©ë‹ˆë‹¤. ê±°ê¸°ì—ëŠ” Kubernetesìš© ì†ŒìŠ¤ ì½”ë“œì˜ í¬ê´„ì ì¸ ì»¬ë ‰ì…˜ì´ ì €ì¥ë˜ì–´ ìˆì–´ìš”.\n\në˜í•œ, ì—¬ëŸ¬ë¶„ì˜ í”¼ë“œë°±ê³¼ ì œì•ˆì„ í™˜ì˜í•©ë‹ˆë‹¤! ë¬¸ì œê°€ ë°œìƒí•˜ê±°ë‚˜ ê°œì„  ì•„ì´ë””ì–´ê°€ ìˆë‹¤ë©´, ì €í¬ì˜ GitHub ì €ì¥ì†Œì—ì„œ issueë¥¼ ì—´ì–´ì£¼ì„¸ìš”. ğŸš€\n\n<img src=\"/assets/img/2024-05-23-AHand-OnGuidetoVaultinKubernetes_6.png\" />\n\n# Connect With Me\n\n<div class=\"content-ad\"></div>\n\nì´ ë¸”ë¡œê·¸ë¥¼ ìœ ìµí•˜ê²Œ ì°¾ìœ¼ì…¨ê³  AWS, í´ë¼ìš°ë“œ ì „ëµ, Kubernetes ë˜ëŠ” ê´€ë ¨ëœ ëª¨ë“  ì£¼ì œì— ëŒ€í•´ ë” ê¹Šì´ ì•Œê³  ì‹¶ë‹¤ë©´, LinkedInì—ì„œ ì—°ê²°í•  ê¸°íšŒë¥¼ ê°–ê²Œ ë˜ì–´ ê¸°ì©ë‹ˆë‹¤. ì˜ë¯¸ ìˆëŠ” ëŒ€í™”ë¥¼ ë‚˜ëˆ„ê³  í†µì°°ì„ ê³µìœ í•˜ë©° í•¨ê»˜ í´ë¼ìš°ë“œ ì»´í“¨íŒ…ì˜ ê´‘í™œí•œ ì˜ì—­ì„ íƒìƒ‰í•´ ë´…ì‹œë‹¤.\n\nì–¸ì œë“ ì§€ ì—°ë½ ì£¼ì‹œê±°ë‚˜ ìƒê°ì„ ê³µìœ í•˜ê±°ë‚˜ ì§ˆë¬¸ì„ í•  ììœ ê°€ ìˆìŠµë‹ˆë‹¤. ë™ì ì¸ ë¶„ì•¼ì—ì„œ ì—°ê²°í•˜ê³  í•¨ê»˜ ì„±ì¥í•˜ê¸°ë¥¼ ê¸°ëŒ€í•©ë‹ˆë‹¤!\n\ní–‰ë³µí•œ ë°°í¬ ë˜ì„¸ìš”! ğŸš€\n\ní–‰ë³µí•œ ì¿ ë²„ë„¤íŒ… ë˜ì„¸ìš”! âˆ\n\n","ogImage":{"url":"/assets/img/2024-05-23-AHand-OnGuidetoVaultinKubernetes_0.png"},"coverImage":"/assets/img/2024-05-23-AHand-OnGuidetoVaultinKubernetes_0.png","tag":["Tech"],"readingTime":11},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<h2>â‡¢ ì‹¤ìš©ì ì¸ ì˜ˆì œë¡œ HashiCorp Vaultë¥¼ ì‚¬ìš©í•˜ì—¬ k8s Secrets ê´€ë¦¬í•˜ê¸°</h2>\n<p><img src=\"/assets/img/2024-05-23-AHand-OnGuidetoVaultinKubernetes_0.png\" alt=\"image\"></p>\n<p>ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¸ê³„ì—ì„œ API í‚¤, ë¹„ë°€ë²ˆí˜¸ ë° ê¸°íƒ€ ì¤‘ìš” ì •ë³´ì™€ ê°™ì€ ë³´ì•ˆ ì •ë³´ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì€ ë§¤ìš° ì¤‘ìš”í•œ ì‘ì—…ì…ë‹ˆë‹¤. ì¿ ë²„ë„¤í‹°ìŠ¤ì—ëŠ” ë‚´ì¥ëœ ë³´ì•ˆ ì •ë³´ ê´€ë¦¬ ë©”ì»¤ë‹ˆì¦˜ì´ ìˆì§€ë§Œ, ëª¨ë“  ì¡°ì§ì˜ ë³´ì•ˆ ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±ì‹œí‚¤ì§€ ëª»í•  ìˆ˜ë„ ìˆëŠ” íŠ¹ì • ì œí•œ ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì¿ ë²„ë„¤í‹°ìŠ¤ ë³´ì•ˆ ì •ë³´ëŠ” etcdì— ì €ì¥ë˜ë©°, ì´ëŠ” íœ´ì‹ ì¤‘ ì•”í˜¸í™”ë˜ì–´ ìˆì§€ë§Œ, ë§¤ìš° ì¤‘ìš”í•œ ì •ë³´ì— í•„ìš”í•œ ë³´ì•ˆ ìˆ˜ì¤€ê³¼ ì ‘ê·¼ ì œì–´ë¥¼ ì œê³µí•˜ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì´ë•Œ HashiCorp Vaultê°€ ë“±ì¥í•©ë‹ˆë‹¤. VaultëŠ” ì¤‘ìš”í•œ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì„¤ê³„ëœ ë„êµ¬ì…ë‹ˆë‹¤. ë™ì  ë³´ì•ˆ ì •ë³´, ì„œë¹„ìŠ¤ë¡œì˜ ì•”í˜¸í™” ë° ì ‘ê·¼ ì œì–´ë¥¼ ìœ„í•œ ê²¬ê³ í•œ ë©”ì»¤ë‹ˆì¦˜ì„ ì œê³µí•˜ì—¬, ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì—ì„œ ë³´ì•ˆ ì •ë³´ë¥¼ ê´€ë¦¬í•˜ê¸°ì— ì´ìƒì ì¸ ì†”ë£¨ì…˜ì…ë‹ˆë‹¤.</p>\n<p>ì´ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” Helmì„ ì‚¬ìš©í•˜ì—¬ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— Vaultë¥¼ ì„¤ì¹˜í•˜ê³  êµ¬ì„±í•˜ëŠ” ë‹¨ê³„ë¥¼ ì•ˆë‚´í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  Podë¥¼ ë°°í¬í•˜ì—¬ Vaultì—ì„œ ë¹„ë°€ì„ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡í•©ë‹ˆë‹¤. ì´ ì•ˆë‚´ì„œë¥¼ ë§ˆì¹˜ë©´ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— ì‘ë™í•˜ëŠ” Vault ì„¤ì •ì´ ì™„ë£Œë˜ì–´ ì‘ìš© í”„ë¡œê·¸ë¨ ë¹„ë°€ì„ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<h1>ì „ì œ ì¡°ê±´</h1>\n<p>ì‹œì‘í•˜ê¸° ì „ì— ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”:</p>\n<ul>\n<li>ì‹¤í–‰ ì¤‘ì¸ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>\n<li>í´ëŸ¬ìŠ¤í„°ì™€ ìƒí˜¸ ì‘ìš©í•˜ë„ë¡ êµ¬ì„±ëœ kubectlì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>\n<li>ë¡œì»¬ ë¨¸ì‹ ì— Helmì´ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>\n</ul>\n<h1>ë³´ë¥´íŠ¸(Namespace) ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„±í•˜ê¸°</h1>\n<p>ìš°ì„ , ë³´ë¥´íŠ¸(Vault)ë¥¼ ìœ„í•œ ë³„ë„ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë³´ë¥´íŠ¸ì— íŠ¹í™”ëœ ë¦¬ì†ŒìŠ¤ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\">$ kubectl create ns vault\n</code></pre>\n<h1>Vault ì„¤ì¹˜</h1>\n<p>ìš°ë¦¬ëŠ” HashiCorpê°€ ì œê³µí•˜ëŠ” Helm ì°¨íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ Vaultì˜ ìµœì‹  ë²„ì „ì„ ì„¤ì¹˜í•  ê²ƒì…ë‹ˆë‹¤. ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë‘ ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤: 1. HashiCorp Helm ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ Helm ì„¤ì¹˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê±°ë‚˜ 2. Helm ì°¨íŠ¸ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë¡œì»¬ë¡œ ì„¤ì¹˜í•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.</p>\n<h2>1. HashiCorp Helm ë¦¬í¬ì§€í† ë¦¬ ì¶”ê°€</h2>\n<p>HashiCorp Helm ë¦¬í¬ì§€í† ë¦¬ë¥¼ Helm êµ¬ì„±ì— ì¶”ê°€í•´ë³´ì„¸ìš”.</p>\n<pre><code class=\"hljs language-js\">helm repo add hashicorp <span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//helm.releases.hashicorp.com</span>\n</code></pre>\n<h2>2. ì„¤ì¹˜ ë°©ë²•</h2>\n<ol>\n<li>ì§ì ‘ Helm ì„¤ì¹˜ ì‹¤í–‰í•˜ê¸°</li>\n</ol>\n<p>ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ HashiCorp ì €ì¥ì†Œì—ì„œ Helm ì°¨íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ Vaultë¥¼ ì§ì ‘ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">helm install vault hashicorp/vault \\\n       --set=<span class=\"hljs-string\">'server.dev.enabled=true'</span> \\\n       --set=<span class=\"hljs-string\">'ui.enabled=true'</span> \\\n       --set=<span class=\"hljs-string\">'ui.serviceType=LoadBalancer'</span> \\\n       --namespace vault\n</code></pre>\n<ol start=\"2\">\n<li>Helm ì°¨íŠ¸ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜</li>\n</ol>\n<p>ëŒ€ì•ˆìœ¼ë¡œ Helm ì°¨íŠ¸ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ë¡œì»¬ë¡œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\"># <span class=\"hljs-title class_\">Helm</span> ì°¨íŠ¸ ë‹¤ìš´ë¡œë“œ\nhelm pull hashicorp/vault --untar\n\n# ë‹¤ìš´ë¡œë“œí•œ ì°¨íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ <span class=\"hljs-title class_\">Vault</span> ì„¤ì¹˜\nhelm install vault \\\n       --set=<span class=\"hljs-string\">'server.dev.enabled=true'</span> \\\n       --set=<span class=\"hljs-string\">'ui.enabled=true'</span> \\\n       --set=<span class=\"hljs-string\">'ui.serviceType=LoadBalancer'</span> \\\n       --namespace vault \\\n       ./vault-chart\n</code></pre>\n<p>ì´ ì„¤ì •ì„ ì‚¬ìš©í•˜ì—¬ UIê°€ í™œì„±í™”ëœ Vaultë¥¼ ê°œë°œ ëª¨ë“œë¡œ ì„¤ì¹˜í•˜ê³  ì™¸ë¶€ì—ì„œ ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ LoadBalancer ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ë…¸ì¶œí•©ë‹ˆë‹¤. ì´ ì„¤ì •ì€ í…ŒìŠ¤íŠ¸ ë° ê°œë°œ ëª©ì ìœ¼ë¡œ ì´ìƒì ì…ë‹ˆë‹¤.</p>\n<p>ê²°ê³¼:</p>\n<pre><code class=\"hljs language-js\">$ kubectl get all -n vault\n<span class=\"hljs-variable constant_\">NAME</span>                                        <span class=\"hljs-variable constant_\">READY</span>   <span class=\"hljs-variable constant_\">STATUS</span>    <span class=\"hljs-variable constant_\">RESTARTS</span>   <span class=\"hljs-variable constant_\">AGE</span>\npod/vault-<span class=\"hljs-number\">0</span>                                 <span class=\"hljs-number\">1</span>/<span class=\"hljs-number\">1</span>     <span class=\"hljs-title class_\">Running</span>   <span class=\"hljs-number\">0</span>          2m39s\npod/vault-agent-injector-8497dd4457-8jgcm   <span class=\"hljs-number\">1</span>/<span class=\"hljs-number\">1</span>     <span class=\"hljs-title class_\">Running</span>   <span class=\"hljs-number\">0</span>          2m39s\n\n<span class=\"hljs-variable constant_\">NAME</span>                               <span class=\"hljs-variable constant_\">TYPE</span>           <span class=\"hljs-variable constant_\">CLUSTER</span>-<span class=\"hljs-variable constant_\">IP</span>       <span class=\"hljs-variable constant_\">EXTERNAL</span>-<span class=\"hljs-variable constant_\">IP</span>    <span class=\"hljs-title function_\">PORT</span>(S)             <span class=\"hljs-variable constant_\">AGE</span>\nservice/vault                      <span class=\"hljs-title class_\">ClusterIP</span>      <span class=\"hljs-number\">10.245</span><span class=\"hljs-number\">.225</span><span class=\"hljs-number\">.169</span>   &#x3C;none>         <span class=\"hljs-number\">8200</span>/<span class=\"hljs-variable constant_\">TCP</span>,<span class=\"hljs-number\">8201</span>/<span class=\"hljs-variable constant_\">TCP</span>   2m40s\nservice/vault-agent-injector-svc   <span class=\"hljs-title class_\">ClusterIP</span>      <span class=\"hljs-number\">10.245</span><span class=\"hljs-number\">.32</span><span class=\"hljs-number\">.56</span>     &#x3C;none>         <span class=\"hljs-number\">443</span>/<span class=\"hljs-variable constant_\">TCP</span>             2m40s\nservice/vault-internal             <span class=\"hljs-title class_\">ClusterIP</span>      <span class=\"hljs-title class_\">None</span>             &#x3C;none>         <span class=\"hljs-number\">8200</span>/<span class=\"hljs-variable constant_\">TCP</span>,<span class=\"hljs-number\">8201</span>/<span class=\"hljs-variable constant_\">TCP</span>   2m40s\nservice/vault-ui                   <span class=\"hljs-title class_\">LoadBalancer</span>   <span class=\"hljs-number\">10.245</span><span class=\"hljs-number\">.103</span><span class=\"hljs-number\">.246</span>   <span class=\"hljs-number\">24.132</span><span class=\"hljs-number\">.59</span><span class=\"hljs-number\">.59</span>   <span class=\"hljs-number\">8200</span>:<span class=\"hljs-number\">31764</span>/<span class=\"hljs-variable constant_\">TCP</span>      2m40s\n\n<span class=\"hljs-variable constant_\">NAME</span>                                   <span class=\"hljs-variable constant_\">READY</span>   <span class=\"hljs-variable constant_\">UP</span>-<span class=\"hljs-variable constant_\">TO</span>-<span class=\"hljs-variable constant_\">DATE</span>   <span class=\"hljs-variable constant_\">AVAILABLE</span>   <span class=\"hljs-variable constant_\">AGE</span>\ndeployment.<span class=\"hljs-property\">apps</span>/vault-agent-injector   <span class=\"hljs-number\">1</span>/<span class=\"hljs-number\">1</span>     <span class=\"hljs-number\">1</span>            <span class=\"hljs-number\">1</span>           2m40s\n\n<span class=\"hljs-variable constant_\">NAME</span>                                              <span class=\"hljs-variable constant_\">DESIRED</span>   <span class=\"hljs-variable constant_\">CURRENT</span>   <span class=\"hljs-variable constant_\">READY</span>   <span class=\"hljs-variable constant_\">AGE</span>\nreplicaset.<span class=\"hljs-property\">apps</span>/vault-agent-injector-8497dd4457   <span class=\"hljs-number\">1</span>         <span class=\"hljs-number\">1</span>         <span class=\"hljs-number\">1</span>       2m40s\n\n<span class=\"hljs-variable constant_\">NAME</span>                     <span class=\"hljs-variable constant_\">READY</span>   <span class=\"hljs-variable constant_\">AGE</span>\nstatefulset.<span class=\"hljs-property\">apps</span>/vault   <span class=\"hljs-number\">1</span>/<span class=\"hljs-number\">1</span>     2m40s\n</code></pre>\n<h1>Vault êµ¬ì„±</h1>\n<p>ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” Kubernetes í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ì•ˆì „í•˜ê²Œ ë¹„ë°€ì„ ê´€ë¦¬í•˜ê³  ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ Vault ì •ì±…ê³¼ ì¸ì¦ ë°©ë²•ì„ ì„¤ì •í•  ê²ƒì…ë‹ˆë‹¤. ì´ êµ¬ì„±ì€ ì¸ì¦ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ë§Œ Vaultì—ì„œ ë¯¼ê°í•œ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.</p>\n<h2>1. Vault Podì— ì—°ê²°í•˜ê¸°</h2>\n<p>ì„¤ì¹˜ê°€ ì™„ë£Œëœ í›„ Vault podì— ì—°ê²°í•˜ì—¬ ì´ˆê¸° êµ¬ì„±ì„ ìˆ˜í–‰í•˜ì„¸ìš”:</p>\n<pre><code class=\"hljs language-js\">kubectl exec -it vault-<span class=\"hljs-number\">0</span> -- <span class=\"hljs-regexp\">/bin/</span>sh\n</code></pre>\n<h2>2. ì •ì±… ìƒì„± ë° ì ìš©í•˜ê¸°</h2>\n<p>ì´ì œ ë¹„ë°€ì„ ì½ì„ ìˆ˜ ìˆëŠ” ì •ì±…ì„ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤. ì´ ì •ì±…ì€ ì—­í• ì— ì²¨ë¶€ë˜ì–´ íŠ¹ì • Kubernetes ì„œë¹„ìŠ¤ ê³„ì •ì— ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì •ì±… íŒŒì¼ì„ ìƒì„±í•˜ì„¸ìš”:</p>\n<pre><code class=\"hljs language-js\">cat &#x3C;&#x3C;<span class=\"hljs-variable constant_\">EOF</span> > <span class=\"hljs-regexp\">/home/</span>vault/read-policy.<span class=\"hljs-property\">hcl</span>\npath <span class=\"hljs-string\">\"secret*\"</span> {\n  capabilities = [<span class=\"hljs-string\">\"read\"</span>]\n}\n<span class=\"hljs-variable constant_\">EOF</span>\n</code></pre>\n<p>ì•„ë˜ì™€ ê°™ì´ ì •ì±…ì„ ì ìš©í•´ì£¼ì„¸ìš”:</p>\n<pre><code class=\"hljs language-js\"># ë¬¸ë²•\n$ vault policy write &#x3C;ì •ì±…ëª…> <span class=\"hljs-regexp\">/ì •ì±…/</span>ê²½ë¡œ/ì—¬ê¸°ì—.<span class=\"hljs-property\">hcl</span>\n\n# ì˜ˆì‹œ\n$ vault policy write read-policy /home/vault/read-policy.<span class=\"hljs-property\">hcl</span>\n</code></pre>\n<h2>3. Kubernetes ì¸ì¦ í™œì„±í™”</h2>\n<p>Vaultì—ì„œ Kubernetes ì¸ì¦ ë°©ë²•ì„ í™œì„±í™”í•˜ì„¸ìš”.</p>\n<pre><code class=\"hljs language-js\">vault auth enable kubernetes\n</code></pre>\n<h2>4. Kubernetes ì¸ì¦ ì„¤ì •</h2>\n<p>Vaultê°€ Kubernetes API ì„œë²„ì™€ í†µì‹ í•˜ë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">vault write auth/kubernetes/config \\\n   token_reviewer_jwt=<span class=\"hljs-string\">\"$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\"</span> \\\n   kubernetes_host=<span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//${KUBERNETES_PORT_443_TCP_ADDR}:443 \\</span>\n   kubernetes_ca_cert=@/<span class=\"hljs-keyword\">var</span>/run/secrets/kubernetes.<span class=\"hljs-property\">io</span>/serviceaccount/ca.<span class=\"hljs-property\">crt</span>\n</code></pre>\n<h2>5. ì—­í•  ìƒì„±</h2>\n<p>íŠ¹ì • ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ìˆëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤ ê³„ì •(vault-serviceaccount)ì— ìœ„ì—ì„œ ë§Œë“  ì •ì±…ì„ ë°”ì¸ë”©í•˜ëŠ” ì—­í• (vault-role)ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ ê³„ì •ì´ Vaultì— ì €ì¥ëœ ì‹œí¬ë¦¿ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">vault write auth/kubernetes/role/vault-role \\\n   bound_service_account_names=vault-serviceaccount \\\n   bound_service_account_namespaces=vault \\\n   policies=read-policy \\\n   ttl=1h\n</code></pre>\n<p>ì—¬ê¸°ì„œ ì—¬ëŸ¬ ê°œì˜ ì„œë¹„ìŠ¤ ê³„ì •ê³¼ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-bash\">vault write auth/kubernetes/role/&#x3C;my-role> \\\n   bound_service_account_names=sa1, sa2 \\\n   bound_service_account_namespaces=namespace1, namespace2 \\\n   policies=&#x3C;policy-name> \\\n   ttl=1h\n</code></pre>\n<h1>ë³´ì•ˆ ì •ë³´ ë§Œë“¤ê¸°</h1>\n<p>ì´ì œ Vaultì— ì¼ë¶€ ë³´ì•ˆ ì •ë³´ë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤:</p>\n<p>ìš°ë¦¬ëŠ” ë‘ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ë³´ì•ˆ ì •ë³´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”:</p>\n<ul>\n<li>Vault CLIë¥¼ ì‚¬ìš©í•˜ê¸°</li>\n</ul>\n<h2>1. Vault CLI ì‚¬ìš©í•˜ê¸°</h2>\n<p>ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œí¬ë¦¿ì„ ìƒì„±í•˜ì„¸ìš”</p>\n<pre><code class=\"hljs language-js\">$ vault kv put secret/login pattoken=ytbuytbytbf765rb65u56rv\n</code></pre>\n<p>ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œí¬ë¦¿ì„ ë‚˜ì—´í•˜ì—¬ ë¹„ë°€ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">$ vault kv list secret\n<span class=\"hljs-title class_\">Keys</span>\n----\nlogin\n</code></pre>\n<h2>2. Vault UI ì‚¬ìš© ë°©ë²•</h2>\n<p>Vault ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ì„œë¹„ìŠ¤ë¥¼ ë‚˜ì—´í•˜ì—¬ ë¡œë“œ ë°¸ëŸ°ì„œì˜ ì™¸ë¶€ IPë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\">$ kubectl get svc -n vault\n<span class=\"hljs-variable constant_\">NAME</span>                       <span class=\"hljs-variable constant_\">TYPE</span>           <span class=\"hljs-variable constant_\">CLUSTER</span>-<span class=\"hljs-variable constant_\">IP</span>       <span class=\"hljs-variable constant_\">EXTERNAL</span>-<span class=\"hljs-variable constant_\">IP</span>    <span class=\"hljs-title function_\">PORT</span>(S)             <span class=\"hljs-variable constant_\">AGE</span>\nvault                      <span class=\"hljs-title class_\">ClusterIP</span>      <span class=\"hljs-number\">10.245</span><span class=\"hljs-number\">.139</span><span class=\"hljs-number\">.117</span>   &#x3C;none>         <span class=\"hljs-number\">8200</span>/<span class=\"hljs-variable constant_\">TCP</span>,<span class=\"hljs-number\">8201</span>/<span class=\"hljs-variable constant_\">TCP</span>   28h\nvault-agent-injector-svc   <span class=\"hljs-title class_\">ClusterIP</span>      <span class=\"hljs-number\">10.245</span><span class=\"hljs-number\">.58</span><span class=\"hljs-number\">.140</span>    &#x3C;none>         <span class=\"hljs-number\">443</span>/<span class=\"hljs-variable constant_\">TCP</span>             28h\nvault-internal             <span class=\"hljs-title class_\">ClusterIP</span>      <span class=\"hljs-title class_\">None</span>             &#x3C;none>         <span class=\"hljs-number\">8200</span>/<span class=\"hljs-variable constant_\">TCP</span>,<span class=\"hljs-number\">8201</span>/<span class=\"hljs-variable constant_\">TCP</span>   28h\nvault-ui                   <span class=\"hljs-title class_\">LoadBalancer</span>   <span class=\"hljs-number\">10.245</span><span class=\"hljs-number\">.11</span><span class=\"hljs-number\">.13</span>     <span class=\"hljs-number\">24.123</span><span class=\"hljs-number\">.49</span><span class=\"hljs-number\">.59</span>   <span class=\"hljs-number\">8200</span>:<span class=\"hljs-number\">32273</span>/<span class=\"hljs-variable constant_\">TCP</span>      26h\n</code></pre>\n<p>ìœ„ì˜ ë¡œë“œë°¸ëŸ°ì„œì˜ ì™¸ë¶€ IPë¥¼ ì‚¬ìš©í•˜ì—¬ Vault UIì— ì•¡ì„¸ìŠ¤í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì˜ˆ: <code>external-ip</code>:8200</p>\n<p>ì œ ê²½ìš°: 24.123.49.59:8200</p>\n<p>ì´ì œ í† í° ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ Vaultì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ˆê¸°ì—ëŠ” Token=rootë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸í•˜ì‹­ì‹œì˜¤.</p>\n<p>ì´ì œ Vault UIì—ì„œ ì‹œí¬ë¦¿ ëŒ€ì‹œë³´ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œí¬ë¦¿ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì‹œí¬ë¦¿ ì—”ì§„ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš” '<code> ì‹œí¬ë¦¿</code></p>\n<p>ê·¸ëŸ° ë‹¤ìŒ ì˜¤ë¥¸ìª½ ìƒë‹¨ì˜ \"ë¹„ë°€ ìƒì„±(Create Secret)\"ì„ í´ë¦­í•˜ì„¸ìš”.</p>\n<p>ì´ì œ ë¹„ë°€ì„ ë§Œë“¤ê¸° ìœ„í•´ ì›í•˜ëŠ” í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>\n<p>ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ Vault CLIì—ì„œ ìœ„ì˜ ë¹„ë°€ì„ ì•¡ì„¸ìŠ¤í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">$ vault kv list secret\n<span class=\"hljs-title class_\">Keys</span>\n----\nlogin\nmy-first-secret\n</code></pre>\n<p>ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— Vaultë¥¼ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜í•˜ê³  êµ¬ì„±í–ˆìŠµë‹ˆë‹¤. ì´ì œ Vaultë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì‘ìš© í”„ë¡œê·¸ë¨ì˜ ë¹„ë°€ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<h1>ì¿ ë²„ë„¤í‹°ìŠ¤ Podì—ì„œ ë¹„ë°€ ì•¡ì„¸ìŠ¤</h1>\n<p>ìœ„ ë‹¨ê³„ë¥¼ ì‚¬ìš©í•˜ì—¬ Vaultë¥¼ ì„¤ì¹˜í•˜ê³  Vault ì—­í• (vault-role)ì„ êµ¬ì„±í•˜ì—¬ ì„œë¹„ìŠ¤ ê³„ì •(vault-serviceaccount)ì´ Vaultì— ì €ì¥ëœ ë¹„ë°€ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.</p>\n<p>ë˜í•œ, loginê³¼ my-first-secretì´ë¼ëŠ” í‚¤-ê°’ ìŒì„ ê°€ì§„ ë‘ ê°œì˜ ì‹œí¬ë¦¿ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤. ì´ì œ ê°„ë‹¨í•œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë°°í¬ë¥¼ ìƒì„±í•˜ê³  ì´ëŸ¬í•œ ì‹œí¬ë¦¿ì— ì•¡ì„¸ìŠ¤í•´ ë³´ê² ìŠµë‹ˆë‹¤.</p>\n<p>ë¨¼ì €, vault ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— vault-serviceaccountë¼ëŠ” ì„œë¹„ìŠ¤ ê³„ì •ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ ê³„ì •ì€ ìœ„ì—ì„œ ì •ì˜í•œ \"Role ìƒì„±\" ë‹¨ê³„ì—ì„œ ì •ì˜ëœ Vault ì—­í• ì— ëŒ€í•œ ê¶Œí•œì´ ë¶€ì—¬ë©ë‹ˆë‹¤.</p>\n<p>ì•„ë˜ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì„ vault-sa.yamlë¡œ ì €ì¥í•©ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">ServiceAccount</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">vault-serviceaccount</span>\n  <span class=\"hljs-attr\">labels:</span>\n    <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">read-vault-secret</span>\n</code></pre>\n<p>ìœ„ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ìœ„ì— ì œê³µëœ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ ì ìš©í•˜ì„¸ìš”.</p>\n<pre><code class=\"hljs language-js\">kubectl apply -f vault-sa.<span class=\"hljs-property\">yaml</span>\n</code></pre>\n<p>ì´ì œ ì•„ë˜ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ê°„ë‹¨í•œ ë°°í¬(vault-secret-test-deploy.yaml)ë¥¼ ìƒì„±í•´ ë´…ì‹œë‹¤.</p>\n<p>ì´ ë°°í¬ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ëŠ” Vaultì—ì„œ ì‹œí¬ë¦¿ì„ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜¤ë„ë¡ êµ¬ì„±ëœ Nginx íŒŒë“œì˜ ë‹¨ì¼ ë ˆí”Œë¦¬ì¹´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. Vault ì—ì´ì „íŠ¸ëŠ” ì§€ì •ëœ í…œí”Œë¦¿ì— ë”°ë¼ ì‹œí¬ë¦¿ì¸ login ë° my-first-secretì„ íŒŒë“œì— ì£¼ì…í•©ë‹ˆë‹¤. ì‹œí¬ë¦¿ì€ íŒŒë“œ íŒŒì¼ ì‹œìŠ¤í…œì— ì €ì¥ë˜ì–´ ì»¨í…Œì´ë„ˆì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Vaultì™€ ì¸ì¦í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ê¶Œí•œì„ ê°–ê³  ìˆëŠ” vault-serviceaccount ì„œë¹„ìŠ¤ ì–´ì¹´ìš´íŠ¸ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>\n<p>ì–´ë…¸í…Œì´ì…˜ ì„¹ì…˜ì„ ìì„¸íˆ ì‚´í´ë³´ë©´ ê·¸ ëª©ì ê³¼ ê¸°ëŠ¥ì„ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-attr\">annotations</span>:\n        vault.<span class=\"hljs-property\">hashicorp</span>.<span class=\"hljs-property\">com</span>/agent-<span class=\"hljs-attr\">inject</span>: <span class=\"hljs-string\">\"true\"</span>\n        vault.<span class=\"hljs-property\">hashicorp</span>.<span class=\"hljs-property\">com</span>/agent-inject-<span class=\"hljs-attr\">status</span>: <span class=\"hljs-string\">\"update\"</span>\n        vault.<span class=\"hljs-property\">hashicorp</span>.<span class=\"hljs-property\">com</span>/agent-inject-secret-<span class=\"hljs-attr\">login</span>: <span class=\"hljs-string\">\"secret/login\"</span>\n        vault.<span class=\"hljs-property\">hashicorp</span>.<span class=\"hljs-property\">com</span>/agent-inject-template-<span class=\"hljs-attr\">login</span>: |\n          {- <span class=\"hljs-keyword\">with</span> secret <span class=\"hljs-string\">\"secret/login\"</span> -}\n          pattoken={ .<span class=\"hljs-property\">Data</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">pattoken</span> }\n          {- end }\n        vault.<span class=\"hljs-property\">hashicorp</span>.<span class=\"hljs-property\">com</span>/agent-inject-secret-my-first-<span class=\"hljs-attr\">secret</span>: <span class=\"hljs-string\">\"secret/my-first-secret\"</span>\n        vault.<span class=\"hljs-property\">hashicorp</span>.<span class=\"hljs-property\">com</span>/agent-inject-template-my-first-<span class=\"hljs-attr\">secret</span>: |\n          {- <span class=\"hljs-keyword\">with</span> secret <span class=\"hljs-string\">\"secret/my-first-secret\"</span> -}\n          username={ .<span class=\"hljs-property\">Data</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">username</span> }\n          password={ .<span class=\"hljs-property\">Data</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">password</span> }\n          {- end }\n        vault.<span class=\"hljs-property\">hashicorp</span>.<span class=\"hljs-property\">com</span>/<span class=\"hljs-attr\">role</span>: <span class=\"hljs-string\">\"vault-role\"</span>\n</code></pre>\n<p>ì´ëŸ¬í•œ ì–´ë…¸í…Œì´ì…˜ì€ Vault ì—ì´ì „íŠ¸ë¥¼ êµ¬ì„±í•˜ì—¬ ì‹œí¬ë¦¿ì„ íŒŒë“œ ë³¼ë¥¨ì— ì£¼ì…í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.</p>\n<ul>\n<li>vault.hashicorp.com/agent-inject: â€œtrueâ€: ì´ íŒŒë“œì— ëŒ€í•œ Vault ì—ì´ì „íŠ¸ ì£¼ì…ì„ í™œì„±í™”í•©ë‹ˆë‹¤.</li>\n<li>vault.hashicorp.com/agent-inject-status: â€œupdateâ€: ì‹œí¬ë¦¿ ì£¼ì… ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.</li>\n<li>vault.hashicorp.com/agent-inject-secret-login: â€œsecret/loginâ€: Vaultì— ì €ì¥ëœ secret/loginì˜ ì‹œí¬ë¦¿ì„ ì£¼ì…í•´ì•¼ í•¨ì„ ì§€ì •í•©ë‹ˆë‹¤.</li>\n<li>vault.hashicorp.com/agent-inject-template-login: ì£¼ì…ëœ ë¡œê·¸ì¸ ì‹œí¬ë¦¿ì˜ í…œí”Œë¦¿ì„ ì •ì˜í•˜ì—¬ ì‹œí¬ë¦¿ì´ ê¸°ë¡ë  í˜•ì‹ì„ ì§€ì •í•©ë‹ˆë‹¤.</li>\n<li>vault.hashicorp.com/agent-inject-secret-my-first-secret: â€œsecret/my-first-secretâ€: Vaultì— ì €ì¥ëœ secret/my-first-secretì˜ ì‹œí¬ë¦¿ì„ ì£¼ì…í•´ì•¼ í•¨ì„ ì§€ì •í•©ë‹ˆë‹¤.</li>\n<li>vault.hashicorp.com/agent-inject-template-my-first-secret: ì£¼ì…ëœ my-first-secretì— ëŒ€í•œ í…œí”Œë¦¿ì„ ì •ì˜í•˜ì—¬ ì‹œí¬ë¦¿ì´ ê¸°ë¡ë  í˜•ì‹ì„ ì§€ì •í•©ë‹ˆë‹¤.</li>\n<li>vault.hashicorp.com/role: â€œvault-roleâ€: ì¸ì¦ì— ì‚¬ìš©ë  Vault ì—­í• ì„ ì§€ì •í•©ë‹ˆë‹¤.</li>\n</ul>\n<p>ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ pod ë³¼ë¥¨ì—ì„œ Vault ì‹œí¬ë¦¿ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\">$ kubectl exec -it vault-test-84d9dc9986-gcxfv -- sh -c <span class=\"hljs-string\">\"cat /vault/secrets/login &#x26;&#x26; cat /vault/secrets/my-first-secret\"</span> -n vault\n</code></pre>\n<pre><code class=\"hljs language-js\">$ kubectl exec -it vault-test-84d9dc9986-gcxfv -- sh -c <span class=\"hljs-string\">\"cat /vault/secrets/login &#x26;&#x26; cat /vault/secrets/my-first-secret\"</span> -n vault\n\n<span class=\"hljs-title class_\">Defaulted</span> container <span class=\"hljs-string\">\"nginx\"</span> out <span class=\"hljs-attr\">of</span>: nginx, vault-agent, vault-agent-init (init)\npattoken=ytbuytbytbf765rb65u56rv\nusername=anvesh\npassword=anveshpassword\n</code></pre>\n<p>ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! Vaultì— ì‹œí¬ë¦¿ì„ ì„±ê³µì ìœ¼ë¡œ ìƒì„±í•˜ê³  í•´ë‹¹ ì‹œí¬ë¦¿ì„ íŒŸ ë‚´ì—ì„œ í™œìš©í–ˆìŠµë‹ˆë‹¤.</p>\n<h1>ì†ŒìŠ¤ ì½”ë“œ</h1>\n<p>ìœ„ì˜ í…ìŠ¤íŠ¸ë¥¼ í•œêµ­ì–´ë¡œ ë²ˆì—­í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n<p>ì¹œêµ¬ì•¼! ë‹¹ì‹ ì„ ìš°ë¦¬ì˜ GitHub ì €ì¥ì†Œë¡œ ì´ˆëŒ€í•©ë‹ˆë‹¤. ê±°ê¸°ì—ëŠ” Kubernetesìš© ì†ŒìŠ¤ ì½”ë“œì˜ í¬ê´„ì ì¸ ì»¬ë ‰ì…˜ì´ ì €ì¥ë˜ì–´ ìˆì–´ìš”.</p>\n<p>ë˜í•œ, ì—¬ëŸ¬ë¶„ì˜ í”¼ë“œë°±ê³¼ ì œì•ˆì„ í™˜ì˜í•©ë‹ˆë‹¤! ë¬¸ì œê°€ ë°œìƒí•˜ê±°ë‚˜ ê°œì„  ì•„ì´ë””ì–´ê°€ ìˆë‹¤ë©´, ì €í¬ì˜ GitHub ì €ì¥ì†Œì—ì„œ issueë¥¼ ì—´ì–´ì£¼ì„¸ìš”. ğŸš€</p>\n<h1>Connect With Me</h1>\n<p>ì´ ë¸”ë¡œê·¸ë¥¼ ìœ ìµí•˜ê²Œ ì°¾ìœ¼ì…¨ê³  AWS, í´ë¼ìš°ë“œ ì „ëµ, Kubernetes ë˜ëŠ” ê´€ë ¨ëœ ëª¨ë“  ì£¼ì œì— ëŒ€í•´ ë” ê¹Šì´ ì•Œê³  ì‹¶ë‹¤ë©´, LinkedInì—ì„œ ì—°ê²°í•  ê¸°íšŒë¥¼ ê°–ê²Œ ë˜ì–´ ê¸°ì©ë‹ˆë‹¤. ì˜ë¯¸ ìˆëŠ” ëŒ€í™”ë¥¼ ë‚˜ëˆ„ê³  í†µì°°ì„ ê³µìœ í•˜ë©° í•¨ê»˜ í´ë¼ìš°ë“œ ì»´í“¨íŒ…ì˜ ê´‘í™œí•œ ì˜ì—­ì„ íƒìƒ‰í•´ ë´…ì‹œë‹¤.</p>\n<p>ì–¸ì œë“ ì§€ ì—°ë½ ì£¼ì‹œê±°ë‚˜ ìƒê°ì„ ê³µìœ í•˜ê±°ë‚˜ ì§ˆë¬¸ì„ í•  ììœ ê°€ ìˆìŠµë‹ˆë‹¤. ë™ì ì¸ ë¶„ì•¼ì—ì„œ ì—°ê²°í•˜ê³  í•¨ê»˜ ì„±ì¥í•˜ê¸°ë¥¼ ê¸°ëŒ€í•©ë‹ˆë‹¤!</p>\n<p>í–‰ë³µí•œ ë°°í¬ ë˜ì„¸ìš”! ğŸš€</p>\n<p>í–‰ë³µí•œ ì¿ ë²„ë„¤íŒ… ë˜ì„¸ìš”! âˆ</p>\n</body>\n</html>\n"},"__N_SSG":true}