{"pageProps":{"post":{"title":"5ê°€ì§€ í•„ìˆ˜ NET ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ íŒ¨í„´","description":"","date":"2024-06-19 11:29","slug":"2024-06-19-5EssentialNETMicroservicesPatterns","content":"\n\n\n![2024-06-19-5EssentialNETMicroservicesPatterns_0](/assets/img/2024-06-19-5EssentialNETMicroservicesPatterns_0.png)\n\nì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì˜ ëŠì„ì—†ëŠ” ì„¸ê³„ì—ì„œ, ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ëŠ” íŠ¹íˆ .NETì˜ ê´‘ë²”ìœ„í•œ ì˜ì—­ì—ì„œ ì¸ê¸° ìˆëŠ” ì„ íƒì§€ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. .NETì€ í™•ì¥ ë° ì ì‘ì´ ê°€ëŠ¥í•œ ëŠ¥ë ¥ìœ¼ë¡œ ëŒ€ê·œëª¨ì˜ ë°ì´í„° ë° íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì´ìƒì ì¸ í”Œë«í¼ì…ë‹ˆë‹¤. \n\nì´ ê¸°ì‚¬ì—ì„œëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ ìˆ™ë‹¬í•˜ê³ ì í•˜ëŠ” .NET ê°œë°œìë“¤ì„ ìœ„í•œ ë‹¤ì„¯ ê°€ì§€ í•„ìˆ˜ íŒ¨í„´ì„ íƒêµ¬í•  ê²ƒì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì‹¤ìš©ì ì¸ ì˜ˆì œì™€ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¡°ì–¸ì„ ì œê³µí•˜ì—¬ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì˜ ìš°ìˆ˜ì„±ì„ ë‹¬ì„±í•˜ëŠ” ì—¬ì •ì—ì„œ ë‹¹ì‹ ì„ ë•ê² ìŠµë‹ˆë‹¤.\n\n## 1. ê²Œì´íŠ¸ì›¨ì´ ì§‘ê³„ íŒ¨í„´\n\n\n<div class=\"content-ad\"></div>\n\n\n![image](/assets/img/2024-06-19-5EssentialNETMicroservicesPatterns_1.png)\n\në§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ ì‘ìš© í”„ë¡œê·¸ë¨ì´ ìƒí˜¸ ì‘ìš©í•´ì•¼ í•  ì—¬ëŸ¬ ì„œë¹„ìŠ¤ê°€ ìˆëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤. ê° ê°œë³„ ì„œë¹„ìŠ¤ì™€ ì§ì ‘ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ëŒ€ì‹  API ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì¢‹ìŠµë‹ˆë‹¤. ì´ ë°©ë²•ì€ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¥¼ ê°„ì†Œí™”í•˜ê³  ë°±ì—”ë“œ ì„œë¹„ìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•œ ë‹¨ì¼ ì§„ì…ì ì„ ìƒì„±í•©ë‹ˆë‹¤.\n\n```js\n// Ocelot API Gateway ì‚¬ìš© ì˜ˆì œ\npublic async Task<AggregatedResult> AggregateData()\n{\n    var userTask = _userService.GetUser();\n    var ordersTask = _orderService.GetOrdersForUser();\n    \n    await Task.WhenAll(userTask, ordersTask);\n    \n    var user = await userTask;\n    var orders = await ordersTask;\n\n    return new AggregatedResult\n    {\n        User = user,\n        Orders = orders\n    };\n}\n```\n\n## 2. íšŒë¡œ ì°¨ë‹¨ê¸° íŒ¨í„´\n\n\n<div class=\"content-ad\"></div>\n\n\n![Circuit Breaker](/assets/img/2024-06-19-5EssentialNETMicroservicesPatterns_2.png)\n\nì„œí‚· ë¸Œë ˆì´ì»¤ë¥¼ êµ¬í˜„í•˜ë©´ ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ì„œë¹„ìŠ¤ ì¥ì• ê°€ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë¡œ ì „íŒŒë˜ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë¹„ìŠ¤ ì¥ì• ê°€ ë°œìƒí•˜ë©´ ì„œí‚· ë¸Œë ˆì´ì»¤ê°€ ì´ë¥¼ ê°ì§€í•˜ê³  ê·¸ ì„œë¹„ìŠ¤ë¡œì˜ í›„ì† í˜¸ì¶œì„ ì¼ì • ê¸°ê°„ ë™ì•ˆ ìë™ìœ¼ë¡œ ì°¨ë‹¨í•©ë‹ˆë‹¤.\n\n```js\n// Polly ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ì˜ˆì œ\nvar circuitBreakerPolicy = Policy\n    .Handle<Exception>()\n    .CircuitBreaker(2, TimeSpan.FromMinutes(1));\n\nawait circuitBreakerPolicy.ExecuteAsync(async () =>\n{\n    await PerformServiceCall();\n});\n```\n\n## 3. ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ íŒ¨í„´\n\n\n<div class=\"content-ad\"></div>\n\n\n![Image](/assets/img/2024-06-19-5EssentialNETMicroservicesPatterns_3.png)\n\në§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ í™•ì¥í• ìˆ˜ë¡ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ì í•˜ê¸°ê°€ ë” ì–´ë ¤ì›Œì§‘ë‹ˆë‹¤. ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ê°€ ë™ì ìœ¼ë¡œ ì„œë¡œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```js\nusing System;\nusing System.Threading.Tasks;\nusing Consul;\nusing Microsoft.Extensions.DependencyInjection;\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        var serviceProvider = new ServiceCollection()\n            .AddSingleton<IConsulClient, ConsulClient>(p => new ConsulClient(consulConfig =>\n            {\n                // Assuming Consul is running on localhost\n                consulConfig.Address = new Uri(\"http://localhost:8500\");\n            }))\n            .AddSingleton<IConsulService, ConsulService>()\n            .BuildServiceProvider();\n\n        var consulService = serviceProvider.GetService<IConsulService>();\n        consulService.RegisterService().Wait();\n        consulService.DiscoverServices().Wait();\n    }\n}\n\npublic interface IConsulService\n{\n    Task RegisterService();\n    Task DiscoverServices();\n}\n\npublic class ConsulService : IConsulService\n{\n    private readonly IConsulClient _consulClient;\n\n    public ConsulService(IConsulClient consulClient)\n    {\n        _consulClient = consulClient;\n    }\n\n    public async Task RegisterService()\n    {\n        var registration = new AgentServiceRegistration()\n        {\n            ID = Guid.NewGuid().ToString(),\n            Name = \"MyService\",\n            Address = \"localhost\",\n            Port = 5000,\n        };\n\n        await _consulClient.Agent.ServiceRegister(registration);\n        Console.WriteLine(\"Consulì— ì„œë¹„ìŠ¤ ë“±ë¡ë¨\");\n    }\n\n    public async Task DiscoverServices()\n    {\n        var services = await _consulClient.Agent.Services();\n        foreach (var service in services.Response.Values)\n        {\n            Console.WriteLine($\"ë°œê²¬ëœ ì„œë¹„ìŠ¤: {service.Service}\");\n        }\n    }\n}\n```\n\n## 4. ì´ë²¤íŠ¸ ì†Œì‹± íŒ¨í„´\n\n\n<div class=\"content-ad\"></div>\n\n<img src=\"/assets/img/2024-06-19-5EssentialNETMicroservicesPatterns_4.png\" />\n\nì´ë²¤íŠ¸ ì†Œì‹±ì€ ì‘ìš© í”„ë¡œê·¸ë¨ ì—”í‹°í‹°ì˜ ìƒíƒœ ë³€ê²½ì„ ì´ë²¤íŠ¸ ì‹œë¦¬ì¦ˆë¡œ ì €ì¥í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ íŠ¹íˆ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì—ì„œ ìœ ìš©í•˜ë©° ì‹œìŠ¤í…œì— ëŒ€í•œ ëª¨ë“  ë³€ê²½ ì‚¬í•­ì˜ ê°ì‚¬ ê°€ëŠ¥í•œ ë ˆì½”ë“œë¥¼ ì œê³µí•˜ì—¬ ë””ë²„ê¹… ë° ë¬¸ì œ í•´ê²°ì— ë„ì›€ì´ ë©ë‹ˆë‹¤. ê²Œë‹¤ê°€ ì´ë²¤íŠ¸ ì†Œì‹±ì€ ì‘ìš© í”„ë¡œê·¸ë¨ì˜ ë‹¤ë¥¸ êµ¬ì„± ìš”ì†Œ ê°„ ë°ì´í„° ì¼ê´€ì„±ì„ ë³´ì¥í•˜ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```js\n// EventStoreë¥¼ ì‚¬ìš©í•œ ì´ë²¤íŠ¸ ì†Œì‹± ì˜ˆì‹œ\npublic async Task SaveEvents(Guid entityId, IEnumerable<Event> events, long expectedVersion)\n{\n    var eventData = events.Select(e => new EventData(\n        Guid.NewGuid(),\n        e.GetType().Name,\n        true,\n        Serialize(e),\n        null));\n\n    var streamName = $\"Entity-{entityId}\";\n    await _eventStoreConnection.AppendToStreamAsync(streamName, expectedVersion, eventData);\n}\n```\n\n## 5. CQRS íŒ¨í„´\n\n<div class=\"content-ad\"></div>\n\n\n![image](/assets/img/2024-06-19-5EssentialNETMicroservicesPatterns_5.png)\n\nCommand Query Responsibility Segregation (CQRS)ëŠ” ì‹œìŠ¤í…œì˜ ì½ê¸° ë° ì“°ê¸° ì‘ì—…ì„ ë¶„ë¦¬í•˜ëŠ” ë””ìì¸ íŒ¨í„´ì…ë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì— ì í•©í•˜ë©° ë³µì¡í•œ ë°ì´í„° ëª¨ë¸ì„ ê´€ë¦¬í•˜ê³  ì‹œìŠ¤í…œì„ ë” íš¨ê³¼ì ìœ¼ë¡œ í™•ì¥í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.\n\nìƒˆë¡œìš´ ì‚¬ìš©ì ì¶”ê°€ë¥¼ ìœ„í•œ ëª…ë ¹\n\n```js\n// Commands/AddUserCommand.cs\npublic class AddUserCommand\n{\n    public string Name { get; }\n\n    public AddUserCommand(string name)\n    {\n        Name = name;\n    }\n}\n\n// Handlers/AddUserCommandHandler.cs\npublic class AddUserCommandHandler : ICommandHandler<AddUserCommand>\n{\n    public void Handle(AddUserCommand command)\n    {\n        // Logic to add the user to the database\n        Console.WriteLine($\"User {command.Name} added\");\n    }\n}\n``` \n\n\n<div class=\"content-ad\"></div>\n\nIDë¡œ ì‚¬ìš©ìë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¿¼ë¦¬\n\n```js\n// Queries/GetUserQuery.cs\npublic class GetUserQuery\n{\n    public int UserId { get; }\n\n    public GetUserQuery(int userId)\n    {\n        UserId = userId;\n    }\n}\n\n// Handlers/GetUserQueryHandler.cs\npublic class GetUserQueryHandler : IQueryHandler<GetUserQuery, User>\n{\n    public User Handle(GetUserQuery query)\n    {\n        // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ìë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¡œì§\n        return new User { Id = query.UserId, Name = \"John Doe\" };\n    }\n}\n```\n\ní•¸ë“¤ëŸ¬ë¥¼ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤\n\n```js\n// Commands/ICommandHandler.cs\npublic interface ICommandHandler<TCommand>\n{\n    void Handle(TCommand command);\n}\n\n// Queries/IQueryHandler.cs\npublic interface IQueryHandler<TQuery, TResult>\n{\n    TResult Handle(TQuery query);\n}\n```\n\n<div class=\"content-ad\"></div>\n\nì´ ë‹¤ì„¯ ê°€ì§€ ë°©ì‹ì„ ë”°ë¼ê°€ë©´ .NET ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ìˆ™ë‹¬í•˜ê¸°ì— í•œ ë°œì§ ë” ë‹¤ê°€ê°ˆ ê²ƒì…ë‹ˆë‹¤. ì´ê²ƒë“¤ì„ êµ¬ì„± ìš”ì†Œë¡œ í™œìš©í•˜ê³  í”„ë¡œì íŠ¸ì— ë§ê²Œ ì‚¬ìš©ì ì •ì˜í•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”. ë‹¹ì‹ ì˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ëŠ” ë²ˆì„±í•  ê²ƒì…ë‹ˆë‹¤. ì½”ë”©ì„ ì¦ê¸°ì„¸ìš”!\n\n![ì´ë¯¸ì§€](https://miro.medium.com/v2/resize:fit:1400/0*UmnFETy8f6kvj1TV.gif)\n\nğŸ‘ ë§Œì•½ ì´ ì½˜í…ì¸ ê°€ ë„ì›€ì´ ëœë‹¤ë©´, ë²„íŠ¼ì„ ëˆ„ë¥¸ ì±„ë¡œ ì—¬ëŸ¬ ë²ˆ í´ë©(clap)í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì—¬ëŸ¬ë¶„ì˜ ìƒê°ê³¼ ì œì•ˆì„ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ ì£¼ì‹œë©´ ë” ë§ì€ í† ë¡ ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì½ì–´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤...","ogImage":{"url":"/assets/img/2024-06-19-5EssentialNETMicroservicesPatterns_0.png"},"coverImage":"/assets/img/2024-06-19-5EssentialNETMicroservicesPatterns_0.png","tag":["Tech"],"readingTime":7},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p><img src=\"/assets/img/2024-06-19-5EssentialNETMicroservicesPatterns_0.png\" alt=\"2024-06-19-5EssentialNETMicroservicesPatterns_0\"></p>\n<p>ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì˜ ëŠì„ì—†ëŠ” ì„¸ê³„ì—ì„œ, ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ëŠ” íŠ¹íˆ .NETì˜ ê´‘ë²”ìœ„í•œ ì˜ì—­ì—ì„œ ì¸ê¸° ìˆëŠ” ì„ íƒì§€ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. .NETì€ í™•ì¥ ë° ì ì‘ì´ ê°€ëŠ¥í•œ ëŠ¥ë ¥ìœ¼ë¡œ ëŒ€ê·œëª¨ì˜ ë°ì´í„° ë° íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì´ìƒì ì¸ í”Œë«í¼ì…ë‹ˆë‹¤.</p>\n<p>ì´ ê¸°ì‚¬ì—ì„œëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ ìˆ™ë‹¬í•˜ê³ ì í•˜ëŠ” .NET ê°œë°œìë“¤ì„ ìœ„í•œ ë‹¤ì„¯ ê°€ì§€ í•„ìˆ˜ íŒ¨í„´ì„ íƒêµ¬í•  ê²ƒì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì‹¤ìš©ì ì¸ ì˜ˆì œì™€ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¡°ì–¸ì„ ì œê³µí•˜ì—¬ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì˜ ìš°ìˆ˜ì„±ì„ ë‹¬ì„±í•˜ëŠ” ì—¬ì •ì—ì„œ ë‹¹ì‹ ì„ ë•ê² ìŠµë‹ˆë‹¤.</p>\n<h2>1. ê²Œì´íŠ¸ì›¨ì´ ì§‘ê³„ íŒ¨í„´</h2>\n<p><img src=\"/assets/img/2024-06-19-5EssentialNETMicroservicesPatterns_1.png\" alt=\"image\"></p>\n<p>ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ ì‘ìš© í”„ë¡œê·¸ë¨ì´ ìƒí˜¸ ì‘ìš©í•´ì•¼ í•  ì—¬ëŸ¬ ì„œë¹„ìŠ¤ê°€ ìˆëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤. ê° ê°œë³„ ì„œë¹„ìŠ¤ì™€ ì§ì ‘ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ëŒ€ì‹  API ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì¢‹ìŠµë‹ˆë‹¤. ì´ ë°©ë²•ì€ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¥¼ ê°„ì†Œí™”í•˜ê³  ë°±ì—”ë“œ ì„œë¹„ìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•œ ë‹¨ì¼ ì§„ì…ì ì„ ìƒì„±í•©ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// Ocelot API Gateway ì‚¬ìš© ì˜ˆì œ</span>\npublic <span class=\"hljs-keyword\">async</span> <span class=\"hljs-title class_\">Task</span>&#x3C;<span class=\"hljs-title class_\">AggregatedResult</span>> <span class=\"hljs-title class_\">AggregateData</span>()\n{\n    <span class=\"hljs-keyword\">var</span> userTask = _userService.<span class=\"hljs-title class_\">GetUser</span>();\n    <span class=\"hljs-keyword\">var</span> ordersTask = _orderService.<span class=\"hljs-title class_\">GetOrdersForUser</span>();\n    \n    <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">Task</span>.<span class=\"hljs-title class_\">WhenAll</span>(userTask, ordersTask);\n    \n    <span class=\"hljs-keyword\">var</span> user = <span class=\"hljs-keyword\">await</span> userTask;\n    <span class=\"hljs-keyword\">var</span> orders = <span class=\"hljs-keyword\">await</span> ordersTask;\n\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AggregatedResult</span>\n    {\n        <span class=\"hljs-title class_\">User</span> = user,\n        <span class=\"hljs-title class_\">Orders</span> = orders\n    };\n}\n</code></pre>\n<h2>2. íšŒë¡œ ì°¨ë‹¨ê¸° íŒ¨í„´</h2>\n<p><img src=\"/assets/img/2024-06-19-5EssentialNETMicroservicesPatterns_2.png\" alt=\"Circuit Breaker\"></p>\n<p>ì„œí‚· ë¸Œë ˆì´ì»¤ë¥¼ êµ¬í˜„í•˜ë©´ ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ì„œë¹„ìŠ¤ ì¥ì• ê°€ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë¡œ ì „íŒŒë˜ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë¹„ìŠ¤ ì¥ì• ê°€ ë°œìƒí•˜ë©´ ì„œí‚· ë¸Œë ˆì´ì»¤ê°€ ì´ë¥¼ ê°ì§€í•˜ê³  ê·¸ ì„œë¹„ìŠ¤ë¡œì˜ í›„ì† í˜¸ì¶œì„ ì¼ì • ê¸°ê°„ ë™ì•ˆ ìë™ìœ¼ë¡œ ì°¨ë‹¨í•©ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// Polly ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ì˜ˆì œ</span>\n<span class=\"hljs-keyword\">var</span> circuitBreakerPolicy = <span class=\"hljs-title class_\">Policy</span>\n    .<span class=\"hljs-property\">Handle</span>&#x3C;<span class=\"hljs-title class_\">Exception</span>>()\n    .<span class=\"hljs-title class_\">CircuitBreaker</span>(<span class=\"hljs-number\">2</span>, <span class=\"hljs-title class_\">TimeSpan</span>.<span class=\"hljs-title class_\">FromMinutes</span>(<span class=\"hljs-number\">1</span>));\n\n<span class=\"hljs-keyword\">await</span> circuitBreakerPolicy.<span class=\"hljs-title class_\">ExecuteAsync</span>(<span class=\"hljs-keyword\">async</span> () =>\n{\n    <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">PerformServiceCall</span>();\n});\n</code></pre>\n<h2>3. ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ íŒ¨í„´</h2>\n<p><img src=\"/assets/img/2024-06-19-5EssentialNETMicroservicesPatterns_3.png\" alt=\"Image\"></p>\n<p>ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ í™•ì¥í• ìˆ˜ë¡ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ì í•˜ê¸°ê°€ ë” ì–´ë ¤ì›Œì§‘ë‹ˆë‹¤. ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ê°€ ë™ì ìœ¼ë¡œ ì„œë¡œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\">using <span class=\"hljs-title class_\">System</span>;\nusing <span class=\"hljs-title class_\">System</span>.<span class=\"hljs-property\">Threading</span>.<span class=\"hljs-property\">Tasks</span>;\nusing <span class=\"hljs-title class_\">Consul</span>;\nusing <span class=\"hljs-title class_\">Microsoft</span>.<span class=\"hljs-property\">Extensions</span>.<span class=\"hljs-property\">DependencyInjection</span>;\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Program</span>\n{\n    <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title class_\">Main</span>(string[] args)\n    {\n        <span class=\"hljs-keyword\">var</span> serviceProvider = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServiceCollection</span>()\n            .<span class=\"hljs-property\">AddSingleton</span>&#x3C;<span class=\"hljs-title class_\">IConsulClient</span>, <span class=\"hljs-title class_\">ConsulClient</span>>(<span class=\"hljs-function\"><span class=\"hljs-params\">p</span> =></span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ConsulClient</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">consulConfig</span> =></span>\n            {\n                <span class=\"hljs-comment\">// Assuming Consul is running on localhost</span>\n                consulConfig.<span class=\"hljs-property\">Address</span> = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Uri</span>(<span class=\"hljs-string\">\"http://localhost:8500\"</span>);\n            }))\n            .<span class=\"hljs-property\">AddSingleton</span>&#x3C;<span class=\"hljs-title class_\">IConsulService</span>, <span class=\"hljs-title class_\">ConsulService</span>>()\n            .<span class=\"hljs-title class_\">BuildServiceProvider</span>();\n\n        <span class=\"hljs-keyword\">var</span> consulService = serviceProvider.<span class=\"hljs-property\">GetService</span>&#x3C;<span class=\"hljs-title class_\">IConsulService</span>>();\n        consulService.<span class=\"hljs-title class_\">RegisterService</span>().<span class=\"hljs-title class_\">Wait</span>();\n        consulService.<span class=\"hljs-title class_\">DiscoverServices</span>().<span class=\"hljs-title class_\">Wait</span>();\n    }\n}\n\npublic interface <span class=\"hljs-title class_\">IConsulService</span>\n{\n    <span class=\"hljs-title class_\">Task</span> <span class=\"hljs-title class_\">RegisterService</span>();\n    <span class=\"hljs-title class_\">Task</span> <span class=\"hljs-title class_\">DiscoverServices</span>();\n}\n\npublic <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ConsulService</span> : <span class=\"hljs-title class_\">IConsulService</span>\n{\n    private readonly <span class=\"hljs-title class_\">IConsulClient</span> _consulClient;\n\n    public <span class=\"hljs-title class_\">ConsulService</span>(<span class=\"hljs-title class_\">IConsulClient</span> consulClient)\n    {\n        _consulClient = consulClient;\n    }\n\n    public <span class=\"hljs-keyword\">async</span> <span class=\"hljs-title class_\">Task</span> <span class=\"hljs-title class_\">RegisterService</span>()\n    {\n        <span class=\"hljs-keyword\">var</span> registration = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AgentServiceRegistration</span>()\n        {\n            <span class=\"hljs-variable constant_\">ID</span> = <span class=\"hljs-title class_\">Guid</span>.<span class=\"hljs-title class_\">NewGuid</span>().<span class=\"hljs-title class_\">ToString</span>(),\n            <span class=\"hljs-title class_\">Name</span> = <span class=\"hljs-string\">\"MyService\"</span>,\n            <span class=\"hljs-title class_\">Address</span> = <span class=\"hljs-string\">\"localhost\"</span>,\n            <span class=\"hljs-title class_\">Port</span> = <span class=\"hljs-number\">5000</span>,\n        };\n\n        <span class=\"hljs-keyword\">await</span> _consulClient.<span class=\"hljs-property\">Agent</span>.<span class=\"hljs-title class_\">ServiceRegister</span>(registration);\n        <span class=\"hljs-title class_\">Console</span>.<span class=\"hljs-title class_\">WriteLine</span>(<span class=\"hljs-string\">\"Consulì— ì„œë¹„ìŠ¤ ë“±ë¡ë¨\"</span>);\n    }\n\n    public <span class=\"hljs-keyword\">async</span> <span class=\"hljs-title class_\">Task</span> <span class=\"hljs-title class_\">DiscoverServices</span>()\n    {\n        <span class=\"hljs-keyword\">var</span> services = <span class=\"hljs-keyword\">await</span> _consulClient.<span class=\"hljs-property\">Agent</span>.<span class=\"hljs-title class_\">Services</span>();\n        foreach (<span class=\"hljs-keyword\">var</span> service <span class=\"hljs-keyword\">in</span> services.<span class=\"hljs-property\">Response</span>.<span class=\"hljs-property\">Values</span>)\n        {\n            <span class=\"hljs-title class_\">Console</span>.<span class=\"hljs-title class_\">WriteLine</span>($<span class=\"hljs-string\">\"ë°œê²¬ëœ ì„œë¹„ìŠ¤: {service.Service}\"</span>);\n        }\n    }\n}\n</code></pre>\n<h2>4. ì´ë²¤íŠ¸ ì†Œì‹± íŒ¨í„´</h2>\n<p>ì´ë²¤íŠ¸ ì†Œì‹±ì€ ì‘ìš© í”„ë¡œê·¸ë¨ ì—”í‹°í‹°ì˜ ìƒíƒœ ë³€ê²½ì„ ì´ë²¤íŠ¸ ì‹œë¦¬ì¦ˆë¡œ ì €ì¥í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ íŠ¹íˆ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì—ì„œ ìœ ìš©í•˜ë©° ì‹œìŠ¤í…œì— ëŒ€í•œ ëª¨ë“  ë³€ê²½ ì‚¬í•­ì˜ ê°ì‚¬ ê°€ëŠ¥í•œ ë ˆì½”ë“œë¥¼ ì œê³µí•˜ì—¬ ë””ë²„ê¹… ë° ë¬¸ì œ í•´ê²°ì— ë„ì›€ì´ ë©ë‹ˆë‹¤. ê²Œë‹¤ê°€ ì´ë²¤íŠ¸ ì†Œì‹±ì€ ì‘ìš© í”„ë¡œê·¸ë¨ì˜ ë‹¤ë¥¸ êµ¬ì„± ìš”ì†Œ ê°„ ë°ì´í„° ì¼ê´€ì„±ì„ ë³´ì¥í•˜ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// EventStoreë¥¼ ì‚¬ìš©í•œ ì´ë²¤íŠ¸ ì†Œì‹± ì˜ˆì‹œ</span>\npublic <span class=\"hljs-keyword\">async</span> <span class=\"hljs-title class_\">Task</span> <span class=\"hljs-title class_\">SaveEvents</span>(<span class=\"hljs-title class_\">Guid</span> entityId, <span class=\"hljs-title class_\">IEnumerable</span>&#x3C;<span class=\"hljs-title class_\">Event</span>> events, long expectedVersion)\n{\n    <span class=\"hljs-keyword\">var</span> eventData = events.<span class=\"hljs-title class_\">Select</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">e</span> =></span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">EventData</span>(\n        <span class=\"hljs-title class_\">Guid</span>.<span class=\"hljs-title class_\">NewGuid</span>(),\n        e.<span class=\"hljs-title class_\">GetType</span>().<span class=\"hljs-property\">Name</span>,\n        <span class=\"hljs-literal\">true</span>,\n        <span class=\"hljs-title class_\">Serialize</span>(e),\n        <span class=\"hljs-literal\">null</span>));\n\n    <span class=\"hljs-keyword\">var</span> streamName = $<span class=\"hljs-string\">\"Entity-{entityId}\"</span>;\n    <span class=\"hljs-keyword\">await</span> _eventStoreConnection.<span class=\"hljs-title class_\">AppendToStreamAsync</span>(streamName, expectedVersion, eventData);\n}\n</code></pre>\n<h2>5. CQRS íŒ¨í„´</h2>\n<p><img src=\"/assets/img/2024-06-19-5EssentialNETMicroservicesPatterns_5.png\" alt=\"image\"></p>\n<p>Command Query Responsibility Segregation (CQRS)ëŠ” ì‹œìŠ¤í…œì˜ ì½ê¸° ë° ì“°ê¸° ì‘ì—…ì„ ë¶„ë¦¬í•˜ëŠ” ë””ìì¸ íŒ¨í„´ì…ë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì— ì í•©í•˜ë©° ë³µì¡í•œ ë°ì´í„° ëª¨ë¸ì„ ê´€ë¦¬í•˜ê³  ì‹œìŠ¤í…œì„ ë” íš¨ê³¼ì ìœ¼ë¡œ í™•ì¥í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.</p>\n<p>ìƒˆë¡œìš´ ì‚¬ìš©ì ì¶”ê°€ë¥¼ ìœ„í•œ ëª…ë ¹</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// Commands/AddUserCommand.cs</span>\npublic <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AddUserCommand</span>\n{\n    public string <span class=\"hljs-title class_\">Name</span> { get; }\n\n    public <span class=\"hljs-title class_\">AddUserCommand</span>(string name)\n    {\n        <span class=\"hljs-title class_\">Name</span> = name;\n    }\n}\n\n<span class=\"hljs-comment\">// Handlers/AddUserCommandHandler.cs</span>\npublic <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AddUserCommandHandler</span> : <span class=\"hljs-title class_\">ICommandHandler</span>&#x3C;<span class=\"hljs-title class_\">AddUserCommand</span>>\n{\n    public <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title class_\">Handle</span>(<span class=\"hljs-title class_\">AddUserCommand</span> command)\n    {\n        <span class=\"hljs-comment\">// Logic to add the user to the database</span>\n        <span class=\"hljs-title class_\">Console</span>.<span class=\"hljs-title class_\">WriteLine</span>($<span class=\"hljs-string\">\"User {command.Name} added\"</span>);\n    }\n}\n</code></pre>\n<p>IDë¡œ ì‚¬ìš©ìë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¿¼ë¦¬</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// Queries/GetUserQuery.cs</span>\npublic <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GetUserQuery</span>\n{\n    public int <span class=\"hljs-title class_\">UserId</span> { get; }\n\n    public <span class=\"hljs-title class_\">GetUserQuery</span>(int userId)\n    {\n        <span class=\"hljs-title class_\">UserId</span> = userId;\n    }\n}\n\n<span class=\"hljs-comment\">// Handlers/GetUserQueryHandler.cs</span>\npublic <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GetUserQueryHandler</span> : <span class=\"hljs-title class_\">IQueryHandler</span>&#x3C;<span class=\"hljs-title class_\">GetUserQuery</span>, <span class=\"hljs-title class_\">User</span>>\n{\n    public <span class=\"hljs-title class_\">User</span> <span class=\"hljs-title class_\">Handle</span>(<span class=\"hljs-title class_\">GetUserQuery</span> query)\n    {\n        <span class=\"hljs-comment\">// ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ìë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¡œì§</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">User</span> { <span class=\"hljs-title class_\">Id</span> = query.<span class=\"hljs-property\">UserId</span>, <span class=\"hljs-title class_\">Name</span> = <span class=\"hljs-string\">\"John Doe\"</span> };\n    }\n}\n</code></pre>\n<p>í•¸ë“¤ëŸ¬ë¥¼ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// Commands/ICommandHandler.cs</span>\npublic interface <span class=\"hljs-title class_\">ICommandHandler</span>&#x3C;<span class=\"hljs-title class_\">TCommand</span>>\n{\n    <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title class_\">Handle</span>(<span class=\"hljs-title class_\">TCommand</span> command);\n}\n\n<span class=\"hljs-comment\">// Queries/IQueryHandler.cs</span>\npublic interface <span class=\"hljs-title class_\">IQueryHandler</span>&#x3C;<span class=\"hljs-title class_\">TQuery</span>, <span class=\"hljs-title class_\">TResult</span>>\n{\n    <span class=\"hljs-title class_\">TResult</span> <span class=\"hljs-title class_\">Handle</span>(<span class=\"hljs-title class_\">TQuery</span> query);\n}\n</code></pre>\n<p>ì´ ë‹¤ì„¯ ê°€ì§€ ë°©ì‹ì„ ë”°ë¼ê°€ë©´ .NET ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ìˆ™ë‹¬í•˜ê¸°ì— í•œ ë°œì§ ë” ë‹¤ê°€ê°ˆ ê²ƒì…ë‹ˆë‹¤. ì´ê²ƒë“¤ì„ êµ¬ì„± ìš”ì†Œë¡œ í™œìš©í•˜ê³  í”„ë¡œì íŠ¸ì— ë§ê²Œ ì‚¬ìš©ì ì •ì˜í•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”. ë‹¹ì‹ ì˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ëŠ” ë²ˆì„±í•  ê²ƒì…ë‹ˆë‹¤. ì½”ë”©ì„ ì¦ê¸°ì„¸ìš”!</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:1400/0*UmnFETy8f6kvj1TV.gif\" alt=\"ì´ë¯¸ì§€\"></p>\n<p>ğŸ‘ ë§Œì•½ ì´ ì½˜í…ì¸ ê°€ ë„ì›€ì´ ëœë‹¤ë©´, ë²„íŠ¼ì„ ëˆ„ë¥¸ ì±„ë¡œ ì—¬ëŸ¬ ë²ˆ í´ë©(clap)í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì—¬ëŸ¬ë¶„ì˜ ìƒê°ê³¼ ì œì•ˆì„ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ ì£¼ì‹œë©´ ë” ë§ì€ í† ë¡ ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì½ì–´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤...</p>\n</body>\n</html>\n"},"__N_SSG":true}