{"pageProps":{"post":{"title":"쿠버네티스 x509 인증서가 만료되었거나 아직 유효하지 않음 오류","description":"","date":"2024-06-19 13:09","slug":"2024-06-19-Kubernetesx509certificatehasexpiredorisnotyetvaliderror","content":"\n\n\n<img src=\"/assets/img/2024-06-19-Kubernetesx509certificatehasexpiredorisnotyetvaliderror_0.png\" />\n\n만약 잘 작동되던 쿠버네티스 환경에서 갑자기 \"x509: certificate has expired or is not yet valid\" 오류가 발생한다면 어떻게 하시겠어요?\n\n오늘 나에게 일어난 것과 똑같이요. 저도 이 오류를 경험했어요. 왜 나타나는지도 모르는데, 뭔가 조치를 취하지 않은 상태에서 발생한 문제였죠!\n\n저는 인증서 만료 문제라고 알고 있었지만, 문제를 어떻게 해결할지 알려고 많은 시간을 보냈어요. 그래서 이 주제에 대해 짧은 기사를 써서 이런 문제를 겪는 다른 분들에게 도움이 되길 바라는 마음으로 준비했어요.\n\n\n<div class=\"content-ad\"></div>\n\nKubernetes 문서에 따르면 kubeadm으로 생성된 클라이언트 인증서는 1년 후에 만료됩니다.\n\n그래서 제가 먼저 한 일은:\n\n- 인증서 세부 정보 확인하기\n\n```js\nkubeadm certs check-expiration\n```\n\n<div class=\"content-ad\"></div>\n\n2. 그런 다음 모든 인증서를 갱신했어요\n\n```js\nkubeadm certs renew all\n```\n\n3. 마지막으로 kubelet을 다시 시작했어요\n\n```js\nsudo systemctl restart kubelet\n```\n\n<div class=\"content-ad\"></div>\n\n하지만, 아무것도 바뀌지 않았네요! 계속해서 같은 오류가 발생하고 있습니다.\n\n여기서 뭔가 빠진 게 있는 것 같아요.\n\n이 문제를 조사하는 데 시간을 많이 쏟았는데, ~/.kube/config 파일을 살펴보던 중 예전 클라이언트 인증서 항목을 사용하고 있다는 것을 깨달았어요.\n\n그리고 kubeadm으로 클러스터를 구축할 때 /etc/kubernetes/admin.conf을 /.kube/config 파일로 복사해야 했다는 것을 기억했네요.\n\n<div class=\"content-ad\"></div>\n\n인증서를 갱신하면 /etc/kubernetes/admin.conf 파일이 업데이트되므로, 당연히 내 /.kube/config 파일도 그에 맞게 업데이트해야 했어요.\n\n다음 명령어를 실행하여 문제를 해결했어요.\n\n```js\nsudo cp -i /etc/kubernetes/admin.conf ~/.kube/config\nsudo chown $(id -u):$(id -g) ~/.kube/config\n```\n\n쿠버네티스 문서에 따르면:","ogImage":{"url":"/assets/img/2024-06-19-Kubernetesx509certificatehasexpiredorisnotyetvaliderror_0.png"},"coverImage":"/assets/img/2024-06-19-Kubernetesx509certificatehasexpiredorisnotyetvaliderror_0.png","tag":["Tech"],"readingTime":2},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p>만약 잘 작동되던 쿠버네티스 환경에서 갑자기 \"x509: certificate has expired or is not yet valid\" 오류가 발생한다면 어떻게 하시겠어요?</p>\n<p>오늘 나에게 일어난 것과 똑같이요. 저도 이 오류를 경험했어요. 왜 나타나는지도 모르는데, 뭔가 조치를 취하지 않은 상태에서 발생한 문제였죠!</p>\n<p>저는 인증서 만료 문제라고 알고 있었지만, 문제를 어떻게 해결할지 알려고 많은 시간을 보냈어요. 그래서 이 주제에 대해 짧은 기사를 써서 이런 문제를 겪는 다른 분들에게 도움이 되길 바라는 마음으로 준비했어요.</p>\n<p>Kubernetes 문서에 따르면 kubeadm으로 생성된 클라이언트 인증서는 1년 후에 만료됩니다.</p>\n<p>그래서 제가 먼저 한 일은:</p>\n<ul>\n<li>인증서 세부 정보 확인하기</li>\n</ul>\n<pre><code class=\"hljs language-js\">kubeadm certs check-expiration\n</code></pre>\n<ol start=\"2\">\n<li>그런 다음 모든 인증서를 갱신했어요</li>\n</ol>\n<pre><code class=\"hljs language-js\">kubeadm certs renew all\n</code></pre>\n<ol start=\"3\">\n<li>마지막으로 kubelet을 다시 시작했어요</li>\n</ol>\n<pre><code class=\"hljs language-js\">sudo systemctl restart kubelet\n</code></pre>\n<p>하지만, 아무것도 바뀌지 않았네요! 계속해서 같은 오류가 발생하고 있습니다.</p>\n<p>여기서 뭔가 빠진 게 있는 것 같아요.</p>\n<p>이 문제를 조사하는 데 시간을 많이 쏟았는데, ~/.kube/config 파일을 살펴보던 중 예전 클라이언트 인증서 항목을 사용하고 있다는 것을 깨달았어요.</p>\n<p>그리고 kubeadm으로 클러스터를 구축할 때 /etc/kubernetes/admin.conf을 /.kube/config 파일로 복사해야 했다는 것을 기억했네요.</p>\n<p>인증서를 갱신하면 /etc/kubernetes/admin.conf 파일이 업데이트되므로, 당연히 내 /.kube/config 파일도 그에 맞게 업데이트해야 했어요.</p>\n<p>다음 명령어를 실행하여 문제를 해결했어요.</p>\n<pre><code class=\"hljs language-js\">sudo cp -i /etc/kubernetes/admin.<span class=\"hljs-property\">conf</span> ~<span class=\"hljs-regexp\">/.kube/</span>config\nsudo chown $(id -u):$(id -g) ~<span class=\"hljs-regexp\">/.kube/</span>config\n</code></pre>\n<p>쿠버네티스 문서에 따르면:</p>\n</body>\n</html>\n"},"__N_SSG":true}