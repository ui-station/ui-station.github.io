{"pageProps":{"post":{"title":"Spring Boot로 API 게이트웨이 구현하는 방법","description":"","date":"2024-06-22 22:18","slug":"2024-06-22-APIgatewayinSpringboot","content":"\n![API Gateway](/assets/img/2024-06-22-APIgatewayinSpringboot_0.png)\n\nAPI는 응용 프로그램 간에 일반적인 통신 방식입니다. 마이크로서비스 아키텍처의 경우 여러 서비스가 있으며 클라이언트는 이러한 서비스를 호출하기 위해 모든 하위 응용 프로그램의 호스트 이름을 알아야 합니다.\n\n이 통신을 간소화하기 위해 클라이언트와 서버 사이에 모든 API 요청을 관리하는 컴포넌트인 API 게이트웨이를 선호합니다. 또한 다음과 같은 다른 기능을 가질 수 있습니다:\n\n- 보안 — 인증, 권한 부여\n- 라우팅 — 라우팅, 요청/응답 조작, 회로 차단기\n- 관찰성 — 지표 집계, 로깅, 추적화\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nAPI 게이트웨이의 아키텍처적 이점:\n\n- 복잡성 감소\n- 정책의 중앙 집중화된 제어\n- 단순화된 문제 해결\n\nAPI 게이트웨이에는 Spring Cloud Gateway, Zuul API Gateway, APIGee, EAG (Enterprise API Gateway)와 같은 다양한 구현 유형이 있습니다.\n\n본 문서에서는 Spring Cloud API 게이트웨이를 구현하는 방법, 들어오는 요청 필터링, 요청/응답 조작, 인증 처리에 대해 살펴볼 것입니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n아래에서 전체 에코시스템을 시각화할 수 있습니다:\n\n![에코시스템 다이어그램](/assets/img/2024-06-22-APIgatewayinSpringboot_1.png)\n\n위 다이어그램에서 총 5개의 서비스가 있습니다.\n\n- 서비스 레지스트리 — 각 프로젝트 내의 각 마이크로서비스 인스턴스의 가용 상태를 추적하는 응용 프로그램입니다.\n- API 게이트웨이 — 들어오는 요청을 수신하고 인증(활성화되어 있다면)을 수행하고 실제 마이크로서비스로 요청을 전달합니다. 응답을 받으면 소비자에게 반환합니다.\n- 인증 서버 — 인증을 처리하는 응용 프로그램입니다.\n- 첫 번째와 두 번째 마이크로서비스 — 서로 다른 기능을 갖는 두 개의 일반 내부 응용 프로그램입니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n모든 애플리케이션은 시작 시 서비스 레지스트리에 등록됩니다. API 요청을 받으면 다음과 같은 단계가 발생합니다:\n\n- 소비자가 API 게이트웨이를 통해 애플리케이션을 호출합니다.\n- API 게이트웨이는 수신 URL이 인증이 필요한지 확인합니다. 필요하다면 인증 서버를 호출하여 유효성을 검사합니다.\n- 유효한 토큰이라면 필터를 적용한 후 해당 애플리케이션으로 요청을 전달합니다.\n- 유효하지 않은 토큰일 경우 소비자에게 권한이 없음을 응답합니다.\n- 내부 마이크로서비스에서 응답을 받으면 필터를 적용한 후 해당 소비자에게 반환합니다.\n\n게이트웨이에서의 필터는 로깅, 요청/응답 세부 사항 조작/사용자 정의와 같은 작업이 포함될 수 있습니다.\n\nService registry\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n유레카 서버로 작동하는 애플리케이션이에요. pom.xml에 다음 종속성이 있어야 해요.\n\n```js\n<dependency>\n  <groupId>org.springframework.cloud</groupId>\n  <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>\n</dependency>\n```\n\n그리고 메인 클래스에 `@EnableEurekaServer` 어노테이션이 있어야 해요.\n\n기본적으로 유레카 서버는 자신을 디스커버리에 등록하는데, 이를 비활성화하기 위해 application.properties에 아래 속성을 포함해야 해요.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\neureka.client.registerWithEureka = false;\neureka.client.fetchRegistry = false;\n```\n\n다른 애플리케이션을 Eureka 클라이언트로 만들려면 pom.xml에 아래 종속성을 포함하세요:\n\n```js\n<dependency>\n  <groupId>org.springframework.cloud</groupId>\n  <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\n</dependency>\n```\n\n그리고, application.properties 파일에 Eureka 서버 URL을 제공해주세요:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\neureka.client.serviceUrl.defaultZone= <eureka-서버-가동-호스트-및-포트>\n\nAPI 게이트웨이:\n\nSpring Cloud API 게이트웨이에는 pom.xml에 아래 종속성이 필요합니다.\n\n```xml\n<dependencies>\n  <dependency>\n   <groupId>org.springframework.cloud</groupId>\n   <artifactId>spring-cloud-starter-gateway</artifactId>\n  </dependency>\n</dependencies>\n <dependencyManagement>\n  <dependencies>\n   <dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-dependencies</artifactId>\n    <version>${spring-cloud.version}</version>\n    <type>pom</type>\n    <scope>import</scope>\n   </dependency>\n  </dependencies>\n </dependencyManagement>\n```\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\napplication.yml 파일에서 모든 내부 마이크로서비스 이름, 경로 및 uri 세부 정보를 다음과 같이 제공해주세요:\n\n```js\nspring:\n  application:\n    name: gateway-service\n  cloud:\n    gateway:\n      routes:\n        - id: first\n          predicates:\n            - Path=/first/\n          uri: localhost:8081\n        - id: second\n          predicates:\n            - Path=/second/\n          uri: localhost:8082\n        - id: auth-server\n          predicates:\n            - Path=/login/\n          uri: localhost:8088\n```\n\n그리고 Gateway가 제공하는 모든 라우트를 제공하기 위해 RouteLocator 유형의 빈이 필요합니다. 요청/응답을 처리하려면 필요에 따라 필터를 포함할 수 있습니다:\n\n```js\n@Bean\npublic RouteLocator customRouteLocator(RouteLocatorBuilder builder) {\n    return builder.routes()\n            .route(\"first-microservice\", r -> r.path(\"/first\")\n                    .and().method(\"POST\")\n                    .and().readBody(Student.class, s -> true).filters(f -> f.filters(requestFilter, authFilter))\n                    .uri(\"http://localhost:8081\"))\n            .route(\"first-microservice\", r -> r.path(\"/first\")\n                    .and().method(\"GET\").filters(f-> f.filters(authFilter))\n                    .uri(\"http://localhost:8081\"))\n            .route(\"second-microservice\", r -> r.path(\"/second\")\n                    .and().method(\"POST\")\n                    .and().readBody(Company.class, s -> true).filters(f -> f.filters(requestFilter, authFilter))\n                    .uri(\"http://localhost:8082\"))\n            .route(\"second-microservice\", r -> r.path(\"/second\")\n                    .and().method(\"GET\").filters(f-> f.filters(authFilter))\n                    .uri(\"http://localhost:8082\"))\n            .route(\"auth-server\", r -> r.path(\"/login\")\n                    .uri(\"http://localhost:8088\"))\n            .build();\n}\n```\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n필터:\n\nA. 요청 본문을 로깅하려면:\n\n본문을 읽기 위해 ResourceLocator 빈에서 readBody()를 true로 설정해야 합니다. 이렇게 하면 ServerWebExchange 객체가 요청 본문을 \"cachedRequestBodyObject\" 속성에 캐시합니다.\n\n```js\npackage com.example.springcloudgatewayoverview.filter;\n\nimport com.example.springcloudgatewayoverview.model.Company;\nimport com.example.springcloudgatewayoverview.model.Student;\nimport org.springframework.cloud.gateway.filter.GatewayFilter;\nimport org.springframework.cloud.gateway.filter.GatewayFilterChain;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.server.ServerWebExchange;\nimport reactor.core.publisher.Mono;\n\n@Component\npublic class RequestFilter implements GatewayFilter {\n    @Override\n    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n        Object body = exchange.getAttribute(\"cachedRequestBodyObject\");\n        System.out.println(\"in request filter\");\n        if(body instanceof Student) {\n            System.out.println(\"body:\" + (Student) body);\n        }\n        else if(body instanceof Company) {\n            System.out.println(\"body:\" + (Company) body);\n        }\n        return chain.filter(exchange);\n    }\n}\n```\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nB. 응답 본문을 로깅하려면:\n\n```js\npackage com.example.springcloudgatewayoverview.filter;\n\nimport com.example.springcloudgatewayoverview.model.Company;\nimport com.example.springcloudgatewayoverview.model.Student;\nimport com.fasterxml.jackson.core.JsonProcessingException;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport org.reactivestreams.Publisher;\nimport org.springframework.core.io.buffer.DataBuffer;\nimport org.springframework.core.io.buffer.DataBufferFactory;\nimport org.springframework.core.io.buffer.DefaultDataBuffer;\nimport org.springframework.core.io.buffer.DefaultDataBufferFactory;\nimport org.springframework.http.server.reactive.ServerHttpRequest;\nimport org.springframework.http.server.reactive.ServerHttpResponse;\nimport org.springframework.http.server.reactive.ServerHttpResponseDecorator;\nimport org.springframework.web.server.ServerWebExchange;\nimport org.springframework.web.server.WebFilter;\nimport org.springframework.web.server.WebFilterChain;\nimport reactor.core.publisher.Flux;\nimport reactor.core.publisher.Mono;\n\nimport java.nio.charset.StandardCharsets;\nimport java.util.List;\n\npublic class PostGlobalFilter implements WebFilter {\n\n    @Override\n    public Mono<Void> filter(ServerWebExchange exchange, WebFilterChain chain) {\n        String path = exchange.getRequest().getPath().toString();\n        ServerHttpResponse response = exchange.getResponse();\n        ServerHttpRequest request = exchange.getRequest();\n        DataBufferFactory dataBufferFactory = response.bufferFactory();\n        ServerHttpResponseDecorator decoratedResponse = getDecoratedResponse(path, response, request, dataBufferFactory);\n        return chain.filter(exchange.mutate().response(decoratedResponse).build());\n    }\n\n    private ServerHttpResponseDecorator getDecoratedResponse(String path, ServerHttpResponse response, ServerHttpRequest request, DataBufferFactory dataBufferFactory) {\n        return new ServerHttpResponseDecorator(response) {\n\n            @Override\n            public Mono<Void> writeWith(final Publisher<? extends DataBuffer> body) {\n\n                if (body instanceof Flux) {\n\n                    Flux<? extends DataBuffer> fluxBody = (Flux<? extends DataBuffer>) body;\n\n                    return super.writeWith(fluxBody.buffer().map(dataBuffers -> {\n\n                        DefaultDataBuffer joinedBuffers = new DefaultDataBufferFactory().join(dataBuffers);\n                        byte[] content = new byte[joinedBuffers.readableByteCount()];\n                        joinedBuffers.read(content);\n                        String responseBody = new String(content, StandardCharsets.UTF_8);//응답 수정 및 수정된 응답 반환\n                        System.out.println(\"requestId: \"+request.getId()+\", method: \"+request.getMethodValue()+\", req url: \"+request.getURI()+\", response body :\"+ responseBody);\n                        try {\n                            if(request.getURI().getPath().equals(\"/first\") && request.getMethodValue().equals(\"GET\")) {\n                                List<Student> student = new ObjectMapper().readValue(responseBody, List.class);\n                                System.out.println(\"student:\" + student);\n                            }\n                            else if(request.getURI().getPath().equals(\"/second\") && request.getMethodValue().equals(\"GET\")) {\n                                List<Company> companies = new ObjectMapper().readValue(responseBody, List.class);\n                                System.out.println(\"companies:\" + companies);\n                            }\n                        } catch (JsonProcessingException e) {\n                            throw new RuntimeException(e);\n                        }\n                        return dataBufferFactory.wrap(responseBody.getBytes());\n                    })).onErrorResume(err -> {\n\n                        System.out.println(\"error while decorating Response: {}\"+err.getMessage());\n                        return Mono.empty();\n                    });\n\n                }\n                return super.writeWith(body);\n            }\n        };\n    }\n\n}\n```\n\nC. API 호출 전에 인증하기:\n\n다음과 같이 인증 필터를 생성하십시오:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```java\npackage com.example.springcloudgatewayoverview.filter;\n\nimport com.example.springcloudgatewayoverview.util.AuthUtil;\nimport com.example.springcloudgatewayoverview.util.JWTUtil;\nimport com.example.springcloudgatewayoverview.validator.RouteValidator;\nimport io.jsonwebtoken.Claims;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.cloud.context.config.annotation.RefreshScope;\nimport org.springframework.cloud.gateway.filter.GatewayFilter;\nimport org.springframework.cloud.gateway.filter.GatewayFilterChain;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.server.reactive.ServerHttpRequest;\nimport org.springframework.http.server.reactive.ServerHttpResponse;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.server.ServerWebExchange;\nimport reactor.core.publisher.Mono;\n\n@Component\n@RefreshScope\npublic class AuthFilter implements GatewayFilter {\n\n    @Autowired\n    RouteValidator routeValidator;\n\n    @Autowired\n    private JWTUtil jwtUtil;\n\n    @Autowired\n    private AuthUtil authUtil;\n\n    @Value(\"${authentication.enabled}\")\n    private boolean authEnabled;\n\n    @Override\n    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n        if(!authEnabled) {\n            System.out.println(\"Authentication is disabled. To enable it, make \\\"authentication.enabled\\\" property as true\");\n            return chain.filter(exchange);\n        }\n        String token =\"\";\n        ServerHttpRequest request = exchange.getRequest();\n\n        if(routeValidator.isSecured.test(request)) {\n            System.out.println(\"validating authentication token\");\n            if(this.isCredsMissing(request)) {\n                System.out.println(\"in error\");\n                return this.onError(exchange,\"Credentials missing\",HttpStatus.UNAUTHORIZED);\n            }\n            if (request.getHeaders().containsKey(\"userName\") && request.getHeaders().containsKey(\"role\")) {\n                token = authUtil.getToken(request.getHeaders().get(\"userName\").toString(), request.getHeaders().get(\"role\").toString());\n            }\n            else {\n                token = request.getHeaders().get(\"Authorization\").toString().split(\" \")[1];\n            }\n\n            if(jwtUtil.isInvalid(token)) {\n                return this.onError(exchange,\"Auth header invalid\",HttpStatus.UNAUTHORIZED);\n            }\n            else {\n                System.out.println(\"Authentication is successful\");\n            }\n\n            this.populateRequestWithHeaders(exchange,token);\n        }\n        return chain.filter(exchange);\n    }\n\n    private Mono<Void> onError(ServerWebExchange exchange, String err, HttpStatus httpStatus) {\n        ServerHttpResponse response = exchange.getResponse();\n        response.setStatusCode(httpStatus);\n        return response.setComplete();\n    }\n\n    private String getAuthHeader(ServerHttpRequest request) {\n        return  request.getHeaders().getOrEmpty(\"Authorization\").get(0);\n    }\n\n\n    private boolean isCredsMissing(ServerHttpRequest request) {\n        return !(request.getHeaders().containsKey(\"userName\") && request.getHeaders().containsKey(\"role\")) && !request.getHeaders().containsKey(\"Authorization\");\n    }\n\n    private void populateRequestWithHeaders(ServerWebExchange exchange, String token) {\n        Claims claims = jwtUtil.getALlClaims(token);\n        exchange.getRequest()\n                .mutate()\n                .header(\"id\",String.valueOf(claims.get(\"id\")))\n                .header(\"role\", String.valueOf(claims.get(\"role\")))\n                .build();\n    }\n}\n```\n\nEndpoints 중 일부는 토큰 없이 호출을 허용해야 합니다. (예: 로그인 URL, 헬스 체크 URL 등). 이러한 엔드포인트들을 아래 목록에 추가할 것입니다:\n\n```java\npackage com.example.springcloudgatewayoverview.validator;\n\nimport org.springframework.http.server.reactive.ServerHttpRequest;\nimport org.springframework.stereotype.Component;\n\nimport java.util.List;\nimport java.util.function.Predicate;\n\n@Component\npublic class RouteValidator {\n    public static final List<String> unprotectedURLs = List.of(\"/login\");\n\n    public Predicate<ServerHttpRequest> isSecured = request -> unprotectedURLs.stream().noneMatch(uri -> request.getURI().getPath().contains(uri));\n}\n```\n\nJWTUtil:\n\n```java\n\n```\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```java\npackage com.example.springcloudgatewayoverview.util;\n\nimport io.jsonwebtoken.Claims;\nimport io.jsonwebtoken.Jwts;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport java.util.Date;\n\n@Component\npublic class JWTUtil {\n\n    @Value(\"${jwt.secret}\")\n    private String secret;\n\n    public Claims getAllClaims(String token) {\n        return Jwts.parserBuilder().setSigningKey(secret).build().parseClaimsJws(token).getBody();\n    }\n\n    private boolean isTokenExpired(String token) {\n        return this.getAllClaims(token).getExpiration().before(new Date());\n    }\n\n    public boolean isInvalid(String token) {\n        return this.isTokenExpired(token);\n    }\n\n}\n```\n\nAuthentication server:\n\n이 서비스는 내부 마이크로서비스에 액세스하기 위한 토큰을 제공합니다.\n\n실행:\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nOnce all applications are running, you can access the service registry by entering http://localhost:8761 in your browser. Here, you can find information about all the currently running services:\n\n![Service Registry](/assets/img/2024-06-22-APIgatewayinSpringboot_2.png)\n\nThe API Gateway is running on localhost at port 8080. You can access the endpoints of the First or Second microservice from http://localhost:8080.\n\n![API Gateway Endpoints](/assets/img/2024-06-22-APIgatewayinSpringboot_3.png)\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nAPIGateway 콘솔의 요청/응답 로그:\n\n![2024-06-22-APIgatewayinSpringboot_4](/assets/img/2024-06-22-APIgatewayinSpringboot_4.png)\n\n인증이 포함된 샘플 요청:\n\n![2024-06-22-APIgatewayinSpringboot_5](/assets/img/2024-06-22-APIgatewayinSpringboot_5.png)\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n서비스의 모든 코드 기반은 여기에서 사용 가능합니다.\n\n읽어 주셔서 감사합니다. 즐거운 탐험하세요!!!\n","ogImage":{"url":"/assets/img/2024-06-22-APIgatewayinSpringboot_0.png"},"coverImage":"/assets/img/2024-06-22-APIgatewayinSpringboot_0.png","tag":["Tech"],"readingTime":20},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p><img src=\"/assets/img/2024-06-22-APIgatewayinSpringboot_0.png\" alt=\"API Gateway\"></p>\n<p>API는 응용 프로그램 간에 일반적인 통신 방식입니다. 마이크로서비스 아키텍처의 경우 여러 서비스가 있으며 클라이언트는 이러한 서비스를 호출하기 위해 모든 하위 응용 프로그램의 호스트 이름을 알아야 합니다.</p>\n<p>이 통신을 간소화하기 위해 클라이언트와 서버 사이에 모든 API 요청을 관리하는 컴포넌트인 API 게이트웨이를 선호합니다. 또한 다음과 같은 다른 기능을 가질 수 있습니다:</p>\n<ul>\n<li>보안 — 인증, 권한 부여</li>\n<li>라우팅 — 라우팅, 요청/응답 조작, 회로 차단기</li>\n<li>관찰성 — 지표 집계, 로깅, 추적화</li>\n</ul>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>API 게이트웨이의 아키텍처적 이점:</p>\n<ul>\n<li>복잡성 감소</li>\n<li>정책의 중앙 집중화된 제어</li>\n<li>단순화된 문제 해결</li>\n</ul>\n<p>API 게이트웨이에는 Spring Cloud Gateway, Zuul API Gateway, APIGee, EAG (Enterprise API Gateway)와 같은 다양한 구현 유형이 있습니다.</p>\n<p>본 문서에서는 Spring Cloud API 게이트웨이를 구현하는 방법, 들어오는 요청 필터링, 요청/응답 조작, 인증 처리에 대해 살펴볼 것입니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>아래에서 전체 에코시스템을 시각화할 수 있습니다:</p>\n<p><img src=\"/assets/img/2024-06-22-APIgatewayinSpringboot_1.png\" alt=\"에코시스템 다이어그램\"></p>\n<p>위 다이어그램에서 총 5개의 서비스가 있습니다.</p>\n<ul>\n<li>서비스 레지스트리 — 각 프로젝트 내의 각 마이크로서비스 인스턴스의 가용 상태를 추적하는 응용 프로그램입니다.</li>\n<li>API 게이트웨이 — 들어오는 요청을 수신하고 인증(활성화되어 있다면)을 수행하고 실제 마이크로서비스로 요청을 전달합니다. 응답을 받으면 소비자에게 반환합니다.</li>\n<li>인증 서버 — 인증을 처리하는 응용 프로그램입니다.</li>\n<li>첫 번째와 두 번째 마이크로서비스 — 서로 다른 기능을 갖는 두 개의 일반 내부 응용 프로그램입니다.</li>\n</ul>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>모든 애플리케이션은 시작 시 서비스 레지스트리에 등록됩니다. API 요청을 받으면 다음과 같은 단계가 발생합니다:</p>\n<ul>\n<li>소비자가 API 게이트웨이를 통해 애플리케이션을 호출합니다.</li>\n<li>API 게이트웨이는 수신 URL이 인증이 필요한지 확인합니다. 필요하다면 인증 서버를 호출하여 유효성을 검사합니다.</li>\n<li>유효한 토큰이라면 필터를 적용한 후 해당 애플리케이션으로 요청을 전달합니다.</li>\n<li>유효하지 않은 토큰일 경우 소비자에게 권한이 없음을 응답합니다.</li>\n<li>내부 마이크로서비스에서 응답을 받으면 필터를 적용한 후 해당 소비자에게 반환합니다.</li>\n</ul>\n<p>게이트웨이에서의 필터는 로깅, 요청/응답 세부 사항 조작/사용자 정의와 같은 작업이 포함될 수 있습니다.</p>\n<p>Service registry</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>유레카 서버로 작동하는 애플리케이션이에요. pom.xml에 다음 종속성이 있어야 해요.</p>\n<pre><code class=\"hljs language-js\">&#x3C;dependency>\n  <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">groupId</span>></span>org.springframework.cloud<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">groupId</span>></span></span>\n  <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">artifactId</span>></span>spring-cloud-starter-netflix-eureka-server<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">artifactId</span>></span></span>\n&#x3C;/dependency>\n</code></pre>\n<p>그리고 메인 클래스에 <code>@EnableEurekaServer</code> 어노테이션이 있어야 해요.</p>\n<p>기본적으로 유레카 서버는 자신을 디스커버리에 등록하는데, 이를 비활성화하기 위해 application.properties에 아래 속성을 포함해야 해요.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\">eureka.<span class=\"hljs-property\">client</span>.<span class=\"hljs-property\">registerWithEureka</span> = <span class=\"hljs-literal\">false</span>;\neureka.<span class=\"hljs-property\">client</span>.<span class=\"hljs-property\">fetchRegistry</span> = <span class=\"hljs-literal\">false</span>;\n</code></pre>\n<p>다른 애플리케이션을 Eureka 클라이언트로 만들려면 pom.xml에 아래 종속성을 포함하세요:</p>\n<pre><code class=\"hljs language-js\">&#x3C;dependency>\n  <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">groupId</span>></span>org.springframework.cloud<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">groupId</span>></span></span>\n  <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">artifactId</span>></span>spring-cloud-starter-netflix-eureka-client<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">artifactId</span>></span></span>\n&#x3C;/dependency>\n</code></pre>\n<p>그리고, application.properties 파일에 Eureka 서버 URL을 제공해주세요:</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>eureka.client.serviceUrl.defaultZone= &#x3C;eureka-서버-가동-호스트-및-포트></p>\n<p>API 게이트웨이:</p>\n<p>Spring Cloud API 게이트웨이에는 pom.xml에 아래 종속성이 필요합니다.</p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">dependencies</span>></span>\n  <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">dependency</span>></span>\n   <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">groupId</span>></span>org.springframework.cloud<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">groupId</span>></span>\n   <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">artifactId</span>></span>spring-cloud-starter-gateway<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">artifactId</span>></span>\n  <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">dependency</span>></span>\n<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">dependencies</span>></span>\n <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">dependencyManagement</span>></span>\n  <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">dependencies</span>></span>\n   <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">dependency</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">groupId</span>></span>org.springframework.cloud<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">groupId</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">artifactId</span>></span>spring-cloud-dependencies<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">artifactId</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">version</span>></span>${spring-cloud.version}<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">version</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">type</span>></span>pom<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">type</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">scope</span>></span>import<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">scope</span>></span>\n   <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">dependency</span>></span>\n  <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">dependencies</span>></span>\n <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">dependencyManagement</span>></span>\n</code></pre>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>application.yml 파일에서 모든 내부 마이크로서비스 이름, 경로 및 uri 세부 정보를 다음과 같이 제공해주세요:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-attr\">spring</span>:\n  <span class=\"hljs-attr\">application</span>:\n    <span class=\"hljs-attr\">name</span>: gateway-service\n  <span class=\"hljs-attr\">cloud</span>:\n    <span class=\"hljs-attr\">gateway</span>:\n      <span class=\"hljs-attr\">routes</span>:\n        - <span class=\"hljs-attr\">id</span>: first\n          <span class=\"hljs-attr\">predicates</span>:\n            - <span class=\"hljs-title class_\">Path</span>=<span class=\"hljs-regexp\">/first/</span>\n          <span class=\"hljs-attr\">uri</span>: <span class=\"hljs-attr\">localhost</span>:<span class=\"hljs-number\">8081</span>\n        - <span class=\"hljs-attr\">id</span>: second\n          <span class=\"hljs-attr\">predicates</span>:\n            - <span class=\"hljs-title class_\">Path</span>=<span class=\"hljs-regexp\">/second/</span>\n          <span class=\"hljs-attr\">uri</span>: <span class=\"hljs-attr\">localhost</span>:<span class=\"hljs-number\">8082</span>\n        - <span class=\"hljs-attr\">id</span>: auth-server\n          <span class=\"hljs-attr\">predicates</span>:\n            - <span class=\"hljs-title class_\">Path</span>=<span class=\"hljs-regexp\">/login/</span>\n          <span class=\"hljs-attr\">uri</span>: <span class=\"hljs-attr\">localhost</span>:<span class=\"hljs-number\">8088</span>\n</code></pre>\n<p>그리고 Gateway가 제공하는 모든 라우트를 제공하기 위해 RouteLocator 유형의 빈이 필요합니다. 요청/응답을 처리하려면 필요에 따라 필터를 포함할 수 있습니다:</p>\n<pre><code class=\"hljs language-js\">@<span class=\"hljs-title class_\">Bean</span>\npublic <span class=\"hljs-title class_\">RouteLocator</span> <span class=\"hljs-title function_\">customRouteLocator</span>(<span class=\"hljs-params\">RouteLocatorBuilder builder</span>) {\n    <span class=\"hljs-keyword\">return</span> builder.<span class=\"hljs-title function_\">routes</span>()\n            .<span class=\"hljs-title function_\">route</span>(<span class=\"hljs-string\">\"first-microservice\"</span>, r -> r.<span class=\"hljs-title function_\">path</span>(<span class=\"hljs-string\">\"/first\"</span>)\n                    .<span class=\"hljs-title function_\">and</span>().<span class=\"hljs-title function_\">method</span>(<span class=\"hljs-string\">\"POST\"</span>)\n                    .<span class=\"hljs-title function_\">and</span>().<span class=\"hljs-title function_\">readBody</span>(<span class=\"hljs-title class_\">Student</span>.<span class=\"hljs-property\">class</span>, s -> <span class=\"hljs-literal\">true</span>).<span class=\"hljs-title function_\">filters</span>(f -> f.<span class=\"hljs-title function_\">filters</span>(requestFilter, authFilter))\n                    .<span class=\"hljs-title function_\">uri</span>(<span class=\"hljs-string\">\"http://localhost:8081\"</span>))\n            .<span class=\"hljs-title function_\">route</span>(<span class=\"hljs-string\">\"first-microservice\"</span>, r -> r.<span class=\"hljs-title function_\">path</span>(<span class=\"hljs-string\">\"/first\"</span>)\n                    .<span class=\"hljs-title function_\">and</span>().<span class=\"hljs-title function_\">method</span>(<span class=\"hljs-string\">\"GET\"</span>).<span class=\"hljs-title function_\">filters</span>(f-> f.<span class=\"hljs-title function_\">filters</span>(authFilter))\n                    .<span class=\"hljs-title function_\">uri</span>(<span class=\"hljs-string\">\"http://localhost:8081\"</span>))\n            .<span class=\"hljs-title function_\">route</span>(<span class=\"hljs-string\">\"second-microservice\"</span>, r -> r.<span class=\"hljs-title function_\">path</span>(<span class=\"hljs-string\">\"/second\"</span>)\n                    .<span class=\"hljs-title function_\">and</span>().<span class=\"hljs-title function_\">method</span>(<span class=\"hljs-string\">\"POST\"</span>)\n                    .<span class=\"hljs-title function_\">and</span>().<span class=\"hljs-title function_\">readBody</span>(<span class=\"hljs-title class_\">Company</span>.<span class=\"hljs-property\">class</span>, s -> <span class=\"hljs-literal\">true</span>).<span class=\"hljs-title function_\">filters</span>(f -> f.<span class=\"hljs-title function_\">filters</span>(requestFilter, authFilter))\n                    .<span class=\"hljs-title function_\">uri</span>(<span class=\"hljs-string\">\"http://localhost:8082\"</span>))\n            .<span class=\"hljs-title function_\">route</span>(<span class=\"hljs-string\">\"second-microservice\"</span>, r -> r.<span class=\"hljs-title function_\">path</span>(<span class=\"hljs-string\">\"/second\"</span>)\n                    .<span class=\"hljs-title function_\">and</span>().<span class=\"hljs-title function_\">method</span>(<span class=\"hljs-string\">\"GET\"</span>).<span class=\"hljs-title function_\">filters</span>(f-> f.<span class=\"hljs-title function_\">filters</span>(authFilter))\n                    .<span class=\"hljs-title function_\">uri</span>(<span class=\"hljs-string\">\"http://localhost:8082\"</span>))\n            .<span class=\"hljs-title function_\">route</span>(<span class=\"hljs-string\">\"auth-server\"</span>, r -> r.<span class=\"hljs-title function_\">path</span>(<span class=\"hljs-string\">\"/login\"</span>)\n                    .<span class=\"hljs-title function_\">uri</span>(<span class=\"hljs-string\">\"http://localhost:8088\"</span>))\n            .<span class=\"hljs-title function_\">build</span>();\n}\n</code></pre>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>필터:</p>\n<p>A. 요청 본문을 로깅하려면:</p>\n<p>본문을 읽기 위해 ResourceLocator 빈에서 readBody()를 true로 설정해야 합니다. 이렇게 하면 ServerWebExchange 객체가 요청 본문을 \"cachedRequestBodyObject\" 속성에 캐시합니다.</p>\n<pre><code class=\"hljs language-js\">package com.<span class=\"hljs-property\">example</span>.<span class=\"hljs-property\">springcloudgatewayoverview</span>.<span class=\"hljs-property\">filter</span>;\n\n<span class=\"hljs-keyword\">import</span> com.<span class=\"hljs-property\">example</span>.<span class=\"hljs-property\">springcloudgatewayoverview</span>.<span class=\"hljs-property\">model</span>.<span class=\"hljs-property\">Company</span>;\n<span class=\"hljs-keyword\">import</span> com.<span class=\"hljs-property\">example</span>.<span class=\"hljs-property\">springcloudgatewayoverview</span>.<span class=\"hljs-property\">model</span>.<span class=\"hljs-property\">Student</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">cloud</span>.<span class=\"hljs-property\">gateway</span>.<span class=\"hljs-property\">filter</span>.<span class=\"hljs-property\">GatewayFilter</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">cloud</span>.<span class=\"hljs-property\">gateway</span>.<span class=\"hljs-property\">filter</span>.<span class=\"hljs-property\">GatewayFilterChain</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">stereotype</span>.<span class=\"hljs-property\">Component</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">web</span>.<span class=\"hljs-property\">server</span>.<span class=\"hljs-property\">ServerWebExchange</span>;\n<span class=\"hljs-keyword\">import</span> reactor.<span class=\"hljs-property\">core</span>.<span class=\"hljs-property\">publisher</span>.<span class=\"hljs-property\">Mono</span>;\n\n@<span class=\"hljs-title class_\">Component</span>\npublic <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">RequestFilter</span> implements <span class=\"hljs-title class_\">GatewayFilter</span> {\n    @<span class=\"hljs-title class_\">Override</span>\n    public <span class=\"hljs-title class_\">Mono</span>&#x3C;<span class=\"hljs-title class_\">Void</span>> <span class=\"hljs-title function_\">filter</span>(<span class=\"hljs-params\">ServerWebExchange exchange, GatewayFilterChain chain</span>) {\n        <span class=\"hljs-title class_\">Object</span> body = exchange.<span class=\"hljs-title function_\">getAttribute</span>(<span class=\"hljs-string\">\"cachedRequestBodyObject\"</span>);\n        <span class=\"hljs-title class_\">System</span>.<span class=\"hljs-property\">out</span>.<span class=\"hljs-title function_\">println</span>(<span class=\"hljs-string\">\"in request filter\"</span>);\n        <span class=\"hljs-keyword\">if</span>(body <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Student</span>) {\n            <span class=\"hljs-title class_\">System</span>.<span class=\"hljs-property\">out</span>.<span class=\"hljs-title function_\">println</span>(<span class=\"hljs-string\">\"body:\"</span> + (<span class=\"hljs-title class_\">Student</span>) body);\n        }\n        <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(body <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Company</span>) {\n            <span class=\"hljs-title class_\">System</span>.<span class=\"hljs-property\">out</span>.<span class=\"hljs-title function_\">println</span>(<span class=\"hljs-string\">\"body:\"</span> + (<span class=\"hljs-title class_\">Company</span>) body);\n        }\n        <span class=\"hljs-keyword\">return</span> chain.<span class=\"hljs-title function_\">filter</span>(exchange);\n    }\n}\n</code></pre>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>B. 응답 본문을 로깅하려면:</p>\n<pre><code class=\"hljs language-js\">package com.<span class=\"hljs-property\">example</span>.<span class=\"hljs-property\">springcloudgatewayoverview</span>.<span class=\"hljs-property\">filter</span>;\n\n<span class=\"hljs-keyword\">import</span> com.<span class=\"hljs-property\">example</span>.<span class=\"hljs-property\">springcloudgatewayoverview</span>.<span class=\"hljs-property\">model</span>.<span class=\"hljs-property\">Company</span>;\n<span class=\"hljs-keyword\">import</span> com.<span class=\"hljs-property\">example</span>.<span class=\"hljs-property\">springcloudgatewayoverview</span>.<span class=\"hljs-property\">model</span>.<span class=\"hljs-property\">Student</span>;\n<span class=\"hljs-keyword\">import</span> com.<span class=\"hljs-property\">fasterxml</span>.<span class=\"hljs-property\">jackson</span>.<span class=\"hljs-property\">core</span>.<span class=\"hljs-property\">JsonProcessingException</span>;\n<span class=\"hljs-keyword\">import</span> com.<span class=\"hljs-property\">fasterxml</span>.<span class=\"hljs-property\">jackson</span>.<span class=\"hljs-property\">databind</span>.<span class=\"hljs-property\">ObjectMapper</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">reactivestreams</span>.<span class=\"hljs-property\">Publisher</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">core</span>.<span class=\"hljs-property\">io</span>.<span class=\"hljs-property\">buffer</span>.<span class=\"hljs-property\">DataBuffer</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">core</span>.<span class=\"hljs-property\">io</span>.<span class=\"hljs-property\">buffer</span>.<span class=\"hljs-property\">DataBufferFactory</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">core</span>.<span class=\"hljs-property\">io</span>.<span class=\"hljs-property\">buffer</span>.<span class=\"hljs-property\">DefaultDataBuffer</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">core</span>.<span class=\"hljs-property\">io</span>.<span class=\"hljs-property\">buffer</span>.<span class=\"hljs-property\">DefaultDataBufferFactory</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">http</span>.<span class=\"hljs-property\">server</span>.<span class=\"hljs-property\">reactive</span>.<span class=\"hljs-property\">ServerHttpRequest</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">http</span>.<span class=\"hljs-property\">server</span>.<span class=\"hljs-property\">reactive</span>.<span class=\"hljs-property\">ServerHttpResponse</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">http</span>.<span class=\"hljs-property\">server</span>.<span class=\"hljs-property\">reactive</span>.<span class=\"hljs-property\">ServerHttpResponseDecorator</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">web</span>.<span class=\"hljs-property\">server</span>.<span class=\"hljs-property\">ServerWebExchange</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">web</span>.<span class=\"hljs-property\">server</span>.<span class=\"hljs-property\">WebFilter</span>;\n<span class=\"hljs-keyword\">import</span> org.<span class=\"hljs-property\">springframework</span>.<span class=\"hljs-property\">web</span>.<span class=\"hljs-property\">server</span>.<span class=\"hljs-property\">WebFilterChain</span>;\n<span class=\"hljs-keyword\">import</span> reactor.<span class=\"hljs-property\">core</span>.<span class=\"hljs-property\">publisher</span>.<span class=\"hljs-property\">Flux</span>;\n<span class=\"hljs-keyword\">import</span> reactor.<span class=\"hljs-property\">core</span>.<span class=\"hljs-property\">publisher</span>.<span class=\"hljs-property\">Mono</span>;\n\n<span class=\"hljs-keyword\">import</span> java.<span class=\"hljs-property\">nio</span>.<span class=\"hljs-property\">charset</span>.<span class=\"hljs-property\">StandardCharsets</span>;\n<span class=\"hljs-keyword\">import</span> java.<span class=\"hljs-property\">util</span>.<span class=\"hljs-property\">List</span>;\n\npublic <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">PostGlobalFilter</span> implements <span class=\"hljs-title class_\">WebFilter</span> {\n\n    @<span class=\"hljs-title class_\">Override</span>\n    public <span class=\"hljs-title class_\">Mono</span>&#x3C;<span class=\"hljs-title class_\">Void</span>> <span class=\"hljs-title function_\">filter</span>(<span class=\"hljs-params\">ServerWebExchange exchange, WebFilterChain chain</span>) {\n        <span class=\"hljs-title class_\">String</span> path = exchange.<span class=\"hljs-title function_\">getRequest</span>().<span class=\"hljs-title function_\">getPath</span>().<span class=\"hljs-title function_\">toString</span>();\n        <span class=\"hljs-title class_\">ServerHttpResponse</span> response = exchange.<span class=\"hljs-title function_\">getResponse</span>();\n        <span class=\"hljs-title class_\">ServerHttpRequest</span> request = exchange.<span class=\"hljs-title function_\">getRequest</span>();\n        <span class=\"hljs-title class_\">DataBufferFactory</span> dataBufferFactory = response.<span class=\"hljs-title function_\">bufferFactory</span>();\n        <span class=\"hljs-title class_\">ServerHttpResponseDecorator</span> decoratedResponse = <span class=\"hljs-title function_\">getDecoratedResponse</span>(path, response, request, dataBufferFactory);\n        <span class=\"hljs-keyword\">return</span> chain.<span class=\"hljs-title function_\">filter</span>(exchange.<span class=\"hljs-title function_\">mutate</span>().<span class=\"hljs-title function_\">response</span>(decoratedResponse).<span class=\"hljs-title function_\">build</span>());\n    }\n\n    private <span class=\"hljs-title class_\">ServerHttpResponseDecorator</span> <span class=\"hljs-title function_\">getDecoratedResponse</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">String</span> path, ServerHttpResponse response, ServerHttpRequest request, DataBufferFactory dataBufferFactory</span>) {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerHttpResponseDecorator</span>(response) {\n\n            @<span class=\"hljs-title class_\">Override</span>\n            public <span class=\"hljs-title class_\">Mono</span>&#x3C;<span class=\"hljs-title class_\">Void</span>> <span class=\"hljs-title function_\">writeWith</span>(<span class=\"hljs-params\">final Publisher&#x3C;? <span class=\"hljs-keyword\">extends</span> DataBuffer> body</span>) {\n\n                <span class=\"hljs-keyword\">if</span> (body <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Flux</span>) {\n\n                    <span class=\"hljs-title class_\">Flux</span>&#x3C;? <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">DataBuffer</span>> fluxBody = (<span class=\"hljs-title class_\">Flux</span>&#x3C;? <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">DataBuffer</span>>) body;\n\n                    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">super</span>.<span class=\"hljs-title function_\">writeWith</span>(fluxBody.<span class=\"hljs-title function_\">buffer</span>().<span class=\"hljs-title function_\">map</span>(dataBuffers -> {\n\n                        <span class=\"hljs-title class_\">DefaultDataBuffer</span> joinedBuffers = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultDataBufferFactory</span>().<span class=\"hljs-title function_\">join</span>(dataBuffers);\n                        byte[] content = <span class=\"hljs-keyword\">new</span> byte[joinedBuffers.<span class=\"hljs-title function_\">readableByteCount</span>()];\n                        joinedBuffers.<span class=\"hljs-title function_\">read</span>(content);\n                        <span class=\"hljs-title class_\">String</span> responseBody = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>(content, <span class=\"hljs-title class_\">StandardCharsets</span>.<span class=\"hljs-property\">UTF_8</span>);<span class=\"hljs-comment\">//응답 수정 및 수정된 응답 반환</span>\n                        <span class=\"hljs-title class_\">System</span>.<span class=\"hljs-property\">out</span>.<span class=\"hljs-title function_\">println</span>(<span class=\"hljs-string\">\"requestId: \"</span>+request.<span class=\"hljs-title function_\">getId</span>()+<span class=\"hljs-string\">\", method: \"</span>+request.<span class=\"hljs-title function_\">getMethodValue</span>()+<span class=\"hljs-string\">\", req url: \"</span>+request.<span class=\"hljs-title function_\">getURI</span>()+<span class=\"hljs-string\">\", response body :\"</span>+ responseBody);\n                        <span class=\"hljs-keyword\">try</span> {\n                            <span class=\"hljs-keyword\">if</span>(request.<span class=\"hljs-title function_\">getURI</span>().<span class=\"hljs-title function_\">getPath</span>().<span class=\"hljs-title function_\">equals</span>(<span class=\"hljs-string\">\"/first\"</span>) &#x26;&#x26; request.<span class=\"hljs-title function_\">getMethodValue</span>().<span class=\"hljs-title function_\">equals</span>(<span class=\"hljs-string\">\"GET\"</span>)) {\n                                <span class=\"hljs-title class_\">List</span>&#x3C;<span class=\"hljs-title class_\">Student</span>> student = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ObjectMapper</span>().<span class=\"hljs-title function_\">readValue</span>(responseBody, <span class=\"hljs-title class_\">List</span>.<span class=\"hljs-property\">class</span>);\n                                <span class=\"hljs-title class_\">System</span>.<span class=\"hljs-property\">out</span>.<span class=\"hljs-title function_\">println</span>(<span class=\"hljs-string\">\"student:\"</span> + student);\n                            }\n                            <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(request.<span class=\"hljs-title function_\">getURI</span>().<span class=\"hljs-title function_\">getPath</span>().<span class=\"hljs-title function_\">equals</span>(<span class=\"hljs-string\">\"/second\"</span>) &#x26;&#x26; request.<span class=\"hljs-title function_\">getMethodValue</span>().<span class=\"hljs-title function_\">equals</span>(<span class=\"hljs-string\">\"GET\"</span>)) {\n                                <span class=\"hljs-title class_\">List</span>&#x3C;<span class=\"hljs-title class_\">Company</span>> companies = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ObjectMapper</span>().<span class=\"hljs-title function_\">readValue</span>(responseBody, <span class=\"hljs-title class_\">List</span>.<span class=\"hljs-property\">class</span>);\n                                <span class=\"hljs-title class_\">System</span>.<span class=\"hljs-property\">out</span>.<span class=\"hljs-title function_\">println</span>(<span class=\"hljs-string\">\"companies:\"</span> + companies);\n                            }\n                        } <span class=\"hljs-keyword\">catch</span> (<span class=\"hljs-title class_\">JsonProcessingException</span> e) {\n                            <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RuntimeException</span>(e);\n                        }\n                        <span class=\"hljs-keyword\">return</span> dataBufferFactory.<span class=\"hljs-title function_\">wrap</span>(responseBody.<span class=\"hljs-title function_\">getBytes</span>());\n                    })).<span class=\"hljs-title function_\">onErrorResume</span>(err -> {\n\n                        <span class=\"hljs-title class_\">System</span>.<span class=\"hljs-property\">out</span>.<span class=\"hljs-title function_\">println</span>(<span class=\"hljs-string\">\"error while decorating Response: {}\"</span>+err.<span class=\"hljs-title function_\">getMessage</span>());\n                        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Mono</span>.<span class=\"hljs-title function_\">empty</span>();\n                    });\n\n                }\n                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">super</span>.<span class=\"hljs-title function_\">writeWith</span>(body);\n            }\n        };\n    }\n\n}\n</code></pre>\n<p>C. API 호출 전에 인증하기:</p>\n<p>다음과 같이 인증 필터를 생성하십시오:</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-java\"><span class=\"hljs-keyword\">package</span> com.example.springcloudgatewayoverview.filter;\n\n<span class=\"hljs-keyword\">import</span> com.example.springcloudgatewayoverview.util.AuthUtil;\n<span class=\"hljs-keyword\">import</span> com.example.springcloudgatewayoverview.util.JWTUtil;\n<span class=\"hljs-keyword\">import</span> com.example.springcloudgatewayoverview.validator.RouteValidator;\n<span class=\"hljs-keyword\">import</span> io.jsonwebtoken.Claims;\n<span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;\n<span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Value;\n<span class=\"hljs-keyword\">import</span> org.springframework.cloud.context.config.annotation.RefreshScope;\n<span class=\"hljs-keyword\">import</span> org.springframework.cloud.gateway.filter.GatewayFilter;\n<span class=\"hljs-keyword\">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;\n<span class=\"hljs-keyword\">import</span> org.springframework.http.HttpStatus;\n<span class=\"hljs-keyword\">import</span> org.springframework.http.server.reactive.ServerHttpRequest;\n<span class=\"hljs-keyword\">import</span> org.springframework.http.server.reactive.ServerHttpResponse;\n<span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;\n<span class=\"hljs-keyword\">import</span> org.springframework.web.server.ServerWebExchange;\n<span class=\"hljs-keyword\">import</span> reactor.core.publisher.Mono;\n\n<span class=\"hljs-meta\">@Component</span>\n<span class=\"hljs-meta\">@RefreshScope</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AuthFilter</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">GatewayFilter</span> {\n\n    <span class=\"hljs-meta\">@Autowired</span>\n    RouteValidator routeValidator;\n\n    <span class=\"hljs-meta\">@Autowired</span>\n    <span class=\"hljs-keyword\">private</span> JWTUtil jwtUtil;\n\n    <span class=\"hljs-meta\">@Autowired</span>\n    <span class=\"hljs-keyword\">private</span> AuthUtil authUtil;\n\n    <span class=\"hljs-meta\">@Value(\"${authentication.enabled}\")</span>\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">boolean</span> authEnabled;\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> Mono&#x3C;Void> <span class=\"hljs-title function_\">filter</span><span class=\"hljs-params\">(ServerWebExchange exchange, GatewayFilterChain chain)</span> {\n        <span class=\"hljs-keyword\">if</span>(!authEnabled) {\n            System.out.println(<span class=\"hljs-string\">\"Authentication is disabled. To enable it, make \\\"authentication.enabled\\\" property as true\"</span>);\n            <span class=\"hljs-keyword\">return</span> chain.filter(exchange);\n        }\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">token</span> <span class=\"hljs-operator\">=</span><span class=\"hljs-string\">\"\"</span>;\n        <span class=\"hljs-type\">ServerHttpRequest</span> <span class=\"hljs-variable\">request</span> <span class=\"hljs-operator\">=</span> exchange.getRequest();\n\n        <span class=\"hljs-keyword\">if</span>(routeValidator.isSecured.test(request)) {\n            System.out.println(<span class=\"hljs-string\">\"validating authentication token\"</span>);\n            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">this</span>.isCredsMissing(request)) {\n                System.out.println(<span class=\"hljs-string\">\"in error\"</span>);\n                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">this</span>.onError(exchange,<span class=\"hljs-string\">\"Credentials missing\"</span>,HttpStatus.UNAUTHORIZED);\n            }\n            <span class=\"hljs-keyword\">if</span> (request.getHeaders().containsKey(<span class=\"hljs-string\">\"userName\"</span>) &#x26;&#x26; request.getHeaders().containsKey(<span class=\"hljs-string\">\"role\"</span>)) {\n                token = authUtil.getToken(request.getHeaders().get(<span class=\"hljs-string\">\"userName\"</span>).toString(), request.getHeaders().get(<span class=\"hljs-string\">\"role\"</span>).toString());\n            }\n            <span class=\"hljs-keyword\">else</span> {\n                token = request.getHeaders().get(<span class=\"hljs-string\">\"Authorization\"</span>).toString().split(<span class=\"hljs-string\">\" \"</span>)[<span class=\"hljs-number\">1</span>];\n            }\n\n            <span class=\"hljs-keyword\">if</span>(jwtUtil.isInvalid(token)) {\n                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">this</span>.onError(exchange,<span class=\"hljs-string\">\"Auth header invalid\"</span>,HttpStatus.UNAUTHORIZED);\n            }\n            <span class=\"hljs-keyword\">else</span> {\n                System.out.println(<span class=\"hljs-string\">\"Authentication is successful\"</span>);\n            }\n\n            <span class=\"hljs-built_in\">this</span>.populateRequestWithHeaders(exchange,token);\n        }\n        <span class=\"hljs-keyword\">return</span> chain.filter(exchange);\n    }\n\n    <span class=\"hljs-keyword\">private</span> Mono&#x3C;Void> <span class=\"hljs-title function_\">onError</span><span class=\"hljs-params\">(ServerWebExchange exchange, String err, HttpStatus httpStatus)</span> {\n        <span class=\"hljs-type\">ServerHttpResponse</span> <span class=\"hljs-variable\">response</span> <span class=\"hljs-operator\">=</span> exchange.getResponse();\n        response.setStatusCode(httpStatus);\n        <span class=\"hljs-keyword\">return</span> response.setComplete();\n    }\n\n    <span class=\"hljs-keyword\">private</span> String <span class=\"hljs-title function_\">getAuthHeader</span><span class=\"hljs-params\">(ServerHttpRequest request)</span> {\n        <span class=\"hljs-keyword\">return</span>  request.getHeaders().getOrEmpty(<span class=\"hljs-string\">\"Authorization\"</span>).get(<span class=\"hljs-number\">0</span>);\n    }\n\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">isCredsMissing</span><span class=\"hljs-params\">(ServerHttpRequest request)</span> {\n        <span class=\"hljs-keyword\">return</span> !(request.getHeaders().containsKey(<span class=\"hljs-string\">\"userName\"</span>) &#x26;&#x26; request.getHeaders().containsKey(<span class=\"hljs-string\">\"role\"</span>)) &#x26;&#x26; !request.getHeaders().containsKey(<span class=\"hljs-string\">\"Authorization\"</span>);\n    }\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">populateRequestWithHeaders</span><span class=\"hljs-params\">(ServerWebExchange exchange, String token)</span> {\n        <span class=\"hljs-type\">Claims</span> <span class=\"hljs-variable\">claims</span> <span class=\"hljs-operator\">=</span> jwtUtil.getALlClaims(token);\n        exchange.getRequest()\n                .mutate()\n                .header(<span class=\"hljs-string\">\"id\"</span>,String.valueOf(claims.get(<span class=\"hljs-string\">\"id\"</span>)))\n                .header(<span class=\"hljs-string\">\"role\"</span>, String.valueOf(claims.get(<span class=\"hljs-string\">\"role\"</span>)))\n                .build();\n    }\n}\n</code></pre>\n<p>Endpoints 중 일부는 토큰 없이 호출을 허용해야 합니다. (예: 로그인 URL, 헬스 체크 URL 등). 이러한 엔드포인트들을 아래 목록에 추가할 것입니다:</p>\n<pre><code class=\"hljs language-java\"><span class=\"hljs-keyword\">package</span> com.example.springcloudgatewayoverview.validator;\n\n<span class=\"hljs-keyword\">import</span> org.springframework.http.server.reactive.ServerHttpRequest;\n<span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;\n\n<span class=\"hljs-keyword\">import</span> java.util.List;\n<span class=\"hljs-keyword\">import</span> java.util.function.Predicate;\n\n<span class=\"hljs-meta\">@Component</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">RouteValidator</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> List&#x3C;String> unprotectedURLs = List.of(<span class=\"hljs-string\">\"/login\"</span>);\n\n    <span class=\"hljs-keyword\">public</span> Predicate&#x3C;ServerHttpRequest> isSecured = request -> unprotectedURLs.stream().noneMatch(uri -> request.getURI().getPath().contains(uri));\n}\n</code></pre>\n<p>JWTUtil:</p>\n<pre><code class=\"hljs language-java\"></code></pre>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-java\"><span class=\"hljs-keyword\">package</span> com.example.springcloudgatewayoverview.util;\n\n<span class=\"hljs-keyword\">import</span> io.jsonwebtoken.Claims;\n<span class=\"hljs-keyword\">import</span> io.jsonwebtoken.Jwts;\n<span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Value;\n<span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;\n\n<span class=\"hljs-keyword\">import</span> java.util.Date;\n\n<span class=\"hljs-meta\">@Component</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">JWTUtil</span> {\n\n    <span class=\"hljs-meta\">@Value(\"${jwt.secret}\")</span>\n    <span class=\"hljs-keyword\">private</span> String secret;\n\n    <span class=\"hljs-keyword\">public</span> Claims <span class=\"hljs-title function_\">getAllClaims</span><span class=\"hljs-params\">(String token)</span> {\n        <span class=\"hljs-keyword\">return</span> Jwts.parserBuilder().setSigningKey(secret).build().parseClaimsJws(token).getBody();\n    }\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">isTokenExpired</span><span class=\"hljs-params\">(String token)</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">this</span>.getAllClaims(token).getExpiration().before(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Date</span>());\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">isInvalid</span><span class=\"hljs-params\">(String token)</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">this</span>.isTokenExpired(token);\n    }\n\n}\n</code></pre>\n<p>Authentication server:</p>\n<p>이 서비스는 내부 마이크로서비스에 액세스하기 위한 토큰을 제공합니다.</p>\n<p>실행:</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>Once all applications are running, you can access the service registry by entering <a href=\"http://localhost:8761\" rel=\"nofollow\" target=\"_blank\">http://localhost:8761</a> in your browser. Here, you can find information about all the currently running services:</p>\n<p><img src=\"/assets/img/2024-06-22-APIgatewayinSpringboot_2.png\" alt=\"Service Registry\"></p>\n<p>The API Gateway is running on localhost at port 8080. You can access the endpoints of the First or Second microservice from <a href=\"http://localhost:8080\" rel=\"nofollow\" target=\"_blank\">http://localhost:8080</a>.</p>\n<p><img src=\"/assets/img/2024-06-22-APIgatewayinSpringboot_3.png\" alt=\"API Gateway Endpoints\"></p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>APIGateway 콘솔의 요청/응답 로그:</p>\n<p><img src=\"/assets/img/2024-06-22-APIgatewayinSpringboot_4.png\" alt=\"2024-06-22-APIgatewayinSpringboot_4\"></p>\n<p>인증이 포함된 샘플 요청:</p>\n<p><img src=\"/assets/img/2024-06-22-APIgatewayinSpringboot_5.png\" alt=\"2024-06-22-APIgatewayinSpringboot_5\"></p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>서비스의 모든 코드 기반은 여기에서 사용 가능합니다.</p>\n<p>읽어 주셔서 감사합니다. 즐거운 탐험하세요!!!</p>\n</body>\n</html>\n"},"__N_SSG":true}