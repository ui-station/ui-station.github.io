{"pageProps":{"post":{"title":"현재 날짜나 시간을 기준으로 데이터브릭에서 여러 파일을 동적으로 로드하는 방법","description":"","date":"2024-05-27 17:13","slug":"2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour","content":"\nBatch 시스템에서는 여러 번 클라이언트가 이미 추출된 파일을 동일한 경로에 유지하고, 도착한 추출 파일이 Bronze 레이어에 로드되기를 원하는 경우가 많습니다.\n\n따라서 이 경우, 개발자는 디렉토리에 있는 파일 목록 중에서 현재 날짜나 현재 시간에 도착한 파일만 고려하여 해당 파일의 내용을 Bronze 레이어에만 로드할 수 있도록 해야 합니다.\n\n이미지를 보면 오늘 날짜는 2024년 5월 25일임을 알 수 있습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n2024년 5월 22일에 첫 번째 파일이 도착했습니다.\n2024년 5월 23일에 두 번째 파일이 도착했습니다.\n2024년 5월 24일에 세 번째 파일이 도착했습니다.\n나머지 네 개의 파일은 오늘인 2024년 5월 25일에 도착했습니다.\n\n오늘 도착한 첫 번째 파일 내용은 다음과 같습니다 -\n\n![이미지](/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_1.png)\n\n오늘 도착한 두 번째 파일 내용은 다음과 같습니다 -\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n![Third File](/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_3.png)\n\nThe content of the Fourth File arrived today is as follows -\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_4.png\" />\n\n# 현재 날짜 기반으로 데이터브릭에서 여러 파일 동적으로 로드하는 방법\n\n그래서, 작업은 최근 네 개의 파일을 처리하고 그 네 개 파일의 내용을 브론즈 레이어의 테이블에 추가 모드로 로드하는 것입니다.\n\n단계 1: 브론즈 테이블 생성하기 -\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n먼저 다음 \"Spark SQL\" 쿼리를 사용하여 \"practice\"라는 데이터베이스를 생성하십시오 -\n\n```js\n%sql\nUSE hive_metastore;\nCREATE DATABASE IF NOT EXISTS practice\n```\n\n데이터베이스는 Databricks 워크스페이스에 생성됩니다 -\n\n![이미지](/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_5.png)\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n그럼 다음 \"Spark SQL\" 쿼리를 사용하여 외부 델타 테이블 \"person_bronze\"을 생성하세요 -\n\n```js\n%sql\nCREATE TABLE IF NOT EXISTS hive_metastore.practice.person_bronze\n(\n  FirstName STRING NOT NULL,\n  LastName STRING NOT NULL,\n  City STRING NOT NULL,\n  Company STRING NOT NULL\n)\nLOCATION \"dbfs:/mnt/iobdatabronze/practice-zone/delta-table/person_bronze\"\n```\n\n외부 델타 테이블은 Databricks 워크스페이스의 \"practice\" 데이터베이스 내부에 생성됩니다 -\n\n![image](/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_6.png)\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n생성된 External Delta Table \"person_bronze\"의 폴더 경로는 제공된 위치에 ADLS에 생성되었습니다-\n\n![image](/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_7.png)\n\n단계 2: 현재 날짜인 2024년 5월 25일을 기준으로 Databricks에서 가장 최근 네 개의 파일을 로드하는 Python 코드를 작성해 보겠습니다.\n\n단계 2.1: Python의 \"datetime\" 모듈을 사용하여 \"현재 날짜\"의 값을 가져와, 도착 파일의 이름에 사용된 형식과 일치하도록 \"현재 날짜\"의 값을 포맷팅해 주세요.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nimport os\nfrom datetime import datetime\nfrom functools import reduce\n\n# Python의 \"datetime\" 모듈을 사용하여 현재 날짜 가져오기\ncurrent_date = datetime.now()\nprint(current_date)\n\n# 현재 날짜의 값을 파일 이름 형식에 맞게 포맷팅하여 출력\nfile_name_date_format = current_date.strftime(\"%Y%m%d\")\nprint(file_name_date_format)\n```\n\n출력 -\n\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_8.png\" />\n\n단계 2.2: 파일이 보관된 ADLS 디렉토리의 \"마운트된 경로\"를 지정합니다.\n그런 다음, 해당 지정된 디렉토리에서 모든 파일을 나열합니다.\n마지막으로, 그 지정된 디렉토리의 파일 이름에 \"현재 날짜\"가 포함된 파일만 걸러내어 Python List에 저장합니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\n# 파일이 위치한 ADLS 디렉토리의 마운트 경로 지정하기\ndirectory_path = \"/mnt/iobdatalanding/practice-zone/input-files/\"\n\n# 지정된 디렉토리에 있는 모든 파일 나열하기\nall_files = os.listdir(\"/dbfs\" + directory_path)\nprint(all_files)\n\n# 현재 날짜가 파일 이름에 포함된 파일만 필터링하여 Python 리스트에 저장하기\nmatching_files = [matching_file for matching_file in all_files if file_name_date_format in matching_file]\nprint(matching_files)\n```\n\n출력 -\n\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_9.png\" />\n\n단계 2.3: 먼저 \"빈 Python 리스트\"를 생성하세요.\n그런 다음 각 일치하는 파일의 내용을 각각 별도의 DataFrame에 로드하세요.\n마지막으로 각 DataFrame을 이미 생성된 \"Python 리스트\"에 \"객체\"로 추가하세요.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\n# 빈 리스트 생성\nlist_of_dfs = []\n\n# 각 일치하는 파일을 각각 별도의 데이터프레임으로 로드\nfor file_name in matching_files:\n    # 실제 파일 경로 생성\n    file_path = os.path.join(directory_path, file_name)\n    # 각 파일마다 데이터프레임 생성\n    df = spark.read.format(\"csv\").option(\"header\", \"true\").load(file_path)\n    # 각 데이터프레임을 빈 리스트에 객체로서 각각 저장\n    list_of_dfs.append(df)\n\nprint(list_of_dfs)\n```\n\n출력 -\n\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_10.png\" />\n\n2.4단계: 각 데이터프레임의 모든 값들을 단일 데이터프레임으로 연결하고, 각 데이터프레임의 값들이 이제 \"파이썬 리스트\"의 각 객체로 되는 단일 데이터프레임을 생성하기 위해 \"reduce()\" 함수와 \"union()\" 메서드를 사용합니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\n# 각 데이터프레임의 모든 값을 연결하여 하나의 데이터프레임으로 만들기\n# 이때 각 데이터프레임의 값은 이제 Python List의 각 객체이며 \"reduce()\" 함수를 사용하여 \"union()\" 메서드와 함께 결합합니다.\nfinal_df = reduce(lambda df1, df2: df1.union(df2), list_of_dfs)\ndisplay(final_df)\n```\n\n결과 -\n\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_11.png\" />\n\n따라서 위 이미지에서 오늘 도착한 네 개의 파일에서 모든 레코드의 조합이 포함된 \"final_df\" 데이터프레임이 있음을 확인할 수 있습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n당신이 개발자십에 관심이 있나봐요! 친철한 톤으로 번역해 드리겠습니다.\n\n스텝 2.5: 'final_df' DataFrame의 내용을 Bronze Table \"person_bronze\"에 삽입하세요.\n\n```js\n# 'final_df' DataFrame의 내용을 Bronze Table \"person_bronze\"에 삽입\nfinal_df.write.format(\"delta\").mode(\"append\").saveAsTable(\"hive_metastore.practice.person_bronze\")\n```\n\n다음 \"스파크 SQL\" 쿼리를 사용하여 'person_bronze' Bronze Table에 방금 삽입된 데이터가 있는지 확인하세요 -\n\n```js\n%sql\n-- 'person_bronze' Bronze Table에 데이터가 있는지 확인\nSELECT * FROM hive_metastore.practice.person_bronze;\n```\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n출력 -\n\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_12.png\" />\n\n# 현재 시간을 기반으로 한 Databricks에서 여러 파일 로드하기\n\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_13.png\" />\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n지금은 2024년 5월 25일이고, 현재 시간은 오후 8시입니다. 위 그림에서 볼 수 있듯이, 마지막 두 파일이 \"현재 시간\"인 즉, 8시에 도착했습니다.\n\n그러므로, 마지막 두 파일을 처리하고 그 두 파일의 내용을 브론즈 레이어의 테이블에 추가 모드로 로드하는 작업입니다.\n\n# 현재 날짜 또는 시간에 따라 Databricks에서 여러 파일을 동적으로 로드하는 방법\n\n배치 시스템에서는 고객이 이미 추출된 파일을 도착한 추출된 파일과 동일한 경로에 유지하고 브론즈 레이어에 로드하길 원하는 경우가 많습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n따라서 현재 일 또는 현재 시간에 도착한 파일만 고려하여 디렉터리에있는 파일 목록에서 해당 파일의 내용을 처리하고 브론즈 계층으로 로드하는 개발자의 책임이 있습니다.\n\n![이미지](/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_14.png)\n\n오늘은 2024년 5월 25일입니다. 위 이미지에서 볼 수 있듯이 -\n\n첫 번째 파일은 2024년 5월 22일에 도착했습니다.\n두 번째 파일은 2024년 5월 23일에 도착했습니다.\n세 번째 파일은 2024년 5월 24일에 도착했습니다.\n나머지 네 번째 파일은 2024년 5월 25일, 즉 오늘 도착했습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n오늘 도착한 첫 번째 파일 내용은 다음과 같습니다 -\n\n![First File](/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_15.png)\n\n오늘 도착한 두 번째 파일 내용은 다음과 같습니다 -\n\n![Second File](/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_16.png)\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n현재 시간에 도착한 첫 번째 파일의 내용은 다음과 같습니다 -\n\n![](/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_17.png)\n\n현재 시간에 도착한 두 번째 파일의 내용은 다음과 같습니다 -\n\n![](/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_18.png)\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nStep 1: Create a Bronze Table -\n\n이미 첫 번째 부분에서 생성되었습니다.\n\nStep 2: 오늘 현재 시간 기준으로 Databricks에서 마지막 두 파일을로드하는 Python 코드 작성 시작, 즉, 2024년 5월 25일 오후 8시.\n\nStep 2.1: Python의 \"datetime\" 모듈을 사용하여 \"현재 날짜\"의 \"현재 시간\" 값을 가져와서 \"현재 날짜\"의 \"현재 시간\" 값을 적시되어 파일 도착 이름 및 \"날짜\" 및 \"시간\" 부분과 일치하도록 형식화하세요.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```python\nimport os\nfrom datetime import datetime\nfrom functools import reduce\n\n# Python의 \"datetime\" 모듈을 사용하여 현재 날짜의 현재 시간을 가져옵니다.\ncurrent_date_and_time = datetime.now()\nprint(current_date_and_time)\n\n# 현재 시간의 값을 파일 이름의 날짜 및 시간 형식과 일치하도록 형식화합니다.\nfile_name_date_and_hour_format = current_date_and_time.strftime(\"%Y%m%d%H\")\nprint(file_name_date_and_hour_format)\n```\n\n출력 -\n\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_19.png\" />\n\n단계 2.2: 파일이 보관된 ADLS 디렉토리의 \"Mounted Path\"를 지정합니다.\n그런 다음, 해당 지정된 디렉토리에서 모든 파일을 나열합니다.\n마지막으로 해당 지정된 디렉토리의 파일 이름 중 \"현재 날짜\"의 \"현재 시간\"이 있는 파일만 필터링하여 Python List에 저장합니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\n# 파일이 위치한 ADLS 디렉토리의 마운트 경로를 지정합니다\ndirectory_path = \"/mnt/iobdatalanding/practice-zone/input-files/\"\n\n# 지정된 디렉토리에 있는 모든 파일을 나열합니다\nall_files = os.listdir(\"/dbfs\" + directory_path)\nprint(all_files)\n\n# 현재 날짜의 현재 시간을 파일 이름에 포함하는 파일만 필터링합니다\nmatching_files = [matching_file for matching_file in all_files if file_name_date_and_hour_format in matching_file]\nprint(matching_files)\n```\n\nOutput -\n\n![다이나믹 파일로드 방법](/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_20.png)\n\n단계 2.3: 먼저 \"빈 Python List\"를 생성합니다.\n그런 다음 각 일치하는 파일의 내용을 각각 별도의 DataFrame으로 로드합니다.\n마지막으로, 각 해당 DataFrame을 이미 생성된 \"Python List\"에 \"객체\"로서 추가합니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\n# 빈 목록 생성\nlist_of_dfs = []\n\n# 각 일치하는 파일을 각각 별도의 데이터프레임으로 불러오기\nfor file_name in matching_files:\n    # 실제 파일 경로 생성\n    file_path = os.path.join(directory_path, file_name)\n    # 각 파일에 대한 데이터프레임 생성\n    df = spark.read.format(\"csv\").option(\"header\", \"true\").load(file_path)\n    # 각 데이터프레임을 빈 목록에 객체로 각각 저장\n    list_of_dfs.append(df)\n\nprint(list_of_dfs)\n```\n\n출력 -\n\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_21.png\" />\n\n단계 2.4: 각 데이터프레임의 모든 값들을 단일 데이터프레임으로 연결합니다. 각 데이터프레임의 값은 이제 \"Python List\"의 각 객체이며, \"reduce()\" 함수와 \"union()\" 메소드를 사용합니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n# 각 DataFrame의 모든 값들을 Python 리스트의 각 객체로 사용하여 하나의 DataFrame으로 결합하십시오. \"reduce()\" 함수를 사용하고 \"union()\" 메서드를 함께 사용하십시오.\n\nfinal_df = reduce(lambda df1, df2: df1.union(df2), list_of_dfs)\ndisplay(final_df)\n\n출력 -\n\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_22.png\" />\n\n따라서 위 이미지에서 현재 시간에 도착한 두 파일의 레코드를 모두 포함하는 \"final_df\" DataFrame을 확인할 수 있습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n스텝 2.5: \"final_df\" 데이터프레임의 내용을 첫 번째 부분에 표시된 PySpark 코드를 사용하여 Bronze 테이블 \"person_bronze\"에 삽입합니다.\n\n마지막으로, 첫 번째 부분에 표시된 \"Spark SQL\" 쿼리를 사용하여 방금 삽입한 데이터가 Bronze 테이블 \"person_bronze\"에 있는지 확인하세요.\n","ogImage":{"url":"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_0.png"},"coverImage":"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_0.png","tag":["Tech"],"readingTime":16},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p>Batch 시스템에서는 여러 번 클라이언트가 이미 추출된 파일을 동일한 경로에 유지하고, 도착한 추출 파일이 Bronze 레이어에 로드되기를 원하는 경우가 많습니다.</p>\n<p>따라서 이 경우, 개발자는 디렉토리에 있는 파일 목록 중에서 현재 날짜나 현재 시간에 도착한 파일만 고려하여 해당 파일의 내용을 Bronze 레이어에만 로드할 수 있도록 해야 합니다.</p>\n<p>이미지를 보면 오늘 날짜는 2024년 5월 25일임을 알 수 있습니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>2024년 5월 22일에 첫 번째 파일이 도착했습니다.\n2024년 5월 23일에 두 번째 파일이 도착했습니다.\n2024년 5월 24일에 세 번째 파일이 도착했습니다.\n나머지 네 개의 파일은 오늘인 2024년 5월 25일에 도착했습니다.</p>\n<p>오늘 도착한 첫 번째 파일 내용은 다음과 같습니다 -</p>\n<p><img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_1.png\" alt=\"이미지\"></p>\n<p>오늘 도착한 두 번째 파일 내용은 다음과 같습니다 -</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p><img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_3.png\" alt=\"Third File\"></p>\n<p>The content of the Fourth File arrived today is as follows -</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_4.png\">\n<h1>현재 날짜 기반으로 데이터브릭에서 여러 파일 동적으로 로드하는 방법</h1>\n<p>그래서, 작업은 최근 네 개의 파일을 처리하고 그 네 개 파일의 내용을 브론즈 레이어의 테이블에 추가 모드로 로드하는 것입니다.</p>\n<p>단계 1: 브론즈 테이블 생성하기 -</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>먼저 다음 \"Spark SQL\" 쿼리를 사용하여 \"practice\"라는 데이터베이스를 생성하십시오 -</p>\n<pre><code class=\"hljs language-js\">%sql\n<span class=\"hljs-variable constant_\">USE</span> hive_metastore;\n<span class=\"hljs-variable constant_\">CREATE</span> <span class=\"hljs-variable constant_\">DATABASE</span> <span class=\"hljs-variable constant_\">IF</span> <span class=\"hljs-variable constant_\">NOT</span> <span class=\"hljs-variable constant_\">EXISTS</span> practice\n</code></pre>\n<p>데이터베이스는 Databricks 워크스페이스에 생성됩니다 -</p>\n<p><img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_5.png\" alt=\"이미지\"></p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>그럼 다음 \"Spark SQL\" 쿼리를 사용하여 외부 델타 테이블 \"person_bronze\"을 생성하세요 -</p>\n<pre><code class=\"hljs language-js\">%sql\n<span class=\"hljs-variable constant_\">CREATE</span> <span class=\"hljs-variable constant_\">TABLE</span> <span class=\"hljs-variable constant_\">IF</span> <span class=\"hljs-variable constant_\">NOT</span> <span class=\"hljs-variable constant_\">EXISTS</span> hive_metastore.<span class=\"hljs-property\">practice</span>.<span class=\"hljs-property\">person_bronze</span>\n(\n  <span class=\"hljs-title class_\">FirstName</span> <span class=\"hljs-variable constant_\">STRING</span> <span class=\"hljs-variable constant_\">NOT</span> <span class=\"hljs-variable constant_\">NULL</span>,\n  <span class=\"hljs-title class_\">LastName</span> <span class=\"hljs-variable constant_\">STRING</span> <span class=\"hljs-variable constant_\">NOT</span> <span class=\"hljs-variable constant_\">NULL</span>,\n  <span class=\"hljs-title class_\">City</span> <span class=\"hljs-variable constant_\">STRING</span> <span class=\"hljs-variable constant_\">NOT</span> <span class=\"hljs-variable constant_\">NULL</span>,\n  <span class=\"hljs-title class_\">Company</span> <span class=\"hljs-variable constant_\">STRING</span> <span class=\"hljs-variable constant_\">NOT</span> <span class=\"hljs-variable constant_\">NULL</span>\n)\n<span class=\"hljs-variable constant_\">LOCATION</span> <span class=\"hljs-string\">\"dbfs:/mnt/iobdatabronze/practice-zone/delta-table/person_bronze\"</span>\n</code></pre>\n<p>외부 델타 테이블은 Databricks 워크스페이스의 \"practice\" 데이터베이스 내부에 생성됩니다 -</p>\n<p><img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_6.png\" alt=\"image\"></p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>생성된 External Delta Table \"person_bronze\"의 폴더 경로는 제공된 위치에 ADLS에 생성되었습니다-</p>\n<p><img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_7.png\" alt=\"image\"></p>\n<p>단계 2: 현재 날짜인 2024년 5월 25일을 기준으로 Databricks에서 가장 최근 네 개의 파일을 로드하는 Python 코드를 작성해 보겠습니다.</p>\n<p>단계 2.1: Python의 \"datetime\" 모듈을 사용하여 \"현재 날짜\"의 값을 가져와, 도착 파일의 이름에 사용된 형식과 일치하도록 \"현재 날짜\"의 값을 포맷팅해 주세요.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n<span class=\"hljs-keyword\">from</span> functools <span class=\"hljs-keyword\">import</span> reduce\n\n# <span class=\"hljs-title class_\">Python</span>의 <span class=\"hljs-string\">\"datetime\"</span> 모듈을 사용하여 현재 날짜 가져오기\ncurrent_date = datetime.<span class=\"hljs-title function_\">now</span>()\n<span class=\"hljs-title function_\">print</span>(current_date)\n\n# 현재 날짜의 값을 파일 이름 형식에 맞게 포맷팅하여 출력\nfile_name_date_format = current_date.<span class=\"hljs-title function_\">strftime</span>(<span class=\"hljs-string\">\"%Y%m%d\"</span>)\n<span class=\"hljs-title function_\">print</span>(file_name_date_format)\n</code></pre>\n<p>출력 -</p>\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_8.png\">\n<p>단계 2.2: 파일이 보관된 ADLS 디렉토리의 \"마운트된 경로\"를 지정합니다.\n그런 다음, 해당 지정된 디렉토리에서 모든 파일을 나열합니다.\n마지막으로, 그 지정된 디렉토리의 파일 이름에 \"현재 날짜\"가 포함된 파일만 걸러내어 Python List에 저장합니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"># 파일이 위치한 <span class=\"hljs-variable constant_\">ADLS</span> 디렉토리의 마운트 경로 지정하기\ndirectory_path = <span class=\"hljs-string\">\"/mnt/iobdatalanding/practice-zone/input-files/\"</span>\n\n# 지정된 디렉토리에 있는 모든 파일 나열하기\nall_files = os.<span class=\"hljs-title function_\">listdir</span>(<span class=\"hljs-string\">\"/dbfs\"</span> + directory_path)\n<span class=\"hljs-title function_\">print</span>(all_files)\n\n# 현재 날짜가 파일 이름에 포함된 파일만 필터링하여 <span class=\"hljs-title class_\">Python</span> 리스트에 저장하기\nmatching_files = [matching_file <span class=\"hljs-keyword\">for</span> matching_file <span class=\"hljs-keyword\">in</span> all_files <span class=\"hljs-keyword\">if</span> file_name_date_format <span class=\"hljs-keyword\">in</span> matching_file]\n<span class=\"hljs-title function_\">print</span>(matching_files)\n</code></pre>\n<p>출력 -</p>\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_9.png\">\n<p>단계 2.3: 먼저 \"빈 Python 리스트\"를 생성하세요.\n그런 다음 각 일치하는 파일의 내용을 각각 별도의 DataFrame에 로드하세요.\n마지막으로 각 DataFrame을 이미 생성된 \"Python 리스트\"에 \"객체\"로 추가하세요.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"># 빈 리스트 생성\nlist_of_dfs = []\n\n# 각 일치하는 파일을 각각 별도의 데이터프레임으로 로드\n<span class=\"hljs-keyword\">for</span> file_name <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">matching_files</span>:\n    # 실제 파일 경로 생성\n    file_path = os.<span class=\"hljs-property\">path</span>.<span class=\"hljs-title function_\">join</span>(directory_path, file_name)\n    # 각 파일마다 데이터프레임 생성\n    df = spark.<span class=\"hljs-property\">read</span>.<span class=\"hljs-title function_\">format</span>(<span class=\"hljs-string\">\"csv\"</span>).<span class=\"hljs-title function_\">option</span>(<span class=\"hljs-string\">\"header\"</span>, <span class=\"hljs-string\">\"true\"</span>).<span class=\"hljs-title function_\">load</span>(file_path)\n    # 각 데이터프레임을 빈 리스트에 객체로서 각각 저장\n    list_of_dfs.<span class=\"hljs-title function_\">append</span>(df)\n\n<span class=\"hljs-title function_\">print</span>(list_of_dfs)\n</code></pre>\n<p>출력 -</p>\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_10.png\">\n<p>2.4단계: 각 데이터프레임의 모든 값들을 단일 데이터프레임으로 연결하고, 각 데이터프레임의 값들이 이제 \"파이썬 리스트\"의 각 객체로 되는 단일 데이터프레임을 생성하기 위해 \"reduce()\" 함수와 \"union()\" 메서드를 사용합니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"># 각 데이터프레임의 모든 값을 연결하여 하나의 데이터프레임으로 만들기\n# 이때 각 데이터프레임의 값은 이제 <span class=\"hljs-title class_\">Python</span> <span class=\"hljs-title class_\">List</span>의 각 객체이며 <span class=\"hljs-string\">\"reduce()\"</span> 함수를 사용하여 <span class=\"hljs-string\">\"union()\"</span> 메서드와 함께 결합합니다.\nfinal_df = <span class=\"hljs-title function_\">reduce</span>(lambda df1, <span class=\"hljs-attr\">df2</span>: df1.<span class=\"hljs-title function_\">union</span>(df2), list_of_dfs)\n<span class=\"hljs-title function_\">display</span>(final_df)\n</code></pre>\n<p>결과 -</p>\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_11.png\">\n<p>따라서 위 이미지에서 오늘 도착한 네 개의 파일에서 모든 레코드의 조합이 포함된 \"final_df\" 데이터프레임이 있음을 확인할 수 있습니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>당신이 개발자십에 관심이 있나봐요! 친철한 톤으로 번역해 드리겠습니다.</p>\n<p>스텝 2.5: 'final_df' DataFrame의 내용을 Bronze Table \"person_bronze\"에 삽입하세요.</p>\n<pre><code class=\"hljs language-js\"># <span class=\"hljs-string\">'final_df'</span> <span class=\"hljs-title class_\">DataFrame</span>의 내용을 <span class=\"hljs-title class_\">Bronze</span> <span class=\"hljs-title class_\">Table</span> <span class=\"hljs-string\">\"person_bronze\"</span>에 삽입\nfinal_df.<span class=\"hljs-property\">write</span>.<span class=\"hljs-title function_\">format</span>(<span class=\"hljs-string\">\"delta\"</span>).<span class=\"hljs-title function_\">mode</span>(<span class=\"hljs-string\">\"append\"</span>).<span class=\"hljs-title function_\">saveAsTable</span>(<span class=\"hljs-string\">\"hive_metastore.practice.person_bronze\"</span>)\n</code></pre>\n<p>다음 \"스파크 SQL\" 쿼리를 사용하여 'person_bronze' Bronze Table에 방금 삽입된 데이터가 있는지 확인하세요 -</p>\n<pre><code class=\"hljs language-js\">%sql\n-- <span class=\"hljs-string\">'person_bronze'</span> <span class=\"hljs-title class_\">Bronze</span> <span class=\"hljs-title class_\">Table</span>에 데이터가 있는지 확인\n<span class=\"hljs-variable constant_\">SELECT</span> * <span class=\"hljs-variable constant_\">FROM</span> hive_metastore.<span class=\"hljs-property\">practice</span>.<span class=\"hljs-property\">person_bronze</span>;\n</code></pre>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>출력 -</p>\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_12.png\">\n<h1>현재 시간을 기반으로 한 Databricks에서 여러 파일 로드하기</h1>\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_13.png\">\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>지금은 2024년 5월 25일이고, 현재 시간은 오후 8시입니다. 위 그림에서 볼 수 있듯이, 마지막 두 파일이 \"현재 시간\"인 즉, 8시에 도착했습니다.</p>\n<p>그러므로, 마지막 두 파일을 처리하고 그 두 파일의 내용을 브론즈 레이어의 테이블에 추가 모드로 로드하는 작업입니다.</p>\n<h1>현재 날짜 또는 시간에 따라 Databricks에서 여러 파일을 동적으로 로드하는 방법</h1>\n<p>배치 시스템에서는 고객이 이미 추출된 파일을 도착한 추출된 파일과 동일한 경로에 유지하고 브론즈 레이어에 로드하길 원하는 경우가 많습니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>따라서 현재 일 또는 현재 시간에 도착한 파일만 고려하여 디렉터리에있는 파일 목록에서 해당 파일의 내용을 처리하고 브론즈 계층으로 로드하는 개발자의 책임이 있습니다.</p>\n<p><img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_14.png\" alt=\"이미지\"></p>\n<p>오늘은 2024년 5월 25일입니다. 위 이미지에서 볼 수 있듯이 -</p>\n<p>첫 번째 파일은 2024년 5월 22일에 도착했습니다.\n두 번째 파일은 2024년 5월 23일에 도착했습니다.\n세 번째 파일은 2024년 5월 24일에 도착했습니다.\n나머지 네 번째 파일은 2024년 5월 25일, 즉 오늘 도착했습니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>오늘 도착한 첫 번째 파일 내용은 다음과 같습니다 -</p>\n<p><img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_15.png\" alt=\"First File\"></p>\n<p>오늘 도착한 두 번째 파일 내용은 다음과 같습니다 -</p>\n<p><img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_16.png\" alt=\"Second File\"></p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>현재 시간에 도착한 첫 번째 파일의 내용은 다음과 같습니다 -</p>\n<p><img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_17.png\" alt=\"\"></p>\n<p>현재 시간에 도착한 두 번째 파일의 내용은 다음과 같습니다 -</p>\n<p><img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_18.png\" alt=\"\"></p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>Step 1: Create a Bronze Table -</p>\n<p>이미 첫 번째 부분에서 생성되었습니다.</p>\n<p>Step 2: 오늘 현재 시간 기준으로 Databricks에서 마지막 두 파일을로드하는 Python 코드 작성 시작, 즉, 2024년 5월 25일 오후 8시.</p>\n<p>Step 2.1: Python의 \"datetime\" 모듈을 사용하여 \"현재 날짜\"의 \"현재 시간\" 값을 가져와서 \"현재 날짜\"의 \"현재 시간\" 값을 적시되어 파일 도착 이름 및 \"날짜\" 및 \"시간\" 부분과 일치하도록 형식화하세요.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n<span class=\"hljs-keyword\">from</span> functools <span class=\"hljs-keyword\">import</span> reduce\n\n<span class=\"hljs-comment\"># Python의 \"datetime\" 모듈을 사용하여 현재 날짜의 현재 시간을 가져옵니다.</span>\ncurrent_date_and_time = datetime.now()\n<span class=\"hljs-built_in\">print</span>(current_date_and_time)\n\n<span class=\"hljs-comment\"># 현재 시간의 값을 파일 이름의 날짜 및 시간 형식과 일치하도록 형식화합니다.</span>\nfile_name_date_and_hour_format = current_date_and_time.strftime(<span class=\"hljs-string\">\"%Y%m%d%H\"</span>)\n<span class=\"hljs-built_in\">print</span>(file_name_date_and_hour_format)\n</code></pre>\n<p>출력 -</p>\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_19.png\">\n<p>단계 2.2: 파일이 보관된 ADLS 디렉토리의 \"Mounted Path\"를 지정합니다.\n그런 다음, 해당 지정된 디렉토리에서 모든 파일을 나열합니다.\n마지막으로 해당 지정된 디렉토리의 파일 이름 중 \"현재 날짜\"의 \"현재 시간\"이 있는 파일만 필터링하여 Python List에 저장합니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"># 파일이 위치한 <span class=\"hljs-variable constant_\">ADLS</span> 디렉토리의 마운트 경로를 지정합니다\ndirectory_path = <span class=\"hljs-string\">\"/mnt/iobdatalanding/practice-zone/input-files/\"</span>\n\n# 지정된 디렉토리에 있는 모든 파일을 나열합니다\nall_files = os.<span class=\"hljs-title function_\">listdir</span>(<span class=\"hljs-string\">\"/dbfs\"</span> + directory_path)\n<span class=\"hljs-title function_\">print</span>(all_files)\n\n# 현재 날짜의 현재 시간을 파일 이름에 포함하는 파일만 필터링합니다\nmatching_files = [matching_file <span class=\"hljs-keyword\">for</span> matching_file <span class=\"hljs-keyword\">in</span> all_files <span class=\"hljs-keyword\">if</span> file_name_date_and_hour_format <span class=\"hljs-keyword\">in</span> matching_file]\n<span class=\"hljs-title function_\">print</span>(matching_files)\n</code></pre>\n<p>Output -</p>\n<p><img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_20.png\" alt=\"다이나믹 파일로드 방법\"></p>\n<p>단계 2.3: 먼저 \"빈 Python List\"를 생성합니다.\n그런 다음 각 일치하는 파일의 내용을 각각 별도의 DataFrame으로 로드합니다.\n마지막으로, 각 해당 DataFrame을 이미 생성된 \"Python List\"에 \"객체\"로서 추가합니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\"># 빈 목록 생성\nlist_of_dfs = []\n\n# 각 일치하는 파일을 각각 별도의 데이터프레임으로 불러오기\n<span class=\"hljs-keyword\">for</span> file_name <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">matching_files</span>:\n    # 실제 파일 경로 생성\n    file_path = os.<span class=\"hljs-property\">path</span>.<span class=\"hljs-title function_\">join</span>(directory_path, file_name)\n    # 각 파일에 대한 데이터프레임 생성\n    df = spark.<span class=\"hljs-property\">read</span>.<span class=\"hljs-title function_\">format</span>(<span class=\"hljs-string\">\"csv\"</span>).<span class=\"hljs-title function_\">option</span>(<span class=\"hljs-string\">\"header\"</span>, <span class=\"hljs-string\">\"true\"</span>).<span class=\"hljs-title function_\">load</span>(file_path)\n    # 각 데이터프레임을 빈 목록에 객체로 각각 저장\n    list_of_dfs.<span class=\"hljs-title function_\">append</span>(df)\n\n<span class=\"hljs-title function_\">print</span>(list_of_dfs)\n</code></pre>\n<p>출력 -</p>\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_21.png\">\n<p>단계 2.4: 각 데이터프레임의 모든 값들을 단일 데이터프레임으로 연결합니다. 각 데이터프레임의 값은 이제 \"Python List\"의 각 객체이며, \"reduce()\" 함수와 \"union()\" 메소드를 사용합니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h1>각 DataFrame의 모든 값들을 Python 리스트의 각 객체로 사용하여 하나의 DataFrame으로 결합하십시오. \"reduce()\" 함수를 사용하고 \"union()\" 메서드를 함께 사용하십시오.</h1>\n<p>final_df = reduce(lambda df1, df2: df1.union(df2), list_of_dfs)\ndisplay(final_df)</p>\n<p>출력 -</p>\n<img src=\"/assets/img/2024-05-27-HowToDynamicallyLoadMultipleFilesinDatabricksBasedonCurrentDateorHour_22.png\">\n<p>따라서 위 이미지에서 현재 시간에 도착한 두 파일의 레코드를 모두 포함하는 \"final_df\" DataFrame을 확인할 수 있습니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>스텝 2.5: \"final_df\" 데이터프레임의 내용을 첫 번째 부분에 표시된 PySpark 코드를 사용하여 Bronze 테이블 \"person_bronze\"에 삽입합니다.</p>\n<p>마지막으로, 첫 번째 부분에 표시된 \"Spark SQL\" 쿼리를 사용하여 방금 삽입한 데이터가 Bronze 테이블 \"person_bronze\"에 있는지 확인하세요.</p>\n</body>\n</html>\n"},"__N_SSG":true}