{"pageProps":{"post":{"title":"í…Œë¼í¼ìœ¼ë¡œ AWS-VPC í”¼ì–´ë§í•˜ê¸°","description":"","date":"2024-05-27 17:35","slug":"2024-05-27-AWS-VPCPeeringwithTerraform","content":"\n\n![AWS VPC Peering with Terraform](/assets/img/2024-05-27-AWS-VPCPeeringwithTerraform_0.png)\n\nAWSì—ì„œ VPCëŠ” ë¬´ì—‡ì¸ê°€ìš”?\n\nAWSì—ì„œ VPC í”¼ì–´ë§ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?\n\nTerraformì€ ë¬´ì—‡ì¸ê°€ìš”?\n\n\n<div class=\"content-ad\"></div>\n\nì´ ê¸€ì—ì„œëŠ” AWSì—ì„œ Terraformì„ ì‚¬ìš©í•˜ì—¬ VPC í”¼ì–´ë§ í”„ë¡œì„¸ìŠ¤ë¥¼ ìë™í™”í•˜ëŠ” ë‹¨ê³„ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.\n\nAWSì—ì„œ ìƒì„±ëœ ìì› ëª©ë¡\n\n- EC2 (2ëŒ€)\n- VPC (2ê°œ)\n- Internet Gateways (2ê°œ)\n- ë³´ì•ˆ ê·¸ë£¹ (4ê°œ)\n- VPC í”¼ì–´ë§ ì—°ê²° (1ê°œ)\n- ë¼ìš°íŠ¸ í…Œì´ë¸” (2ê°œ)\n\n# í”„ë¡œì íŠ¸ êµ¬ì¡°\n\n<div class=\"content-ad\"></div>\n\n\nterraform_project/\nâ”‚\nâ”œâ”€â”€ module/\nâ”‚   â”œâ”€â”€ ec2/\nâ”‚   â”‚   â”œâ”€â”€ main.tf\nâ”‚   â”‚   â”œâ”€â”€ output.tf\nâ”‚   â”‚   â””â”€â”€ variables.tf\nâ”‚   â”œâ”€â”€ vpc/\nâ”‚   â”‚   â”œâ”€â”€ main.tf\nâ”‚   â”‚   â”œâ”€â”€ output.tf\nâ”‚   â”‚   â””â”€â”€ variables.tf\nâ”‚   â””â”€â”€ ...\nâ”‚\nâ”œâ”€â”€ main.tf\nâ”œâ”€â”€ variables.tf\nâ””â”€â”€ variable.tfvars/\n    â”œâ”€â”€ dev-env.tfvars\n    â”œâ”€â”€ stage-env.tfvars\n    â””â”€â”€ prod-env.tfvars\n\n\n## ë‹¨ê³„ 1: VPCë¥¼ ìœ„í•œ ëª¨ë“ˆ ìƒì„± ë° ê°€ì ¸ì˜¤ê¸°\n\nmodules/vpc-peering/main.tf\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source                = \"hashicorp/aws\"\n      version               = \"~> 5.0\"\n      configuration_aliases = [aws.us_west]\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nresource \"aws_vpc\" \"main_vpc\" {\n  cidr_block = var.vpc_cidr\n\n  tags = {\n    Name       = var.vpc_name\n    created_by = var.owner_name\n  }\n}\n```\n\n<div class=\"content-ad\"></div>\n\nì§€ê¸ˆ, í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ main.tf íŒŒì¼ì— ëª¨ë“ˆì„ ê°€ì ¸ì˜¤ê² ìŠµë‹ˆë‹¤.\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.0\"\n    }\n  }\n}\n\nprovider \"aws\" {\n  region = \"us-east-1\"\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nmodule \"vpc_A\" {\n  source     = \"./modules/vpc\"\n  vpc_name   = var.vpcs[\"vpc_A\"][\"vpc_name\"]\n  vpc_cidr   = var.vpcs[\"vpc_A\"][\"cidr_block\"]\n  owner_name = var.owner_name\n}\n\nmodule \"vpc_B\" {\n  source     = \"./modules/vpc\"\n  vpc_name   = var.vpcs[\"vpc_B\"][\"vpc_name\"]\n  vpc_cidr   = var.vpcs[\"vpc_B\"][\"cidr_block\"]\n  owner_name = var.owner_name\n  providers = {\n    aws = aws.us_west\n  }\n}\n```\n\n## Step 2: Subnetsìš© ëª¨ë“ˆì„ ë§Œë“¤ì–´ importí•´ë³´ì„¸ìš”.\n\nmodules/subnets/main.tf\n\n<div class=\"content-ad\"></div>\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.0\"\n      # configuration_aliases = [aws.us_west]\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nresource \"aws_subnet\" \"main_subnet\" {\n  vpc_id            = var.vpc_id\n  cidr_block        = var.subnet_cidr\n  availability_zone = var.availability_zone\n\n  tags = {\n    Name       = var.subnet_name\n    created_by = var.owner_name\n  }\n}\n```\n\nì´ì œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ main.tf íŒŒì¼ì— ëª¨ë“ˆì„ ê°€ì ¸ ì˜¤ê² ìŠµë‹ˆë‹¤.\n\n```js\nmodule \"subnetsForvpc_A\" {\n  for_each          = var.subnetsForvpc_A\n  source            = \"./modules/subnets\"\n  vpc_id            = module.vpc_A.vpc_id\n  subnet_cidr       = var.subnetsForvpc_A[each.key][\"subnet_cidr\"]\n  subnet_name       = var.subnetsForvpc_A[each.key][\"subnet_name\"]\n  availability_zone = var.subnetsForvpc_A[each.key][\"availability_zone\"]\n  owner_name        = var.owner_name\n}\n\nmodule \"subnetsForvpc_B\" {\n  for_each          = var.subnetsForvpc_B\n  source            = \"./modules/subnets\"\n  vpc_id            = module.vpc_B.vpc_id\n  subnet_cidr       = var.subnetsForvpc_B[each.key][\"subnet_cidr\"]\n  subnet_name       = var.subnetsForvpc_B[each.key][\"subnet_name\"]\n  availability_zone = var.subnetsForvpc_B[each.key][\"availability_zone\"]\n  owner_name        = var.owner_name\n  providers = {\n    aws = aws.us_west\n  }\n}\n```\n\n## ë‹¨ê³„ 3: ë³´ì•ˆ ê·¸ë£¹ ëª¨ë“ˆì„ ìƒì„±í•˜ê³  ê°€ì ¸ ì˜¤ê¸°\n\n<div class=\"content-ad\"></div>\n\nmodules/security-groups/main.tf\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source                = \"hashicorp/aws\"\n      version               = \"~> 5.0\"\n      configuration_aliases = [aws.us_west]\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nresource \"aws_security_group\" \"allow_ssh\" {\n  name        = var.sg_name\n  description = var.sg_description\n  vpc_id      = var.vpc_id\n\n  ingress {\n    description = var.ingress_description\n    from_port   = var.ingress_from_port\n    to_port     = var.ingress_to_port\n    protocol    = var.ingress_protocol\n    cidr_blocks = var.ingress_cidr_blocks\n  }\n\n  egress {\n    from_port   = \"0\"\n    to_port     = \"0\"\n    protocol    = \"-1\"\n    cidr_blocks = [\"0.0.0.0/0\"]\n  }\n\n  tags = {\n    Name       = var.sg_name\n    created_by = var.owner_name\n  }\n}\n```\n\në³´ì•ˆ ê·¸ë£¹ì„ ìœ„í•´, ì €ëŠ” main.tf íŒŒì¼ì—ì„œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¡œ ëª¨ë“ˆì„ ë‘ ë²ˆ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ë³´ì•ˆ ê·¸ë£¹ì€ EC2ë¡œ SSHë¥¼ í—ˆìš©í•˜ê³ , ë‘ ë²ˆì§¸ëŠ” EC2ì—ì„œ ICMP íŒ¨í‚·ì˜ íë¦„ì„ í—ˆìš©í•©ë‹ˆë‹¤.\n\n```js\nmodule \"ssh_sg_vpcA\" {\n  source              = \"./modules/security-groups\"\n  sg_name             = var.sgs[\"ssh_sg\"][\"sg_name\"]\n  sg_description      = var.sgs[\"ssh_sg\"][\"sg_description\"]\n  ingress_description = var.sgs[\"ssh_sg\"][\"ingress_description\"]\n  ingress_from_port   = var.sgs[\"ssh_sg\"][\"ingress_from_port\"]\n  ingress_to_port     = var.sgs[\"ssh_sg\"][\"ingress_to_port\"]\n  ingress_protocol    = var.sgs[\"ssh_sg\"][\"ingress_protocol\"]\n  ingress_cidr_blocks = var.sg_cidr_blocks[\"ssh_sg\"][\"ingress_cidr_blocks\"]\n  owner_name          = var.owner_name\n  vpc_id              = module.vpc_A.vpc_id\n}\n\nmodule \"ssh_sg_vpcB\" {\n  source              = \"./modules/security-groups\"\n  sg_name             = var.sgs[\"ssh_sg\"][\"sg_name\"]\n  sg_description      = var.sgs[\"ssh_sg\"][\"sg_description\"]\n  ingress_description = var.sgs[\"ssh_sg\"][\"ingress_description\"]\n  ingress_from_port   = var.sgs[\"ssh_sg\"][\"ingress_from_port\"]\n  ingress_to_port     = var.sgs[\"ssh_sg\"][\"ingress_to_port\"]\n  ingress_protocol    = var.sgs[\"ssh_sg\"][\"ingress_protocol\"]\n  ingress_cidr_blocks = var.sg_cidr_blocks[\"ssh_sg\"][\"ingress_cidr_blocks\"]\n  owner_name          = var.owner_name\n  vpc_id              = module.vpc_B.vpc_id\n  providers = {\n    aws = aws.us_west\n  }\n}\n\nmodule \"icmp_sg_vpcA\" {\n  source              = \"./modules/security-groups\"\n  sg_name             = var.sgs[\"icmp_sg\"][\"sg_name\"]\n  sg_description      = var.sgs[\"icmp_sg\"][\"sg_description\"]\n  ingress_description = var.sgs[\"icmp_sg\"][\"ingress_description\"]\n  ingress_from_port   = var.sgs[\"icmp_sg\"][\"ingress_from_port\"]\n  ingress_to_port     = var.sgs[\"icmp_sg\"][\"ingress_to_port\"]\n  ingress_protocol    = var.sgs[\"icmp_sg\"][\"ingress_protocol\"]\n  ingress_cidr_blocks = var.sg_cidr_blocks[\"icmp_sg\"][\"ingress_cidr_blocks_for_vpcA\"]\n  owner_name          = var.owner_name\n  vpc_id              = module.vpc_A.vpc_id\n}\n\nmodule \"icmp_sg_vpcB\" {\n  source              = \"./modules/security-groups\"\n  sg_name             = var.sgs[\"icmp_sg\"][\"sg_name\"]\n  sg_description      = var.sgs[\"icmp_sg\"][\"sg_description\"]\n  ingress_description = var.sgs[\"icmp_sg\"][\"ingress_description\"]\n  ingress_from_port   = var.sgs[\"icmp_sg\"][\"ingress_from_port\"]\n  ingress_to_port     = var.sgs[\"icmp_sg\"][\"ingress_to_port\"]\n  ingress_protocol    = var.sgs[\"icmp_sg\"][\"ingress_protocol\"]\n  ingress_cidr_blocks = var.sg_cidr_blocks[\"icmp_sg\"][\"ingress_cidr_blocks_for_vpcB\"]\n  owner_name          = var.owner_name\n  vpc_id              = module.vpc_B.vpc_id\n  providers = {\n    aws = aws.us_west\n  }\n}\n```\n\n<div class=\"content-ad\"></div>\n\n## ë‹¨ê³„ 4: EC2ë¥¼ ìœ„í•œ ëª¨ë“ˆ ìƒì„± ë° ê°€ì ¸ì˜¤ê¸°\n\nmodules/ec2/main.tf\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source                = \"hashicorp/aws\"\n      version               = \"~> 5.0\"\n      configuration_aliases = [aws.us_west]\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nresource \"aws_instance\" \"my_ec2\" {\n\n  ami                         = var.ami_id\n  instance_type               = var.instance_type\n  subnet_id                   = var.subnet_id\n  associate_public_ip_address = true\n  key_name                    = var.key_name\n\n  tags = {\n    Name       = var.ec2_name\n    created_by = var.owner_name\n  }\n}\n\nresource \"aws_network_interface_sg_attachment\" \"ssh_sg_attachment\" {\n  security_group_id    = var.ssh_sg_id\n  network_interface_id = aws_instance.my_ec2.primary_network_interface_id\n}\n\nresource \"aws_network_interface_sg_attachment\" \"icmp_sg_attachment\" {\n  security_group_id    = var.icmp_sg_id\n  network_interface_id = aws_instance.my_ec2.primary_network_interface_id\n}\n```\n\nì´ì œ ëª¨ë“ˆì„ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ main.tf íŒŒì¼ì— ê°€ì ¸ì˜¤ê² ìŠµë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\n\nmodule \"ec2_vpcA\" {\n  source        = \"./modules/ec2\"\n  subnet_id     = module.subnetsForvpc_A[\"subnet1\"].subnet_id\n  ami_id        = var.ec2s[\"ec2_vpcA\"][\"ami_id\"]\n  instance_type = var.ec2s[\"ec2_vpcA\"][\"instance_type\"]\n  ec2_name      = var.ec2s[\"ec2_vpcA\"][\"ec2_name\"]\n  key_name      = var.ec2s[\"ec2_vpcA\"][\"key_name\"]\n  ssh_sg_id     = module.ssh_sg_vpcA.sg_id\n  icmp_sg_id    = module.icmp_sg_vpcA.sg_id\n  owner_name    = var.owner_name\n}\n\nmodule \"ec2_vpcB\" {\n  source        = \"./modules/ec2\"\n  subnet_id     = module.subnetsForvpc_B[\"subnet1\"].subnet_id\n  ami_id        = var.ec2s[\"ec2_vpcB\"][\"ami_id\"]\n  instance_type = var.ec2s[\"ec2_vpcB\"][\"instance_type\"]\n  ec2_name      = var.ec2s[\"ec2_vpcB\"][\"ec2_name\"]\n  key_name      = var.ec2s[\"ec2_vpcB\"][\"key_name\"]\n  ssh_sg_id     = module.ssh_sg_vpcB.sg_id\n  icmp_sg_id    = module.icmp_sg_vpcB.sg_id\n  owner_name    = var.owner_name\n  providers = {\n    aws = aws.us_west\n  }\n}\n\n\n## Step 5: Create modules for Internet Gateways and importing them\n\nmodules/internet-gateways/main.tf\n\n\nterraform {\n  required_providers {\n    aws = {\n      source                = \"hashicorp/aws\"\n      version               = \"~> 5.0\"\n      configuration_aliases = [aws.us_west]\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nresource \"aws_internet_gateway\" \"i_gw\" {\n  vpc_id = var.vpc_id\n\n  tags = {\n    Name       = var.igw_name\n    created_by = var.owner_name\n  }\n}\n\n\n<div class=\"content-ad\"></div>\n\nì´ì œ, í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ main.tf íŒŒì¼ì— ëª¨ë“ˆì„ ê°€ì ¸ì˜¤ê² ìŠµë‹ˆë‹¤.\n\n```js\nmodule \"igw_vpcA\" {\n  source     = \"./modules/internet-gateways\"\n  vpc_id     = module.vpc_A.vpc_id\n  igw_name   = var.igws[\"igw_vpcA\"][\"name\"]\n  owner_name = var.owner_name\n}\n\nmodule \"igw_vpcB\" {\n  source     = \"./modules/internet-gateways\"\n  vpc_id     = module.vpc_B.vpc_id\n  igw_name   = var.igws[\"igw_vpcB\"][\"name\"]\n  owner_name = var.owner_name\n  providers = {\n    aws = aws.us_west\n  }\n}\n```\n\n## ë‹¨ê³„ 6: VPC Peering, VPC Peering accepter, VPC Peering configureìš© ëª¨ë“ˆ ìƒì„± ë° ê°€ì ¸ì˜¤ê¸°\n\nëª¨ë“ˆ - VPC Peering (modules/vpc-peering/main.tf)\n\n<div class=\"content-ad\"></div>\n\n```kotlin\ní…Œë¼í¼ {\n  í•„ìˆ˜_ì œê³µì {\n    aws = {\n      ì†ŒìŠ¤ = \"hashicorp/aws\"\n      ë²„ì „ = \"~> 5.0\"\n      êµ¬ì„±_ë³„ì¹­ = [aws.us_west]\n    }\n  }\n}\n\nì œê³µì \"aws\" {\n  ë³„ì¹­  = \"us_west\"\n  ì§€ì—­ = \"us-west-1\"\n}\n\në¦¬ì†ŒìŠ¤ \"aws_vpc_peering_connection\" \"vpc_peering\" {\n  peer_vpc_id = var.peer_vpc_id\n  vpc_id      = var.vpc_id\n  peer_region = \"us-west-1\"\n  tags = {\n    ì´ë¦„       = var.vpcpeer_name\n    ìƒì„±ì = var.owner_name\n  }\n}\n```\n\nëª¨ë“ˆ â€” VPC í”¼ì–´ë§ ìˆ˜ë½ì (modules/vpc-peering-accepter/main.tf)\n\n```kotlin\ní…Œë¼í¼ {\n  í•„ìˆ˜_ì œê³µì {\n    aws = {\n      ì†ŒìŠ¤ = \"hashicorp/aws\"\n      ë²„ì „ = \"~> 5.0\"\n      êµ¬ì„±_ë³„ì¹­ = [aws.us_west]\n    }\n  }\n}\n\nì œê³µì \"aws\" {\n  ë³„ì¹­  = \"us_west\"\n  ì§€ì—­ = \"us-west-1\"\n}\n\në¦¬ì†ŒìŠ¤ \"aws_vpc_peering_connection_accepter\" \"peer_vpc_AB\" {\n  provider = aws.us_west\n\n  vpc_peering_connection_id = var.vpc_peering_id\n  auto_accept               = true\n\n  tags = {\n    ìª½       = \"ìˆ˜ë½ì\"\n    ì†Œìœ ì_ì´ë¦„ = var.owner_name\n  }\n}\n```\n\nëª¨ë“ˆ â€” VPC í”¼ì–´ë§ êµ¬ì„± (modules/vpc-peering-configure/main.tf)\n\n\n\n<div class=\"content-ad\"></div>\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source                = \"hashicorp/aws\"\n      version               = \"~> 5.0\"\n      configuration_aliases = [aws.us_west]\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nresource \"aws_vpc_peering_connection_options\" \"vpc_peering_configure\" {\n  vpc_peering_connection_id = var.vpc_peering_connection_id\n}\n```\n\nì´ì œ, ìœ„ì˜ ëª¨ë“  ëª¨ë“ˆì„ ë£¨íŠ¸ì˜ main.tf íŒŒì¼ë¡œ ê°€ì ¸ì˜¤ê² ìŠµë‹ˆë‹¤.\n\n```js\nmodule \"vpc_peering\" {\n  source       = \"./modules/vpc-peering\"\n  peer_vpc_id  = module.vpc_B.vpc_id\n  vpc_id       = module.vpc_A.vpc_id\n  vpcpeer_name = var.vpcpeer_name\n  owner_name   = var.owner_name\n}\n\nmodule \"vpc_peering_accepter\" {\n  source         = \"./modules/vpc-peering-accepter\"\n  vpc_peering_id = module.vpc_peering.aws_vpc_peering_connection_id\n  owner_name     = var.owner_name\n  providers = {\n    aws = aws.us_west\n  }\n}\n\nmodule \"vpc_peering_configureA\" {\n  source                    = \"./modules/vpc_peer_configure\"\n  vpc_peering_connection_id = module.vpc_peering_accepter.aws_vpc_peering_connection_accepter\n}\n\nmodule \"vpc_peering_configureB\" {\n  source                    = \"./modules/vpc_peer_configure\"\n  vpc_peering_connection_id = module.vpc_peering_accepter.aws_vpc_peering_connection_accepter\n  providers = {\n    aws = aws.us_west\n  }\n}\n```\n\n## ë‹¨ê³„ 7: ë¼ìš°íŠ¸ í…Œì´ë¸”ì„ ìœ„í•œ ëª¨ë“ˆ ë§Œë“¤ê¸° ë° ê°€ì ¸ì˜¤ê¸°```\n\n<div class=\"content-ad\"></div>\n\nmodules/route-tables/main.tf\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source                = \"hashicorp/aws\"\n      version               = \"~> 5.0\"\n      configuration_aliases = [aws.us_west]\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nresource \"aws_route\" \"route\" {\n  route_table_id            = var.route_table_id\n  destination_cidr_block    = var.destination_cidr_block\n  gateway_id                = var.gateway_id != \"\" ? var.gateway_id : null\n  vpc_peering_connection_id = var.vpc_peering_connection_id != \"\" ? var.vpc_peering_connection_id : null\n}\n```\n\nì´ì œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ main.tf íŒŒì¼ì— ëª¨ë“ˆì„ ê°€ì ¸ì™€ë³´ê² ìŠµë‹ˆë‹¤.\n\n```js\nmodule \"route_table_vpcA_pcgw\" {\n  source                    = \"./modules/route-table\"\n  route_table_id            = module.vpc_A.default_route_table_id\n  destination_cidr_block    = var.destination_cidr_blocks_for_routetable[\"for_route_vpcA\"][\"pcgw_cidr\"]\n  vpc_peering_connection_id = module.vpc_peering.aws_vpc_peering_connection_id\n  gateway_id                = \"\"\n}\n\nmodule \"route_table_vpcB_pcgw\" {\n  source                    = \"./modules/route-table\"\n  route_table_id            = module.vpc_B.default_route_table_id\n  destination_cidr_block    = var.destination_cidr_blocks_for_routetable[\"for_route_vpcB\"][\"pcgw_cidr\"]\n  vpc_peering_connection_id = module.vpc_peering.aws_vpc_peering_connection_id\n  gateway_id                = \"\"\n  providers = {\n    aws = aws.us_west\n  }\n}\n\nmodule \"route_table_vpcA_igw\" {\n  source                    = \"./modules/route-table\"\n  route_table_id            = module.vpc_A.default_route_table_id\n  destination_cidr_block    = var.destination_cidr_blocks_for_routetable[\"for_route_vpcA\"][\"igw_cidr\"]\n  gateway_id                = module.igw_vpcA.igw_id\n  vpc_peering_connection_id = \"\"\n}\n\nmodule \"route_table_vpcB_igw\" {\n  source                    = \"./modules/route-table\"\n  route_table_id            = module.vpc_B.default_route_table_id\n  destination_cidr_block    = var.destination_cidr_blocks_for_routetable[\"for_route_vpcB\"][\"igw_cidr\"]\n  gateway_id                = module.igw_vpcB.igw_id\n  vpc_peering_connection_id = \"\"\n  providers = {\n    aws = aws.us_west\n  }\n}\n```\n\n<div class=\"content-ad\"></div>\n\n## ë‹¨ê³„ 8: dev-env.tfvars íŒŒì¼ ì‘ì„±\n\nvariable.tfvars/dev-env.tfvars\n\n```js\nowner_name = \"NIKUNJ\"\n\nvpcs = {\n  \"vpc_A\" = {\n    vpc_name   = \"vpc-us-east1\"\n    cidr_block = \"10.1.0.0/16\"\n  }\n  \"vpc_B\" = {\n    vpc_name   = \"vpc-us-west1\"\n    cidr_block = \"10.2.0.0/16\"\n  }\n}\n\nvpc_Aì— ëŒ€í•œ ì„œë¸Œë„· ëª©ë¡ = {\n  \"subnet1\" = {\n    subnet_cidr       = \"10.1.0.0/20\"\n    subnet_name       = \"subnet-us-east1a\"\n    availability_zone = \"us-east-1a\"\n  }\n  \"subnet2\" = {\n    subnet_cidr       = \"10.1.16.0/20\"\n    subnet_name       = \"subnet-us-east1b\"\n    availability_zone = \"us-east-1b\"\n  }\n  \"subnet3\" = {\n    subnet_cidr       = \"10.1.32.0/20\"\n    subnet_name       = \"subnet-us-east1c\"\n    availability_zone = \"us-east-1c\"\n  }\n}\n\nvpc_Bì— ëŒ€í•œ ì„œë¸Œë„· ëª©ë¡ = {\n  \"subnet1\" = {\n    subnet_cidr       = \"10.2.0.0/20\"\n    subnet_name       = \"subnet-us-west1a\"\n    availability_zone = \"us-west-1a\"\n  }\n  \"subnet2\" = {\n    subnet_cidr       = \"10.2.16.0/20\"\n    subnet_name       = \"subnet-us-west1b\"\n    availability_zone = \"us-west-1b\"\n  }\n}\n\në³´ì•ˆ ê·¸ë£¹ ëª©ë¡ = {\n  \"ssh_sg\" = {\n    sg_name             = \"allow_ssh\"\n    sg_description      = \"ë‚´ IPì—ì„œ SSH í—ˆìš©\"\n    ingress_description = \"ë‚´ IPë¥¼ ìœ„í•œ SSH\"\n    ingress_from_port   = \"22\"\n    ingress_to_port     = \"22\"\n    ingress_protocol    = \"tcp\"\n  }\n  \"icmp_sg\" = {\n    sg_name             = \"allow_ping_traffic\"\n    sg_description      = \"ë‚´ IPì—ì„œ ping í—ˆìš©\"\n    ingress_description = \"ë‚´ IPë¡œë¶€í„°ì˜ ping\"\n    ingress_from_port   = \"8\"\n    ingress_to_port     = \"0\"\n    ingress_protocol    = \"icmp\"\n  }\n}\n\nsg_cidr_blocks = {\n  \"ssh_sg\" = {\n    ingress_cidr_blocks = [\"12.34.56.78/32\"] # ec2ë¡œì˜ SSHê°€ í—ˆìš©ëœ IPë¥¼ ì–¸ê¸‰\n  }\n  \"icmp_sg\" = {\n    ingress_cidr_blocks_for_vpcA = [\"10.2.0.0/16\"]\n    ingress_cidr_blocks_for_vpcB = [\"10.1.0.0/16\"]\n  }\n}\n\nec2 ëª©ë¡ = {\n  \"ec2_vpcA\" = {\n    ami_id        = \"ami-0e8a34246278c21e4\"\n    instance_type = \"t2.micro\"\n    ec2_name      = \"ec2-us-east1\"\n    key_name      = \"us-east-1-demo\"\n  }\n  \"ec2_vpcB\" = {\n    ami_id        = \"ami-09ab9d570789dfdd4\"\n    instance_type = \"t2.micro\"\n    ec2_name      = \"ec2-us-west1\"\n    key_name      = \"us-west-1-demo\"\n  }\n}\n\nì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ ëª©ë¡ = {\n  \"igw_vpcA\" = {\n    name = \"igw_vpcA\"\n  }\n  \"igw_vpcB\" = {\n    name = \"igw_vpcB\"\n  }\n}\n\nVPC í”¼ì–´ë§ ì´ë¦„ = \"vpc_AB_peering\"\n\nroute í…Œì´ë¸”ìš© ëŒ€ìƒ CIDR ë¸”ë¡ = {\n  \"for_route_vpcA\" = {\n    pcgw_cidr = \"10.2.0.0/16\"\n    igw_cidr  = \"0.0.0.0/0\"\n  }\n  \"for_route_vpcB\" = {\n    pcgw_cidr = \"10.1.0.0/16\"\n    igw_cidr  = \"0.0.0.0/0\"\n  }\n}\n```\n\n## ë‹¨ê³„ 9: ì‘ì—… ë””ë ‰í† ë¦¬ ì´ˆê¸°í™”\n\n<div class=\"content-ad\"></div>\n\n- ì‘ì—… ë””ë ‰í† ë¦¬ì—ì„œ terraform init ëª…ë ¹ì„ ì‹¤í–‰í•˜ì„¸ìš”. ì´ ëª…ë ¹ì€ í•„ìš”í•œ ëª¨ë“  ê³µê¸‰ì ë° ëª¨ë“ˆì„ ë‹¤ìš´ë¡œë“œí•˜ê³  ë°±ì—”ë“œë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.\n\n## ë‹¨ê³„ 10: í…Œë¼í¼ ì‹¤í–‰ ê³„íš ìƒì„±\n\n- ì‘ì—… ë””ë ‰í† ë¦¬ì—ì„œ terraform plan ëª…ë ¹ì„ ì‹¤í–‰í•˜ì„¸ìš”. ì‹¤í–‰ ê³„íšì„ ì œê³µí•©ë‹ˆë‹¤.\n\n## ë‹¨ê³„ 11: terraform apply ì‹¤í–‰\n\n<div class=\"content-ad\"></div>\n\n- ì‘ì—… ë””ë ‰í† ë¦¬ì—ì„œ terraform apply ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ AWSì— í•„ìš”í•œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë©ë‹ˆë‹¤.\n\n## ë‹¨ê³„ 12: ì—°ê²° í™•ì¸\n\n- SSHë¥¼ ì‚¬ìš©í•˜ì—¬ EC2 ì¸ìŠ¤í„´ìŠ¤ ì¤‘ í•˜ë‚˜ì— ì—°ê²°í•˜ê³  ë‹¤ë¥¸ EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ ì‚¬ì„¤ IPë¥¼ ì‚¬ìš©í•˜ì—¬ í•‘ì„ ë³´ëƒ…ë‹ˆë‹¤.\n- ëª¨ë“  ê²ƒì´ ì˜ ë˜ì—ˆë‹¤ë©´ ICMP ë°ì´í„° íŒ¨í‚·ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.\n\nì—¬ê¸°ê¹Œì§€ì…ë‹ˆë‹¤. ì´ì œ Terraformì„ ì‚¬ìš©í•˜ì—¬ AWS VPC í”¼ì–´ë§ ì—°ê²°ì„ ìƒì„±í•˜ëŠ” ë°©ë²•ì„ ë°°ì› ìŠµë‹ˆë‹¤. ì´ì œ ì—¬ëŸ¬ë¶„ì€ ì´ê²ƒì„ ì‚¬ìš©í•˜ê³  í•„ìš”ì— ë”°ë¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\nì „ì²´ ì½”ë“œëŠ” ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆì–´ìš”.\n\nì´ ê°€ì´ë“œê°€ ë„ì›€ì´ ë˜ì—ˆë‹¤ë©´ ğŸ‘ ë²„íŠ¼ì„ í´ë¦­í•´ ì£¼ì„¸ìš”. ëŒ“ê¸€ë„ ììœ ë¡­ê²Œ ë‚¨ê²¨ì£¼ì„¸ìš”.\n","ogImage":{"url":"/assets/img/2024-05-27-AWS-VPCPeeringwithTerraform_0.png"},"coverImage":"/assets/img/2024-05-27-AWS-VPCPeeringwithTerraform_0.png","tag":["Tech"],"readingTime":18},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p><img src=\"/assets/img/2024-05-27-AWS-VPCPeeringwithTerraform_0.png\" alt=\"AWS VPC Peering with Terraform\"></p>\n<p>AWSì—ì„œ VPCëŠ” ë¬´ì—‡ì¸ê°€ìš”?</p>\n<p>AWSì—ì„œ VPC í”¼ì–´ë§ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?</p>\n<p>Terraformì€ ë¬´ì—‡ì¸ê°€ìš”?</p>\n<p>ì´ ê¸€ì—ì„œëŠ” AWSì—ì„œ Terraformì„ ì‚¬ìš©í•˜ì—¬ VPC í”¼ì–´ë§ í”„ë¡œì„¸ìŠ¤ë¥¼ ìë™í™”í•˜ëŠ” ë‹¨ê³„ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>\n<p>AWSì—ì„œ ìƒì„±ëœ ìì› ëª©ë¡</p>\n<ul>\n<li>EC2 (2ëŒ€)</li>\n<li>VPC (2ê°œ)</li>\n<li>Internet Gateways (2ê°œ)</li>\n<li>ë³´ì•ˆ ê·¸ë£¹ (4ê°œ)</li>\n<li>VPC í”¼ì–´ë§ ì—°ê²° (1ê°œ)</li>\n<li>ë¼ìš°íŠ¸ í…Œì´ë¸” (2ê°œ)</li>\n</ul>\n<h1>í”„ë¡œì íŠ¸ êµ¬ì¡°</h1>\n<p>terraform_project/\nâ”‚\nâ”œâ”€â”€ module/\nâ”‚   â”œâ”€â”€ ec2/\nâ”‚   â”‚   â”œâ”€â”€ main.tf\nâ”‚   â”‚   â”œâ”€â”€ output.tf\nâ”‚   â”‚   â””â”€â”€ variables.tf\nâ”‚   â”œâ”€â”€ vpc/\nâ”‚   â”‚   â”œâ”€â”€ main.tf\nâ”‚   â”‚   â”œâ”€â”€ output.tf\nâ”‚   â”‚   â””â”€â”€ variables.tf\nâ”‚   â””â”€â”€ ...\nâ”‚\nâ”œâ”€â”€ main.tf\nâ”œâ”€â”€ variables.tf\nâ””â”€â”€ variable.tfvars/\nâ”œâ”€â”€ dev-env.tfvars\nâ”œâ”€â”€ stage-env.tfvars\nâ””â”€â”€ prod-env.tfvars</p>\n<h2>ë‹¨ê³„ 1: VPCë¥¼ ìœ„í•œ ëª¨ë“ˆ ìƒì„± ë° ê°€ì ¸ì˜¤ê¸°</h2>\n<p>modules/vpc-peering/main.tf</p>\n<pre><code class=\"hljs language-js\">terraform {\n  required_providers {\n    aws = {\n      source                = <span class=\"hljs-string\">\"hashicorp/aws\"</span>\n      version               = <span class=\"hljs-string\">\"~> 5.0\"</span>\n      configuration_aliases = [aws.<span class=\"hljs-property\">us_west</span>]\n    }\n  }\n}\n\nprovider <span class=\"hljs-string\">\"aws\"</span> {\n  alias  = <span class=\"hljs-string\">\"us_west\"</span>\n  region = <span class=\"hljs-string\">\"us-west-1\"</span>\n}\n\nresource <span class=\"hljs-string\">\"aws_vpc\"</span> <span class=\"hljs-string\">\"main_vpc\"</span> {\n  cidr_block = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">vpc_cidr</span>\n\n  tags = {\n    <span class=\"hljs-title class_\">Name</span>       = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">vpc_name</span>\n    created_by = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n  }\n}\n</code></pre>\n<p>ì§€ê¸ˆ, í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ main.tf íŒŒì¼ì— ëª¨ë“ˆì„ ê°€ì ¸ì˜¤ê² ìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\">terraform {\n  required_providers {\n    aws = {\n      source  = <span class=\"hljs-string\">\"hashicorp/aws\"</span>\n      version = <span class=\"hljs-string\">\"~> 5.0\"</span>\n    }\n  }\n}\n\nprovider <span class=\"hljs-string\">\"aws\"</span> {\n  region = <span class=\"hljs-string\">\"us-east-1\"</span>\n}\n\nprovider <span class=\"hljs-string\">\"aws\"</span> {\n  alias  = <span class=\"hljs-string\">\"us_west\"</span>\n  region = <span class=\"hljs-string\">\"us-west-1\"</span>\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"vpc_A\"</span> {\n  source     = <span class=\"hljs-string\">\"./modules/vpc\"</span>\n  vpc_name   = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">vpcs</span>[<span class=\"hljs-string\">\"vpc_A\"</span>][<span class=\"hljs-string\">\"vpc_name\"</span>]\n  vpc_cidr   = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">vpcs</span>[<span class=\"hljs-string\">\"vpc_A\"</span>][<span class=\"hljs-string\">\"cidr_block\"</span>]\n  owner_name = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"vpc_B\"</span> {\n  source     = <span class=\"hljs-string\">\"./modules/vpc\"</span>\n  vpc_name   = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">vpcs</span>[<span class=\"hljs-string\">\"vpc_B\"</span>][<span class=\"hljs-string\">\"vpc_name\"</span>]\n  vpc_cidr   = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">vpcs</span>[<span class=\"hljs-string\">\"vpc_B\"</span>][<span class=\"hljs-string\">\"cidr_block\"</span>]\n  owner_name = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n  providers = {\n    aws = aws.<span class=\"hljs-property\">us_west</span>\n  }\n}\n</code></pre>\n<h2>Step 2: Subnetsìš© ëª¨ë“ˆì„ ë§Œë“¤ì–´ importí•´ë³´ì„¸ìš”.</h2>\n<p>modules/subnets/main.tf</p>\n<pre><code class=\"hljs language-js\">terraform {\n  required_providers {\n    aws = {\n      source  = <span class=\"hljs-string\">\"hashicorp/aws\"</span>\n      version = <span class=\"hljs-string\">\"~> 5.0\"</span>\n      # configuration_aliases = [aws.<span class=\"hljs-property\">us_west</span>]\n    }\n  }\n}\n\nprovider <span class=\"hljs-string\">\"aws\"</span> {\n  alias  = <span class=\"hljs-string\">\"us_west\"</span>\n  region = <span class=\"hljs-string\">\"us-west-1\"</span>\n}\n\nresource <span class=\"hljs-string\">\"aws_subnet\"</span> <span class=\"hljs-string\">\"main_subnet\"</span> {\n  vpc_id            = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">vpc_id</span>\n  cidr_block        = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">subnet_cidr</span>\n  availability_zone = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">availability_zone</span>\n\n  tags = {\n    <span class=\"hljs-title class_\">Name</span>       = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">subnet_name</span>\n    created_by = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n  }\n}\n</code></pre>\n<p>ì´ì œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ main.tf íŒŒì¼ì— ëª¨ë“ˆì„ ê°€ì ¸ ì˜¤ê² ìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"subnetsForvpc_A\"</span> {\n  for_each          = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">subnetsForvpc_A</span>\n  source            = <span class=\"hljs-string\">\"./modules/subnets\"</span>\n  vpc_id            = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_A</span>.<span class=\"hljs-property\">vpc_id</span>\n  subnet_cidr       = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">subnetsForvpc_A</span>[each.<span class=\"hljs-property\">key</span>][<span class=\"hljs-string\">\"subnet_cidr\"</span>]\n  subnet_name       = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">subnetsForvpc_A</span>[each.<span class=\"hljs-property\">key</span>][<span class=\"hljs-string\">\"subnet_name\"</span>]\n  availability_zone = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">subnetsForvpc_A</span>[each.<span class=\"hljs-property\">key</span>][<span class=\"hljs-string\">\"availability_zone\"</span>]\n  owner_name        = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"subnetsForvpc_B\"</span> {\n  for_each          = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">subnetsForvpc_B</span>\n  source            = <span class=\"hljs-string\">\"./modules/subnets\"</span>\n  vpc_id            = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_B</span>.<span class=\"hljs-property\">vpc_id</span>\n  subnet_cidr       = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">subnetsForvpc_B</span>[each.<span class=\"hljs-property\">key</span>][<span class=\"hljs-string\">\"subnet_cidr\"</span>]\n  subnet_name       = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">subnetsForvpc_B</span>[each.<span class=\"hljs-property\">key</span>][<span class=\"hljs-string\">\"subnet_name\"</span>]\n  availability_zone = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">subnetsForvpc_B</span>[each.<span class=\"hljs-property\">key</span>][<span class=\"hljs-string\">\"availability_zone\"</span>]\n  owner_name        = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n  providers = {\n    aws = aws.<span class=\"hljs-property\">us_west</span>\n  }\n}\n</code></pre>\n<h2>ë‹¨ê³„ 3: ë³´ì•ˆ ê·¸ë£¹ ëª¨ë“ˆì„ ìƒì„±í•˜ê³  ê°€ì ¸ ì˜¤ê¸°</h2>\n<p>modules/security-groups/main.tf</p>\n<pre><code class=\"hljs language-js\">terraform {\n  required_providers {\n    aws = {\n      source                = <span class=\"hljs-string\">\"hashicorp/aws\"</span>\n      version               = <span class=\"hljs-string\">\"~> 5.0\"</span>\n      configuration_aliases = [aws.<span class=\"hljs-property\">us_west</span>]\n    }\n  }\n}\n\nprovider <span class=\"hljs-string\">\"aws\"</span> {\n  alias  = <span class=\"hljs-string\">\"us_west\"</span>\n  region = <span class=\"hljs-string\">\"us-west-1\"</span>\n}\n\nresource <span class=\"hljs-string\">\"aws_security_group\"</span> <span class=\"hljs-string\">\"allow_ssh\"</span> {\n  name        = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sg_name</span>\n  description = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sg_description</span>\n  vpc_id      = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">vpc_id</span>\n\n  ingress {\n    description = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">ingress_description</span>\n    from_port   = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">ingress_from_port</span>\n    to_port     = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">ingress_to_port</span>\n    protocol    = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">ingress_protocol</span>\n    cidr_blocks = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">ingress_cidr_blocks</span>\n  }\n\n  egress {\n    from_port   = <span class=\"hljs-string\">\"0\"</span>\n    to_port     = <span class=\"hljs-string\">\"0\"</span>\n    protocol    = <span class=\"hljs-string\">\"-1\"</span>\n    cidr_blocks = [<span class=\"hljs-string\">\"0.0.0.0/0\"</span>]\n  }\n\n  tags = {\n    <span class=\"hljs-title class_\">Name</span>       = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sg_name</span>\n    created_by = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n  }\n}\n</code></pre>\n<p>ë³´ì•ˆ ê·¸ë£¹ì„ ìœ„í•´, ì €ëŠ” main.tf íŒŒì¼ì—ì„œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¡œ ëª¨ë“ˆì„ ë‘ ë²ˆ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ë³´ì•ˆ ê·¸ë£¹ì€ EC2ë¡œ SSHë¥¼ í—ˆìš©í•˜ê³ , ë‘ ë²ˆì§¸ëŠ” EC2ì—ì„œ ICMP íŒ¨í‚·ì˜ íë¦„ì„ í—ˆìš©í•©ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"ssh_sg_vpcA\"</span> {\n  source              = <span class=\"hljs-string\">\"./modules/security-groups\"</span>\n  sg_name             = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"sg_name\"</span>]\n  sg_description      = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"sg_description\"</span>]\n  ingress_description = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"ingress_description\"</span>]\n  ingress_from_port   = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"ingress_from_port\"</span>]\n  ingress_to_port     = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"ingress_to_port\"</span>]\n  ingress_protocol    = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"ingress_protocol\"</span>]\n  ingress_cidr_blocks = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sg_cidr_blocks</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"ingress_cidr_blocks\"</span>]\n  owner_name          = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n  vpc_id              = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_A</span>.<span class=\"hljs-property\">vpc_id</span>\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"ssh_sg_vpcB\"</span> {\n  source              = <span class=\"hljs-string\">\"./modules/security-groups\"</span>\n  sg_name             = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"sg_name\"</span>]\n  sg_description      = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"sg_description\"</span>]\n  ingress_description = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"ingress_description\"</span>]\n  ingress_from_port   = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"ingress_from_port\"</span>]\n  ingress_to_port     = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"ingress_to_port\"</span>]\n  ingress_protocol    = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"ingress_protocol\"</span>]\n  ingress_cidr_blocks = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sg_cidr_blocks</span>[<span class=\"hljs-string\">\"ssh_sg\"</span>][<span class=\"hljs-string\">\"ingress_cidr_blocks\"</span>]\n  owner_name          = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n  vpc_id              = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_B</span>.<span class=\"hljs-property\">vpc_id</span>\n  providers = {\n    aws = aws.<span class=\"hljs-property\">us_west</span>\n  }\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"icmp_sg_vpcA\"</span> {\n  source              = <span class=\"hljs-string\">\"./modules/security-groups\"</span>\n  sg_name             = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"sg_name\"</span>]\n  sg_description      = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"sg_description\"</span>]\n  ingress_description = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"ingress_description\"</span>]\n  ingress_from_port   = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"ingress_from_port\"</span>]\n  ingress_to_port     = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"ingress_to_port\"</span>]\n  ingress_protocol    = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"ingress_protocol\"</span>]\n  ingress_cidr_blocks = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sg_cidr_blocks</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"ingress_cidr_blocks_for_vpcA\"</span>]\n  owner_name          = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n  vpc_id              = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_A</span>.<span class=\"hljs-property\">vpc_id</span>\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"icmp_sg_vpcB\"</span> {\n  source              = <span class=\"hljs-string\">\"./modules/security-groups\"</span>\n  sg_name             = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"sg_name\"</span>]\n  sg_description      = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"sg_description\"</span>]\n  ingress_description = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"ingress_description\"</span>]\n  ingress_from_port   = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"ingress_from_port\"</span>]\n  ingress_to_port     = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"ingress_to_port\"</span>]\n  ingress_protocol    = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sgs</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"ingress_protocol\"</span>]\n  ingress_cidr_blocks = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">sg_cidr_blocks</span>[<span class=\"hljs-string\">\"icmp_sg\"</span>][<span class=\"hljs-string\">\"ingress_cidr_blocks_for_vpcB\"</span>]\n  owner_name          = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n  vpc_id              = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_B</span>.<span class=\"hljs-property\">vpc_id</span>\n  providers = {\n    aws = aws.<span class=\"hljs-property\">us_west</span>\n  }\n}\n</code></pre>\n<h2>ë‹¨ê³„ 4: EC2ë¥¼ ìœ„í•œ ëª¨ë“ˆ ìƒì„± ë° ê°€ì ¸ì˜¤ê¸°</h2>\n<p>modules/ec2/main.tf</p>\n<pre><code class=\"hljs language-js\">terraform {\n  required_providers {\n    aws = {\n      source                = <span class=\"hljs-string\">\"hashicorp/aws\"</span>\n      version               = <span class=\"hljs-string\">\"~> 5.0\"</span>\n      configuration_aliases = [aws.<span class=\"hljs-property\">us_west</span>]\n    }\n  }\n}\n\nprovider <span class=\"hljs-string\">\"aws\"</span> {\n  alias  = <span class=\"hljs-string\">\"us_west\"</span>\n  region = <span class=\"hljs-string\">\"us-west-1\"</span>\n}\n\nresource <span class=\"hljs-string\">\"aws_instance\"</span> <span class=\"hljs-string\">\"my_ec2\"</span> {\n\n  ami                         = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">ami_id</span>\n  instance_type               = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">instance_type</span>\n  subnet_id                   = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">subnet_id</span>\n  associate_public_ip_address = <span class=\"hljs-literal\">true</span>\n  key_name                    = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">key_name</span>\n\n  tags = {\n    <span class=\"hljs-title class_\">Name</span>       = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">ec2_name</span>\n    created_by = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n  }\n}\n\nresource <span class=\"hljs-string\">\"aws_network_interface_sg_attachment\"</span> <span class=\"hljs-string\">\"ssh_sg_attachment\"</span> {\n  security_group_id    = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">ssh_sg_id</span>\n  network_interface_id = aws_instance.<span class=\"hljs-property\">my_ec2</span>.<span class=\"hljs-property\">primary_network_interface_id</span>\n}\n\nresource <span class=\"hljs-string\">\"aws_network_interface_sg_attachment\"</span> <span class=\"hljs-string\">\"icmp_sg_attachment\"</span> {\n  security_group_id    = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">icmp_sg_id</span>\n  network_interface_id = aws_instance.<span class=\"hljs-property\">my_ec2</span>.<span class=\"hljs-property\">primary_network_interface_id</span>\n}\n</code></pre>\n<p>ì´ì œ ëª¨ë“ˆì„ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ main.tf íŒŒì¼ì— ê°€ì ¸ì˜¤ê² ìŠµë‹ˆë‹¤.</p>\n<p>module \"ec2_vpcA\" {\nsource        = \"./modules/ec2\"\nsubnet_id     = module.subnetsForvpc_A[\"subnet1\"].subnet_id\nami_id        = var.ec2s[\"ec2_vpcA\"][\"ami_id\"]\ninstance_type = var.ec2s[\"ec2_vpcA\"][\"instance_type\"]\nec2_name      = var.ec2s[\"ec2_vpcA\"][\"ec2_name\"]\nkey_name      = var.ec2s[\"ec2_vpcA\"][\"key_name\"]\nssh_sg_id     = module.ssh_sg_vpcA.sg_id\nicmp_sg_id    = module.icmp_sg_vpcA.sg_id\nowner_name    = var.owner_name\n}</p>\n<p>module \"ec2_vpcB\" {\nsource        = \"./modules/ec2\"\nsubnet_id     = module.subnetsForvpc_B[\"subnet1\"].subnet_id\nami_id        = var.ec2s[\"ec2_vpcB\"][\"ami_id\"]\ninstance_type = var.ec2s[\"ec2_vpcB\"][\"instance_type\"]\nec2_name      = var.ec2s[\"ec2_vpcB\"][\"ec2_name\"]\nkey_name      = var.ec2s[\"ec2_vpcB\"][\"key_name\"]\nssh_sg_id     = module.ssh_sg_vpcB.sg_id\nicmp_sg_id    = module.icmp_sg_vpcB.sg_id\nowner_name    = var.owner_name\nproviders = {\naws = aws.us_west\n}\n}</p>\n<h2>Step 5: Create modules for Internet Gateways and importing them</h2>\n<p>modules/internet-gateways/main.tf</p>\n<p>terraform {\nrequired_providers {\naws = {\nsource                = \"hashicorp/aws\"\nversion               = \"~> 5.0\"\nconfiguration_aliases = [aws.us_west]\n}\n}\n}</p>\n<p>provider \"aws\" {\nalias  = \"us_west\"\nregion = \"us-west-1\"\n}</p>\n<p>resource \"aws_internet_gateway\" \"i_gw\" {\nvpc_id = var.vpc_id</p>\n<p>tags = {\nName       = var.igw_name\ncreated_by = var.owner_name\n}\n}</p>\n<p>ì´ì œ, í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ main.tf íŒŒì¼ì— ëª¨ë“ˆì„ ê°€ì ¸ì˜¤ê² ìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"igw_vpcA\"</span> {\n  source     = <span class=\"hljs-string\">\"./modules/internet-gateways\"</span>\n  vpc_id     = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_A</span>.<span class=\"hljs-property\">vpc_id</span>\n  igw_name   = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">igws</span>[<span class=\"hljs-string\">\"igw_vpcA\"</span>][<span class=\"hljs-string\">\"name\"</span>]\n  owner_name = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"igw_vpcB\"</span> {\n  source     = <span class=\"hljs-string\">\"./modules/internet-gateways\"</span>\n  vpc_id     = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_B</span>.<span class=\"hljs-property\">vpc_id</span>\n  igw_name   = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">igws</span>[<span class=\"hljs-string\">\"igw_vpcB\"</span>][<span class=\"hljs-string\">\"name\"</span>]\n  owner_name = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n  providers = {\n    aws = aws.<span class=\"hljs-property\">us_west</span>\n  }\n}\n</code></pre>\n<h2>ë‹¨ê³„ 6: VPC Peering, VPC Peering accepter, VPC Peering configureìš© ëª¨ë“ˆ ìƒì„± ë° ê°€ì ¸ì˜¤ê¸°</h2>\n<p>ëª¨ë“ˆ - VPC Peering (modules/vpc-peering/main.tf)</p>\n<pre><code class=\"hljs language-kotlin\">í…Œë¼í¼ {\n  í•„ìˆ˜_ì œê³µì {\n    aws = {\n      ì†ŒìŠ¤ = <span class=\"hljs-string\">\"hashicorp/aws\"</span>\n      ë²„ì „ = <span class=\"hljs-string\">\"~> 5.0\"</span>\n      êµ¬ì„±_ë³„ì¹­ = [aws.us_west]\n    }\n  }\n}\n\nì œê³µì <span class=\"hljs-string\">\"aws\"</span> {\n  ë³„ì¹­  = <span class=\"hljs-string\">\"us_west\"</span>\n  ì§€ì—­ = <span class=\"hljs-string\">\"us-west-1\"</span>\n}\n\në¦¬ì†ŒìŠ¤ <span class=\"hljs-string\">\"aws_vpc_peering_connection\"</span> <span class=\"hljs-string\">\"vpc_peering\"</span> {\n  peer_vpc_id = <span class=\"hljs-keyword\">var</span>.peer_vpc_id\n  vpc_id      = <span class=\"hljs-keyword\">var</span>.vpc_id\n  peer_region = <span class=\"hljs-string\">\"us-west-1\"</span>\n  tags = {\n    ì´ë¦„       = <span class=\"hljs-keyword\">var</span>.vpcpeer_name\n    ìƒì„±ì = <span class=\"hljs-keyword\">var</span>.owner_name\n  }\n}\n</code></pre>\n<p>ëª¨ë“ˆ â€” VPC í”¼ì–´ë§ ìˆ˜ë½ì (modules/vpc-peering-accepter/main.tf)</p>\n<pre><code class=\"hljs language-kotlin\">í…Œë¼í¼ {\n  í•„ìˆ˜_ì œê³µì {\n    aws = {\n      ì†ŒìŠ¤ = <span class=\"hljs-string\">\"hashicorp/aws\"</span>\n      ë²„ì „ = <span class=\"hljs-string\">\"~> 5.0\"</span>\n      êµ¬ì„±_ë³„ì¹­ = [aws.us_west]\n    }\n  }\n}\n\nì œê³µì <span class=\"hljs-string\">\"aws\"</span> {\n  ë³„ì¹­  = <span class=\"hljs-string\">\"us_west\"</span>\n  ì§€ì—­ = <span class=\"hljs-string\">\"us-west-1\"</span>\n}\n\në¦¬ì†ŒìŠ¤ <span class=\"hljs-string\">\"aws_vpc_peering_connection_accepter\"</span> <span class=\"hljs-string\">\"peer_vpc_AB\"</span> {\n  provider = aws.us_west\n\n  vpc_peering_connection_id = <span class=\"hljs-keyword\">var</span>.vpc_peering_id\n  auto_accept               = <span class=\"hljs-literal\">true</span>\n\n  tags = {\n    ìª½       = <span class=\"hljs-string\">\"ìˆ˜ë½ì\"</span>\n    ì†Œìœ ì_ì´ë¦„ = <span class=\"hljs-keyword\">var</span>.owner_name\n  }\n}\n</code></pre>\n<p>ëª¨ë“ˆ â€” VPC í”¼ì–´ë§ êµ¬ì„± (modules/vpc-peering-configure/main.tf)</p>\n<pre><code class=\"hljs language-js\">terraform {\n  required_providers {\n    aws = {\n      source                = <span class=\"hljs-string\">\"hashicorp/aws\"</span>\n      version               = <span class=\"hljs-string\">\"~> 5.0\"</span>\n      configuration_aliases = [aws.<span class=\"hljs-property\">us_west</span>]\n    }\n  }\n}\n\nprovider <span class=\"hljs-string\">\"aws\"</span> {\n  alias  = <span class=\"hljs-string\">\"us_west\"</span>\n  region = <span class=\"hljs-string\">\"us-west-1\"</span>\n}\n\nresource <span class=\"hljs-string\">\"aws_vpc_peering_connection_options\"</span> <span class=\"hljs-string\">\"vpc_peering_configure\"</span> {\n  vpc_peering_connection_id = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">vpc_peering_connection_id</span>\n}\n</code></pre>\n<p>ì´ì œ, ìœ„ì˜ ëª¨ë“  ëª¨ë“ˆì„ ë£¨íŠ¸ì˜ main.tf íŒŒì¼ë¡œ ê°€ì ¸ì˜¤ê² ìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"vpc_peering\"</span> {\n  source       = <span class=\"hljs-string\">\"./modules/vpc-peering\"</span>\n  peer_vpc_id  = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_B</span>.<span class=\"hljs-property\">vpc_id</span>\n  vpc_id       = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_A</span>.<span class=\"hljs-property\">vpc_id</span>\n  vpcpeer_name = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">vpcpeer_name</span>\n  owner_name   = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"vpc_peering_accepter\"</span> {\n  source         = <span class=\"hljs-string\">\"./modules/vpc-peering-accepter\"</span>\n  vpc_peering_id = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_peering</span>.<span class=\"hljs-property\">aws_vpc_peering_connection_id</span>\n  owner_name     = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">owner_name</span>\n  providers = {\n    aws = aws.<span class=\"hljs-property\">us_west</span>\n  }\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"vpc_peering_configureA\"</span> {\n  source                    = <span class=\"hljs-string\">\"./modules/vpc_peer_configure\"</span>\n  vpc_peering_connection_id = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_peering_accepter</span>.<span class=\"hljs-property\">aws_vpc_peering_connection_accepter</span>\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"vpc_peering_configureB\"</span> {\n  source                    = <span class=\"hljs-string\">\"./modules/vpc_peer_configure\"</span>\n  vpc_peering_connection_id = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_peering_accepter</span>.<span class=\"hljs-property\">aws_vpc_peering_connection_accepter</span>\n  providers = {\n    aws = aws.<span class=\"hljs-property\">us_west</span>\n  }\n}\n</code></pre>\n<h2>ë‹¨ê³„ 7: ë¼ìš°íŠ¸ í…Œì´ë¸”ì„ ìœ„í•œ ëª¨ë“ˆ ë§Œë“¤ê¸° ë° ê°€ì ¸ì˜¤ê¸°```</h2>\n<p>modules/route-tables/main.tf</p>\n<pre><code class=\"hljs language-js\">terraform {\n  required_providers {\n    aws = {\n      source                = <span class=\"hljs-string\">\"hashicorp/aws\"</span>\n      version               = <span class=\"hljs-string\">\"~> 5.0\"</span>\n      configuration_aliases = [aws.<span class=\"hljs-property\">us_west</span>]\n    }\n  }\n}\n\nprovider <span class=\"hljs-string\">\"aws\"</span> {\n  alias  = <span class=\"hljs-string\">\"us_west\"</span>\n  region = <span class=\"hljs-string\">\"us-west-1\"</span>\n}\n\nresource <span class=\"hljs-string\">\"aws_route\"</span> <span class=\"hljs-string\">\"route\"</span> {\n  route_table_id            = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">route_table_id</span>\n  destination_cidr_block    = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">destination_cidr_block</span>\n  gateway_id                = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">gateway_id</span> != <span class=\"hljs-string\">\"\"</span> ? <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">gateway_id</span> : <span class=\"hljs-literal\">null</span>\n  vpc_peering_connection_id = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">vpc_peering_connection_id</span> != <span class=\"hljs-string\">\"\"</span> ? <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">vpc_peering_connection_id</span> : <span class=\"hljs-literal\">null</span>\n}\n</code></pre>\n<p>ì´ì œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ main.tf íŒŒì¼ì— ëª¨ë“ˆì„ ê°€ì ¸ì™€ë³´ê² ìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"route_table_vpcA_pcgw\"</span> {\n  source                    = <span class=\"hljs-string\">\"./modules/route-table\"</span>\n  route_table_id            = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_A</span>.<span class=\"hljs-property\">default_route_table_id</span>\n  destination_cidr_block    = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">destination_cidr_blocks_for_routetable</span>[<span class=\"hljs-string\">\"for_route_vpcA\"</span>][<span class=\"hljs-string\">\"pcgw_cidr\"</span>]\n  vpc_peering_connection_id = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_peering</span>.<span class=\"hljs-property\">aws_vpc_peering_connection_id</span>\n  gateway_id                = <span class=\"hljs-string\">\"\"</span>\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"route_table_vpcB_pcgw\"</span> {\n  source                    = <span class=\"hljs-string\">\"./modules/route-table\"</span>\n  route_table_id            = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_B</span>.<span class=\"hljs-property\">default_route_table_id</span>\n  destination_cidr_block    = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">destination_cidr_blocks_for_routetable</span>[<span class=\"hljs-string\">\"for_route_vpcB\"</span>][<span class=\"hljs-string\">\"pcgw_cidr\"</span>]\n  vpc_peering_connection_id = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_peering</span>.<span class=\"hljs-property\">aws_vpc_peering_connection_id</span>\n  gateway_id                = <span class=\"hljs-string\">\"\"</span>\n  providers = {\n    aws = aws.<span class=\"hljs-property\">us_west</span>\n  }\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"route_table_vpcA_igw\"</span> {\n  source                    = <span class=\"hljs-string\">\"./modules/route-table\"</span>\n  route_table_id            = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_A</span>.<span class=\"hljs-property\">default_route_table_id</span>\n  destination_cidr_block    = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">destination_cidr_blocks_for_routetable</span>[<span class=\"hljs-string\">\"for_route_vpcA\"</span>][<span class=\"hljs-string\">\"igw_cidr\"</span>]\n  gateway_id                = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">igw_vpcA</span>.<span class=\"hljs-property\">igw_id</span>\n  vpc_peering_connection_id = <span class=\"hljs-string\">\"\"</span>\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"route_table_vpcB_igw\"</span> {\n  source                    = <span class=\"hljs-string\">\"./modules/route-table\"</span>\n  route_table_id            = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">vpc_B</span>.<span class=\"hljs-property\">default_route_table_id</span>\n  destination_cidr_block    = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">destination_cidr_blocks_for_routetable</span>[<span class=\"hljs-string\">\"for_route_vpcB\"</span>][<span class=\"hljs-string\">\"igw_cidr\"</span>]\n  gateway_id                = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">igw_vpcB</span>.<span class=\"hljs-property\">igw_id</span>\n  vpc_peering_connection_id = <span class=\"hljs-string\">\"\"</span>\n  providers = {\n    aws = aws.<span class=\"hljs-property\">us_west</span>\n  }\n}\n</code></pre>\n<h2>ë‹¨ê³„ 8: dev-env.tfvars íŒŒì¼ ì‘ì„±</h2>\n<p>variable.tfvars/dev-env.tfvars</p>\n<pre><code class=\"hljs language-js\">owner_name = <span class=\"hljs-string\">\"NIKUNJ\"</span>\n\nvpcs = {\n  <span class=\"hljs-string\">\"vpc_A\"</span> = {\n    vpc_name   = <span class=\"hljs-string\">\"vpc-us-east1\"</span>\n    cidr_block = <span class=\"hljs-string\">\"10.1.0.0/16\"</span>\n  }\n  <span class=\"hljs-string\">\"vpc_B\"</span> = {\n    vpc_name   = <span class=\"hljs-string\">\"vpc-us-west1\"</span>\n    cidr_block = <span class=\"hljs-string\">\"10.2.0.0/16\"</span>\n  }\n}\n\nvpc_Aì— ëŒ€í•œ ì„œë¸Œë„· ëª©ë¡ = {\n  <span class=\"hljs-string\">\"subnet1\"</span> = {\n    subnet_cidr       = <span class=\"hljs-string\">\"10.1.0.0/20\"</span>\n    subnet_name       = <span class=\"hljs-string\">\"subnet-us-east1a\"</span>\n    availability_zone = <span class=\"hljs-string\">\"us-east-1a\"</span>\n  }\n  <span class=\"hljs-string\">\"subnet2\"</span> = {\n    subnet_cidr       = <span class=\"hljs-string\">\"10.1.16.0/20\"</span>\n    subnet_name       = <span class=\"hljs-string\">\"subnet-us-east1b\"</span>\n    availability_zone = <span class=\"hljs-string\">\"us-east-1b\"</span>\n  }\n  <span class=\"hljs-string\">\"subnet3\"</span> = {\n    subnet_cidr       = <span class=\"hljs-string\">\"10.1.32.0/20\"</span>\n    subnet_name       = <span class=\"hljs-string\">\"subnet-us-east1c\"</span>\n    availability_zone = <span class=\"hljs-string\">\"us-east-1c\"</span>\n  }\n}\n\nvpc_Bì— ëŒ€í•œ ì„œë¸Œë„· ëª©ë¡ = {\n  <span class=\"hljs-string\">\"subnet1\"</span> = {\n    subnet_cidr       = <span class=\"hljs-string\">\"10.2.0.0/20\"</span>\n    subnet_name       = <span class=\"hljs-string\">\"subnet-us-west1a\"</span>\n    availability_zone = <span class=\"hljs-string\">\"us-west-1a\"</span>\n  }\n  <span class=\"hljs-string\">\"subnet2\"</span> = {\n    subnet_cidr       = <span class=\"hljs-string\">\"10.2.16.0/20\"</span>\n    subnet_name       = <span class=\"hljs-string\">\"subnet-us-west1b\"</span>\n    availability_zone = <span class=\"hljs-string\">\"us-west-1b\"</span>\n  }\n}\n\në³´ì•ˆ ê·¸ë£¹ ëª©ë¡ = {\n  <span class=\"hljs-string\">\"ssh_sg\"</span> = {\n    sg_name             = <span class=\"hljs-string\">\"allow_ssh\"</span>\n    sg_description      = <span class=\"hljs-string\">\"ë‚´ IPì—ì„œ SSH í—ˆìš©\"</span>\n    ingress_description = <span class=\"hljs-string\">\"ë‚´ IPë¥¼ ìœ„í•œ SSH\"</span>\n    ingress_from_port   = <span class=\"hljs-string\">\"22\"</span>\n    ingress_to_port     = <span class=\"hljs-string\">\"22\"</span>\n    ingress_protocol    = <span class=\"hljs-string\">\"tcp\"</span>\n  }\n  <span class=\"hljs-string\">\"icmp_sg\"</span> = {\n    sg_name             = <span class=\"hljs-string\">\"allow_ping_traffic\"</span>\n    sg_description      = <span class=\"hljs-string\">\"ë‚´ IPì—ì„œ ping í—ˆìš©\"</span>\n    ingress_description = <span class=\"hljs-string\">\"ë‚´ IPë¡œë¶€í„°ì˜ ping\"</span>\n    ingress_from_port   = <span class=\"hljs-string\">\"8\"</span>\n    ingress_to_port     = <span class=\"hljs-string\">\"0\"</span>\n    ingress_protocol    = <span class=\"hljs-string\">\"icmp\"</span>\n  }\n}\n\nsg_cidr_blocks = {\n  <span class=\"hljs-string\">\"ssh_sg\"</span> = {\n    ingress_cidr_blocks = [<span class=\"hljs-string\">\"12.34.56.78/32\"</span>] # ec2ë¡œì˜ <span class=\"hljs-variable constant_\">SSH</span>ê°€ í—ˆìš©ëœ <span class=\"hljs-variable constant_\">IP</span>ë¥¼ ì–¸ê¸‰\n  }\n  <span class=\"hljs-string\">\"icmp_sg\"</span> = {\n    ingress_cidr_blocks_for_vpcA = [<span class=\"hljs-string\">\"10.2.0.0/16\"</span>]\n    ingress_cidr_blocks_for_vpcB = [<span class=\"hljs-string\">\"10.1.0.0/16\"</span>]\n  }\n}\n\nec2 ëª©ë¡ = {\n  <span class=\"hljs-string\">\"ec2_vpcA\"</span> = {\n    ami_id        = <span class=\"hljs-string\">\"ami-0e8a34246278c21e4\"</span>\n    instance_type = <span class=\"hljs-string\">\"t2.micro\"</span>\n    ec2_name      = <span class=\"hljs-string\">\"ec2-us-east1\"</span>\n    key_name      = <span class=\"hljs-string\">\"us-east-1-demo\"</span>\n  }\n  <span class=\"hljs-string\">\"ec2_vpcB\"</span> = {\n    ami_id        = <span class=\"hljs-string\">\"ami-09ab9d570789dfdd4\"</span>\n    instance_type = <span class=\"hljs-string\">\"t2.micro\"</span>\n    ec2_name      = <span class=\"hljs-string\">\"ec2-us-west1\"</span>\n    key_name      = <span class=\"hljs-string\">\"us-west-1-demo\"</span>\n  }\n}\n\nì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ ëª©ë¡ = {\n  <span class=\"hljs-string\">\"igw_vpcA\"</span> = {\n    name = <span class=\"hljs-string\">\"igw_vpcA\"</span>\n  }\n  <span class=\"hljs-string\">\"igw_vpcB\"</span> = {\n    name = <span class=\"hljs-string\">\"igw_vpcB\"</span>\n  }\n}\n\n<span class=\"hljs-variable constant_\">VPC</span> í”¼ì–´ë§ ì´ë¦„ = <span class=\"hljs-string\">\"vpc_AB_peering\"</span>\n\nroute í…Œì´ë¸”ìš© ëŒ€ìƒ <span class=\"hljs-variable constant_\">CIDR</span> ë¸”ë¡ = {\n  <span class=\"hljs-string\">\"for_route_vpcA\"</span> = {\n    pcgw_cidr = <span class=\"hljs-string\">\"10.2.0.0/16\"</span>\n    igw_cidr  = <span class=\"hljs-string\">\"0.0.0.0/0\"</span>\n  }\n  <span class=\"hljs-string\">\"for_route_vpcB\"</span> = {\n    pcgw_cidr = <span class=\"hljs-string\">\"10.1.0.0/16\"</span>\n    igw_cidr  = <span class=\"hljs-string\">\"0.0.0.0/0\"</span>\n  }\n}\n</code></pre>\n<h2>ë‹¨ê³„ 9: ì‘ì—… ë””ë ‰í† ë¦¬ ì´ˆê¸°í™”</h2>\n<ul>\n<li>ì‘ì—… ë””ë ‰í† ë¦¬ì—ì„œ terraform init ëª…ë ¹ì„ ì‹¤í–‰í•˜ì„¸ìš”. ì´ ëª…ë ¹ì€ í•„ìš”í•œ ëª¨ë“  ê³µê¸‰ì ë° ëª¨ë“ˆì„ ë‹¤ìš´ë¡œë“œí•˜ê³  ë°±ì—”ë“œë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.</li>\n</ul>\n<h2>ë‹¨ê³„ 10: í…Œë¼í¼ ì‹¤í–‰ ê³„íš ìƒì„±</h2>\n<ul>\n<li>ì‘ì—… ë””ë ‰í† ë¦¬ì—ì„œ terraform plan ëª…ë ¹ì„ ì‹¤í–‰í•˜ì„¸ìš”. ì‹¤í–‰ ê³„íšì„ ì œê³µí•©ë‹ˆë‹¤.</li>\n</ul>\n<h2>ë‹¨ê³„ 11: terraform apply ì‹¤í–‰</h2>\n<ul>\n<li>ì‘ì—… ë””ë ‰í† ë¦¬ì—ì„œ terraform apply ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ AWSì— í•„ìš”í•œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë©ë‹ˆë‹¤.</li>\n</ul>\n<h2>ë‹¨ê³„ 12: ì—°ê²° í™•ì¸</h2>\n<ul>\n<li>SSHë¥¼ ì‚¬ìš©í•˜ì—¬ EC2 ì¸ìŠ¤í„´ìŠ¤ ì¤‘ í•˜ë‚˜ì— ì—°ê²°í•˜ê³  ë‹¤ë¥¸ EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ ì‚¬ì„¤ IPë¥¼ ì‚¬ìš©í•˜ì—¬ í•‘ì„ ë³´ëƒ…ë‹ˆë‹¤.</li>\n<li>ëª¨ë“  ê²ƒì´ ì˜ ë˜ì—ˆë‹¤ë©´ ICMP ë°ì´í„° íŒ¨í‚·ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.</li>\n</ul>\n<p>ì—¬ê¸°ê¹Œì§€ì…ë‹ˆë‹¤. ì´ì œ Terraformì„ ì‚¬ìš©í•˜ì—¬ AWS VPC í”¼ì–´ë§ ì—°ê²°ì„ ìƒì„±í•˜ëŠ” ë°©ë²•ì„ ë°°ì› ìŠµë‹ˆë‹¤. ì´ì œ ì—¬ëŸ¬ë¶„ì€ ì´ê²ƒì„ ì‚¬ìš©í•˜ê³  í•„ìš”ì— ë”°ë¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì „ì²´ ì½”ë“œëŠ” ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆì–´ìš”.</p>\n<p>ì´ ê°€ì´ë“œê°€ ë„ì›€ì´ ë˜ì—ˆë‹¤ë©´ ğŸ‘ ë²„íŠ¼ì„ í´ë¦­í•´ ì£¼ì„¸ìš”. ëŒ“ê¸€ë„ ììœ ë¡­ê²Œ ë‚¨ê²¨ì£¼ì„¸ìš”.</p>\n</body>\n</html>\n"},"__N_SSG":true}