{"pageProps":{"post":{"title":"NET 8에서 헬스 체크 구현하는 방법","description":"","date":"2024-06-23 22:01","slug":"2024-06-23-ImplementingHealthChecksinNET8","content":"\n<img src=\"/assets/img/2024-06-23-ImplementingHealthChecksinNET8_0.png\" />\n\nHealth checks are critical for monitoring the status of your applications and services. They offer a fast and automated method to ensure that your application's dependencies and components are functioning correctly.\n\nThis article will delve into how to implement health checks in a .NET 8 web application.\n\n## Why Health Checks in ASP.NET Applications?\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n헬스 체크는 애플리케이션 내에서 문제점을 사전에 식별할 수 있게 도와주어 사용자에 영향을 미치기 전에 그 문제를 해결할 수 있는 기회를 주는 중요한 도구입니다. 정기적으로 애플리케이션 구성 요소들의 건강 상태를 확인하는 것은 더욱 신뢰성이 높고 견고한 시스템을 유지할 수 있도록 도와줍니다.\n\nASP.NET 애플리케이션을 개발할 때, 이는 종종 데이터베이스, 파일 시스템, API 등과 같은 다양한 하위 시스템에 의존합니다. 가장 흔한 시나리오 중 하나는 데이터베이스에 대한 의존성입니다. 사실 거의 모든 애플리케이션은 데이터베이스와의 원활한 상호 작용을 필요로 하며 이는 핵심 시스템 구성 요소로 작용합니다. 그러나 기존의 애플리케이션 개발은 종종 이 부분을 간과하고 데이터베이스와의 연결이 끊어지는 경우 잠재적인 고장을 야기할 수 있습니다.\n\n예를 들어 애플리케이션이 데이터베이스에 의존하는 상황을 생각해봅시다. 다양한 이유로 데이터베이스에 대한 연결이 끊겨버리면 애플리케이션이 작동하지 않을 가능성이 높습니다. 이 상황은 헬스 체크가 왜 유용한지의 기본적인 예시이지만, 그들의 개발의 전체적인 범위를 충분히 이해하기에는 부족합니다. 따라서,\n\n## 데이터베이스 예제를 깊게 들어가 ASP.NET 헬스 체크가 어떻게 더 큰 규모에서 중요한지 살펴보겠습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n- 데이터베이스 연결을 설정하기 전에 데이터베이스의 가용성을 확인할 수 있다면 어떨까요?\n  — — 애플리케이션의 중요한 하위 시스템의 상태와 가용성을 사전에 확인할 수 있는 기능을 갖고 있다면 어떨까요? 데이터베이스 연결이 끊겨 갑작스럽게 애플리케이션 오류가 발생하는 대신, 가용성을 선행적으로 확인할 수 있다면 좋지 않을까요?\n- 데이터베이스 가용성 시나리오를 우아하게 처리할 수 있는 애플리케이션이 있다면 어떨까요?\n  — — 데이터베이스에 접속할 수 없는 상황에서 사용자 친화적인 메시지를 표시하는 기능을 애플리케이션이 갖고 있다면 어떨까요? 사용자들을 혼란스럽게 만드는 암호화된 오류 메시지가 아닌 중요 구성 요소의 가용성을 원활하게 전달할 수 있다면 사용자 경험이 향상되지 않을까요?\n- 가용하지 않을 때 대비해 대체 데이터베이스로 원활하게 전환할 수 있다면 어떨까요?\n  — — 주 데이터베이스가 가용하지 않을 경우 대비하여 대체 데이터베이스로 순조롭게 전환할 수 있는 유연성을 고려해보세요. 이는 애플리케이션의 연속성을 유지할 뿐만 아니라 사용자들이 최소한의 중단이 발생하도록 보장합니다.\n- 상태 확인에 따라 대체 환경으로 스위치할 로드 밸런서를 지시할 수 있다면 어떨까요?\n  — — 애플리케이션의 상태를 로드 밸런서에게 전달할 수 있는 능력을 상상해보세요. 데이터베이스가 없거나 다른 심각한 문제로 인해 애플리케이션이 건강하지 않다고 판단되면 로드 밸런서는 지능적으로 트래픽을 대체 환경으로 리디렉션하여 지속적인 서비스 가용성을 보장합니다.\n\nASP.NET Health Checks를 통해 다음을 수행할 수 있습니다:\n\n- 시스템의 건강 상태와 가용성을 평가합니다.\n- 다른 시스템에 애플리케이션의 건강 상태를 알리기 위한 엔드포인트를 생성합니다.\n- 다른 시스템의 건강 확인 엔드포인트를 사용합니다.\n\n이러한 건강 확인 기능은 느슨하게 연결된 애플리케이션이 종속되어 있는 시스템의 건강을 알아야 하는 마이크로서비스 환경을 위해 특별히 디자인되었습니다. 그러나 다양한 하위 시스템과 인프라에 의존하는 단일 애플리케이션에서도 유용합니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n# .Net 8에서 건강 점검을 구현하는 방법\n\n.NET 8에서 건강 점검 구성 방법을 두 가지로 보여드리겠습니다.\n\n# 섹션 1: 기본 건강 점검 설정\n\n이 섹션은 응용 프로그램의 건강 점검을 위한 기초를 구축하는 데 목적이 있습니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nNuGet 패키지 설치 필요\n다음 NuGet 패키지가 설치되어 있는지 확인하세요:\n\n1. Microsoft.Extensions.Diagnostics.HealthChecks\n\nHealth Checks 서비스 추가\nProgram.cs에 필요한 헬스 체크 서비스를 DI 컨테이너에 추가하세요:\nProgram.cs\n\n```js\nbuilder.Services.AddHealthChecks();\n\n//HealthCheck Middleware\napp.MapHealthChecks(\"/api/health\");\n```\n\n이것들을 .NET 8 웹 API에 추가한 후, 애플리케이션을 성공적으로 실행하세요. 브라우저를 사용해 다음 엔드포인트로 이동하세요:\nhttps://localhost:44333/swagger/feedbackservice/index.html\n웹 API의 상태를 확인하려면 다음으로 이동하세요:\nhttps://localhost:44333/api/health\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n엔드포인트를 호출한 뒤에 웹 API가 \"Healthy\"임을 확인할 수 있습니다.\n\n![이미지](/assets/img/2024-06-23-ImplementingHealthChecksinNET8_1.png)\n\n이 엔드포인트를 호출하면 웹 API가 \"Healthy\"로 표시되는 것을 확인해야 합니다. 현재 단계에서는 애플리케이션의 전체적인 건강을 보장하기 위해 기본 건강 점검이 설정되어 있지만 부속 시스템에 대한 구체적인 건강 점검은 아직 구현되지 않았음을 알립니다.\n\n# 섹션 2: 건강 점검으로 구현\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n고객님을 위한 개인화된 건강 체크를 통한 첨단 모니터링\n이 섹션에서는 .NET 8 웹 API의 중요 구성 요소를 모니터링하는 데 맞춤형 건강 체크를 구현하는 구체적인 예시를 살펴보겠습니다. 이러한 체크는 기본 설정을 뛰어넘어 응용 프로그램의 건강 상태에 대한 보다 상세하고 통찰력 있는 관점을 제공합니다.\n\n필요한 NuGet 패키지\n다음 NuGet 패키지가 설치되어 있는지 확인하세요:\n\n1. Microsoft.Extensions.Diagnostics.HealthChecks\n2. AspNetCore.HealthChecks.SqlServer\n3. AspNetCore.HealthChecks.UI\n4. AspNetCore.HealthChecks.UI.Client\n5. AspNetCore.HealthChecks.UI.InMemory.Storage\n6. AspNetCore.HealthChecks.Uris\n\n참고: 별도의 HealthCheck.cs 파일을 만들고 모든 건강 체크 구성을 구현했습니다.\n\n## a. 데이터베이스 건강 체크\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n데이터베이스 헬스 체크는 애플리케이션의 웰빙을 모니터링하는 중요한 측면입니다. 특히 데이터 저장 및 검색을 위해 데이터베이스를 사용하는 경우에는 더욱 중요합니다. 이 헬스 체크는 데이터베이스가 연결 가능하고 쿼리에 응답할 수 있는지 확인합니다.\n\nHealthCheck.cs\n\n```csharp\npublic static void ConfigureHealthChecks(this IServiceCollection services, IConfiguration configuration)\n{\n    services.AddHealthChecks()\n        .AddSqlServer(configuration[\"ConnectionStrings:DefaultConnection\"], healthQuery: \"select 1\", name: \"SQL Server\", failureStatus: HealthStatus.Unhealthy, tags: new[] { \"Feedback\", \"Database\" });\n\n    //services.AddHealthChecksUI();\n    services.AddHealthChecksUI(opt =>\n    {\n        opt.SetEvaluationTimeInSeconds(10); //체크 간 시간(초)\n        opt.MaximumHistoryEntriesPerEndpoint(60); //체크 히스토리 최대\n        opt.SetApiMaxActiveRequests(1); //API 요청 동시성\n        opt.AddHealthCheckEndpoint(\"피드백 API\", \"/api/health\"); //헬스 체크 API 맵핑\n\n    })\n        .AddInMemoryStorage();\n}\n```\n\n`configuration[\"ConnectionStrings:DefaultConnection\"]`은 구성에서 연결 문자열을 검색하여 데이터베이스 연결 구성을 유연하게 설정할 수 있습니다.\n`failureStatus: HealthStatus.Unhealthy`는 헬스 체크 실패 시 전체 헬스 상태를 건강하지 않음으로 표시해야 함을 나타냅니다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n프로그램.cs에서 ConfigureHealthChecks()를 구성하세요.\n\n```js\n// Health Check 구성\nbuilder.Services.ConfigureHealthChecks(builder.Configuration);\n\n// Health Check 미들웨어\napp.MapHealthChecks(\"/api/health\", new HealthCheckOptions()\n{\n    Predicate = _ => true,\n    ResponseWriter = UIResponseWriter.WriteHealthCheckUIResponse\n});\napp.UseHealthChecksUI(delegate (Options options)\n{\n    options.UIPath = \"/healthcheck-ui\";\n    options.AddCustomStylesheet(\"./HealthCheck/Custom.css\");\n});\n```\n\n결과:\nEndpoint: /api/health\n\n<img src=\"/assets/img/2024-06-23-ImplementingHealthChecksinNET8_2.png\" />\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n엔드포인트: /healthcheck-ui\n\n![health-check-screenshot](/assets/img/2024-06-23-ImplementingHealthChecksinNET8_3.png)\n\n## b. 원격 엔드포인트의 건강 상태 확인\n\n다음으로, 원격 엔드포인트 및 메모리의 건강 상태를 확인하는 작업을 구현할 것입니다.\nRemoteHealthCheck.cs\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```csharp\nusing Microsoft.Extensions.Diagnostics.HealthChecks;\nusing System;\nusing System.Net.Http;\nusing System.Threading;\nusing System.Threading.Tasks;\n\nnamespace FeedbackService.Api\n{\n    public class RemoteHealthCheck : IHealthCheck\n    {\n        private readonly IHttpClientFactory _httpClientFactory;\n        public RemoteHealthCheck(IHttpClientFactory httpClientFactory)\n        {\n            _httpClientFactory = httpClientFactory;\n        }\n        public async Task<HealthCheckResult> CheckHealthAsync(HealthCheckContext context, CancellationToken cancellationToken = new CancellationToken())\n        {\n            using (var httpClient = _httpClientFactory.CreateClient())\n            {\n                var response = await httpClient.GetAsync(\"https://api.ipify.org\");\n                if (response.IsSuccessStatusCode)\n                {\n                    return HealthCheckResult.Healthy($\"Remote endpoint is healthy.\");\n                }\n\n                return HealthCheckResult.Unhealthy(\"Remote endpoint is unhealthy\");\n            }\n        }\n    }\n}\n```\n\n이 health check은 HTTP 요청을 통해 원격 엔드포인트(예: API)의 상태를 모니터링합니다.\n\n## b. 메모리 헬스 체크\n\n마지막으로 API 서비스의 메모리 상태를 모니터링하는 health check을 구현해 봅시다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nMemoryHealthCheck.cs\n\n```js\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Threading;\nusing System.Threading.Tasks;\nusing Microsoft.Extensions.Diagnostics.HealthChecks;\nusing Microsoft.Extensions.Options;\n\nnamespace FeedbackService.Api.HealthCheck\n{\n    public class MemoryHealthCheck : IHealthCheck\n    {\n        private readonly IOptionsMonitor<MemoryCheckOptions> _options;\n\n        public MemoryHealthCheck(IOptionsMonitor<MemoryCheckOptions> options)\n        {\n            _options = options;\n        }\n\n        public string Name => \"memory_check\";\n\n        public Task<HealthCheckResult> CheckHealthAsync(\n            HealthCheckContext context,\n            CancellationToken cancellationToken = default(CancellationToken))\n        {\n            var options = _options.Get(context.Registration.Name);\n\n            // Include GC information in the reported diagnostics.\n            var allocated = GC.GetTotalMemory(forceFullCollection: false);\n            var data = new Dictionary<string, object>()\n        {\n            { \"AllocatedBytes\", allocated },\n            { \"Gen0Collections\", GC.CollectionCount(0) },\n            { \"Gen1Collections\", GC.CollectionCount(1) },\n            { \"Gen2Collections\", GC.CollectionCount(2) },\n        };\n            var status = (allocated < options.Threshold) ? HealthStatus.Healthy : HealthStatus.Unhealthy;\n\n            return Task.FromResult(new HealthCheckResult(\n                status,\n                description: \"Reports degraded status if allocated bytes \" +\n                    $\">= {options.Threshold} bytes.\",\n                exception: null,\n                data: data));\n        }\n    }\n    public class MemoryCheckOptions\n    {\n        public string Memorystatus { get; set; }\n        //public int Threshold { get; set; }\n        // Failure threshold (in bytes)\n        public long Threshold { get; set; } = 1024L * 1024L * 1024L;\n    }\n}\n```\n\n이 Health Check은 Feedback Service의 메모리 상태를 할당된 바이트를 기반으로 평가합니다.\n\n이제 HealthCheck.cs 내부에서 RemoteHealthCheck.cs와 MemoryHealthCheck.cs를 구성합시다.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nHealthCheck.cs\n\n```js\npublic static void ConfigureHealthChecks(this IServiceCollection services, IConfiguration configuration)\n{\n    services.AddHealthChecks()\n        .AddSqlServer(configuration[\"ConnectionStrings:Feedback\"], healthQuery: \"select 1\", name: \"SQL 서버\", failureStatus: HealthStatus.Unhealthy, tags: new[] { \"Feedback\", \"Database\" })\n        .AddCheck<RemoteHealthCheck>(\"원격 엔드포인트 헬스체크\", failureStatus: HealthStatus.Unhealthy)\n        .AddCheck<MemoryHealthCheck>($\"피드백 서비스 메모리 체크\", failureStatus: HealthStatus.Unhealthy, tags: new[] { \"피드백 서비스\" })\n        .AddUrlGroup(new Uri(\"https://localhost:44333/api/v1/heartbeats/ping\"), name: \"기본 URL\", failureStatus: HealthStatus.Unhealthy);\n\n    //services.AddHealthChecksUI();\n    services.AddHealthChecksUI(opt =>\n    {\n        opt.SetEvaluationTimeInSeconds(10); // 각 체크 사이의 시간(초)\n        opt.MaximumHistoryEntriesPerEndpoint(60); // 체크 이력 최대 갯수\n        opt.SetApiMaxActiveRequests(1); // API 요청 동시성\n        opt.AddHealthCheckEndpoint(\"피드백 API\", \"/api/health\"); // 헬스체크 API 매핑\n\n    })\n        .AddInMemoryStorage();\n}\n```\n\n**출력:**\nEndpoint: /api/health\n\n![ImplementingHealthChecksin.NET8.4](/assets/img/2024-06-23-ImplementingHealthChecksinNET8_4.png)\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nEndpoint: /healthcheck-ui\n\n![Health Check](https://assets/img/2024-06-23-ImplementingHealthChecksinNET8_5.png)\n\n여기 있습니다! 웹 API 내에서 몇 가지 헬스 체크를 성공적으로 구현했습니다. 이러한 체크를 통해 응용 프로그램이 모니터링되고 웰빙이 보장되도록 할 수 있습니다. .NET 8의 헬스 체크의 힘으로 견고하고 견고한 응용 프로그램을 계속하여 만들어보세요! 😍\n\n![Resilient Applications](https://miro.medium.com/v2/resize:fit:996/1*ECmfhzVd4avHlD_B1-gocg.gif)\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n# 결론\n\n.NET 8 애플리케이션에 건강 점검을 구현하는 것은 탄탄하고 안정적인 시스템을 구축하기 위한 중요한 단계입니다. 내장 및 사용자 정의 건강 점검을 통해 응용 프로그램과 해당 종속성의 상태를 모니터링하여 더 원할한 사용자 경험을 제공할 수 있습니다.\n\n본 문서에서는 응용 프로그램에 건강 점검을 추가하는 기본 사항을 다루었으며, 고유한 요구에 맞춰 점검을 자세히 사용자 정의할 수 있습니다. 응용 프로그램을 계속 개발하는 과정에서 시스템 건강의 다양한 측면을 커버하기 위해 추가적인 점검 항목을 추가하는 것을 고려해 보세요. 정기적인 검토 및 업데이트를 통해 건강 점검을 유지하면 강력하고 반응 빠른 응용 프로그램을 유지할 수 있습니다.\n\n더 자세한 정보와 고급 구성에 대해서는 AspNetCore.Diagnostics.HealthChecks 저장소를 참조하십시오.\n\n<!-- ui-station 사각형 -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n저자: Jeslur Rahman 😍\n","ogImage":{"url":"/assets/img/2024-06-23-ImplementingHealthChecksinNET8_0.png"},"coverImage":"/assets/img/2024-06-23-ImplementingHealthChecksinNET8_0.png","tag":["Tech"],"readingTime":15},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<img src=\"/assets/img/2024-06-23-ImplementingHealthChecksinNET8_0.png\">\n<p>Health checks are critical for monitoring the status of your applications and services. They offer a fast and automated method to ensure that your application's dependencies and components are functioning correctly.</p>\n<p>This article will delve into how to implement health checks in a .NET 8 web application.</p>\n<h2>Why Health Checks in ASP.NET Applications?</h2>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>헬스 체크는 애플리케이션 내에서 문제점을 사전에 식별할 수 있게 도와주어 사용자에 영향을 미치기 전에 그 문제를 해결할 수 있는 기회를 주는 중요한 도구입니다. 정기적으로 애플리케이션 구성 요소들의 건강 상태를 확인하는 것은 더욱 신뢰성이 높고 견고한 시스템을 유지할 수 있도록 도와줍니다.</p>\n<p>ASP.NET 애플리케이션을 개발할 때, 이는 종종 데이터베이스, 파일 시스템, API 등과 같은 다양한 하위 시스템에 의존합니다. 가장 흔한 시나리오 중 하나는 데이터베이스에 대한 의존성입니다. 사실 거의 모든 애플리케이션은 데이터베이스와의 원활한 상호 작용을 필요로 하며 이는 핵심 시스템 구성 요소로 작용합니다. 그러나 기존의 애플리케이션 개발은 종종 이 부분을 간과하고 데이터베이스와의 연결이 끊어지는 경우 잠재적인 고장을 야기할 수 있습니다.</p>\n<p>예를 들어 애플리케이션이 데이터베이스에 의존하는 상황을 생각해봅시다. 다양한 이유로 데이터베이스에 대한 연결이 끊겨버리면 애플리케이션이 작동하지 않을 가능성이 높습니다. 이 상황은 헬스 체크가 왜 유용한지의 기본적인 예시이지만, 그들의 개발의 전체적인 범위를 충분히 이해하기에는 부족합니다. 따라서,</p>\n<h2>데이터베이스 예제를 깊게 들어가 ASP.NET 헬스 체크가 어떻게 더 큰 규모에서 중요한지 살펴보겠습니다.</h2>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<ul>\n<li>데이터베이스 연결을 설정하기 전에 데이터베이스의 가용성을 확인할 수 있다면 어떨까요?\n— — 애플리케이션의 중요한 하위 시스템의 상태와 가용성을 사전에 확인할 수 있는 기능을 갖고 있다면 어떨까요? 데이터베이스 연결이 끊겨 갑작스럽게 애플리케이션 오류가 발생하는 대신, 가용성을 선행적으로 확인할 수 있다면 좋지 않을까요?</li>\n<li>데이터베이스 가용성 시나리오를 우아하게 처리할 수 있는 애플리케이션이 있다면 어떨까요?\n— — 데이터베이스에 접속할 수 없는 상황에서 사용자 친화적인 메시지를 표시하는 기능을 애플리케이션이 갖고 있다면 어떨까요? 사용자들을 혼란스럽게 만드는 암호화된 오류 메시지가 아닌 중요 구성 요소의 가용성을 원활하게 전달할 수 있다면 사용자 경험이 향상되지 않을까요?</li>\n<li>가용하지 않을 때 대비해 대체 데이터베이스로 원활하게 전환할 수 있다면 어떨까요?\n— — 주 데이터베이스가 가용하지 않을 경우 대비하여 대체 데이터베이스로 순조롭게 전환할 수 있는 유연성을 고려해보세요. 이는 애플리케이션의 연속성을 유지할 뿐만 아니라 사용자들이 최소한의 중단이 발생하도록 보장합니다.</li>\n<li>상태 확인에 따라 대체 환경으로 스위치할 로드 밸런서를 지시할 수 있다면 어떨까요?\n— — 애플리케이션의 상태를 로드 밸런서에게 전달할 수 있는 능력을 상상해보세요. 데이터베이스가 없거나 다른 심각한 문제로 인해 애플리케이션이 건강하지 않다고 판단되면 로드 밸런서는 지능적으로 트래픽을 대체 환경으로 리디렉션하여 지속적인 서비스 가용성을 보장합니다.</li>\n</ul>\n<p>ASP.NET Health Checks를 통해 다음을 수행할 수 있습니다:</p>\n<ul>\n<li>시스템의 건강 상태와 가용성을 평가합니다.</li>\n<li>다른 시스템에 애플리케이션의 건강 상태를 알리기 위한 엔드포인트를 생성합니다.</li>\n<li>다른 시스템의 건강 확인 엔드포인트를 사용합니다.</li>\n</ul>\n<p>이러한 건강 확인 기능은 느슨하게 연결된 애플리케이션이 종속되어 있는 시스템의 건강을 알아야 하는 마이크로서비스 환경을 위해 특별히 디자인되었습니다. 그러나 다양한 하위 시스템과 인프라에 의존하는 단일 애플리케이션에서도 유용합니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h1>.Net 8에서 건강 점검을 구현하는 방법</h1>\n<p>.NET 8에서 건강 점검 구성 방법을 두 가지로 보여드리겠습니다.</p>\n<h1>섹션 1: 기본 건강 점검 설정</h1>\n<p>이 섹션은 응용 프로그램의 건강 점검을 위한 기초를 구축하는 데 목적이 있습니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>NuGet 패키지 설치 필요\n다음 NuGet 패키지가 설치되어 있는지 확인하세요:</p>\n<ol>\n<li>Microsoft.Extensions.Diagnostics.HealthChecks</li>\n</ol>\n<p>Health Checks 서비스 추가\nProgram.cs에 필요한 헬스 체크 서비스를 DI 컨테이너에 추가하세요:\nProgram.cs</p>\n<pre><code class=\"hljs language-js\">builder.<span class=\"hljs-property\">Services</span>.<span class=\"hljs-title class_\">AddHealthChecks</span>();\n\n<span class=\"hljs-comment\">//HealthCheck Middleware</span>\napp.<span class=\"hljs-title class_\">MapHealthChecks</span>(<span class=\"hljs-string\">\"/api/health\"</span>);\n</code></pre>\n<p>이것들을 .NET 8 웹 API에 추가한 후, 애플리케이션을 성공적으로 실행하세요. 브라우저를 사용해 다음 엔드포인트로 이동하세요:\n<a href=\"https://localhost:44333/swagger/feedbackservice/index.html\" rel=\"nofollow\" target=\"_blank\">https://localhost:44333/swagger/feedbackservice/index.html</a>\n웹 API의 상태를 확인하려면 다음으로 이동하세요:\n<a href=\"https://localhost:44333/api/health\" rel=\"nofollow\" target=\"_blank\">https://localhost:44333/api/health</a></p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>엔드포인트를 호출한 뒤에 웹 API가 \"Healthy\"임을 확인할 수 있습니다.</p>\n<p><img src=\"/assets/img/2024-06-23-ImplementingHealthChecksinNET8_1.png\" alt=\"이미지\"></p>\n<p>이 엔드포인트를 호출하면 웹 API가 \"Healthy\"로 표시되는 것을 확인해야 합니다. 현재 단계에서는 애플리케이션의 전체적인 건강을 보장하기 위해 기본 건강 점검이 설정되어 있지만 부속 시스템에 대한 구체적인 건강 점검은 아직 구현되지 않았음을 알립니다.</p>\n<h1>섹션 2: 건강 점검으로 구현</h1>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>고객님을 위한 개인화된 건강 체크를 통한 첨단 모니터링\n이 섹션에서는 .NET 8 웹 API의 중요 구성 요소를 모니터링하는 데 맞춤형 건강 체크를 구현하는 구체적인 예시를 살펴보겠습니다. 이러한 체크는 기본 설정을 뛰어넘어 응용 프로그램의 건강 상태에 대한 보다 상세하고 통찰력 있는 관점을 제공합니다.</p>\n<p>필요한 NuGet 패키지\n다음 NuGet 패키지가 설치되어 있는지 확인하세요:</p>\n<ol>\n<li>Microsoft.Extensions.Diagnostics.HealthChecks</li>\n<li>AspNetCore.HealthChecks.SqlServer</li>\n<li>AspNetCore.HealthChecks.UI</li>\n<li>AspNetCore.HealthChecks.UI.Client</li>\n<li>AspNetCore.HealthChecks.UI.InMemory.Storage</li>\n<li>AspNetCore.HealthChecks.Uris</li>\n</ol>\n<p>참고: 별도의 HealthCheck.cs 파일을 만들고 모든 건강 체크 구성을 구현했습니다.</p>\n<h2>a. 데이터베이스 건강 체크</h2>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>데이터베이스 헬스 체크는 애플리케이션의 웰빙을 모니터링하는 중요한 측면입니다. 특히 데이터 저장 및 검색을 위해 데이터베이스를 사용하는 경우에는 더욱 중요합니다. 이 헬스 체크는 데이터베이스가 연결 가능하고 쿼리에 응답할 수 있는지 확인합니다.</p>\n<p>HealthCheck.cs</p>\n<pre><code class=\"hljs language-csharp\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">ConfigureHealthChecks</span>(<span class=\"hljs-params\"><span class=\"hljs-keyword\">this</span> IServiceCollection services, IConfiguration configuration</span>)</span>\n{\n    services.AddHealthChecks()\n        .AddSqlServer(configuration[<span class=\"hljs-string\">\"ConnectionStrings:DefaultConnection\"</span>], healthQuery: <span class=\"hljs-string\">\"select 1\"</span>, name: <span class=\"hljs-string\">\"SQL Server\"</span>, failureStatus: HealthStatus.Unhealthy, tags: <span class=\"hljs-keyword\">new</span>[] { <span class=\"hljs-string\">\"Feedback\"</span>, <span class=\"hljs-string\">\"Database\"</span> });\n\n    <span class=\"hljs-comment\">//services.AddHealthChecksUI();</span>\n    services.AddHealthChecksUI(opt =>\n    {\n        opt.SetEvaluationTimeInSeconds(<span class=\"hljs-number\">10</span>); <span class=\"hljs-comment\">//체크 간 시간(초)</span>\n        opt.MaximumHistoryEntriesPerEndpoint(<span class=\"hljs-number\">60</span>); <span class=\"hljs-comment\">//체크 히스토리 최대</span>\n        opt.SetApiMaxActiveRequests(<span class=\"hljs-number\">1</span>); <span class=\"hljs-comment\">//API 요청 동시성</span>\n        opt.AddHealthCheckEndpoint(<span class=\"hljs-string\">\"피드백 API\"</span>, <span class=\"hljs-string\">\"/api/health\"</span>); <span class=\"hljs-comment\">//헬스 체크 API 맵핑</span>\n\n    })\n        .AddInMemoryStorage();\n}\n</code></pre>\n<p><code>configuration[\"ConnectionStrings:DefaultConnection\"]</code>은 구성에서 연결 문자열을 검색하여 데이터베이스 연결 구성을 유연하게 설정할 수 있습니다.\n<code>failureStatus: HealthStatus.Unhealthy</code>는 헬스 체크 실패 시 전체 헬스 상태를 건강하지 않음으로 표시해야 함을 나타냅니다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>프로그램.cs에서 ConfigureHealthChecks()를 구성하세요.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// Health Check 구성</span>\nbuilder.<span class=\"hljs-property\">Services</span>.<span class=\"hljs-title class_\">ConfigureHealthChecks</span>(builder.<span class=\"hljs-property\">Configuration</span>);\n\n<span class=\"hljs-comment\">// Health Check 미들웨어</span>\napp.<span class=\"hljs-title class_\">MapHealthChecks</span>(<span class=\"hljs-string\">\"/api/health\"</span>, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HealthCheckOptions</span>()\n{\n    <span class=\"hljs-title class_\">Predicate</span> = <span class=\"hljs-function\"><span class=\"hljs-params\">_</span> =></span> <span class=\"hljs-literal\">true</span>,\n    <span class=\"hljs-title class_\">ResponseWriter</span> = <span class=\"hljs-title class_\">UIResponseWriter</span>.<span class=\"hljs-property\">WriteHealthCheckUIResponse</span>\n});\napp.<span class=\"hljs-title class_\">UseHealthChecksUI</span>(delegate (<span class=\"hljs-title class_\">Options</span> options)\n{\n    options.<span class=\"hljs-property\">UIPath</span> = <span class=\"hljs-string\">\"/healthcheck-ui\"</span>;\n    options.<span class=\"hljs-title class_\">AddCustomStylesheet</span>(<span class=\"hljs-string\">\"./HealthCheck/Custom.css\"</span>);\n});\n</code></pre>\n<p>결과:\nEndpoint: /api/health</p>\n<img src=\"/assets/img/2024-06-23-ImplementingHealthChecksinNET8_2.png\">\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>엔드포인트: /healthcheck-ui</p>\n<p><img src=\"/assets/img/2024-06-23-ImplementingHealthChecksinNET8_3.png\" alt=\"health-check-screenshot\"></p>\n<h2>b. 원격 엔드포인트의 건강 상태 확인</h2>\n<p>다음으로, 원격 엔드포인트 및 메모리의 건강 상태를 확인하는 작업을 구현할 것입니다.\nRemoteHealthCheck.cs</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-csharp\"><span class=\"hljs-keyword\">using</span> Microsoft.Extensions.Diagnostics.HealthChecks;\n<span class=\"hljs-keyword\">using</span> System;\n<span class=\"hljs-keyword\">using</span> System.Net.Http;\n<span class=\"hljs-keyword\">using</span> System.Threading;\n<span class=\"hljs-keyword\">using</span> System.Threading.Tasks;\n\n<span class=\"hljs-keyword\">namespace</span> <span class=\"hljs-title\">FeedbackService.Api</span>\n{\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">RemoteHealthCheck</span> : <span class=\"hljs-title\">IHealthCheck</span>\n    {\n        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">readonly</span> IHttpClientFactory _httpClientFactory;\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">RemoteHealthCheck</span>(<span class=\"hljs-params\">IHttpClientFactory httpClientFactory</span>)</span>\n        {\n            _httpClientFactory = httpClientFactory;\n        }\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">async</span> Task&#x3C;HealthCheckResult> <span class=\"hljs-title\">CheckHealthAsync</span>(<span class=\"hljs-params\">HealthCheckContext context, CancellationToken cancellationToken = <span class=\"hljs-keyword\">new</span> CancellationToken(</span>))</span>\n        {\n            <span class=\"hljs-keyword\">using</span> (<span class=\"hljs-keyword\">var</span> httpClient = _httpClientFactory.CreateClient())\n            {\n                <span class=\"hljs-keyword\">var</span> response = <span class=\"hljs-keyword\">await</span> httpClient.GetAsync(<span class=\"hljs-string\">\"https://api.ipify.org\"</span>);\n                <span class=\"hljs-keyword\">if</span> (response.IsSuccessStatusCode)\n                {\n                    <span class=\"hljs-keyword\">return</span> HealthCheckResult.Healthy(<span class=\"hljs-string\">$\"Remote endpoint is healthy.\"</span>);\n                }\n\n                <span class=\"hljs-keyword\">return</span> HealthCheckResult.Unhealthy(<span class=\"hljs-string\">\"Remote endpoint is unhealthy\"</span>);\n            }\n        }\n    }\n}\n</code></pre>\n<p>이 health check은 HTTP 요청을 통해 원격 엔드포인트(예: API)의 상태를 모니터링합니다.</p>\n<h2>b. 메모리 헬스 체크</h2>\n<p>마지막으로 API 서비스의 메모리 상태를 모니터링하는 health check을 구현해 봅시다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>MemoryHealthCheck.cs</p>\n<pre><code class=\"hljs language-js\">using <span class=\"hljs-title class_\">System</span>;\nusing <span class=\"hljs-title class_\">System</span>.<span class=\"hljs-property\">Collections</span>.<span class=\"hljs-property\">Generic</span>;\nusing <span class=\"hljs-title class_\">System</span>.<span class=\"hljs-property\">Linq</span>;\nusing <span class=\"hljs-title class_\">System</span>.<span class=\"hljs-property\">Threading</span>;\nusing <span class=\"hljs-title class_\">System</span>.<span class=\"hljs-property\">Threading</span>.<span class=\"hljs-property\">Tasks</span>;\nusing <span class=\"hljs-title class_\">Microsoft</span>.<span class=\"hljs-property\">Extensions</span>.<span class=\"hljs-property\">Diagnostics</span>.<span class=\"hljs-property\">HealthChecks</span>;\nusing <span class=\"hljs-title class_\">Microsoft</span>.<span class=\"hljs-property\">Extensions</span>.<span class=\"hljs-property\">Options</span>;\n\nnamespace <span class=\"hljs-title class_\">FeedbackService</span>.<span class=\"hljs-property\">Api</span>.<span class=\"hljs-property\">HealthCheck</span>\n{\n    public <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MemoryHealthCheck</span> : <span class=\"hljs-title class_\">IHealthCheck</span>\n    {\n        private readonly <span class=\"hljs-title class_\">IOptionsMonitor</span>&#x3C;<span class=\"hljs-title class_\">MemoryCheckOptions</span>> _options;\n\n        public <span class=\"hljs-title class_\">MemoryHealthCheck</span>(<span class=\"hljs-title class_\">IOptionsMonitor</span>&#x3C;<span class=\"hljs-title class_\">MemoryCheckOptions</span>> options)\n        {\n            _options = options;\n        }\n\n        public string <span class=\"hljs-title class_\">Name</span> => <span class=\"hljs-string\">\"memory_check\"</span>;\n\n        public <span class=\"hljs-title class_\">Task</span>&#x3C;<span class=\"hljs-title class_\">HealthCheckResult</span>> <span class=\"hljs-title class_\">CheckHealthAsync</span>(\n            <span class=\"hljs-title class_\">HealthCheckContext</span> context,\n            <span class=\"hljs-title class_\">CancellationToken</span> cancellationToken = <span class=\"hljs-title function_\">default</span>(<span class=\"hljs-title class_\">CancellationToken</span>))\n        {\n            <span class=\"hljs-keyword\">var</span> options = _options.<span class=\"hljs-title class_\">Get</span>(context.<span class=\"hljs-property\">Registration</span>.<span class=\"hljs-property\">Name</span>);\n\n            <span class=\"hljs-comment\">// Include GC information in the reported diagnostics.</span>\n            <span class=\"hljs-keyword\">var</span> allocated = <span class=\"hljs-variable constant_\">GC</span>.<span class=\"hljs-title class_\">GetTotalMemory</span>(<span class=\"hljs-attr\">forceFullCollection</span>: <span class=\"hljs-literal\">false</span>);\n            <span class=\"hljs-keyword\">var</span> data = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Dictionary</span>&#x3C;string, object>()\n        {\n            { <span class=\"hljs-string\">\"AllocatedBytes\"</span>, allocated },\n            { <span class=\"hljs-string\">\"Gen0Collections\"</span>, <span class=\"hljs-variable constant_\">GC</span>.<span class=\"hljs-title class_\">CollectionCount</span>(<span class=\"hljs-number\">0</span>) },\n            { <span class=\"hljs-string\">\"Gen1Collections\"</span>, <span class=\"hljs-variable constant_\">GC</span>.<span class=\"hljs-title class_\">CollectionCount</span>(<span class=\"hljs-number\">1</span>) },\n            { <span class=\"hljs-string\">\"Gen2Collections\"</span>, <span class=\"hljs-variable constant_\">GC</span>.<span class=\"hljs-title class_\">CollectionCount</span>(<span class=\"hljs-number\">2</span>) },\n        };\n            <span class=\"hljs-keyword\">var</span> status = (allocated &#x3C; options.<span class=\"hljs-property\">Threshold</span>) ? <span class=\"hljs-title class_\">HealthStatus</span>.<span class=\"hljs-property\">Healthy</span> : <span class=\"hljs-title class_\">HealthStatus</span>.<span class=\"hljs-property\">Unhealthy</span>;\n\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Task</span>.<span class=\"hljs-title class_\">FromResult</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HealthCheckResult</span>(\n                status,\n                <span class=\"hljs-attr\">description</span>: <span class=\"hljs-string\">\"Reports degraded status if allocated bytes \"</span> +\n                    $<span class=\"hljs-string\">\">= {options.Threshold} bytes.\"</span>,\n                <span class=\"hljs-attr\">exception</span>: <span class=\"hljs-literal\">null</span>,\n                <span class=\"hljs-attr\">data</span>: data));\n        }\n    }\n    public <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MemoryCheckOptions</span>\n    {\n        public string <span class=\"hljs-title class_\">Memorystatus</span> { get; set; }\n        <span class=\"hljs-comment\">//public int Threshold { get; set; }</span>\n        <span class=\"hljs-comment\">// Failure threshold (in bytes)</span>\n        public long <span class=\"hljs-title class_\">Threshold</span> { get; set; } = 1024L * 1024L * 1024L;\n    }\n}\n</code></pre>\n<p>이 Health Check은 Feedback Service의 메모리 상태를 할당된 바이트를 기반으로 평가합니다.</p>\n<p>이제 HealthCheck.cs 내부에서 RemoteHealthCheck.cs와 MemoryHealthCheck.cs를 구성합시다.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>HealthCheck.cs</p>\n<pre><code class=\"hljs language-js\">public <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title class_\">ConfigureHealthChecks</span>(<span class=\"hljs-variable language_\">this</span> <span class=\"hljs-title class_\">IServiceCollection</span> services, <span class=\"hljs-title class_\">IConfiguration</span> configuration)\n{\n    services.<span class=\"hljs-title class_\">AddHealthChecks</span>()\n        .<span class=\"hljs-title class_\">AddSqlServer</span>(configuration[<span class=\"hljs-string\">\"ConnectionStrings:Feedback\"</span>], <span class=\"hljs-attr\">healthQuery</span>: <span class=\"hljs-string\">\"select 1\"</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">\"SQL 서버\"</span>, <span class=\"hljs-attr\">failureStatus</span>: <span class=\"hljs-title class_\">HealthStatus</span>.<span class=\"hljs-property\">Unhealthy</span>, <span class=\"hljs-attr\">tags</span>: <span class=\"hljs-keyword\">new</span>[] { <span class=\"hljs-string\">\"Feedback\"</span>, <span class=\"hljs-string\">\"Database\"</span> })\n        .<span class=\"hljs-property\">AddCheck</span>&#x3C;<span class=\"hljs-title class_\">RemoteHealthCheck</span>>(<span class=\"hljs-string\">\"원격 엔드포인트 헬스체크\"</span>, <span class=\"hljs-attr\">failureStatus</span>: <span class=\"hljs-title class_\">HealthStatus</span>.<span class=\"hljs-property\">Unhealthy</span>)\n        .<span class=\"hljs-property\">AddCheck</span>&#x3C;<span class=\"hljs-title class_\">MemoryHealthCheck</span>>($<span class=\"hljs-string\">\"피드백 서비스 메모리 체크\"</span>, <span class=\"hljs-attr\">failureStatus</span>: <span class=\"hljs-title class_\">HealthStatus</span>.<span class=\"hljs-property\">Unhealthy</span>, <span class=\"hljs-attr\">tags</span>: <span class=\"hljs-keyword\">new</span>[] { <span class=\"hljs-string\">\"피드백 서비스\"</span> })\n        .<span class=\"hljs-title class_\">AddUrlGroup</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Uri</span>(<span class=\"hljs-string\">\"https://localhost:44333/api/v1/heartbeats/ping\"</span>), <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">\"기본 URL\"</span>, <span class=\"hljs-attr\">failureStatus</span>: <span class=\"hljs-title class_\">HealthStatus</span>.<span class=\"hljs-property\">Unhealthy</span>);\n\n    <span class=\"hljs-comment\">//services.AddHealthChecksUI();</span>\n    services.<span class=\"hljs-title class_\">AddHealthChecksUI</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">opt</span> =></span>\n    {\n        opt.<span class=\"hljs-title class_\">SetEvaluationTimeInSeconds</span>(<span class=\"hljs-number\">10</span>); <span class=\"hljs-comment\">// 각 체크 사이의 시간(초)</span>\n        opt.<span class=\"hljs-title class_\">MaximumHistoryEntriesPerEndpoint</span>(<span class=\"hljs-number\">60</span>); <span class=\"hljs-comment\">// 체크 이력 최대 갯수</span>\n        opt.<span class=\"hljs-title class_\">SetApiMaxActiveRequests</span>(<span class=\"hljs-number\">1</span>); <span class=\"hljs-comment\">// API 요청 동시성</span>\n        opt.<span class=\"hljs-title class_\">AddHealthCheckEndpoint</span>(<span class=\"hljs-string\">\"피드백 API\"</span>, <span class=\"hljs-string\">\"/api/health\"</span>); <span class=\"hljs-comment\">// 헬스체크 API 매핑</span>\n\n    })\n        .<span class=\"hljs-title class_\">AddInMemoryStorage</span>();\n}\n</code></pre>\n<p><strong>출력:</strong>\nEndpoint: /api/health</p>\n<p><img src=\"/assets/img/2024-06-23-ImplementingHealthChecksinNET8_4.png\" alt=\"ImplementingHealthChecksin.NET8.4\"></p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>Endpoint: /healthcheck-ui</p>\n<p><img src=\"https://assets/img/2024-06-23-ImplementingHealthChecksinNET8_5.png\" alt=\"Health Check\"></p>\n<p>여기 있습니다! 웹 API 내에서 몇 가지 헬스 체크를 성공적으로 구현했습니다. 이러한 체크를 통해 응용 프로그램이 모니터링되고 웰빙이 보장되도록 할 수 있습니다. .NET 8의 헬스 체크의 힘으로 견고하고 견고한 응용 프로그램을 계속하여 만들어보세요! 😍</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:996/1*ECmfhzVd4avHlD_B1-gocg.gif\" alt=\"Resilient Applications\"></p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h1>결론</h1>\n<p>.NET 8 애플리케이션에 건강 점검을 구현하는 것은 탄탄하고 안정적인 시스템을 구축하기 위한 중요한 단계입니다. 내장 및 사용자 정의 건강 점검을 통해 응용 프로그램과 해당 종속성의 상태를 모니터링하여 더 원할한 사용자 경험을 제공할 수 있습니다.</p>\n<p>본 문서에서는 응용 프로그램에 건강 점검을 추가하는 기본 사항을 다루었으며, 고유한 요구에 맞춰 점검을 자세히 사용자 정의할 수 있습니다. 응용 프로그램을 계속 개발하는 과정에서 시스템 건강의 다양한 측면을 커버하기 위해 추가적인 점검 항목을 추가하는 것을 고려해 보세요. 정기적인 검토 및 업데이트를 통해 건강 점검을 유지하면 강력하고 반응 빠른 응용 프로그램을 유지할 수 있습니다.</p>\n<p>더 자세한 정보와 고급 구성에 대해서는 AspNetCore.Diagnostics.HealthChecks 저장소를 참조하십시오.</p>\n<!-- ui-station 사각형 -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>저자: Jeslur Rahman 😍</p>\n</body>\n</html>\n"},"__N_SSG":true}