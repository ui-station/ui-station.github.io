{"pageProps":{"post":{"title":"ë‚´ IaC AWS ë‹¤ì¤‘ ê³„ì • í”„ë¡œë¹„ì €ë‹ ë¸”ë£¨í”„ë¦°íŠ¸, ìµœê³ ì˜ ê´€í–‰","description":"","date":"2024-05-27 17:37","slug":"2024-05-27-MyIaCAWSMulti-AccountProvisioningBluePrintBestPractices","content":"\n## SSO ì‚¬ìš©ìì™€ í•¨ê»˜ Terraform ì‹¤í–‰ ì—­í• ì„ ê°€ì •í•˜ëŠ” ë°©ë²•.\n\nì´ ê¸°ì‚¬ì—ì„œëŠ” IaC (Terraform) í”„ë¡œì íŠ¸ì˜ êµ¬ì¡°ë¥¼ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ëŠ” ë³´í†µ ì—¬ê¸°ì €ê¸° í©ì–´ì ¸ ìˆëŠ” ê°’ íŒŒì¼ì´ í•„ìš”í•˜ì§€ ì•Šë„ë¡ êµ¬ì„±ë©ë‹ˆë‹¤. ë˜í•œ í•˜ë‚˜ì˜ êµ¬ì„± íŒŒì¼ë§Œìœ¼ë¡œ ëª¨ë“  í™˜ê²½ì„ ì œì–´í•˜ëŠ” ë°©ë²•ê³¼ í”Œë«í¼ê³¼ ì‘ìš©í”„ë¡œê·¸ë¨ ì¸í”„ë¼ ì½”ë“œë¥¼ ì–´ë–»ê²Œ ë¶„ë¦¬í•˜ëŠ”ì§€ë„ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n## ì´ ê¸°ì‚¬ì—ì„œ ë‹¤ë£¨ëŠ” ì£¼ì œë“¤:\n\n- ì—¬ëŸ¬ ê³„ì • ë°°í¬ ë„êµ¬ì˜ ìš°ìŠ¹ìì¸ Terragrunt\n- Terraform ë° Terragruntì˜ í˜‘ë ¥\n- ì‘ìš©í”„ë¡œê·¸ë¨ ì¸í”„ë¼ Terragrunt Main êµ¬ì„± íŒŒì¼ (Locals/Backend S3/AWS Provider)\n- Terraform ì‹¤í–‰ì„ ìœ„í•œ AWS Identity Center (SSO) ê¶Œí•œ ì§‘í•© (AWS í‚¤ì™€ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜êµ¬ì ì´ì§€ ì•ŠëŠ” ì—­í• ìœ¼ë¡œ ê°€ì •)\n- í”Œë«í¼ vs ì‘ìš©í”„ë¡œê·¸ë¨ ì¸í”„ë¼\n- í”Œë«í¼ ì¸í”„ë¼ Terragrunt Main êµ¬ì„± íŒŒì¼ (Locals/Backend S3/AWS Provider)\n- Terraform ì‹¤í–‰ ì—­í•  ìƒì„± (ì‘ìš©í”„ë¡œê·¸ë¨ ì¸í”„ë¼ ë°°í¬ë¥¼ ìœ„í•´) IAM ì•¡ì„¸ìŠ¤ Identity (SSO)ë¡œ í”„ë¡œë¹„ì €ë‹ëœ ì—­í• ì˜ ì‹ ë¢° ì •ì±…\n- ì•ˆì „í•˜ê²Œ SSO AWS ì„ì‹œ ìê²© ì¦ëª… êµ¬ì„±\n- AWS-VAULT\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n# í…Œë¼ê·¸ëŸ°íŠ¸\n\në‚´ ì˜ê²¬ìœ¼ë¡œ í…Œë¼ê·¸ëŸ°íŠ¸ëŠ” ì¸í”„ë¼ë¥¼ ìœ„í•œ ë‹¤ì¤‘ ê³„ì • ë°°í¬ êµ¬ì¡°í™”ì— ì‚¬ìš© ê°€ëŠ¥í•œ (ë‚´ê°€ ì•„ëŠ” í•œ) ìµœê³  ë„êµ¬ì…ë‹ˆë‹¤.\n\ní…Œë¼ê·¸ëŸ°íŠ¸ ë¬¸ì„œì— ë”°ë¥´ë©´ ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì¡°í™”í•˜ëŠ” ê²ƒì„ ì œì•ˆí•©ë‹ˆë‹¤:\n\n![í…Œë¼ê·¸ëŸ°íŠ¸ êµ¬ì¡°](/assets/img/2024-05-27-MyIaCAWSMulti-AccountProvisioningBluePrintBestPractices_0.png)\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nê·¸ëŸ¬ë‚˜ ì£¼ì˜í•´ì•¼ í•  ì ì€ terragruntë¥¼ ìì›ì„ ì¡°ì •í•˜ëŠ” ë° ê³¼ë„í•˜ê²Œ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.\n\nTerraformì€ ì—¬ëŸ¬ ëª¨ë“ˆì„ í•˜ë‚˜ë¡œ ë²ˆë“¤ë§í•˜ì—¬ ì‘ìš© í”„ë¡œê·¸ë¨ì´ë‚˜ í”Œë«í¼ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.\n\nTerragruntëŠ” ì´ë¯¸ í†µí•©ëœ Terraform ëª¨ë“ˆì„ ì„œë¡œ ë‹¤ë¥¸ í™˜ê²½ì— ë°°í¬í•˜ëŠ” ë°ë§Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.\n\n# ì‘ìš© í”„ë¡œê·¸ë¨ ëª¨ë“ˆì„ ìƒì„±í•˜ëŠ” ë° Terraformì„ ì‚¬ìš©í•˜ê³ , ë‹¤ë¥¸ í™˜ê²½ì— ë°°í¬í•˜ëŠ” ë° Terragruntë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë“ˆ(ì™¼ìª½)ì„ ë§Œë“¤ ë•Œ Terragruntë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆê³  í…Œë¼í¼ ìƒíƒœê°€ ì•± ë‹¨ìœ„ê°€ ì•„ë‹Œ êµ¬ì„± ìš”ì†Œ ë‹¨ìœ„ë¡œ ìƒì„±ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Terragruntë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë°°í¬(ì˜¤ë¥¸ìª½)ì—ë§Œ ì‚¬ìš©í•˜ì„¸ìš”.\n\nê³¼ê±°ì— ì €í¬ê°€ í•œ ì‹¤ìˆ˜ë¥¼ í”¼í•˜ê¸° ìœ„í•´ ì´ë ‡ê²Œ ë§ì”€ ë“œë¦¬ëŠ”ë°ìš”. ì €ëŠ” Terragrunt ë‚´ë¶€ì˜ ì»´í¬ë„ŒíŠ¸ì— ë„ˆë¬´ ë§ì´ ë‚˜ëˆ  ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸í”„ë¼ë¥¼ ë¶„ë¦¬í•˜ë©´ì„œ ê°œë³„ ë¦¬ì†ŒìŠ¤ë¥¼ ë” ì˜ ê´€ë¦¬í•˜ë ¤ê³  í–ˆì§€ë§Œ ë” ë§ì€ ë¬¸ì œë¥¼ ë°œìƒì‹œì¼°ìŠµë‹ˆë‹¤.\n\n# ì™œ ì´ëŸ° ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‚˜ìš”?\n\nì €ì˜ ëª‡ëª‡ í”„ë¡œì íŠ¸ ì¤‘ í•˜ë‚˜ì—ì„œ ì €ëŠ” Terragruntì—ì„œ Terraform ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¡œ ë‹¤ì¤‘ ê³„ì • ë°°í¬ ë°©ë²•ì„ ë³€ê²½í•˜ëŠ” ì‘ì—…ì„ ë§¡ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ ì„œë¡œ ë‹¤ë¥¸ AWS í™˜ê²½ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì¡°ì§ì˜ í‘œì¤€ ì ˆì°¨ì— ë§ì¶”ê¸° ìœ„í•œ ê²ƒì…ë‹ˆë‹¤.\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì´ í”„ë¡œì„¸ìŠ¤ëŠ” Terragruntê°€ ë‹¨ìˆœíˆ í…Œë¼í¼ ë˜í¼ì¼ ë¿ì´ê¸° ë•Œë¬¸ì— ë§¤ìš° ê°„ë‹¨í•  ìˆ˜ ìˆì—ˆì„ ê²ƒì…ë‹ˆë‹¤.\n\ní•˜ì§€ë§Œ ì•±ì„ êµ¬ì„± ìš”ì†Œë¡œ ë¶„í• í•˜ê³  ê·¸ êµ¬ì„± ìš”ì†Œê°€ ëª¨ë“ˆ ë‚´ì— ì¡´ì¬í•˜ë©´ ìƒíƒœ íŒŒì¼ì„ ë³‘í•©í•´ì•¼ í•˜ëŠ” ì•…ëª½ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nê·¸ë˜ì„œ Terragrunt í’‹í”„ë¦°íŠ¸ë¥¼ ìµœì†Œí™”í•˜ë ¤ë©´...\n\nT\nerraformì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‚˜ í”Œë«í¼ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•´ ì„œë¡œ ë‹¤ë¥¸ ëª¨ë“ˆì„ ë²ˆë“¤ë¡œ ë¬¶ì„ ê²ƒìœ¼ë¡œ ì˜ë„ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## ì˜ˆì‹œ: ìµœì†Œí•œì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸í”„ë¼ ë¦¬ì†ŒìŠ¤:\n\n```js\ndata \"aws_caller_identity\" \"current\" {}\n\nlocals {\n  aws_account_id = data.aws_caller_identity.current.account_id\n}\n\nmodule \"app_logs\" {\n  source = \"git::https://github.com/terraform-aws-modules/terraform-aws-dynamodb-table.git//\"\n  name         = \"${var.app_name}-logs\"\n  billing_mode = \"PAY_PER_REQUEST\"\n  hash_key     = \"organization\"\n  range_key    = \"job_id\"\n\n  server_side_encryption_enabled = true\n  deletion_protection_enabled    = false\n\n  attributes = [\n    {\n      name = \"organization\"\n      type = \"S\"\n    },\n    {\n      name = \"job_id\"\n      type = \"S\"\n    }\n  ]\n}\n\nmodule \"app_users\" {\n  source = \"git::https://github.com/terraform-aws-modules/terraform-aws-dynamodb-table.git//\"\n  # í•„ìš” ì‹œ ë‹¤ë¥¸ DynamoDB í…Œì´ë¸”ì„ ì—¬ê¸°ì— ì¶”ê°€\n}\n\nmodule \"lambda_execution_role\" {\n  source = \"../lambda-execution-role\"\n  aws_account_id = local.aws_account_id\n  app_name       = var.app_name\n  env            = var.env\n}\n\nmodule \"s3_bucket_files\" {\n  source = \"git::https://github.com/terraform-aws-modules/terraform-aws-s3-bucket.git//?ref=v3.6.1\"\n  bucket                  = var.env == \"production\" ? \"my-company-app-${var.app_name}-files\" : \"my-company-app-${var.app_name}-files-${var.env}\"\n  block_public_acls       = \"true\"\n  block_public_policy     = \"true\"\n  ignore_public_acls      = \"true\"\n  restrict_public_buckets = \"true\"\n}\n\nmodule \"another_s3_bucket_files\" {\n  source = \"git::https://github.com/terraform-aws-modules/terraform-aws-s3-bucket.git//?ref=v3.6.1\"\n  # í•„ìš” ì‹œ ë‹¤ë¥¸ S3 ë²„ì¼“ì„ ì—¬ê¸°ì— ì¶”ê°€\n}\n\n# SSM ParamsëŠ” ì„œë²„ë¦¬ìŠ¤ë‚˜ ë‹¤ë¥¸ ë„êµ¬ì— ê°’ë“¤ì„ ì „ë‹¬í•˜ëŠ” ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤.\nmodule \"ssm_params\" {\n  source = \"../ssm-parameters-store\"\n  parameters = {\n    1 = {\n      name  = \"/app/${var.app_name}/s3_bucket_files\"\n      value = module.s3_bucket_files.s3_bucket_id\n    }\n    2 = {\n      name  = \"/app/${var.app_name}/lambda_role\"\n      value = module.lambda_execution_role.role_arn\n    }\n    3 = {\n      name  = \"/app/${var.app_name}/event_bridge_name\"\n      value = \"${var.app_name}-event-bus\"\n    }\n    4 = {\n      name  = \"/app/${var.app_name}/logs\"\n      value = module.app_logs.dynamodb_table_id\n    }\n  }\n}\n```\n\nì´ ëª¨ë“ˆì—ì„œëŠ” ë‹¤ë¥¸ ëª¨ë“ˆì„ í˜¸ì¶œí•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ ì¢…ë¥˜ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤:\n\n- DynamoDB í…Œì´ë¸”\n- S3 ë²„ì¼“\n- IAM Lambda ì‹¤í–‰ ì—­í• \n- ì´ì „ì— ìƒì„±ëœ ë¦¬ì†ŒìŠ¤ì˜ ARN ë˜ëŠ” IDë¥¼ ë³´ê´€í•˜ëŠ” SSM ë§¤ê°œë³€ìˆ˜\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì—¬ê¸°ì„œ ë¹ ì§„ ê²ƒì€ ë‹¤ë¥¸ ê¸°ì‚¬ì—ì„œ ë³´ì—¬ì¤€ ê²ƒì²˜ëŸ¼ ë°±ì—”ë“œ S3 ë° AWS ì œê³µì êµ¬ì„±ì…ë‹ˆë‹¤... ì—¬ê¸°ì„œ Terragruntê°€ ë“±ì¥í•©ë‹ˆë‹¤...\n\n# í”Œë«í¼ ëŒ€ ì‘ìš© í”„ë¡œê·¸ë¨\n\nì´ëŸ¬í•œ ì—¼ë ¤ ì‚¬í•­ì˜ ë¶„ë¦¬ëŠ” ì„œë¡œ ë‹¤ë¥¸ GIT ì €ì¥ì†Œë¥¼ ê°€ì§€ê±°ë‚˜ ë‹¨ìˆœíˆ ë™ì¼í•œ Repo ë‚´ì—ì„œ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë¡œ ì·¨ê¸‰í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤... ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²ƒì€ ì‘ìš© í”„ë¡œê·¸ë¨ ì¸í”„ë¼ ì½”ë“œê°€ í”Œë«í¼ ì¸í”„ë¼ ì½”ë“œì— ì§ì ‘ì ì¸ ì¢…ì†ì„±ì„ í¬í•¨í•´ì„œëŠ” ì•ˆëœë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤... ë”°ë¼ì„œ ì´ê²ƒì€ ì‘ìš© í”„ë¡œê·¸ë¨ ì†ŒìŠ¤ ì½”ë“œ(BE/FE)ì™€ í•¨ê»˜ ì‰½ê²Œ ì¶”ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤...\n\ní•˜ì§€ë§Œ ìš°ë¦¬ëŠ” ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆì„ê¹Œìš”? ë¬´ì—‡ì„ í”Œë«í¼ ì¸í”„ë¼ì— ìœ„ì¹˜ì‹œí‚¤ê³  ì–´ë–¤ ê²ƒì„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸í”„ë¼ì— ìœ„ì¹˜ì‹œì¼œì•¼ í• ì§€ìš”?\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## í”Œë«í¼ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜:\n\ní”Œë«í¼ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ëŠ” ë³´ë‹¤ í¬ê´„ì ì´ë©° ì¡°ì§ ì „ì²´ì—ì„œ ì—¬ëŸ¬ ì‘ìš© í”„ë¡œê·¸ë¨ì„ ì§€ì›í•˜ëŠ” ê¸°ë³¸ êµ¬ì„± ìš”ì†Œì™€ ì„œë¹„ìŠ¤ë¥¼ ì§€ì¹­í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤:\n\n- CI/CDìš© IAM ì—­í• \n- Route53 í˜¸ìŠ¤íŒ… ì˜ì—­\n- ë„¤íŠ¸ì›Œí‚¹: VPC, ë°©í™”ë²½ ë° NATì™€ ê°™ì€ êµ¬ì„± ìš”ì†Œ\n- ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…: Prometheus, Grafana ë˜ëŠ” CloudWatchì™€ ê°™ì€ ìš”ì†Œ\n\n## ì‘ìš© í”„ë¡œê·¸ë¨ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜:\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì‘ìš© í”„ë¡œê·¸ë¨ ì¸í”„ë¼ëŠ” íŠ¹ì • ì‘ìš© í”„ë¡œê·¸ë¨ ë˜ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ ì„¸íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ë° í•„ìš”í•œ êµ¬ì„± ìš”ì†Œì™€ ë¦¬ì†ŒìŠ¤ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ì´ëŠ” ì¢…ì¢… ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤:\n\n- EC2 ì¸ìŠ¤í„´ìŠ¤, ëŒë‹¤ í•¨ìˆ˜\n- íŠ¸ëœì§“ ê²Œì´íŠ¸ì›¨ì´, ë¡œë“œ ë°¸ëŸ°ì„œ\n- ì•± ë°ì´í„°ë² ì´ìŠ¤: MySQL, PostgreSQL ë˜ëŠ” MongoDBì™€ ê°™ì€ ë°ì´í„°ë² ì´ìŠ¤\n- ë©”ì‹œì§€ ëŒ€ê¸°ì—´: SQS ë˜ëŠ” Kafkaì™€ ê°™ì€ ë©”ì‹œì§€ ëŒ€ê¸°ì—´\n\n## ì£¼ìš” í¬ì¸íŠ¸ëŠ” ê°œë³„ ì•±ì˜ ìš”êµ¬ ì‚¬í•­ì— ë§ì¶”ëŠ” ê²ƒì…ë‹ˆë‹¤.\n\nì˜ˆë¥¼ ë“¤ì–´ Serverless Frameworkë‚˜ AWS SAMì´ ìˆìŠµë‹ˆë‹¤.\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•´ì„œëŠ” í…Œë¼í¼ê³¼ ì„œë²„ë¦¬ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë©‹ì§„ ê°€ì´ë“œê°€ ìˆì–´ìš”.\n\n## í…Œë¼í¼ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë‹¤ë¥¸ ë„êµ¬ë¥¼ ì‚¬ìš©í•  ë•Œ, ì„œë²„ë¦¬ìŠ¤ í”„ë ˆì„ì›Œí¬ë‚˜ SAMê°™ì€:\n\n# ì• í”Œë¦¬ì¼€ì´ì…˜ IaCë¥¼ ìœ„í•œ Terragrunt\n\nâ€˜liveâ€˜ ë””ë ‰í† ë¦¬ ë‚´ì—ì„œ ë°°í¬í•  í™˜ê²½ì„ ì§€ì •í•˜ì„¸ìš”.\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n```js\nâ”œâ”€â”€ README.md\nâ”œâ”€â”€ live\nâ”‚   â”œâ”€â”€ _env\nâ”‚   â”‚   â””â”€â”€ app.hcl\nâ”‚   â”œâ”€â”€ dev\nâ”‚   â”‚   â””â”€â”€ app\nâ”‚   â”‚       â””â”€â”€ terragrunt.hcl <--- this is not a config file, but an environment resource file\nâ”‚   â”œâ”€â”€ production\nâ”‚   â”‚   â””â”€â”€ app\nâ”‚   â”‚       â””â”€â”€ terragrunt.hcl\nâ”‚   â”œâ”€â”€ terragrunt.hcl         <------ Terragrunt config file (Unique)\nâ”‚   â””â”€â”€ test\nâ”‚       â””â”€â”€ app\nâ”‚           â””â”€â”€ terragrunt.hcl\nâ””â”€â”€ modules\n    â”œâ”€â”€ lambda-execution-role\n    â”‚   â”œâ”€â”€ data.tf\n    â”‚   â”œâ”€â”€ main.tf\n    â”‚   â”œâ”€â”€ output.tf\n    â”‚   â””â”€â”€ variables.tf\n    â”œâ”€â”€ application_1\n    â”‚   â”œâ”€â”€ main.tf\n    â”‚   â””â”€â”€ variables.tf\n    â””â”€â”€ ssm-parameters-store\n        â”œâ”€â”€ main.tf\n        â””â”€â”€ variables.tf\n```\n\n# ìœ ì¼ë¬´ì´í•œ terragrunt.hcl ì„¤ì • íŒŒì¼\n\nì—¬ê¸°ì—ëŠ” í•˜ë‚˜ì˜ terragrunt.hcl êµ¬ì„± íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ë©€í‹° ê³„ì • ë°°í¬ë¥¼ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì´ ë‚˜ì™€ ìˆì–´ìš”.\n\ní…Œë¼í¼ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ êµ¬ì„±ê³¼ Terragrunt êµ¬ì„±ì„ ë¹„êµí•´ë³´ê² ìŠµë‹ˆë‹¤.\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\në¡œì»¬ ë³€ìˆ˜ ì •ì˜ëŠ” \"ê±°ì˜\" ê°™ì€ ìƒíƒœë¡œ ìœ ì§€ë˜ê³  ìˆìœ¼ë©°, Terragrunt Live ë””ë ‰í„°ë¦¬ë¥¼ ë‹¤ë¥¸ í™˜ê²½ì˜ ì´ë¦„ìœ¼ë¡œ êµ¬ì¡°í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤.\n\nAWS í™˜ê²½ ì´ë¦„ê³¼ ë””ë ‰í„°ë¦¬ ì´ë¦„ì´ ì¼ì¹˜í•˜ë¯€ë¡œ ê°„ë‹¨í•œ ì •ê·œ í‘œí˜„ì‹ìœ¼ë¡œ ì‹¤í–‰ ì‹œê°„ì— í™˜ê²½ ê°’ì„ ì¶”ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n## infrastructure/live/terragrunt.hcl\n\nì—¬ê¸°ì— ì™„ì „í•œ terragrunt.hcl íŒŒì¼ì´ ìˆìŠµë‹ˆë‹¤.\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nbackend.tfì™€ provider.tf ìƒì„±ê¸°ì—ì„œ \"profile\" ë§¤ê°œë³€ìˆ˜ë¥¼ ì£¼ëª©í•´ì£¼ì„¸ìš”. ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ì´ë“¤ì„ ì œê±°í•  ì˜ˆì •ì…ë‹ˆë‹¤.\n\n```js\nlocals {\n  # í™˜ê²½\n  env_regex = \"infrastructure/live/([a-zA-Z0-9-]+)/\"\n  aws_env   = try(regex(local.env_regex, get_original_terragrunt_dir())[0])\n  # ì–´í”Œë¦¬ì¼€ì´ì…˜\n  app_name = \"my-app\"\n  component = \"api\"\n\n  # AWS ì¡°ì§ ê³„ì •\n  account_mapping = {\n    dev             = 22222222222\n    test            = 111111111111\n    production      = 000000000000\n    shared-services = 555555555555\n  }\n  # ê°€ì •í•  IAM ì—­í• \n  account_role_name     = \"apps-terraform-execution-role\" # <--- ê°€ì •í•  ì—­í• \n  # ì§€ì—­ ë° ê°€ìš© ì˜ì—­\n  region = \"us-east-1\"\n}\nremote_state {\n  backend = \"s3\"\n  generate = {\n    path      = \"backend.tf\"\n    if_exists = \"overwrite_terragrunt\"\n  }\n  config = {\n    bucket         = \"terraform-state-shared-services\"\n    key            = \"${local.app_name}/${get_path_from_repo_root()}/terraform.tfstate\"\n    region         = local.region\n    profile        = \"shared-services\" #<----- AWS í”„ë¡œí•„\n    encrypt        = true\n    dynamodb_table = \"shared-services-lock-table\"\n  }\n}\ngenerate \"provider\" {\n  path      = \"provider.tf\"\n  if_exists = \"overwrite_terragrunt\"\n  contents  = <<-EOF\n    provider \"aws\" {\n      region = \"${local.region}\"\n      profile = \"shared-services\" #<----- AWS í”„ë¡œí•„\n      allowed_account_ids = [\n        \"${local.account_mapping[local.aws_env]}\"\n      ]\n      assume_role {\n        role_arn = \"arn:aws:iam::${local.account_mapping[local.aws_env]}:role/${local.account_role_name}\"\n      }\n      default_tags {\n        tags = {\n          Environment = \"${local.aws_env}\"\n          ManagedBy   = \"terraform\"\n          DeployedBy  = \"terragrunt\"\n          Creator     = \"${get_env(\"USER\", \"NOT_SET\")}\"\n          Application = \"${local.app_name}\"\n          Component   = \"${local.component}\"\n        }\n      }\n    }\nEOF\n}\n```\n\nTerragruntê°€ ìƒì„±ê¸°ì— ë³´ê°„ì„ í—ˆìš©í•˜ë¯€ë¡œ ëª¨ë“  ëŒ€ìƒ AWS ê³„ì •ì— ëŒ€í•´ ë§¤ê°œë³€ìˆ˜í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n## infrastructure/live/\\_env/app.hcl\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\ní…Œì´ë¸” íƒœê·¸ë¥¼ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”.\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## Terraform í”„ë¡œë¹„ì €ë‹ ì¸í”„ë¼ì— í•„ìš”í•œ ì—­í•  ì„¤ì •í•˜ê¸°\n\n```js\naccount_role_name     = \"apps-terraform-execution-role\" # <--- ì „í™˜í•  ì—­í• \n```\n\në˜í•œ ì´ì „ ê²Œì‹œë¬¼ì—ì„œ AWS ê³µìœ  ì„œë¹„ìŠ¤ ê³„ì •ì— terraform-multiaccount-role ë° ê° ì‘ì—… ë¶€í•˜ ê³„ì •(ê°œë°œ, í…ŒìŠ¤íŠ¸, í”„ë¡œë•ì…˜)ì— terraform-roleì„ ì„¤ì •í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤.\n\nê·¸ëŸ¬ë‚˜ ì´ ì„¤ì •ì€ í•˜ë‚˜ì˜ ì—”í„°í‹°(terraform-multiaccount-role)ê°€ ëª¨ë“  ê³„ì •ì—ì„œ terraform-roleì„ ê°€ì •(Assume)í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. ì´ëŠ” ê°œë°œíŒ€ì´ ìì²´ ì¸í”„ë¼ë¥¼ ê°œë°œ í™˜ê²½ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•˜ë ¤ëŠ” ê²½ìš°ì—ëŠ” í¸ë¦¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê°œë°œ íŒ€ì´ Dev ê³„ì •ì—ì„œë§Œ ì—­í• ì„ ì „í™˜í•  ìˆ˜ ìˆëŠ” ì—”í„°í‹°ì™€ Test ë° Productionì— ëŒ€í•œ ë‹¤ë¥¸ ì—”í„°í‹°ê°€ í•„ìš”í•©ë‹ˆë‹¤.\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## AWS Identity Center ìœ„ì„ëœ ê´€ë¦¬ì ê³„ì • ë° ê¶Œí•œ ì§‘í•©\n\nAWS ê³„ì •ì— ê¶Œí•œ ì§‘í•©ì„ ë§Œë“œëŠ” ë°©ë²• ë° ê¶Œí•œ ì§‘í•©ì„ AWS ê³„ì •ì— í• ë‹¹í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ë¬¸ì„œë¥¼ ë”°ë¥´ì„¸ìš”.\n\në‹¤ìŒê³¼ ê°™ì€ ê¶Œí•œ ì§‘í•©ì„ ë§Œë“¤ì–´ ë³´ì„¸ìš”: terraform-dev, terraform-test, terraform-production.\n\nê° ê¶Œí•œ ì§‘í•©ì— ëŒ€í•œ ëŒ€ìƒ ê³„ì •ì— ë‹¤ìŒê³¼ ê°™ì€ ë‚´ë¶€ ì •ì±…ì„ ë§Œë“œì„¸ìš”. í—ˆìš©í•˜ëŠ” ê¶Œí•œ ì§‘í•©(Identity ê³„ì •ì— ì„¤ì •ëœ)ì´ ê³µìœ  ì„œë¹„ìŠ¤ ê³„ì •ì— ë°°í¬ë˜ì–´ ë‹¤ìŒ ê³„ì •ì—ì„œ ì—­í• ì„ ê°€ì •í•  ìˆ˜ ìˆë„ë¡í•©ë‹ˆë‹¤:\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì´ë ‡ê²Œ ë³´ì´ëŠ” 3ê°€ì§€ ë‹¤ë¥¸ ê¶Œí•œ ì„¸íŠ¸ê°€ ìˆìŠµë‹ˆë‹¤:\n\n```js\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": \"sts:AssumeRole\",\n            \"Resource\": \"arn:aws:iam::000000000000:role/apps-terraform-execution-role\"\n        },\n        {\n            \"Sid\": \"Statement1\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n              \"s3:GetObject\",\n              \"s3:PutObject\",\n              \"s3:ListBucket\"\n            ],\n            \"Resource\": [\n                \"arn:aws:s3:::terraform-state-shared-services*\",\n                \"arn:aws:s3:::terraform-state-shared-services/*\"\n            ]\n        },\n        {\n            \"Sid\": \"Statement2\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n              \"dynamodb:GetItem\",\n              \"dynamodb:PutItem\",\n              \"dynamodb:DeleteItem\"\n            ],\n            \"Resource\": [\n                \"arn:aws:dynamodb:us-east-1:555555555555:table/shared-services-lock-table\"\n            ]\n        }\n    ]\n}\n```\n\nê° ì›Œí¬ë¡œë“œ ê³„ì •ì— apps-terraform-execution-roleì„ ë§Œë“¤ê³  SSO ì‚¬ìš©ìê°€ ì—­í• ì„ í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤.\n\nì°¸ê³ : \"terraform-production\"ì—ê²Œë„ Testì—ì„œ ì—­í• ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ ì •ì±…ì„ ì•½ê°„ ì¡°ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n# í”Œë«í¼ ì¸í”„ë¼ (IaC)\n\nìµœì†Œí•œì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•´ DNS, ë„¤íŠ¸ì›Œí‚¹ ë° ì‹ë³„ ê´€ë¦¬ ì—­í•  ë° ì •ì±…ê³¼ ê°™ì€ í”Œë«í¼ ë¦¬ì†ŒìŠ¤ë¥¼ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.\n\n```js\nâœ  live git:(main) âœ— tree\n.\nâ”œâ”€â”€ _env\nâ”‚   â”œâ”€â”€ route53-zones.hcl\nâ”‚   â””â”€â”€ iam-roles.hcl\nâ”œâ”€â”€ dev\nâ”‚   â”œâ”€â”€ iam-roles\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â”œâ”€â”€ route53-zones\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â””â”€â”€ platform\nâ”‚       â””â”€â”€ terragrunt.hcl\nâ”œâ”€â”€ network\nâ”‚   â”œâ”€â”€ dmz\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â”œâ”€â”€ network-egress\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â”œâ”€â”€ transitgateway-dmz-vpc-attachment\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â””â”€â”€ transitgateway-egress-vpc-attachment\nâ”‚       â”œâ”€â”€ mystate.tfstate\nâ”‚       â””â”€â”€ terragrunt.hcl\nâ”œâ”€â”€ production\nâ”‚   â”œâ”€â”€ iam-roles\nâ”‚   â”‚   â””â”€â”€ terragrunt.hcl\nâ”‚   â””â”€â”€ platform\nâ”‚       â””â”€â”€ terragrunt.hcl\nâ”œâ”€â”€ terragrunt.hcl\nâ””â”€â”€ test\n    â”œâ”€â”€ iam-roles\n    â”‚   â””â”€â”€ terragrunt.hcl\n    â”œâ”€â”€ route53-zones\n    â”‚   â””â”€â”€ terragrunt.hcl\n    â””â”€â”€ platform\n        â””â”€â”€ terragrunt.hcl\n```\n\n## ë¡œì»¬ ë³€ìˆ˜\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì—¬ëŸ¬ ê°œì˜ ê³„ì • ê°’ë“¤ì„ í•˜ë‚˜ì˜ ì¥ì†Œì—ì„œ ì¤‘ì•™í™”í•˜ëŠ” ë°©ë²•ì˜ ì˜ˆì‹œì…ë‹ˆë‹¤:\n\n```js\nlocals {\n  # í™˜ê²½ ë³€ìˆ˜\n  env_regex = \"infrastructure/live/([a-zA-Z0-9-]+)/\"\n  aws_env   = try(regex(local.env_regex, get_original_terragrunt_dir())[0])\n  # ì–´í”Œë¦¬ì¼€ì´ì…˜\n  app_name  = \"my-application-platform\"\n  component = \"platform\"\n  platform_apps = [\n    \"application_1\",\n    \"application_2\",\n    \"application_3\"\n  ]\n  # AWS ì¡°ì§ ê³„ì •\n  application_account_mapping = {\n    dev        = 222222222222\n    test       = 111111111111\n    production = 000000000000\n  }\n  platform_account_mapping = {\n    shared-services = 555555555555\n    network         = \"666666666666\"\n    dns             = 888888888888\n  }\n  account_mapping = merge(local.application_account_mapping, local.platform_account_mapping)\n\n  # ê°€ì •í•  IAM ì—­í• \n  account_role_name     = \"terraform-role\"\n  multiaccount_role_arn = \"arn:aws:iam::555555555555:role/terraform-multiaccount-role\" # shared-services\n\n  terraform_execution_role_mapping = {\n    dev = \"arn:aws:iam::555555555555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_terraform-dev_ab1\"\n    test = \"arn:aws:iam::555555555555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_terraform-test_ab2\"\n    production = \"arn:aws:iam::555555555555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_terraform-production_ab3\"\n  }\n\n  # ê¸°íƒ€ í”Œë«í¼ êµ¬ì„± ê°’ë“¤\n  # ===================================\n  # DNS\n  main_public_dns_zone_name     = \"example.com\"\n  env_public_dns_zone_subdomain = \"${local.aws_env}\"\n  environment_hosted_zone_name  = \"${local.env_public_dns_zone_subdomain}.${local.main_public_dns_zone_name}\"\n  acm_subject_alternative_names = [\n    \"${local.environment_hosted_zone_name}\",\n    \"*.${local.environment_hosted_zone_name}\",\n    \"*.api.${local.environment_hosted_zone_name}\",\n    \"*.myapps.${local.environment_hosted_zone_name}\",\n    \"*.apps.${local.environment_hosted_zone_name}\"\n  ]\n  # ì§€ì—­ ë° ê°€ìš© ì˜ì—­\n  region = \"us-east-1\"\n  azs = [\n    \"us-east-1a\",\n    \"us-east-1b\",\n    \"us-east-1c\"\n  ]\n  platform_accounts = {\n    dev = {\n      cidr = \"10.3.0.0/16\"\n      private_subnets = [\n        \"10.3.1.0/24\",\n        \"10.3.2.0/24\",\n        \"10.3.3.0/24\"\n      ]\n    }\n    test = {\n      cidr = \"10.2.0.0/16\"\n      private_subnets = [\n        \"10.2.1.0/24\",\n        \"10.2.2.0/24\",\n        \"10.2.3.0/24\"\n      ]\n    }\n    production = {\n      cidr = \"10.0.0.0/16\"\n      private_subnets = [\n        \"10.0.1.0/24\",\n        \"10.0.2.0/24\",\n        \"10.0.3.0/24\"\n      ]\n    }\n  }\n}\n```\n\n```js\ninclude \"root\" {\n  path = find_in_parent_folders()\n}\n\ninclude \"env\" {\n  path = \"../../_env/iam-roles.hcl\"\n}\n```\n\n```js\nlocals {\n  env_vars = read_terragrunt_config(find_in_parent_folders(\"terragrunt.hcl\"))\n  env      = local.env_vars.locals.aws_env\n}\n\nterraform {\n  source = \"../../../modules//platform/iam-roles\"\n}\n\ninputs = {\n  trusted_role_arns = [\n    local.env_vars.locals.terraform_execution_role_mapping[local.env]\n  ]\n}\n```\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n## infrastructure/modules/platform/iam-roles\n\n\"Iam:_\"ì— ëŒ€í•œ ë²”ìœ„ë¥¼ ì¢íˆê³  ìˆìŒì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤. ì´ëŠ” Terraformì´ ì‘ìš© í”„ë¡œê·¸ë¨ì„ ìœ„í•´ Role ë° ì •ì±…ì„ ìƒì„±, ì œê±° ë° ì—…ë°ì´íŠ¸í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— í•„ìš”í•œ ê¶Œí•œì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ê²½ìš° \":role/app/_\" ë‚´ì˜ Roles ë° Policiesë¡œ ë²”ìœ„ë¥¼ ì¢í ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```json\ndata \"aws_caller_identity\" \"current\" {}\nmodule \"app_terraform_execution_role\" {\n  source                            = \"../../iam-role\"\n  role_name                         = \"apps-terraform-execution-role\"\n  create_role                       = true\n  role_requires_mfa                 = var.role_requires_mfa\n  path                              = \"/\"\n  description                       = \"Terraform Execution role\"\n  trusted_role_arns                 = var.trusted_role_arns\n  number_of_custom_role_policy_arns = 1\n  policy = jsonencode(\n    {\n      \"Version\" : \"2012-10-17\",\n      \"Statement\" : [\n        {\n          \"Action\" : var.app_allowed_actions,\n          \"Effect\" : \"Allow\",\n          \"Resource\" : \"*\",\n          \"Condition\" : {\n            \"StringEquals\" : {\n              \"aws:RequestedRegion\" : \"us-east-1\"\n            }\n          }\n        },\n        {\n          \"Action\" : [\n            \"iam:*\"\n          ],\n          \"Effect\" : \"Allow\",\n          \"Resource\" : \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:role/app/*\"\n        }\n      ]\n  })\n}\n\nvariable \"app_allowed_actions\" {\n  default = [\n    \"cloudwatch:*\",\n    \"iam:List*\",\n    \"iam:Get*\",\n    \"iam:Describe*\",\n    \"logs:*\",\n    \"logs:ListTagsLogGroup\",\n    \"s3:*\",\n    \"secretsmanager:*\",\n    \"ses:*\",\n    \"sns:*\",\n    \"ssm:*\",\n    \"dynamodb:*\",\n    \"sts:*\",\n    \"route53:*\"\n  ]\n}\n```\n\n```json\nmodule \"iam_policy\" {\n  source      = \"git::https://github.com/terraform-aws-modules/terraform-aws-iam.git//modules/iam-policy\"\n  path        = var.path\n  name        = \"${var.role_name}-policy\"\n  description = var.description\n  policy      = var.policy\n}\n\nmodule \"iam_assumable_role\" {\n  source            = \"git::https://github.com/terraform-aws-modules/terraform-aws-iam.git//modules/iam-assumable-role\"\n  create_role       = var.create_role\n  role_name         = var.role_name\n  role_requires_mfa = var.role_requires_mfa\n  trusted_role_arns = var.trusted_role_arns\n  custom_role_policy_arns = [\n    module.iam_policy.arn\n  ]\n  number_of_custom_role_policy_arns = var.number_of_custom_role_policy_arns\n}\n```\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n# AWS ì¸ê°€: SSOë¥¼ ì‚¬ìš©í•  ì˜ˆì •ì´ë¯€ë¡œ ì¥ê¸°ì ìœ¼ë¡œ ìœ íš¨í•œ ìê²© ì¦ëª…ì´ í•„ìš”í•˜ì§€ ì•Šì•„ìš” ğŸ¥³\n\n# ë¡œì»¬ êµ¬ì„± í”„ë¡œíŒŒì¼ êµ¬ì„± (~/.aws/config)\n\n## í”Œë«í¼\n\nìš”ê¸° ëª»ìƒê¸´ ë‹­ê³¼ ê³„ë€ ë¬¸ì œê°€ ìˆëŠ”ë°... ê¹”ë”í•œ AWS ê³„ì •ì´ ìˆê³ , í”Œë«í¼ ì¸í”„ë¼ í”„ë¡œë¹„ì €ë‹ì— ê¶Œí•œì„ ë¶€ì—¬í•´ì•¼ í•´ìš”. ì´ê±´ IaCë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì–´ì„œ í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œì—ìš”.\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nAWS ì½˜ì†”ì´ë‚˜ CLIë¥¼ ì‚¬ìš©í•˜ì—¬ Terraform í”Œë«í¼ì— ëŒ€í•œ IAM ë˜ëŠ” IAM Identity Center ì‚¬ìš©ìë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì„¤ì •ì´ ì™„ë£Œë˜ë©´ IaCë¥¼ í”„ë¡œë¹„ì €ë‹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œë¹„ì €ë‹ì„ ìœ„í•œ ëª¨ë“  ì—­í• ê³¼ ì •ì±…(CICD ì¸¡ë©´ì„ ê³ ë ¤í•œ)ì€ í”Œë«í¼ IaCì—ì„œ ìƒì„±ë©ë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ì„ ìœ„í•œ ëª¨ë“  ì—­í• ê³¼ ì •ì±…(ì˜ˆ: ëŒë‹¤ ì‹¤í–‰ ì—­í• )ì€ ì‘ìš© í”„ë¡œê·¸ë¨ ì½”ë“œ ë‚´ì—ì„œ ìƒì„±ë©ë‹ˆë‹¤.\n\n```js\n[profile terraform-platform]\nsso_start_url=https://my-organization.awsapps.com/start\nsso_region=us-east-1\nsso_account_id=555555555555\nsso_role_name=PlatformTerraform\nregion=us-east-1\noutput=json\n```\n\n## ì‘ìš© í”„ë¡œê·¸ë¨ ë¦¬ì†ŒìŠ¤ (ê°œë°œìê°€ ì“°ê¸° ì•¡ì„¸ìŠ¤ë¥¼ ì–»ëŠ” ê³³)\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n<img src=\"/assets/img/2024-05-27-MyIaCAWSMulti-AccountProvisioningBluePrintBestPractices_1.png\" />\n\n```js\n[profile terraform]\nsso_start_url=https://my-organization.awsapps.com/start\nsso_region=us-east-1\nsso_account_id=555555555555\nsso_role_name=terraform-dev\nregion=us-east-1\noutput=json\n\n[profile terraform-test]\nsso_start_url=https://my-organization.awsapps.com/start\nsso_region=us-east-1\nsso_account_id=555555555555\nsso_role_name=terraform-test\nregion=us-east-1\noutput=json\n\n[profile terraform-production]\nsso_start_url=https://my-organization.awsapps.com/start\nsso_region=us-east-1\nsso_account_id=555555555555\nsso_role_name=terraform-production\nregion=us-east-1\noutput=json\n```\n\n# AWS Backend & Provider Config\n\nì–´ë¨¸ë¨¸... íœ´ìŠ¤í„´, ë¬¸ì œ ë°œìƒí–ˆì–´ìš”.... AWS ê³„ì • ë³„ë¡œ ë‹¤ë¥¸ ê¶Œí•œ ì„¸íŠ¸ê°€ ìˆì–´ìš”... ì´ì œ ë” ì´ìƒ `profile = shared-services`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ëë„¤ìš”.\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\ní˜¹ì‹œ ë§¤í•‘í• ê¹Œìš”? ì•„ë‹ˆë©´ í™˜ê²½ê³¼ ì ‘ë‘ì‚¬ë¥¼ ì¶”ê°€í• ê¹Œìš”?â€¦.\n\n```js\nremote_state {\n  backend = \"s3\"\n .....\n  }\n  config = {\n   ........\n\n    # ì—¬ê¸°ê°€ ë¬¸ì œì…ë‹ˆë‹¤\n    profile        = \"terraform\" # í˜¹ì€ \"terraform-test\" ë˜ëŠ” \"terraform-production\"\n  }\n}\n\ngenerate \"provider\" {\n  path      = \"provider.tf\"\n  if_exists = \"overwrite_terragrunt\"\n  contents  = <<-EOF\n    provider \"aws\" {\n      ...\n      ....\n      profile = \"terraform\" # í˜¹ì€ \"terraform-test\" ë˜ëŠ” \"terraform-production\"\n    }\nEOF\n}\n```\n\n## ì´ê²ƒì„ ì œê±°í•˜ê³  í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •í•©ì‹œë‹¤\n\n```js\nlocals {\n  # ENV\n  env_regex = \"infrastructure/live/([a-zA-Z0-9-]+)/\"\n  aws_env   = try(regex(local.env_regex, get_original_terragrunt_dir())[0])\n  # Application\n  app_name  = \"my-application-platform\"\n  component = \"platform\"\n  platform_apps = [\n    \"application_1\",\n    \"application_2\",\n    \"application_3\"\n  ]\n  # AWS Organizations Accounts\n  application_account_mapping = {\n    dev        = 222222222222\n    test       = 111111111111\n    production = 000000000000\n  }\n  platform_account_mapping = {\n    shared-services = 555555555555\n    network         = \"666666666666\"\n    dns             = 888888888888\n  }\n  account_mapping = merge(local.application_account_mapping, local.platform_account_mapping)\n\n  # IAM Roles to Assume\n  account_role_name     = \"terraform-role\"\n  multiaccount_role_arn = \"arn:aws:iam::555555555555:role/terraform-multiaccount-role\" # shared-services\n\n  terraform_execution_role_mapping = {\n    dev = \"arn:aws:iam::555555555555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_terraform-dev_ab1\"\n    test = \"arn:aws:iam::555555555555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_terraform-test_ab2\"\n    production = \"arn:aws:iam::555555555555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_terraform-production_ab3\"\n  }\n\n  # Other Platform Config Values Below\n  # ===================================\n  # DNS\n  main_public_dns_zone_name     = \"example.com\"\n  env_public_dns_zone_subdomain = \"${local.aws_env}\"\n  environment_hosted_zone_name  = \"${local.env_public_dns_zone_subdomain}.${local.main_public_dns_zone_name}\"\n  acm_subject_alternative_names = [\n    \"${local.environment_hosted_zone_name}\",\n    \"*.${local.environment_hosted_zone_name}\",\n    \"*.api.${local.environment_hosted_zone_name}\",\n    \"*.myapps.${local.environment_hosted_zone_name}\",\n    \"*.apps.${local.environment_hosted_zone_name}\"\n  ]\n  # Region and Zones\n  region = \"us-east-1\"\n  azs = [\n    \"us-east-1a\",\n    \"us-east-1b\",\n    \"us-east-1c\"\n  ]\n  platform_accounts = {\n    dev = {\n      cidr = \"10.3.0.0/16\"\n      private_subnets = [\n        \"10.3.1.0/24\",\n        \"10.3.2.0/24\",\n        \"10.3.3.0/24\"\n      ]\n    }\n    test = {\n      cidr = \"10.2.0.0/16\"\n      private_subnets = [\n        \"10.2.1.0/24\",\n        \"10.2.2.0/24\",\n        \"10.2.3.0/24\"\n      ]\n    }\n    production = {\n      cidr = \"10.0.0.0/16\"\n      private_subnets = [\n        \"10.0.1.0/24\",\n        \"10.0.2.0/24\",\n        \"10.0.3.0/24\"\n      ]\n    }\n  }\n}\nremote_state {\n  backend = \"s3\"\n  generate = {\n    path      = \"backend.tf\"\n    if_exists = \"overwrite_terragrunt\"\n  }\n  config = {\n    bucket         = \"terraform-state-shared-services\"\n    key            = \"${local.app_name}/${get_path_from_repo_root()}/terraform.tfstate\"\n    region         = local.region\n    encrypt        = true\n    dynamodb_table = \"shared-services-lock-table\"\n  }\n}\n\ngenerate \"provider\" {\n  path      = \"provider.tf\"\n  if_exists = \"overwrite_terragrunt\"\n  contents  = <<-EOF\n    provider \"aws\" {\n      region = \"${local.region}\"\n      allowed_account_ids = [\n        \"${local.account_mapping[local.aws_env]}\"\n      ]\n      assume_role {\n        role_arn = \"arn:aws:iam::${local.account_mapping[local.aws_env]}:role/${local.account_role_name}\"\n      }\n      default_tags {\n        tags = {\n          Environment = \"${local.aws_env}\"\n          ManagedBy   = \"terraform\"\n          DeployedBy  = \"terragrunt\"\n          Creator     = \"${get_env(\"USER\", \"NOT_SET\")}\"\n          Application = \"${local.app_name}\"\n          Component   = \"${local.component}\"\n        }\n      }\n    }\nEOF\n}\n```\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n# ë°°í¬\n\n## í”Œë«í¼\n\n```js\naws sso login --profile terraform-platform\nexport AWS_PROFILE=terraform-platform\n\n# ê°œë°œ\ncd infrastructure/live/dev/iam-roles\nterragrunt init\nterragrunt plan\nterragrunt apply\n\n# í…ŒìŠ¤íŠ¸\ncd infrastructure/live/test/iam-roles\nterragrunt init\nterragrunt plan\nterragrunt apply\n\n# í”„ë¡œë•ì…˜\ncd infrastructure/live/production/iam-roles\nterragrunt init\nterragrunt plan\nterragrunt apply\n```\n\n## ì–´í”Œë¦¬ì¼€ì´ì…˜\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nì—¬ê¸°ì„œëŠ” ë°©ê¸ˆ ë§Œë“  ìƒˆ ì—­í• ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.\n\n```js\n# ê°œë°œ\ncd infrastructure/live/dev/app\naws sso login --profile terraform-dev\nexport AWS_PROFILE=terraform-dev\nterragrunt init\nterragrunt plan\nterragrunt apply\n\n# í…ŒìŠ¤íŠ¸\ncd infrastructure/live/test/app\naws sso login --profile terraform-test\nexport AWS_PROFILE=terraform-test\nterragrunt init\nterragrunt plan\nterragrunt apply\n\n# í”„ë¡œë•ì…˜\ncd infrastructure/live/production/app\naws sso login --profile terraform-production\nexport AWS_PROFILE=terraform-production\nterragrunt init\nterragrunt plan\nterragrunt apply\n```\n\n# AWS Vault\n\nAWS Vaultì€ ê°œë°œ í™˜ê²½ì—ì„œ AWS ìê²© ì¦ëª…ì„ ì•ˆì „í•˜ê²Œ ì €ì¥í•˜ê³  ì•¡ì„¸ìŠ¤í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\nAWS Vaultì€ IAM ìê²© ì¦ëª…ì„ ì‚¬ìš©ìì˜ ìš´ì˜ ì²´ì œ ì•ˆì „í•œ í‚¤ ì €ì¥ì†Œì— ì €ì¥í•œ ë‹¤ìŒ í•´ë‹¹ ìê²© ì¦ëª…ì„ ì„ì‹œ ìê²© ì¦ëª…ìœ¼ë¡œ ìƒì„±í•˜ì—¬ ì‰˜ ë° ì‘ìš© í”„ë¡œê·¸ë¨ì— ë…¸ì¶œí•©ë‹ˆë‹¤. ì´ëŠ” AWS CLI ë„êµ¬ì™€ í•¨ê»˜ ë³´ì¡°ì ìœ¼ë¡œ ì‚¬ìš©ë˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìœ¼ë©° ~/.aws/configì— ìˆëŠ” í”„ë¡œí•„ê³¼ êµ¬ì„±ì„ ì¸ì‹í•©ë‹ˆë‹¤.\n\n```js\nbrew install --cask aws-vault\n```\n\n## ë”°ë¼ì„œ ì´ëŠ” ë°±ì—”ë“œ êµ¬ì„± ë° ê³µê¸‰ìì—ì„œ \"í”„ë¡œí•„\" ë§¤ê°œë³€ìˆ˜ë¥¼ ì œê±°í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.\n\n# AWS-Vaultë¡œ ë°°í¬í•˜ê¸°\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n# í”Œë«í¼\n\n```js\n# Dev\ncd infrastructure/live/dev/iam-roles\naws-vault exec terraform-platform terragrunt init\naws-vault exec terraform-platform terragrunt plan\naws-vault exec terraform-platform terragrunt apply\n\n# í…ŒìŠ¤íŠ¸\ncd infrastructure/live/test/iam-roles\naws-vault exec terraform-platform terragrunt init\naws-vault exec terraform-platform terragrunt plan\naws-vault exec terraform-platform terragrunt apply\n\n# í”„ë¡œë•ì…˜\ncd infrastructure/live/production/iam-roles\naws-vault exec terraform-platform terragrunt init\naws-vault exec terraform-platform terragrunt plan\naws-vault exec terraform-platform terragrunt apply\n```\n\n# ì• í”Œë¦¬ì¼€ì´ì…˜\n\n```js\ncd infrastructure/live/dev/app\naws-vault exec terraform-dev terragrunt init\naws-vault exec terraform-dev terragrunt plan\naws-vault exec terraform-dev terragrunt apply\n\ncd infrastructure/live/test/app\naws-vault exec terraform-test terragrunt init\naws-vault exec terraform-test terragrunt plan\naws-vault exec terraform-test terragrunt apply\n\ncd infrastructure/live/production/app\naws-vault exec terraform-production terragrunt init\naws-vault exec terraform-production terragrunt plan\naws-vault exec terraform-production terragrunt apply\n```\n\n<!-- ui-station ì‚¬ê°í˜• -->\n\n<ins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"></ins>\n\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n\n<img src=\"/assets/img/2024-05-27-MyIaCAWSMulti-AccountProvisioningBluePrintBestPractices_2.png\" />\n\n## ê²°ê³¼\n\n```js\n $ aws-vault exec terraform-production terragrunt apply\n\n\n\në°±ì—”ë“œ ì´ˆê¸°í™” ì¤‘...\n\në°±ì—”ë“œ \"s3\"ì´ ì„±ê³µì ìœ¼ë¡œ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ë°±ì—”ë“œ êµ¬ì„±ì´ ë³€ê²½ë˜ì§€ ì•ŠëŠ” í•œ Terraformì€\nìë™ìœ¼ë¡œì´ ë°±ì—”ë“œë¥¼ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.\nëª¨ë“ˆ ì´ˆê¸°í™” ì¤‘...\njobs_logs(ì„)ë¥¼ ìœ„í•´ git::https://github.com/terraform-aws-modules/terraform-aws-dynamodb-table.gitì„(ë¥¼) ë‹¤ìš´ë¡œë“œ ì¤‘...\n- .terraform/modules/logsì— jobs_logs\n- ../lambda-execution-roleì— lambda_execution_role\ns3_bucket_files(ì„)ë¥¼ ìœ„í•´ git::https://github.com/terraform-aws-modules/terraform-aws-s3-bucket.git?ref=v3.6.1ì„(ë¥¼) ë‹¤ìš´ë¡œë“œ ì¤‘...\n- .terraform/modules/s3_bucket_filesì— s3_bucket_files\n- ../ssm-parameters-storeì— ssm_params\n\nì œê³µì í”ŒëŸ¬ê·¸ì¸ ì´ˆê¸°í™” ì¤‘...\n- ì¢…ì†ì„± ì ê¸ˆ íŒŒì¼ì—ì„œ ì´ì „ ë²„ì „ì˜ hashicorp/aws ì¬ì‚¬ìš©\n- hashicorp/aws v5.23.1 ì„¤ì¹˜ ì¤‘...\n- hashicorp/aws v5.23.1 ì„¤ì¹˜ë¨ (HashiCorpì—ì„œ ì„œëª…ë¨)\n\nTerraformì´ ì„±ê³µì ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ì œ Terraformì„ ì‚¬ìš©í•˜ì—¬ ì‘ì—…ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. \"terraform plan\"ì„ ì‹¤í–‰í•˜ì—¬\nì¸í”„ë¼ì— í•„ìš”í•œ ëª¨ë“  ë³€ê²½ ì‚¬í•­ì„ í™•ì¸í•´ ë³´ì„¸ìš”. ì´ì œ ëª¨ë“  Terraform ëª…ë ¹ì´\nì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤.\n\nTerraformì„ ìœ„í•´ ëª¨ë“ˆì´ë‚˜ ë°±ì—”ë“œ êµ¬ì„±ì„ ì„¤ì • ë˜ëŠ” ë³€ê²½í•œ ê²½ìš°,\nì‘ì—… ë””ë ‰í„°ë¦¬ë¥¼ ë‹¤ì‹œ ì´ˆê¸°í™”í•˜ë ¤ë©´ì´ ëª…ë ¹ì„ ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”. ìŠì–´ ë²„ë¦° ê²½ìš°\në‹¤ë¥¸ ëª…ë ¹ì´ í•„ìš”í•œ ê²½ìš°ì´ë¥¼ ê°ì§€í•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•˜ë¼ëŠ” ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤.\nìƒíƒœ ì ê¸ˆ íšë“ ì¤‘. ì´ ì‘ì—…ì€ ëª‡ ë¶„ ì •ë„ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤...\nmodule.lambda_execution_role.data.aws_iam_policy_document.lambda_assume_role_policy: ì½ëŠ” ì¤‘...\nmodule.s3_bucket_files.data.aws_caller_identity.current: ì½ëŠ” ì¤‘...\nmodule.s3_bucket_files.data.aws_canonical_user_id.this: ì½ëŠ” ì¤‘...\ndata.aws_caller_identity.current: ì½ëŠ” ì¤‘...\nmodule.s3_bucket_files.aws_s3_bucket.this[0]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=my-company-myapp-files-dev]\nmodule.jobs_logs.aws_dynamodb_table.this[0]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=my-company-myapp-logs]\nmodule.lambda_execution_role.data.aws_iam_policy_document.lambda_assume_role_policy: 0ì´ˆ í›„ì— ì½ê¸° ì™„ë£Œ [id=000000000]\ndata.aws_caller_identity.current: 0ì´ˆ í›„ì— ì½ê¸° ì™„ë£Œ [id=000000000]\nmodule.lambda_execution_role.data.aws_iam_policy_document.inline_policy: ì½ëŠ” ì¤‘...\nmodule.s3_bucket_files.data.aws_caller_identity.current: 0ì´ˆ í›„ì— ì½ê¸° ì™„ë£Œ [id=000000000]\nmodule.lambda_execution_role.data.aws_iam_policy_document.inline_policy: 0ì´ˆ í›„ì— ì½ê¸° ì™„ë£Œ [id=000000000]\nmodule.lambda_execution_role.aws_iam_role.lambda_execution_role: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=my-company-myapp-lambda-execution-role]\nmodule.s3_bucket_files.data.aws_canonical_user_id.this: 1ì´ˆ í›„ì— ì½ê¸° ì™„ë£Œ [id=51528157cefbacf17d3cc90bf31e07f8f463cadfbf31739f6b264afac67fb2ce]\nmodule.s3_bucket_files.aws_s3_bucket_public_access_block.this[0]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=my-company-myapp-files-dev]\nmodule.ssm_params.aws_ssm_parameter.this[\"2\"]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=/app/myapp/lambda_role]\nmodule.ssm_params.aws_ssm_parameter.this[\"3\"]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=/app/myapp/event_bridge_name]\nmodule.ssm_params.aws_ssm_parameter.this[\"4\"]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=/app/myapp/logs]\nmodule.ssm_params.aws_ssm_parameter.this[\"1\"]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=/app/myapp/s3_bucket_files]\n\në³€ê²½ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤. ì¸í”„ë¼ê°€ êµ¬ì„±ê³¼ ì¼ì¹˜í•©ë‹ˆë‹¤.\n\nTerraformì€ ì‹¤ì œ ì¸í”„ë¼ë¥¼ êµ¬ì„±ê³¼ ë¹„êµí•˜ê³  ì°¨ì´ì ì„ ì°¾ì•˜ìœ¼ë©° ë³€ê²½ ì‚¬í•­ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nìƒíƒœ ì ê¸ˆ í•´ì œ ì¤‘. ì´ ì‘ì—…ì€ ëª‡ ë¶„ ì •ë„ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤...\n```\n\nì½ì–´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!\n","ogImage":{"url":"/assets/img/2024-05-27-MyIaCAWSMulti-AccountProvisioningBluePrintBestPractices_0.png"},"coverImage":"/assets/img/2024-05-27-MyIaCAWSMulti-AccountProvisioningBluePrintBestPractices_0.png","tag":["Tech"],"readingTime":35},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<h2>SSO ì‚¬ìš©ìì™€ í•¨ê»˜ Terraform ì‹¤í–‰ ì—­í• ì„ ê°€ì •í•˜ëŠ” ë°©ë²•.</h2>\n<p>ì´ ê¸°ì‚¬ì—ì„œëŠ” IaC (Terraform) í”„ë¡œì íŠ¸ì˜ êµ¬ì¡°ë¥¼ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ëŠ” ë³´í†µ ì—¬ê¸°ì €ê¸° í©ì–´ì ¸ ìˆëŠ” ê°’ íŒŒì¼ì´ í•„ìš”í•˜ì§€ ì•Šë„ë¡ êµ¬ì„±ë©ë‹ˆë‹¤. ë˜í•œ í•˜ë‚˜ì˜ êµ¬ì„± íŒŒì¼ë§Œìœ¼ë¡œ ëª¨ë“  í™˜ê²½ì„ ì œì–´í•˜ëŠ” ë°©ë²•ê³¼ í”Œë«í¼ê³¼ ì‘ìš©í”„ë¡œê·¸ë¨ ì¸í”„ë¼ ì½”ë“œë¥¼ ì–´ë–»ê²Œ ë¶„ë¦¬í•˜ëŠ”ì§€ë„ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>\n<h2>ì´ ê¸°ì‚¬ì—ì„œ ë‹¤ë£¨ëŠ” ì£¼ì œë“¤:</h2>\n<ul>\n<li>ì—¬ëŸ¬ ê³„ì • ë°°í¬ ë„êµ¬ì˜ ìš°ìŠ¹ìì¸ Terragrunt</li>\n<li>Terraform ë° Terragruntì˜ í˜‘ë ¥</li>\n<li>ì‘ìš©í”„ë¡œê·¸ë¨ ì¸í”„ë¼ Terragrunt Main êµ¬ì„± íŒŒì¼ (Locals/Backend S3/AWS Provider)</li>\n<li>Terraform ì‹¤í–‰ì„ ìœ„í•œ AWS Identity Center (SSO) ê¶Œí•œ ì§‘í•© (AWS í‚¤ì™€ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜êµ¬ì ì´ì§€ ì•ŠëŠ” ì—­í• ìœ¼ë¡œ ê°€ì •)</li>\n<li>í”Œë«í¼ vs ì‘ìš©í”„ë¡œê·¸ë¨ ì¸í”„ë¼</li>\n<li>í”Œë«í¼ ì¸í”„ë¼ Terragrunt Main êµ¬ì„± íŒŒì¼ (Locals/Backend S3/AWS Provider)</li>\n<li>Terraform ì‹¤í–‰ ì—­í•  ìƒì„± (ì‘ìš©í”„ë¡œê·¸ë¨ ì¸í”„ë¼ ë°°í¬ë¥¼ ìœ„í•´) IAM ì•¡ì„¸ìŠ¤ Identity (SSO)ë¡œ í”„ë¡œë¹„ì €ë‹ëœ ì—­í• ì˜ ì‹ ë¢° ì •ì±…</li>\n<li>ì•ˆì „í•˜ê²Œ SSO AWS ì„ì‹œ ìê²© ì¦ëª… êµ¬ì„±</li>\n<li>AWS-VAULT</li>\n</ul>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h1>í…Œë¼ê·¸ëŸ°íŠ¸</h1>\n<p>ë‚´ ì˜ê²¬ìœ¼ë¡œ í…Œë¼ê·¸ëŸ°íŠ¸ëŠ” ì¸í”„ë¼ë¥¼ ìœ„í•œ ë‹¤ì¤‘ ê³„ì • ë°°í¬ êµ¬ì¡°í™”ì— ì‚¬ìš© ê°€ëŠ¥í•œ (ë‚´ê°€ ì•„ëŠ” í•œ) ìµœê³  ë„êµ¬ì…ë‹ˆë‹¤.</p>\n<p>í…Œë¼ê·¸ëŸ°íŠ¸ ë¬¸ì„œì— ë”°ë¥´ë©´ ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì¡°í™”í•˜ëŠ” ê²ƒì„ ì œì•ˆí•©ë‹ˆë‹¤:</p>\n<p><img src=\"/assets/img/2024-05-27-MyIaCAWSMulti-AccountProvisioningBluePrintBestPractices_0.png\" alt=\"í…Œë¼ê·¸ëŸ°íŠ¸ êµ¬ì¡°\"></p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ê·¸ëŸ¬ë‚˜ ì£¼ì˜í•´ì•¼ í•  ì ì€ terragruntë¥¼ ìì›ì„ ì¡°ì •í•˜ëŠ” ë° ê³¼ë„í•˜ê²Œ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.</p>\n<p>Terraformì€ ì—¬ëŸ¬ ëª¨ë“ˆì„ í•˜ë‚˜ë¡œ ë²ˆë“¤ë§í•˜ì—¬ ì‘ìš© í”„ë¡œê·¸ë¨ì´ë‚˜ í”Œë«í¼ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.</p>\n<p>TerragruntëŠ” ì´ë¯¸ í†µí•©ëœ Terraform ëª¨ë“ˆì„ ì„œë¡œ ë‹¤ë¥¸ í™˜ê²½ì— ë°°í¬í•˜ëŠ” ë°ë§Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.</p>\n<h1>ì‘ìš© í”„ë¡œê·¸ë¨ ëª¨ë“ˆì„ ìƒì„±í•˜ëŠ” ë° Terraformì„ ì‚¬ìš©í•˜ê³ , ë‹¤ë¥¸ í™˜ê²½ì— ë°°í¬í•˜ëŠ” ë° Terragruntë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.</h1>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë“ˆ(ì™¼ìª½)ì„ ë§Œë“¤ ë•Œ Terragruntë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆê³  í…Œë¼í¼ ìƒíƒœê°€ ì•± ë‹¨ìœ„ê°€ ì•„ë‹Œ êµ¬ì„± ìš”ì†Œ ë‹¨ìœ„ë¡œ ìƒì„±ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Terragruntë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë°°í¬(ì˜¤ë¥¸ìª½)ì—ë§Œ ì‚¬ìš©í•˜ì„¸ìš”.</p>\n<p>ê³¼ê±°ì— ì €í¬ê°€ í•œ ì‹¤ìˆ˜ë¥¼ í”¼í•˜ê¸° ìœ„í•´ ì´ë ‡ê²Œ ë§ì”€ ë“œë¦¬ëŠ”ë°ìš”. ì €ëŠ” Terragrunt ë‚´ë¶€ì˜ ì»´í¬ë„ŒíŠ¸ì— ë„ˆë¬´ ë§ì´ ë‚˜ëˆ  ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸í”„ë¼ë¥¼ ë¶„ë¦¬í•˜ë©´ì„œ ê°œë³„ ë¦¬ì†ŒìŠ¤ë¥¼ ë” ì˜ ê´€ë¦¬í•˜ë ¤ê³  í–ˆì§€ë§Œ ë” ë§ì€ ë¬¸ì œë¥¼ ë°œìƒì‹œì¼°ìŠµë‹ˆë‹¤.</p>\n<h1>ì™œ ì´ëŸ° ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‚˜ìš”?</h1>\n<p>ì €ì˜ ëª‡ëª‡ í”„ë¡œì íŠ¸ ì¤‘ í•˜ë‚˜ì—ì„œ ì €ëŠ” Terragruntì—ì„œ Terraform ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¡œ ë‹¤ì¤‘ ê³„ì • ë°°í¬ ë°©ë²•ì„ ë³€ê²½í•˜ëŠ” ì‘ì—…ì„ ë§¡ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ ì„œë¡œ ë‹¤ë¥¸ AWS í™˜ê²½ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì¡°ì§ì˜ í‘œì¤€ ì ˆì°¨ì— ë§ì¶”ê¸° ìœ„í•œ ê²ƒì…ë‹ˆë‹¤.</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì´ í”„ë¡œì„¸ìŠ¤ëŠ” Terragruntê°€ ë‹¨ìˆœíˆ í…Œë¼í¼ ë˜í¼ì¼ ë¿ì´ê¸° ë•Œë¬¸ì— ë§¤ìš° ê°„ë‹¨í•  ìˆ˜ ìˆì—ˆì„ ê²ƒì…ë‹ˆë‹¤.</p>\n<p>í•˜ì§€ë§Œ ì•±ì„ êµ¬ì„± ìš”ì†Œë¡œ ë¶„í• í•˜ê³  ê·¸ êµ¬ì„± ìš”ì†Œê°€ ëª¨ë“ˆ ë‚´ì— ì¡´ì¬í•˜ë©´ ìƒíƒœ íŒŒì¼ì„ ë³‘í•©í•´ì•¼ í•˜ëŠ” ì•…ëª½ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ê·¸ë˜ì„œ Terragrunt í’‹í”„ë¦°íŠ¸ë¥¼ ìµœì†Œí™”í•˜ë ¤ë©´...</p>\n<p>T\nerraformì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‚˜ í”Œë«í¼ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•´ ì„œë¡œ ë‹¤ë¥¸ ëª¨ë“ˆì„ ë²ˆë“¤ë¡œ ë¬¶ì„ ê²ƒìœ¼ë¡œ ì˜ë„ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>ì˜ˆì‹œ: ìµœì†Œí•œì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸í”„ë¼ ë¦¬ì†ŒìŠ¤:</h2>\n<pre><code class=\"hljs language-js\">data <span class=\"hljs-string\">\"aws_caller_identity\"</span> <span class=\"hljs-string\">\"current\"</span> {}\n\nlocals {\n  aws_account_id = data.<span class=\"hljs-property\">aws_caller_identity</span>.<span class=\"hljs-property\">current</span>.<span class=\"hljs-property\">account_id</span>\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"app_logs\"</span> {\n  source = <span class=\"hljs-string\">\"git::https://github.com/terraform-aws-modules/terraform-aws-dynamodb-table.git//\"</span>\n  name         = <span class=\"hljs-string\">\"${var.app_name}-logs\"</span>\n  billing_mode = <span class=\"hljs-string\">\"PAY_PER_REQUEST\"</span>\n  hash_key     = <span class=\"hljs-string\">\"organization\"</span>\n  range_key    = <span class=\"hljs-string\">\"job_id\"</span>\n\n  server_side_encryption_enabled = <span class=\"hljs-literal\">true</span>\n  deletion_protection_enabled    = <span class=\"hljs-literal\">false</span>\n\n  attributes = [\n    {\n      name = <span class=\"hljs-string\">\"organization\"</span>\n      type = <span class=\"hljs-string\">\"S\"</span>\n    },\n    {\n      name = <span class=\"hljs-string\">\"job_id\"</span>\n      type = <span class=\"hljs-string\">\"S\"</span>\n    }\n  ]\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"app_users\"</span> {\n  source = <span class=\"hljs-string\">\"git::https://github.com/terraform-aws-modules/terraform-aws-dynamodb-table.git//\"</span>\n  # í•„ìš” ì‹œ ë‹¤ë¥¸ <span class=\"hljs-title class_\">DynamoDB</span> í…Œì´ë¸”ì„ ì—¬ê¸°ì— ì¶”ê°€\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"lambda_execution_role\"</span> {\n  source = <span class=\"hljs-string\">\"../lambda-execution-role\"</span>\n  aws_account_id = local.<span class=\"hljs-property\">aws_account_id</span>\n  app_name       = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">app_name</span>\n  env            = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">env</span>\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"s3_bucket_files\"</span> {\n  source = <span class=\"hljs-string\">\"git::https://github.com/terraform-aws-modules/terraform-aws-s3-bucket.git//?ref=v3.6.1\"</span>\n  bucket                  = <span class=\"hljs-keyword\">var</span>.<span class=\"hljs-property\">env</span> == <span class=\"hljs-string\">\"production\"</span> ? <span class=\"hljs-string\">\"my-company-app-${var.app_name}-files\"</span> : <span class=\"hljs-string\">\"my-company-app-${var.app_name}-files-${var.env}\"</span>\n  block_public_acls       = <span class=\"hljs-string\">\"true\"</span>\n  block_public_policy     = <span class=\"hljs-string\">\"true\"</span>\n  ignore_public_acls      = <span class=\"hljs-string\">\"true\"</span>\n  restrict_public_buckets = <span class=\"hljs-string\">\"true\"</span>\n}\n\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"another_s3_bucket_files\"</span> {\n  source = <span class=\"hljs-string\">\"git::https://github.com/terraform-aws-modules/terraform-aws-s3-bucket.git//?ref=v3.6.1\"</span>\n  # í•„ìš” ì‹œ ë‹¤ë¥¸ <span class=\"hljs-variable constant_\">S3</span> ë²„ì¼“ì„ ì—¬ê¸°ì— ì¶”ê°€\n}\n\n# <span class=\"hljs-variable constant_\">SSM</span> <span class=\"hljs-title class_\">Params</span>ëŠ” ì„œë²„ë¦¬ìŠ¤ë‚˜ ë‹¤ë¥¸ ë„êµ¬ì— ê°’ë“¤ì„ ì „ë‹¬í•˜ëŠ” ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤.\n<span class=\"hljs-variable language_\">module</span> <span class=\"hljs-string\">\"ssm_params\"</span> {\n  source = <span class=\"hljs-string\">\"../ssm-parameters-store\"</span>\n  parameters = {\n    <span class=\"hljs-number\">1</span> = {\n      name  = <span class=\"hljs-string\">\"/app/${var.app_name}/s3_bucket_files\"</span>\n      value = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">s3_bucket_files</span>.<span class=\"hljs-property\">s3_bucket_id</span>\n    }\n    <span class=\"hljs-number\">2</span> = {\n      name  = <span class=\"hljs-string\">\"/app/${var.app_name}/lambda_role\"</span>\n      value = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">lambda_execution_role</span>.<span class=\"hljs-property\">role_arn</span>\n    }\n    <span class=\"hljs-number\">3</span> = {\n      name  = <span class=\"hljs-string\">\"/app/${var.app_name}/event_bridge_name\"</span>\n      value = <span class=\"hljs-string\">\"${var.app_name}-event-bus\"</span>\n    }\n    <span class=\"hljs-number\">4</span> = {\n      name  = <span class=\"hljs-string\">\"/app/${var.app_name}/logs\"</span>\n      value = <span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">app_logs</span>.<span class=\"hljs-property\">dynamodb_table_id</span>\n    }\n  }\n}\n</code></pre>\n<p>ì´ ëª¨ë“ˆì—ì„œëŠ” ë‹¤ë¥¸ ëª¨ë“ˆì„ í˜¸ì¶œí•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ ì¢…ë¥˜ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤:</p>\n<ul>\n<li>DynamoDB í…Œì´ë¸”</li>\n<li>S3 ë²„ì¼“</li>\n<li>IAM Lambda ì‹¤í–‰ ì—­í• </li>\n<li>ì´ì „ì— ìƒì„±ëœ ë¦¬ì†ŒìŠ¤ì˜ ARN ë˜ëŠ” IDë¥¼ ë³´ê´€í•˜ëŠ” SSM ë§¤ê°œë³€ìˆ˜</li>\n</ul>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì—¬ê¸°ì„œ ë¹ ì§„ ê²ƒì€ ë‹¤ë¥¸ ê¸°ì‚¬ì—ì„œ ë³´ì—¬ì¤€ ê²ƒì²˜ëŸ¼ ë°±ì—”ë“œ S3 ë° AWS ì œê³µì êµ¬ì„±ì…ë‹ˆë‹¤... ì—¬ê¸°ì„œ Terragruntê°€ ë“±ì¥í•©ë‹ˆë‹¤...</p>\n<h1>í”Œë«í¼ ëŒ€ ì‘ìš© í”„ë¡œê·¸ë¨</h1>\n<p>ì´ëŸ¬í•œ ì—¼ë ¤ ì‚¬í•­ì˜ ë¶„ë¦¬ëŠ” ì„œë¡œ ë‹¤ë¥¸ GIT ì €ì¥ì†Œë¥¼ ê°€ì§€ê±°ë‚˜ ë‹¨ìˆœíˆ ë™ì¼í•œ Repo ë‚´ì—ì„œ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë¡œ ì·¨ê¸‰í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤... ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²ƒì€ ì‘ìš© í”„ë¡œê·¸ë¨ ì¸í”„ë¼ ì½”ë“œê°€ í”Œë«í¼ ì¸í”„ë¼ ì½”ë“œì— ì§ì ‘ì ì¸ ì¢…ì†ì„±ì„ í¬í•¨í•´ì„œëŠ” ì•ˆëœë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤... ë”°ë¼ì„œ ì´ê²ƒì€ ì‘ìš© í”„ë¡œê·¸ë¨ ì†ŒìŠ¤ ì½”ë“œ(BE/FE)ì™€ í•¨ê»˜ ì‰½ê²Œ ì¶”ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤...</p>\n<p>í•˜ì§€ë§Œ ìš°ë¦¬ëŠ” ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆì„ê¹Œìš”? ë¬´ì—‡ì„ í”Œë«í¼ ì¸í”„ë¼ì— ìœ„ì¹˜ì‹œí‚¤ê³  ì–´ë–¤ ê²ƒì„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸í”„ë¼ì— ìœ„ì¹˜ì‹œì¼œì•¼ í• ì§€ìš”?</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>í”Œë«í¼ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜:</h2>\n<p>í”Œë«í¼ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ëŠ” ë³´ë‹¤ í¬ê´„ì ì´ë©° ì¡°ì§ ì „ì²´ì—ì„œ ì—¬ëŸ¬ ì‘ìš© í”„ë¡œê·¸ë¨ì„ ì§€ì›í•˜ëŠ” ê¸°ë³¸ êµ¬ì„± ìš”ì†Œì™€ ì„œë¹„ìŠ¤ë¥¼ ì§€ì¹­í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤:</p>\n<ul>\n<li>CI/CDìš© IAM ì—­í• </li>\n<li>Route53 í˜¸ìŠ¤íŒ… ì˜ì—­</li>\n<li>ë„¤íŠ¸ì›Œí‚¹: VPC, ë°©í™”ë²½ ë° NATì™€ ê°™ì€ êµ¬ì„± ìš”ì†Œ</li>\n<li>ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…: Prometheus, Grafana ë˜ëŠ” CloudWatchì™€ ê°™ì€ ìš”ì†Œ</li>\n</ul>\n<h2>ì‘ìš© í”„ë¡œê·¸ë¨ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜:</h2>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì‘ìš© í”„ë¡œê·¸ë¨ ì¸í”„ë¼ëŠ” íŠ¹ì • ì‘ìš© í”„ë¡œê·¸ë¨ ë˜ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ ì„¸íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ë° í•„ìš”í•œ êµ¬ì„± ìš”ì†Œì™€ ë¦¬ì†ŒìŠ¤ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ì´ëŠ” ì¢…ì¢… ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤:</p>\n<ul>\n<li>EC2 ì¸ìŠ¤í„´ìŠ¤, ëŒë‹¤ í•¨ìˆ˜</li>\n<li>íŠ¸ëœì§“ ê²Œì´íŠ¸ì›¨ì´, ë¡œë“œ ë°¸ëŸ°ì„œ</li>\n<li>ì•± ë°ì´í„°ë² ì´ìŠ¤: MySQL, PostgreSQL ë˜ëŠ” MongoDBì™€ ê°™ì€ ë°ì´í„°ë² ì´ìŠ¤</li>\n<li>ë©”ì‹œì§€ ëŒ€ê¸°ì—´: SQS ë˜ëŠ” Kafkaì™€ ê°™ì€ ë©”ì‹œì§€ ëŒ€ê¸°ì—´</li>\n</ul>\n<h2>ì£¼ìš” í¬ì¸íŠ¸ëŠ” ê°œë³„ ì•±ì˜ ìš”êµ¬ ì‚¬í•­ì— ë§ì¶”ëŠ” ê²ƒì…ë‹ˆë‹¤.</h2>\n<p>ì˜ˆë¥¼ ë“¤ì–´ Serverless Frameworkë‚˜ AWS SAMì´ ìˆìŠµë‹ˆë‹¤.</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•´ì„œëŠ” í…Œë¼í¼ê³¼ ì„œë²„ë¦¬ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë©‹ì§„ ê°€ì´ë“œê°€ ìˆì–´ìš”.</p>\n<h2>í…Œë¼í¼ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë‹¤ë¥¸ ë„êµ¬ë¥¼ ì‚¬ìš©í•  ë•Œ, ì„œë²„ë¦¬ìŠ¤ í”„ë ˆì„ì›Œí¬ë‚˜ SAMê°™ì€:</h2>\n<h1>ì• í”Œë¦¬ì¼€ì´ì…˜ IaCë¥¼ ìœ„í•œ Terragrunt</h1>\n<p>â€˜liveâ€˜ ë””ë ‰í† ë¦¬ ë‚´ì—ì„œ ë°°í¬í•  í™˜ê²½ì„ ì§€ì •í•˜ì„¸ìš”.</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<pre><code class=\"hljs language-js\">â”œâ”€â”€ <span class=\"hljs-variable constant_\">README</span>.<span class=\"hljs-property\">md</span>\nâ”œâ”€â”€ live\nâ”‚   â”œâ”€â”€ _env\nâ”‚   â”‚   â””â”€â”€ app.<span class=\"hljs-property\">hcl</span>\nâ”‚   â”œâ”€â”€ dev\nâ”‚   â”‚   â””â”€â”€ app\nâ”‚   â”‚       â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span> &#x3C;--- <span class=\"hljs-variable language_\">this</span> is not a config file, but an environment resource file\nâ”‚   â”œâ”€â”€ production\nâ”‚   â”‚   â””â”€â”€ app\nâ”‚   â”‚       â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\nâ”‚   â”œâ”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>         &#x3C;------ <span class=\"hljs-title class_\">Terragrunt</span> config file (<span class=\"hljs-title class_\">Unique</span>)\nâ”‚   â””â”€â”€ test\nâ”‚       â””â”€â”€ app\nâ”‚           â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\nâ””â”€â”€ modules\n    â”œâ”€â”€ lambda-execution-role\n    â”‚   â”œâ”€â”€ data.<span class=\"hljs-property\">tf</span>\n    â”‚   â”œâ”€â”€ main.<span class=\"hljs-property\">tf</span>\n    â”‚   â”œâ”€â”€ output.<span class=\"hljs-property\">tf</span>\n    â”‚   â””â”€â”€ variables.<span class=\"hljs-property\">tf</span>\n    â”œâ”€â”€ application_1\n    â”‚   â”œâ”€â”€ main.<span class=\"hljs-property\">tf</span>\n    â”‚   â””â”€â”€ variables.<span class=\"hljs-property\">tf</span>\n    â””â”€â”€ ssm-parameters-store\n        â”œâ”€â”€ main.<span class=\"hljs-property\">tf</span>\n        â””â”€â”€ variables.<span class=\"hljs-property\">tf</span>\n</code></pre>\n<h1>ìœ ì¼ë¬´ì´í•œ terragrunt.hcl ì„¤ì • íŒŒì¼</h1>\n<p>ì—¬ê¸°ì—ëŠ” í•˜ë‚˜ì˜ terragrunt.hcl êµ¬ì„± íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ë©€í‹° ê³„ì • ë°°í¬ë¥¼ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì´ ë‚˜ì™€ ìˆì–´ìš”.</p>\n<p>í…Œë¼í¼ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ êµ¬ì„±ê³¼ Terragrunt êµ¬ì„±ì„ ë¹„êµí•´ë³´ê² ìŠµë‹ˆë‹¤.</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ë¡œì»¬ ë³€ìˆ˜ ì •ì˜ëŠ” \"ê±°ì˜\" ê°™ì€ ìƒíƒœë¡œ ìœ ì§€ë˜ê³  ìˆìœ¼ë©°, Terragrunt Live ë””ë ‰í„°ë¦¬ë¥¼ ë‹¤ë¥¸ í™˜ê²½ì˜ ì´ë¦„ìœ¼ë¡œ êµ¬ì¡°í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>\n<p>AWS í™˜ê²½ ì´ë¦„ê³¼ ë””ë ‰í„°ë¦¬ ì´ë¦„ì´ ì¼ì¹˜í•˜ë¯€ë¡œ ê°„ë‹¨í•œ ì •ê·œ í‘œí˜„ì‹ìœ¼ë¡œ ì‹¤í–‰ ì‹œê°„ì— í™˜ê²½ ê°’ì„ ì¶”ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<h2>infrastructure/live/terragrunt.hcl</h2>\n<p>ì—¬ê¸°ì— ì™„ì „í•œ terragrunt.hcl íŒŒì¼ì´ ìˆìŠµë‹ˆë‹¤.</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>backend.tfì™€ provider.tf ìƒì„±ê¸°ì—ì„œ \"profile\" ë§¤ê°œë³€ìˆ˜ë¥¼ ì£¼ëª©í•´ì£¼ì„¸ìš”. ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ì´ë“¤ì„ ì œê±°í•  ì˜ˆì •ì…ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\">locals {\n  # í™˜ê²½\n  env_regex = <span class=\"hljs-string\">\"infrastructure/live/([a-zA-Z0-9-]+)/\"</span>\n  aws_env   = <span class=\"hljs-title function_\">try</span>(<span class=\"hljs-title function_\">regex</span>(local.<span class=\"hljs-property\">env_regex</span>, <span class=\"hljs-title function_\">get_original_terragrunt_dir</span>())[<span class=\"hljs-number\">0</span>])\n  # ì–´í”Œë¦¬ì¼€ì´ì…˜\n  app_name = <span class=\"hljs-string\">\"my-app\"</span>\n  component = <span class=\"hljs-string\">\"api\"</span>\n\n  # <span class=\"hljs-variable constant_\">AWS</span> ì¡°ì§ ê³„ì •\n  account_mapping = {\n    dev             = <span class=\"hljs-number\">22222222222</span>\n    test            = <span class=\"hljs-number\">111111111111</span>\n    production      = <span class=\"hljs-number\">000000000000</span>\n    shared-services = <span class=\"hljs-number\">555555555555</span>\n  }\n  # ê°€ì •í•  <span class=\"hljs-variable constant_\">IAM</span> ì—­í• \n  account_role_name     = <span class=\"hljs-string\">\"apps-terraform-execution-role\"</span> # &#x3C;--- ê°€ì •í•  ì—­í• \n  # ì§€ì—­ ë° ê°€ìš© ì˜ì—­\n  region = <span class=\"hljs-string\">\"us-east-1\"</span>\n}\nremote_state {\n  backend = <span class=\"hljs-string\">\"s3\"</span>\n  generate = {\n    path      = <span class=\"hljs-string\">\"backend.tf\"</span>\n    if_exists = <span class=\"hljs-string\">\"overwrite_terragrunt\"</span>\n  }\n  config = {\n    bucket         = <span class=\"hljs-string\">\"terraform-state-shared-services\"</span>\n    key            = <span class=\"hljs-string\">\"${local.app_name}/${get_path_from_repo_root()}/terraform.tfstate\"</span>\n    region         = local.<span class=\"hljs-property\">region</span>\n    profile        = <span class=\"hljs-string\">\"shared-services\"</span> #&#x3C;----- <span class=\"hljs-variable constant_\">AWS</span> í”„ë¡œí•„\n    encrypt        = <span class=\"hljs-literal\">true</span>\n    dynamodb_table = <span class=\"hljs-string\">\"shared-services-lock-table\"</span>\n  }\n}\ngenerate <span class=\"hljs-string\">\"provider\"</span> {\n  path      = <span class=\"hljs-string\">\"provider.tf\"</span>\n  if_exists = <span class=\"hljs-string\">\"overwrite_terragrunt\"</span>\n  contents  = &#x3C;&#x3C;-<span class=\"hljs-variable constant_\">EOF</span>\n    provider <span class=\"hljs-string\">\"aws\"</span> {\n      region = <span class=\"hljs-string\">\"${local.region}\"</span>\n      profile = <span class=\"hljs-string\">\"shared-services\"</span> #&#x3C;----- <span class=\"hljs-variable constant_\">AWS</span> í”„ë¡œí•„\n      allowed_account_ids = [\n        <span class=\"hljs-string\">\"${local.account_mapping[local.aws_env]}\"</span>\n      ]\n      assume_role {\n        role_arn = <span class=\"hljs-string\">\"arn:aws:iam::${local.account_mapping[local.aws_env]}:role/${local.account_role_name}\"</span>\n      }\n      default_tags {\n        tags = {\n          <span class=\"hljs-title class_\">Environment</span> = <span class=\"hljs-string\">\"${local.aws_env}\"</span>\n          <span class=\"hljs-title class_\">ManagedBy</span>   = <span class=\"hljs-string\">\"terraform\"</span>\n          <span class=\"hljs-title class_\">DeployedBy</span>  = <span class=\"hljs-string\">\"terragrunt\"</span>\n          <span class=\"hljs-title class_\">Creator</span>     = <span class=\"hljs-string\">\"${get_env(\"</span><span class=\"hljs-variable constant_\">USER</span><span class=\"hljs-string\">\", \"</span><span class=\"hljs-variable constant_\">NOT_SET</span><span class=\"hljs-string\">\")}\"</span>\n          <span class=\"hljs-title class_\">Application</span> = <span class=\"hljs-string\">\"${local.app_name}\"</span>\n          <span class=\"hljs-title class_\">Component</span>   = <span class=\"hljs-string\">\"${local.component}\"</span>\n        }\n      }\n    }\n<span class=\"hljs-variable constant_\">EOF</span>\n}\n</code></pre>\n<p>Terragruntê°€ ìƒì„±ê¸°ì— ë³´ê°„ì„ í—ˆìš©í•˜ë¯€ë¡œ ëª¨ë“  ëŒ€ìƒ AWS ê³„ì •ì— ëŒ€í•´ ë§¤ê°œë³€ìˆ˜í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<h2>infrastructure/live/_env/app.hcl</h2>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>í…Œì´ë¸” íƒœê·¸ë¥¼ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”.</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>Terraform í”„ë¡œë¹„ì €ë‹ ì¸í”„ë¼ì— í•„ìš”í•œ ì—­í•  ì„¤ì •í•˜ê¸°</h2>\n<pre><code class=\"hljs language-js\">account_role_name     = <span class=\"hljs-string\">\"apps-terraform-execution-role\"</span> # &#x3C;--- ì „í™˜í•  ì—­í• \n</code></pre>\n<p>ë˜í•œ ì´ì „ ê²Œì‹œë¬¼ì—ì„œ AWS ê³µìœ  ì„œë¹„ìŠ¤ ê³„ì •ì— terraform-multiaccount-role ë° ê° ì‘ì—… ë¶€í•˜ ê³„ì •(ê°œë°œ, í…ŒìŠ¤íŠ¸, í”„ë¡œë•ì…˜)ì— terraform-roleì„ ì„¤ì •í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤.</p>\n<p>ê·¸ëŸ¬ë‚˜ ì´ ì„¤ì •ì€ í•˜ë‚˜ì˜ ì—”í„°í‹°(terraform-multiaccount-role)ê°€ ëª¨ë“  ê³„ì •ì—ì„œ terraform-roleì„ ê°€ì •(Assume)í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. ì´ëŠ” ê°œë°œíŒ€ì´ ìì²´ ì¸í”„ë¼ë¥¼ ê°œë°œ í™˜ê²½ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•˜ë ¤ëŠ” ê²½ìš°ì—ëŠ” í¸ë¦¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê°œë°œ íŒ€ì´ Dev ê³„ì •ì—ì„œë§Œ ì—­í• ì„ ì „í™˜í•  ìˆ˜ ìˆëŠ” ì—”í„°í‹°ì™€ Test ë° Productionì— ëŒ€í•œ ë‹¤ë¥¸ ì—”í„°í‹°ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>AWS Identity Center ìœ„ì„ëœ ê´€ë¦¬ì ê³„ì • ë° ê¶Œí•œ ì§‘í•©</h2>\n<p>AWS ê³„ì •ì— ê¶Œí•œ ì§‘í•©ì„ ë§Œë“œëŠ” ë°©ë²• ë° ê¶Œí•œ ì§‘í•©ì„ AWS ê³„ì •ì— í• ë‹¹í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ë¬¸ì„œë¥¼ ë”°ë¥´ì„¸ìš”.</p>\n<p>ë‹¤ìŒê³¼ ê°™ì€ ê¶Œí•œ ì§‘í•©ì„ ë§Œë“¤ì–´ ë³´ì„¸ìš”: terraform-dev, terraform-test, terraform-production.</p>\n<p>ê° ê¶Œí•œ ì§‘í•©ì— ëŒ€í•œ ëŒ€ìƒ ê³„ì •ì— ë‹¤ìŒê³¼ ê°™ì€ ë‚´ë¶€ ì •ì±…ì„ ë§Œë“œì„¸ìš”. í—ˆìš©í•˜ëŠ” ê¶Œí•œ ì§‘í•©(Identity ê³„ì •ì— ì„¤ì •ëœ)ì´ ê³µìœ  ì„œë¹„ìŠ¤ ê³„ì •ì— ë°°í¬ë˜ì–´ ë‹¤ìŒ ê³„ì •ì—ì„œ ì—­í• ì„ ê°€ì •í•  ìˆ˜ ìˆë„ë¡í•©ë‹ˆë‹¤:</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì´ë ‡ê²Œ ë³´ì´ëŠ” 3ê°€ì§€ ë‹¤ë¥¸ ê¶Œí•œ ì„¸íŠ¸ê°€ ìˆìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">{\n    <span class=\"hljs-string\">\"Version\"</span>: <span class=\"hljs-string\">\"2012-10-17\"</span>,\n    <span class=\"hljs-string\">\"Statement\"</span>: [\n        {\n            <span class=\"hljs-string\">\"Effect\"</span>: <span class=\"hljs-string\">\"Allow\"</span>,\n            <span class=\"hljs-string\">\"Action\"</span>: <span class=\"hljs-string\">\"sts:AssumeRole\"</span>,\n            <span class=\"hljs-string\">\"Resource\"</span>: <span class=\"hljs-string\">\"arn:aws:iam::000000000000:role/apps-terraform-execution-role\"</span>\n        },\n        {\n            <span class=\"hljs-string\">\"Sid\"</span>: <span class=\"hljs-string\">\"Statement1\"</span>,\n            <span class=\"hljs-string\">\"Effect\"</span>: <span class=\"hljs-string\">\"Allow\"</span>,\n            <span class=\"hljs-string\">\"Action\"</span>: [\n              <span class=\"hljs-string\">\"s3:GetObject\"</span>,\n              <span class=\"hljs-string\">\"s3:PutObject\"</span>,\n              <span class=\"hljs-string\">\"s3:ListBucket\"</span>\n            ],\n            <span class=\"hljs-string\">\"Resource\"</span>: [\n                <span class=\"hljs-string\">\"arn:aws:s3:::terraform-state-shared-services*\"</span>,\n                <span class=\"hljs-string\">\"arn:aws:s3:::terraform-state-shared-services/*\"</span>\n            ]\n        },\n        {\n            <span class=\"hljs-string\">\"Sid\"</span>: <span class=\"hljs-string\">\"Statement2\"</span>,\n            <span class=\"hljs-string\">\"Effect\"</span>: <span class=\"hljs-string\">\"Allow\"</span>,\n            <span class=\"hljs-string\">\"Action\"</span>: [\n              <span class=\"hljs-string\">\"dynamodb:GetItem\"</span>,\n              <span class=\"hljs-string\">\"dynamodb:PutItem\"</span>,\n              <span class=\"hljs-string\">\"dynamodb:DeleteItem\"</span>\n            ],\n            <span class=\"hljs-string\">\"Resource\"</span>: [\n                <span class=\"hljs-string\">\"arn:aws:dynamodb:us-east-1:555555555555:table/shared-services-lock-table\"</span>\n            ]\n        }\n    ]\n}\n</code></pre>\n<p>ê° ì›Œí¬ë¡œë“œ ê³„ì •ì— apps-terraform-execution-roleì„ ë§Œë“¤ê³  SSO ì‚¬ìš©ìê°€ ì—­í• ì„ í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤.</p>\n<p>ì°¸ê³ : \"terraform-production\"ì—ê²Œë„ Testì—ì„œ ì—­í• ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ ì •ì±…ì„ ì•½ê°„ ì¡°ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h1>í”Œë«í¼ ì¸í”„ë¼ (IaC)</h1>\n<p>ìµœì†Œí•œì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•´ DNS, ë„¤íŠ¸ì›Œí‚¹ ë° ì‹ë³„ ê´€ë¦¬ ì—­í•  ë° ì •ì±…ê³¼ ê°™ì€ í”Œë«í¼ ë¦¬ì†ŒìŠ¤ë¥¼ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\">âœ  live <span class=\"hljs-attr\">git</span>:(main) âœ— tree\n.\nâ”œâ”€â”€ _env\nâ”‚   â”œâ”€â”€ route53-zones.<span class=\"hljs-property\">hcl</span>\nâ”‚   â””â”€â”€ iam-roles.<span class=\"hljs-property\">hcl</span>\nâ”œâ”€â”€ dev\nâ”‚   â”œâ”€â”€ iam-roles\nâ”‚   â”‚   â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\nâ”‚   â”œâ”€â”€ route53-zones\nâ”‚   â”‚   â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\nâ”‚   â””â”€â”€ platform\nâ”‚       â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\nâ”œâ”€â”€ network\nâ”‚   â”œâ”€â”€ dmz\nâ”‚   â”‚   â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\nâ”‚   â”œâ”€â”€ network-egress\nâ”‚   â”‚   â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\nâ”‚   â”œâ”€â”€ transitgateway-dmz-vpc-attachment\nâ”‚   â”‚   â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\nâ”‚   â””â”€â”€ transitgateway-egress-vpc-attachment\nâ”‚       â”œâ”€â”€ mystate.<span class=\"hljs-property\">tfstate</span>\nâ”‚       â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\nâ”œâ”€â”€ production\nâ”‚   â”œâ”€â”€ iam-roles\nâ”‚   â”‚   â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\nâ”‚   â””â”€â”€ platform\nâ”‚       â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\nâ”œâ”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\nâ””â”€â”€ test\n    â”œâ”€â”€ iam-roles\n    â”‚   â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\n    â”œâ”€â”€ route53-zones\n    â”‚   â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\n    â””â”€â”€ platform\n        â””â”€â”€ terragrunt.<span class=\"hljs-property\">hcl</span>\n</code></pre>\n<h2>ë¡œì»¬ ë³€ìˆ˜</h2>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì—¬ëŸ¬ ê°œì˜ ê³„ì • ê°’ë“¤ì„ í•˜ë‚˜ì˜ ì¥ì†Œì—ì„œ ì¤‘ì•™í™”í•˜ëŠ” ë°©ë²•ì˜ ì˜ˆì‹œì…ë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">locals {\n  # í™˜ê²½ ë³€ìˆ˜\n  env_regex = <span class=\"hljs-string\">\"infrastructure/live/([a-zA-Z0-9-]+)/\"</span>\n  aws_env   = <span class=\"hljs-title function_\">try</span>(<span class=\"hljs-title function_\">regex</span>(local.<span class=\"hljs-property\">env_regex</span>, <span class=\"hljs-title function_\">get_original_terragrunt_dir</span>())[<span class=\"hljs-number\">0</span>])\n  # ì–´í”Œë¦¬ì¼€ì´ì…˜\n  app_name  = <span class=\"hljs-string\">\"my-application-platform\"</span>\n  component = <span class=\"hljs-string\">\"platform\"</span>\n  platform_apps = [\n    <span class=\"hljs-string\">\"application_1\"</span>,\n    <span class=\"hljs-string\">\"application_2\"</span>,\n    <span class=\"hljs-string\">\"application_3\"</span>\n  ]\n  # <span class=\"hljs-variable constant_\">AWS</span> ì¡°ì§ ê³„ì •\n  application_account_mapping = {\n    dev        = <span class=\"hljs-number\">222222222222</span>\n    test       = <span class=\"hljs-number\">111111111111</span>\n    production = <span class=\"hljs-number\">000000000000</span>\n  }\n  platform_account_mapping = {\n    shared-services = <span class=\"hljs-number\">555555555555</span>\n    network         = <span class=\"hljs-string\">\"666666666666\"</span>\n    dns             = <span class=\"hljs-number\">888888888888</span>\n  }\n  account_mapping = <span class=\"hljs-title function_\">merge</span>(local.<span class=\"hljs-property\">application_account_mapping</span>, local.<span class=\"hljs-property\">platform_account_mapping</span>)\n\n  # ê°€ì •í•  <span class=\"hljs-variable constant_\">IAM</span> ì—­í• \n  account_role_name     = <span class=\"hljs-string\">\"terraform-role\"</span>\n  multiaccount_role_arn = <span class=\"hljs-string\">\"arn:aws:iam::555555555555:role/terraform-multiaccount-role\"</span> # shared-services\n\n  terraform_execution_role_mapping = {\n    dev = <span class=\"hljs-string\">\"arn:aws:iam::555555555555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_terraform-dev_ab1\"</span>\n    test = <span class=\"hljs-string\">\"arn:aws:iam::555555555555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_terraform-test_ab2\"</span>\n    production = <span class=\"hljs-string\">\"arn:aws:iam::555555555555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_terraform-production_ab3\"</span>\n  }\n\n  # ê¸°íƒ€ í”Œë«í¼ êµ¬ì„± ê°’ë“¤\n  # ===================================\n  # <span class=\"hljs-variable constant_\">DNS</span>\n  main_public_dns_zone_name     = <span class=\"hljs-string\">\"example.com\"</span>\n  env_public_dns_zone_subdomain = <span class=\"hljs-string\">\"${local.aws_env}\"</span>\n  environment_hosted_zone_name  = <span class=\"hljs-string\">\"${local.env_public_dns_zone_subdomain}.${local.main_public_dns_zone_name}\"</span>\n  acm_subject_alternative_names = [\n    <span class=\"hljs-string\">\"${local.environment_hosted_zone_name}\"</span>,\n    <span class=\"hljs-string\">\"*.${local.environment_hosted_zone_name}\"</span>,\n    <span class=\"hljs-string\">\"*.api.${local.environment_hosted_zone_name}\"</span>,\n    <span class=\"hljs-string\">\"*.myapps.${local.environment_hosted_zone_name}\"</span>,\n    <span class=\"hljs-string\">\"*.apps.${local.environment_hosted_zone_name}\"</span>\n  ]\n  # ì§€ì—­ ë° ê°€ìš© ì˜ì—­\n  region = <span class=\"hljs-string\">\"us-east-1\"</span>\n  azs = [\n    <span class=\"hljs-string\">\"us-east-1a\"</span>,\n    <span class=\"hljs-string\">\"us-east-1b\"</span>,\n    <span class=\"hljs-string\">\"us-east-1c\"</span>\n  ]\n  platform_accounts = {\n    dev = {\n      cidr = <span class=\"hljs-string\">\"10.3.0.0/16\"</span>\n      private_subnets = [\n        <span class=\"hljs-string\">\"10.3.1.0/24\"</span>,\n        <span class=\"hljs-string\">\"10.3.2.0/24\"</span>,\n        <span class=\"hljs-string\">\"10.3.3.0/24\"</span>\n      ]\n    }\n    test = {\n      cidr = <span class=\"hljs-string\">\"10.2.0.0/16\"</span>\n      private_subnets = [\n        <span class=\"hljs-string\">\"10.2.1.0/24\"</span>,\n        <span class=\"hljs-string\">\"10.2.2.0/24\"</span>,\n        <span class=\"hljs-string\">\"10.2.3.0/24\"</span>\n      ]\n    }\n    production = {\n      cidr = <span class=\"hljs-string\">\"10.0.0.0/16\"</span>\n      private_subnets = [\n        <span class=\"hljs-string\">\"10.0.1.0/24\"</span>,\n        <span class=\"hljs-string\">\"10.0.2.0/24\"</span>,\n        <span class=\"hljs-string\">\"10.0.3.0/24\"</span>\n      ]\n    }\n  }\n}\n</code></pre>\n<pre><code class=\"hljs language-js\">include <span class=\"hljs-string\">\"root\"</span> {\n  path = <span class=\"hljs-title function_\">find_in_parent_folders</span>()\n}\n\ninclude <span class=\"hljs-string\">\"env\"</span> {\n  path = <span class=\"hljs-string\">\"../../_env/iam-roles.hcl\"</span>\n}\n</code></pre>\n<pre><code class=\"hljs language-js\">locals {\n  env_vars = <span class=\"hljs-title function_\">read_terragrunt_config</span>(<span class=\"hljs-title function_\">find_in_parent_folders</span>(<span class=\"hljs-string\">\"terragrunt.hcl\"</span>))\n  env      = local.<span class=\"hljs-property\">env_vars</span>.<span class=\"hljs-property\">locals</span>.<span class=\"hljs-property\">aws_env</span>\n}\n\nterraform {\n  source = <span class=\"hljs-string\">\"../../../modules//platform/iam-roles\"</span>\n}\n\ninputs = {\n  trusted_role_arns = [\n    local.<span class=\"hljs-property\">env_vars</span>.<span class=\"hljs-property\">locals</span>.<span class=\"hljs-property\">terraform_execution_role_mapping</span>[local.<span class=\"hljs-property\">env</span>]\n  ]\n}\n</code></pre>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h2>infrastructure/modules/platform/iam-roles</h2>\n<p>\"Iam:<em>\"ì— ëŒ€í•œ ë²”ìœ„ë¥¼ ì¢íˆê³  ìˆìŒì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤. ì´ëŠ” Terraformì´ ì‘ìš© í”„ë¡œê·¸ë¨ì„ ìœ„í•´ Role ë° ì •ì±…ì„ ìƒì„±, ì œê±° ë° ì—…ë°ì´íŠ¸í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— í•„ìš”í•œ ê¶Œí•œì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ê²½ìš° \":role/app/</em>\" ë‚´ì˜ Roles ë° Policiesë¡œ ë²”ìœ„ë¥¼ ì¢í ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-json\">data <span class=\"hljs-string\">\"aws_caller_identity\"</span> <span class=\"hljs-string\">\"current\"</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span>\nmodule <span class=\"hljs-string\">\"app_terraform_execution_role\"</span> <span class=\"hljs-punctuation\">{</span>\n  source                            = <span class=\"hljs-string\">\"../../iam-role\"</span>\n  role_name                         = <span class=\"hljs-string\">\"apps-terraform-execution-role\"</span>\n  create_role                       = <span class=\"hljs-literal\"><span class=\"hljs-keyword\">true</span></span>\n  role_requires_mfa                 = var.role_requires_mfa\n  path                              = <span class=\"hljs-string\">\"/\"</span>\n  description                       = <span class=\"hljs-string\">\"Terraform Execution role\"</span>\n  trusted_role_arns                 = var.trusted_role_arns\n  number_of_custom_role_policy_arns = <span class=\"hljs-number\">1</span>\n  policy = jsonencode(\n    <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">\"Version\"</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"2012-10-17\"</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">\"Statement\"</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n        <span class=\"hljs-punctuation\">{</span>\n          <span class=\"hljs-attr\">\"Action\"</span> <span class=\"hljs-punctuation\">:</span> var.app_allowed_actions<span class=\"hljs-punctuation\">,</span>\n          <span class=\"hljs-attr\">\"Effect\"</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"Allow\"</span><span class=\"hljs-punctuation\">,</span>\n          <span class=\"hljs-attr\">\"Resource\"</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"*\"</span><span class=\"hljs-punctuation\">,</span>\n          <span class=\"hljs-attr\">\"Condition\"</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n            <span class=\"hljs-attr\">\"StringEquals\"</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n              <span class=\"hljs-attr\">\"aws:RequestedRegion\"</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"us-east-1\"</span>\n            <span class=\"hljs-punctuation\">}</span>\n          <span class=\"hljs-punctuation\">}</span>\n        <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-punctuation\">{</span>\n          <span class=\"hljs-attr\">\"Action\"</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n            <span class=\"hljs-string\">\"iam:*\"</span>\n          <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n          <span class=\"hljs-attr\">\"Effect\"</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"Allow\"</span><span class=\"hljs-punctuation\">,</span>\n          <span class=\"hljs-attr\">\"Resource\"</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"arn:aws:iam::${data.aws_caller_identity.current.account_id}:role/app/*\"</span>\n        <span class=\"hljs-punctuation\">}</span>\n      <span class=\"hljs-punctuation\">]</span>\n  <span class=\"hljs-punctuation\">}</span>)\n<span class=\"hljs-punctuation\">}</span>\n\nvariable <span class=\"hljs-string\">\"app_allowed_actions\"</span> <span class=\"hljs-punctuation\">{</span>\n  default = <span class=\"hljs-punctuation\">[</span>\n    <span class=\"hljs-string\">\"cloudwatch:*\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-string\">\"iam:List*\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-string\">\"iam:Get*\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-string\">\"iam:Describe*\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-string\">\"logs:*\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-string\">\"logs:ListTagsLogGroup\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-string\">\"s3:*\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-string\">\"secretsmanager:*\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-string\">\"ses:*\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-string\">\"sns:*\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-string\">\"ssm:*\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-string\">\"dynamodb:*\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-string\">\"sts:*\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-string\">\"route53:*\"</span>\n  <span class=\"hljs-punctuation\">]</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<pre><code class=\"hljs language-json\">module <span class=\"hljs-string\">\"iam_policy\"</span> <span class=\"hljs-punctuation\">{</span>\n  source      = <span class=\"hljs-string\">\"git::https://github.com/terraform-aws-modules/terraform-aws-iam.git//modules/iam-policy\"</span>\n  path        = var.path\n  name        = <span class=\"hljs-string\">\"${var.role_name}-policy\"</span>\n  description = var.description\n  policy      = var.policy\n<span class=\"hljs-punctuation\">}</span>\n\nmodule <span class=\"hljs-string\">\"iam_assumable_role\"</span> <span class=\"hljs-punctuation\">{</span>\n  source            = <span class=\"hljs-string\">\"git::https://github.com/terraform-aws-modules/terraform-aws-iam.git//modules/iam-assumable-role\"</span>\n  create_role       = var.create_role\n  role_name         = var.role_name\n  role_requires_mfa = var.role_requires_mfa\n  trusted_role_arns = var.trusted_role_arns\n  custom_role_policy_arns = <span class=\"hljs-punctuation\">[</span>\n    module.iam_policy.arn\n  <span class=\"hljs-punctuation\">]</span>\n  number_of_custom_role_policy_arns = var.number_of_custom_role_policy_arns\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h1>AWS ì¸ê°€: SSOë¥¼ ì‚¬ìš©í•  ì˜ˆì •ì´ë¯€ë¡œ ì¥ê¸°ì ìœ¼ë¡œ ìœ íš¨í•œ ìê²© ì¦ëª…ì´ í•„ìš”í•˜ì§€ ì•Šì•„ìš” ğŸ¥³</h1>\n<h1>ë¡œì»¬ êµ¬ì„± í”„ë¡œíŒŒì¼ êµ¬ì„± (~/.aws/config)</h1>\n<h2>í”Œë«í¼</h2>\n<p>ìš”ê¸° ëª»ìƒê¸´ ë‹­ê³¼ ê³„ë€ ë¬¸ì œê°€ ìˆëŠ”ë°... ê¹”ë”í•œ AWS ê³„ì •ì´ ìˆê³ , í”Œë«í¼ ì¸í”„ë¼ í”„ë¡œë¹„ì €ë‹ì— ê¶Œí•œì„ ë¶€ì—¬í•´ì•¼ í•´ìš”. ì´ê±´ IaCë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì–´ì„œ í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œì—ìš”.</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>AWS ì½˜ì†”ì´ë‚˜ CLIë¥¼ ì‚¬ìš©í•˜ì—¬ Terraform í”Œë«í¼ì— ëŒ€í•œ IAM ë˜ëŠ” IAM Identity Center ì‚¬ìš©ìë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì„¤ì •ì´ ì™„ë£Œë˜ë©´ IaCë¥¼ í”„ë¡œë¹„ì €ë‹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œë¹„ì €ë‹ì„ ìœ„í•œ ëª¨ë“  ì—­í• ê³¼ ì •ì±…(CICD ì¸¡ë©´ì„ ê³ ë ¤í•œ)ì€ í”Œë«í¼ IaCì—ì„œ ìƒì„±ë©ë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ì„ ìœ„í•œ ëª¨ë“  ì—­í• ê³¼ ì •ì±…(ì˜ˆ: ëŒë‹¤ ì‹¤í–‰ ì—­í• )ì€ ì‘ìš© í”„ë¡œê·¸ë¨ ì½”ë“œ ë‚´ì—ì„œ ìƒì„±ë©ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\">[profile terraform-platform]\nsso_start_url=<span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//my-organization.awsapps.com/start</span>\nsso_region=us-east-<span class=\"hljs-number\">1</span>\nsso_account_id=<span class=\"hljs-number\">555555555555</span>\nsso_role_name=<span class=\"hljs-title class_\">PlatformTerraform</span>\nregion=us-east-<span class=\"hljs-number\">1</span>\noutput=json\n</code></pre>\n<h2>ì‘ìš© í”„ë¡œê·¸ë¨ ë¦¬ì†ŒìŠ¤ (ê°œë°œìê°€ ì“°ê¸° ì•¡ì„¸ìŠ¤ë¥¼ ì–»ëŠ” ê³³)</h2>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<img src=\"/assets/img/2024-05-27-MyIaCAWSMulti-AccountProvisioningBluePrintBestPractices_1.png\">\n<pre><code class=\"hljs language-js\">[profile terraform]\nsso_start_url=<span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//my-organization.awsapps.com/start</span>\nsso_region=us-east-<span class=\"hljs-number\">1</span>\nsso_account_id=<span class=\"hljs-number\">555555555555</span>\nsso_role_name=terraform-dev\nregion=us-east-<span class=\"hljs-number\">1</span>\noutput=json\n\n[profile terraform-test]\nsso_start_url=<span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//my-organization.awsapps.com/start</span>\nsso_region=us-east-<span class=\"hljs-number\">1</span>\nsso_account_id=<span class=\"hljs-number\">555555555555</span>\nsso_role_name=terraform-test\nregion=us-east-<span class=\"hljs-number\">1</span>\noutput=json\n\n[profile terraform-production]\nsso_start_url=<span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//my-organization.awsapps.com/start</span>\nsso_region=us-east-<span class=\"hljs-number\">1</span>\nsso_account_id=<span class=\"hljs-number\">555555555555</span>\nsso_role_name=terraform-production\nregion=us-east-<span class=\"hljs-number\">1</span>\noutput=json\n</code></pre>\n<h1>AWS Backend &#x26; Provider Config</h1>\n<p>ì–´ë¨¸ë¨¸... íœ´ìŠ¤í„´, ë¬¸ì œ ë°œìƒí–ˆì–´ìš”.... AWS ê³„ì • ë³„ë¡œ ë‹¤ë¥¸ ê¶Œí•œ ì„¸íŠ¸ê°€ ìˆì–´ìš”... ì´ì œ ë” ì´ìƒ <code>profile = shared-services</code>ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ëë„¤ìš”.</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>í˜¹ì‹œ ë§¤í•‘í• ê¹Œìš”? ì•„ë‹ˆë©´ í™˜ê²½ê³¼ ì ‘ë‘ì‚¬ë¥¼ ì¶”ê°€í• ê¹Œìš”?â€¦.</p>\n<pre><code class=\"hljs language-js\">remote_state {\n  backend = <span class=\"hljs-string\">\"s3\"</span>\n .....\n  }\n  config = {\n   ........\n\n    # ì—¬ê¸°ê°€ ë¬¸ì œì…ë‹ˆë‹¤\n    profile        = <span class=\"hljs-string\">\"terraform\"</span> # í˜¹ì€ <span class=\"hljs-string\">\"terraform-test\"</span> ë˜ëŠ” <span class=\"hljs-string\">\"terraform-production\"</span>\n  }\n}\n\ngenerate <span class=\"hljs-string\">\"provider\"</span> {\n  path      = <span class=\"hljs-string\">\"provider.tf\"</span>\n  if_exists = <span class=\"hljs-string\">\"overwrite_terragrunt\"</span>\n  contents  = &#x3C;&#x3C;-<span class=\"hljs-variable constant_\">EOF</span>\n    provider <span class=\"hljs-string\">\"aws\"</span> {\n      ...\n      ....\n      profile = <span class=\"hljs-string\">\"terraform\"</span> # í˜¹ì€ <span class=\"hljs-string\">\"terraform-test\"</span> ë˜ëŠ” <span class=\"hljs-string\">\"terraform-production\"</span>\n    }\n<span class=\"hljs-variable constant_\">EOF</span>\n}\n</code></pre>\n<h2>ì´ê²ƒì„ ì œê±°í•˜ê³  í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •í•©ì‹œë‹¤</h2>\n<pre><code class=\"hljs language-js\">locals {\n  # <span class=\"hljs-variable constant_\">ENV</span>\n  env_regex = <span class=\"hljs-string\">\"infrastructure/live/([a-zA-Z0-9-]+)/\"</span>\n  aws_env   = <span class=\"hljs-title function_\">try</span>(<span class=\"hljs-title function_\">regex</span>(local.<span class=\"hljs-property\">env_regex</span>, <span class=\"hljs-title function_\">get_original_terragrunt_dir</span>())[<span class=\"hljs-number\">0</span>])\n  # <span class=\"hljs-title class_\">Application</span>\n  app_name  = <span class=\"hljs-string\">\"my-application-platform\"</span>\n  component = <span class=\"hljs-string\">\"platform\"</span>\n  platform_apps = [\n    <span class=\"hljs-string\">\"application_1\"</span>,\n    <span class=\"hljs-string\">\"application_2\"</span>,\n    <span class=\"hljs-string\">\"application_3\"</span>\n  ]\n  # <span class=\"hljs-variable constant_\">AWS</span> <span class=\"hljs-title class_\">Organizations</span> <span class=\"hljs-title class_\">Accounts</span>\n  application_account_mapping = {\n    dev        = <span class=\"hljs-number\">222222222222</span>\n    test       = <span class=\"hljs-number\">111111111111</span>\n    production = <span class=\"hljs-number\">000000000000</span>\n  }\n  platform_account_mapping = {\n    shared-services = <span class=\"hljs-number\">555555555555</span>\n    network         = <span class=\"hljs-string\">\"666666666666\"</span>\n    dns             = <span class=\"hljs-number\">888888888888</span>\n  }\n  account_mapping = <span class=\"hljs-title function_\">merge</span>(local.<span class=\"hljs-property\">application_account_mapping</span>, local.<span class=\"hljs-property\">platform_account_mapping</span>)\n\n  # <span class=\"hljs-variable constant_\">IAM</span> <span class=\"hljs-title class_\">Roles</span> to <span class=\"hljs-title class_\">Assume</span>\n  account_role_name     = <span class=\"hljs-string\">\"terraform-role\"</span>\n  multiaccount_role_arn = <span class=\"hljs-string\">\"arn:aws:iam::555555555555:role/terraform-multiaccount-role\"</span> # shared-services\n\n  terraform_execution_role_mapping = {\n    dev = <span class=\"hljs-string\">\"arn:aws:iam::555555555555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_terraform-dev_ab1\"</span>\n    test = <span class=\"hljs-string\">\"arn:aws:iam::555555555555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_terraform-test_ab2\"</span>\n    production = <span class=\"hljs-string\">\"arn:aws:iam::555555555555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_terraform-production_ab3\"</span>\n  }\n\n  # <span class=\"hljs-title class_\">Other</span> <span class=\"hljs-title class_\">Platform</span> <span class=\"hljs-title class_\">Config</span> <span class=\"hljs-title class_\">Values</span> <span class=\"hljs-title class_\">Below</span>\n  # ===================================\n  # <span class=\"hljs-variable constant_\">DNS</span>\n  main_public_dns_zone_name     = <span class=\"hljs-string\">\"example.com\"</span>\n  env_public_dns_zone_subdomain = <span class=\"hljs-string\">\"${local.aws_env}\"</span>\n  environment_hosted_zone_name  = <span class=\"hljs-string\">\"${local.env_public_dns_zone_subdomain}.${local.main_public_dns_zone_name}\"</span>\n  acm_subject_alternative_names = [\n    <span class=\"hljs-string\">\"${local.environment_hosted_zone_name}\"</span>,\n    <span class=\"hljs-string\">\"*.${local.environment_hosted_zone_name}\"</span>,\n    <span class=\"hljs-string\">\"*.api.${local.environment_hosted_zone_name}\"</span>,\n    <span class=\"hljs-string\">\"*.myapps.${local.environment_hosted_zone_name}\"</span>,\n    <span class=\"hljs-string\">\"*.apps.${local.environment_hosted_zone_name}\"</span>\n  ]\n  # <span class=\"hljs-title class_\">Region</span> and <span class=\"hljs-title class_\">Zones</span>\n  region = <span class=\"hljs-string\">\"us-east-1\"</span>\n  azs = [\n    <span class=\"hljs-string\">\"us-east-1a\"</span>,\n    <span class=\"hljs-string\">\"us-east-1b\"</span>,\n    <span class=\"hljs-string\">\"us-east-1c\"</span>\n  ]\n  platform_accounts = {\n    dev = {\n      cidr = <span class=\"hljs-string\">\"10.3.0.0/16\"</span>\n      private_subnets = [\n        <span class=\"hljs-string\">\"10.3.1.0/24\"</span>,\n        <span class=\"hljs-string\">\"10.3.2.0/24\"</span>,\n        <span class=\"hljs-string\">\"10.3.3.0/24\"</span>\n      ]\n    }\n    test = {\n      cidr = <span class=\"hljs-string\">\"10.2.0.0/16\"</span>\n      private_subnets = [\n        <span class=\"hljs-string\">\"10.2.1.0/24\"</span>,\n        <span class=\"hljs-string\">\"10.2.2.0/24\"</span>,\n        <span class=\"hljs-string\">\"10.2.3.0/24\"</span>\n      ]\n    }\n    production = {\n      cidr = <span class=\"hljs-string\">\"10.0.0.0/16\"</span>\n      private_subnets = [\n        <span class=\"hljs-string\">\"10.0.1.0/24\"</span>,\n        <span class=\"hljs-string\">\"10.0.2.0/24\"</span>,\n        <span class=\"hljs-string\">\"10.0.3.0/24\"</span>\n      ]\n    }\n  }\n}\nremote_state {\n  backend = <span class=\"hljs-string\">\"s3\"</span>\n  generate = {\n    path      = <span class=\"hljs-string\">\"backend.tf\"</span>\n    if_exists = <span class=\"hljs-string\">\"overwrite_terragrunt\"</span>\n  }\n  config = {\n    bucket         = <span class=\"hljs-string\">\"terraform-state-shared-services\"</span>\n    key            = <span class=\"hljs-string\">\"${local.app_name}/${get_path_from_repo_root()}/terraform.tfstate\"</span>\n    region         = local.<span class=\"hljs-property\">region</span>\n    encrypt        = <span class=\"hljs-literal\">true</span>\n    dynamodb_table = <span class=\"hljs-string\">\"shared-services-lock-table\"</span>\n  }\n}\n\ngenerate <span class=\"hljs-string\">\"provider\"</span> {\n  path      = <span class=\"hljs-string\">\"provider.tf\"</span>\n  if_exists = <span class=\"hljs-string\">\"overwrite_terragrunt\"</span>\n  contents  = &#x3C;&#x3C;-<span class=\"hljs-variable constant_\">EOF</span>\n    provider <span class=\"hljs-string\">\"aws\"</span> {\n      region = <span class=\"hljs-string\">\"${local.region}\"</span>\n      allowed_account_ids = [\n        <span class=\"hljs-string\">\"${local.account_mapping[local.aws_env]}\"</span>\n      ]\n      assume_role {\n        role_arn = <span class=\"hljs-string\">\"arn:aws:iam::${local.account_mapping[local.aws_env]}:role/${local.account_role_name}\"</span>\n      }\n      default_tags {\n        tags = {\n          <span class=\"hljs-title class_\">Environment</span> = <span class=\"hljs-string\">\"${local.aws_env}\"</span>\n          <span class=\"hljs-title class_\">ManagedBy</span>   = <span class=\"hljs-string\">\"terraform\"</span>\n          <span class=\"hljs-title class_\">DeployedBy</span>  = <span class=\"hljs-string\">\"terragrunt\"</span>\n          <span class=\"hljs-title class_\">Creator</span>     = <span class=\"hljs-string\">\"${get_env(\"</span><span class=\"hljs-variable constant_\">USER</span><span class=\"hljs-string\">\", \"</span><span class=\"hljs-variable constant_\">NOT_SET</span><span class=\"hljs-string\">\")}\"</span>\n          <span class=\"hljs-title class_\">Application</span> = <span class=\"hljs-string\">\"${local.app_name}\"</span>\n          <span class=\"hljs-title class_\">Component</span>   = <span class=\"hljs-string\">\"${local.component}\"</span>\n        }\n      }\n    }\n<span class=\"hljs-variable constant_\">EOF</span>\n}\n</code></pre>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h1>ë°°í¬</h1>\n<h2>í”Œë«í¼</h2>\n<pre><code class=\"hljs language-js\">aws sso login --profile terraform-platform\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-variable constant_\">AWS_PROFILE</span>=terraform-platform\n\n# ê°œë°œ\ncd infrastructure/live/dev/iam-roles\nterragrunt init\nterragrunt plan\nterragrunt apply\n\n# í…ŒìŠ¤íŠ¸\ncd infrastructure/live/test/iam-roles\nterragrunt init\nterragrunt plan\nterragrunt apply\n\n# í”„ë¡œë•ì…˜\ncd infrastructure/live/production/iam-roles\nterragrunt init\nterragrunt plan\nterragrunt apply\n</code></pre>\n<h2>ì–´í”Œë¦¬ì¼€ì´ì…˜</h2>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>ì—¬ê¸°ì„œëŠ” ë°©ê¸ˆ ë§Œë“  ìƒˆ ì—­í• ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\"># ê°œë°œ\ncd infrastructure/live/dev/app\naws sso login --profile terraform-dev\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-variable constant_\">AWS_PROFILE</span>=terraform-dev\nterragrunt init\nterragrunt plan\nterragrunt apply\n\n# í…ŒìŠ¤íŠ¸\ncd infrastructure/live/test/app\naws sso login --profile terraform-test\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-variable constant_\">AWS_PROFILE</span>=terraform-test\nterragrunt init\nterragrunt plan\nterragrunt apply\n\n# í”„ë¡œë•ì…˜\ncd infrastructure/live/production/app\naws sso login --profile terraform-production\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-variable constant_\">AWS_PROFILE</span>=terraform-production\nterragrunt init\nterragrunt plan\nterragrunt apply\n</code></pre>\n<h1>AWS Vault</h1>\n<p>AWS Vaultì€ ê°œë°œ í™˜ê²½ì—ì„œ AWS ìê²© ì¦ëª…ì„ ì•ˆì „í•˜ê²Œ ì €ì¥í•˜ê³  ì•¡ì„¸ìŠ¤í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.</p>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<p>AWS Vaultì€ IAM ìê²© ì¦ëª…ì„ ì‚¬ìš©ìì˜ ìš´ì˜ ì²´ì œ ì•ˆì „í•œ í‚¤ ì €ì¥ì†Œì— ì €ì¥í•œ ë‹¤ìŒ í•´ë‹¹ ìê²© ì¦ëª…ì„ ì„ì‹œ ìê²© ì¦ëª…ìœ¼ë¡œ ìƒì„±í•˜ì—¬ ì‰˜ ë° ì‘ìš© í”„ë¡œê·¸ë¨ì— ë…¸ì¶œí•©ë‹ˆë‹¤. ì´ëŠ” AWS CLI ë„êµ¬ì™€ í•¨ê»˜ ë³´ì¡°ì ìœ¼ë¡œ ì‚¬ìš©ë˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìœ¼ë©° ~/.aws/configì— ìˆëŠ” í”„ë¡œí•„ê³¼ êµ¬ì„±ì„ ì¸ì‹í•©ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\">brew install --cask aws-vault\n</code></pre>\n<h2>ë”°ë¼ì„œ ì´ëŠ” ë°±ì—”ë“œ êµ¬ì„± ë° ê³µê¸‰ìì—ì„œ \"í”„ë¡œí•„\" ë§¤ê°œë³€ìˆ˜ë¥¼ ì œê±°í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</h2>\n<h1>AWS-Vaultë¡œ ë°°í¬í•˜ê¸°</h1>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<h1>í”Œë«í¼</h1>\n<pre><code class=\"hljs language-js\"># <span class=\"hljs-title class_\">Dev</span>\ncd infrastructure/live/dev/iam-roles\naws-vault exec terraform-platform terragrunt init\naws-vault exec terraform-platform terragrunt plan\naws-vault exec terraform-platform terragrunt apply\n\n# í…ŒìŠ¤íŠ¸\ncd infrastructure/live/test/iam-roles\naws-vault exec terraform-platform terragrunt init\naws-vault exec terraform-platform terragrunt plan\naws-vault exec terraform-platform terragrunt apply\n\n# í”„ë¡œë•ì…˜\ncd infrastructure/live/production/iam-roles\naws-vault exec terraform-platform terragrunt init\naws-vault exec terraform-platform terragrunt plan\naws-vault exec terraform-platform terragrunt apply\n</code></pre>\n<h1>ì• í”Œë¦¬ì¼€ì´ì…˜</h1>\n<pre><code class=\"hljs language-js\">cd infrastructure/live/dev/app\naws-vault exec terraform-dev terragrunt init\naws-vault exec terraform-dev terragrunt plan\naws-vault exec terraform-dev terragrunt apply\n\ncd infrastructure/live/test/app\naws-vault exec terraform-test terragrunt init\naws-vault exec terraform-test terragrunt plan\naws-vault exec terraform-test terragrunt apply\n\ncd infrastructure/live/production/app\naws-vault exec terraform-production terragrunt init\naws-vault exec terraform-production terragrunt plan\naws-vault exec terraform-production terragrunt apply\n</code></pre>\n<!-- ui-station ì‚¬ê°í˜• -->\n<p><ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"></ins></p>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n<img src=\"/assets/img/2024-05-27-MyIaCAWSMulti-AccountProvisioningBluePrintBestPractices_2.png\">\n<h2>ê²°ê³¼</h2>\n<pre><code class=\"hljs language-js\"> $ aws-vault exec terraform-production terragrunt apply\n\n\n\në°±ì—”ë“œ ì´ˆê¸°í™” ì¤‘...\n\në°±ì—”ë“œ <span class=\"hljs-string\">\"s3\"</span>ì´ ì„±ê³µì ìœ¼ë¡œ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ë°±ì—”ë“œ êµ¬ì„±ì´ ë³€ê²½ë˜ì§€ ì•ŠëŠ” í•œ <span class=\"hljs-title class_\">Terraform</span>ì€\nìë™ìœ¼ë¡œì´ ë°±ì—”ë“œë¥¼ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.\nëª¨ë“ˆ ì´ˆê¸°í™” ì¤‘...\n<span class=\"hljs-title function_\">jobs_logs</span>(ì„)ë¥¼ ìœ„í•´ <span class=\"hljs-attr\">git</span>::<span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//github.com/terraform-aws-modules/terraform-aws-dynamodb-table.gitì„(ë¥¼) ë‹¤ìš´ë¡œë“œ ì¤‘...</span>\n- .<span class=\"hljs-property\">terraform</span>/modules/logsì— jobs_logs\n- ../lambda-execution-roleì— lambda_execution_role\n<span class=\"hljs-title function_\">s3_bucket_files</span>(ì„)ë¥¼ ìœ„í•´ <span class=\"hljs-attr\">git</span>::<span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//github.com/terraform-aws-modules/terraform-aws-s3-bucket.git?ref=v3.6.1ì„(ë¥¼) ë‹¤ìš´ë¡œë“œ ì¤‘...</span>\n- .<span class=\"hljs-property\">terraform</span>/modules/s3_bucket_filesì— s3_bucket_files\n- ../ssm-parameters-storeì— ssm_params\n\nì œê³µì í”ŒëŸ¬ê·¸ì¸ ì´ˆê¸°í™” ì¤‘...\n- ì¢…ì†ì„± ì ê¸ˆ íŒŒì¼ì—ì„œ ì´ì „ ë²„ì „ì˜ hashicorp/aws ì¬ì‚¬ìš©\n- hashicorp/aws v5<span class=\"hljs-number\">.23</span><span class=\"hljs-number\">.1</span> ì„¤ì¹˜ ì¤‘...\n- hashicorp/aws v5<span class=\"hljs-number\">.23</span><span class=\"hljs-number\">.1</span> ì„¤ì¹˜ë¨ (<span class=\"hljs-title class_\">HashiCorp</span>ì—ì„œ ì„œëª…ë¨)\n\n<span class=\"hljs-title class_\">Terraform</span>ì´ ì„±ê³µì ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ì œ <span class=\"hljs-title class_\">Terraform</span>ì„ ì‚¬ìš©í•˜ì—¬ ì‘ì—…ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <span class=\"hljs-string\">\"terraform plan\"</span>ì„ ì‹¤í–‰í•˜ì—¬\nì¸í”„ë¼ì— í•„ìš”í•œ ëª¨ë“  ë³€ê²½ ì‚¬í•­ì„ í™•ì¸í•´ ë³´ì„¸ìš”. ì´ì œ ëª¨ë“  <span class=\"hljs-title class_\">Terraform</span> ëª…ë ¹ì´\nì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤.\n\n<span class=\"hljs-title class_\">Terraform</span>ì„ ìœ„í•´ ëª¨ë“ˆì´ë‚˜ ë°±ì—”ë“œ êµ¬ì„±ì„ ì„¤ì • ë˜ëŠ” ë³€ê²½í•œ ê²½ìš°,\nì‘ì—… ë””ë ‰í„°ë¦¬ë¥¼ ë‹¤ì‹œ ì´ˆê¸°í™”í•˜ë ¤ë©´ì´ ëª…ë ¹ì„ ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”. ìŠì–´ ë²„ë¦° ê²½ìš°\në‹¤ë¥¸ ëª…ë ¹ì´ í•„ìš”í•œ ê²½ìš°ì´ë¥¼ ê°ì§€í•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•˜ë¼ëŠ” ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤.\nìƒíƒœ ì ê¸ˆ íšë“ ì¤‘. ì´ ì‘ì—…ì€ ëª‡ ë¶„ ì •ë„ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤...\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">lambda_execution_role</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">aws_iam_policy_document</span>.<span class=\"hljs-property\">lambda_assume_role_policy</span>: ì½ëŠ” ì¤‘...\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">s3_bucket_files</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">aws_caller_identity</span>.<span class=\"hljs-property\">current</span>: ì½ëŠ” ì¤‘...\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">s3_bucket_files</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">aws_canonical_user_id</span>.<span class=\"hljs-property\">this</span>: ì½ëŠ” ì¤‘...\ndata.<span class=\"hljs-property\">aws_caller_identity</span>.<span class=\"hljs-property\">current</span>: ì½ëŠ” ì¤‘...\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">s3_bucket_files</span>.<span class=\"hljs-property\">aws_s3_bucket</span>.<span class=\"hljs-property\">this</span>[<span class=\"hljs-number\">0</span>]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=my-company-myapp-files-dev]\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">jobs_logs</span>.<span class=\"hljs-property\">aws_dynamodb_table</span>.<span class=\"hljs-property\">this</span>[<span class=\"hljs-number\">0</span>]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=my-company-myapp-logs]\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">lambda_execution_role</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">aws_iam_policy_document</span>.<span class=\"hljs-property\">lambda_assume_role_policy</span>: <span class=\"hljs-number\">0</span>ì´ˆ í›„ì— ì½ê¸° ì™„ë£Œ [id=<span class=\"hljs-number\">000000000</span>]\ndata.<span class=\"hljs-property\">aws_caller_identity</span>.<span class=\"hljs-property\">current</span>: <span class=\"hljs-number\">0</span>ì´ˆ í›„ì— ì½ê¸° ì™„ë£Œ [id=<span class=\"hljs-number\">000000000</span>]\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">lambda_execution_role</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">aws_iam_policy_document</span>.<span class=\"hljs-property\">inline_policy</span>: ì½ëŠ” ì¤‘...\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">s3_bucket_files</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">aws_caller_identity</span>.<span class=\"hljs-property\">current</span>: <span class=\"hljs-number\">0</span>ì´ˆ í›„ì— ì½ê¸° ì™„ë£Œ [id=<span class=\"hljs-number\">000000000</span>]\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">lambda_execution_role</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">aws_iam_policy_document</span>.<span class=\"hljs-property\">inline_policy</span>: <span class=\"hljs-number\">0</span>ì´ˆ í›„ì— ì½ê¸° ì™„ë£Œ [id=<span class=\"hljs-number\">000000000</span>]\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">lambda_execution_role</span>.<span class=\"hljs-property\">aws_iam_role</span>.<span class=\"hljs-property\">lambda_execution_role</span>: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=my-company-myapp-lambda-execution-role]\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">s3_bucket_files</span>.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">aws_canonical_user_id</span>.<span class=\"hljs-property\">this</span>: <span class=\"hljs-number\">1</span>ì´ˆ í›„ì— ì½ê¸° ì™„ë£Œ [id=51528157cefbacf17d3cc90bf31e07f8f463cadfbf31739f6b264afac67fb2ce]\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">s3_bucket_files</span>.<span class=\"hljs-property\">aws_s3_bucket_public_access_block</span>.<span class=\"hljs-property\">this</span>[<span class=\"hljs-number\">0</span>]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=my-company-myapp-files-dev]\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">ssm_params</span>.<span class=\"hljs-property\">aws_ssm_parameter</span>.<span class=\"hljs-property\">this</span>[<span class=\"hljs-string\">\"2\"</span>]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=<span class=\"hljs-regexp\">/app/my</span>app/lambda_role]\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">ssm_params</span>.<span class=\"hljs-property\">aws_ssm_parameter</span>.<span class=\"hljs-property\">this</span>[<span class=\"hljs-string\">\"3\"</span>]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=<span class=\"hljs-regexp\">/app/my</span>app/event_bridge_name]\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">ssm_params</span>.<span class=\"hljs-property\">aws_ssm_parameter</span>.<span class=\"hljs-property\">this</span>[<span class=\"hljs-string\">\"4\"</span>]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=<span class=\"hljs-regexp\">/app/my</span>app/logs]\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">ssm_params</span>.<span class=\"hljs-property\">aws_ssm_parameter</span>.<span class=\"hljs-property\">this</span>[<span class=\"hljs-string\">\"1\"</span>]: ìƒíƒœ ìƒˆë¡œ ê³ ì¹¨ ì¤‘... [id=<span class=\"hljs-regexp\">/app/my</span>app/s3_bucket_files]\n\në³€ê²½ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤. ì¸í”„ë¼ê°€ êµ¬ì„±ê³¼ ì¼ì¹˜í•©ë‹ˆë‹¤.\n\n<span class=\"hljs-title class_\">Terraform</span>ì€ ì‹¤ì œ ì¸í”„ë¼ë¥¼ êµ¬ì„±ê³¼ ë¹„êµí•˜ê³  ì°¨ì´ì ì„ ì°¾ì•˜ìœ¼ë©° ë³€ê²½ ì‚¬í•­ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nìƒíƒœ ì ê¸ˆ í•´ì œ ì¤‘. ì´ ì‘ì—…ì€ ëª‡ ë¶„ ì •ë„ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤...\n</code></pre>\n<p>ì½ì–´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!</p>\n</body>\n</html>\n"},"__N_SSG":true}