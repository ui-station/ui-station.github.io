<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>오픈 소스 LLM을 활용한 자연어를 SQL 쿼리로 변환하기 | ui-station</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://ui-station.github.io///post/2024-05-18-NaturalLanguagetoSQLQueryusinganOpenSourceLLM" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="오픈 소스 LLM을 활용한 자연어를 SQL 쿼리로 변환하기 | ui-station" data-gatsby-head="true"/><meta property="og:title" content="오픈 소스 LLM을 활용한 자연어를 SQL 쿼리로 변환하기 | ui-station" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-18-NaturalLanguagetoSQLQueryusinganOpenSourceLLM_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://ui-station.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://ui-station.github.io///post/2024-05-18-NaturalLanguagetoSQLQueryusinganOpenSourceLLM" data-gatsby-head="true"/><meta name="twitter:title" content="오픈 소스 LLM을 활용한 자연어를 SQL 쿼리로 변환하기 | ui-station" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-18-NaturalLanguagetoSQLQueryusinganOpenSourceLLM_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | ui-station" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-18 18:19" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-V5DKFTZ6BX"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-V5DKFTZ6BX');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cd012fc8787133d0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cd012fc8787133d0.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/_next/static/chunks/348-d11c34b645b13f5b.js" defer=""></script><script src="/_next/static/chunks/551-3069cf29fe274aab.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-561ae49ab5aab7f5.js" defer=""></script><script src="/_next/static/ll1cGyplNwh83dpggeai1/_buildManifest.js" defer=""></script><script src="/_next/static/ll1cGyplNwh83dpggeai1/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UI STATION</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">오픈 소스 LLM을 활용한 자연어를 SQL 쿼리로 변환하기</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="오픈 소스 LLM을 활용한 자연어를 SQL 쿼리로 변환하기" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UI STATION</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 18, 2024</span><span class="posts_reading_time__f7YPP">32<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-18-NaturalLanguagetoSQLQueryusinganOpenSourceLLM&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><h1>소개</h1>
<p>데이터 활용의 동적인 풍경에서는 데이터베이스와 손쉽게 상호 작용할 수 있는 능력이 중요합니다. 전통적으로 이 상호 작용은 구조화된 쿼리 언어(SQL)에 대한 심층적인 이해가 필요하여 많은 사용자들에게 진입 장벽이 되었습니다. 그러나 자연어 처리(NLP)를 SQL 쿼리 엔진에 적용하여 이 풍경이 변화되었으며, 이를 통해 사용자들이 자연어 명령을 사용하여 데이터베이스와 소통할 수 있게 되었습니다. 이 첨단 기술은 인간의 언어를 SQL 쿼리로 순조롭게 번역하여 데이터를 검색하고 조작하는 방식을 혁신하고 있습니다.</p>
<p>자연어 처리(NLP)에서 Mistral 7B 및 Microsoft Phi-3과 같은 모델은 주요 역할을 하며 성능과 효율성의 경계를 재정의하고 있습니다.</p>
<p>Mistral 7B는 NLP 작업에서 뛰어난 성능과 정밀도로 높이 평가 받고 있습니다. 그룹화된 쿼리 어텐션(GQA) 및 슬라이딩 윈도우 어텐션(SWA)과 같은 혁신적인 기능들을 갖춘 Mistral 7B는 수학 및 코드 생성을 포함한 다양한 벤치마크에서 우수한 성과를 거두고 있습니다. Code-Llama 7B의 코딩 능력에 가까워짐과 동시에 NLP 발전에서의 중요성을 강조하며 다양한 분야에서 우수성을 유지하고 있습니다.</p>
<div class="content-ad"></div>
<p>Phi-3 는 작은 언어 모델(SLMs) 분야에서의 Microsoft의 최신 혁신으로, AI의 풍경을 변화시키는 대단한 제품입니다. Phi-3-mini, Phi-3-small 및 Phi-3-medium으로 구성된 이 모델군은 간결한 구성으로 뛰어난 성능을 제공합니다. 38억 개의 파라미터를 자랑하는 Phi-3-mini는 더 큰 모델들과 견줄 만한 성능을 발휘하면서도 스마트폰에서 효율적으로 동작합니다. Phi-3의 성공 뒤에는 견고함, 안전성 및 대화 능력을 중시하는 정교하게 선별된 학습 데이터셋이 있습니다. Phi-3-small 및 Phi-3-medium은 Phi-3의 능력을 더욱 확장하여 다양한 응용 분야에 대응합니다. 정교하게 설계된 아키텍처와 학습 방법을 통해 Phi-3은 AI 기술의 큰 발전을 상징하며, 다양한 생성형 AI 작업에 대한 우수한 성능과 효율성을 약속합니다.</p>
<p>NLP와 SQL의 교차점을 탐색하여 Mistral 7B와 Microsoft Phi-3의 활용에 대해 알아봅니다. 이러한 모델들은 자연어 쿼리를 구조화된 SQL 쿼리로 원활하게 변환하여 데이터베이스 쿼리 작업에서 향상된 효율성과 정확도를 제공합니다.</p>
<p><img src="/assets/img/2024-05-18-NaturalLanguagetoSQLQueryusinganOpenSourceLLM_0.png" alt=""/></p>
<h1>학습 목표</h1>
<div class="content-ad"></div>
<p>이 블로그 포스트에서는 오픈 소스 Mistral 7B 모델을 NL2SQL 작업에 활용하는 복잡성을 탐색할 것입니다. 또한 NL2SQL 애플리케이션을 위해 모델을 맞춤화하고 훈련하는 방법에 대해 논의할 것입니다. 기사의 나머지 부분은 다음과 같은 내용을 다룹니다.</p>
<h1>동기부여</h1>
<p>오픈 소스 LLMs를 활용하면 자연어 명령을 SQL 쿼리로 변환하는 복잡한 프로세스를 실행할 수 있습니다. 이 혁신적인 기술은 사용자가 수동 쿼리 작성 없이 데이터 요구 사항을 자연스럽게 표현하도록 자동화하며, 이로써 사용자의 입력을 분석하고 의미론적으로 정확한 SQL 쿼리를 생성하는 복잡한 알고리즘과 대규모 언어 모델이 활용됩니다. 이는 변환 프로세스를 간소화시키고 광범위한 사용자들에게 광범위한 SQL 지식이 없어도 데이터를 이용할 수 있게 합니다. 오픈 소스 LLMs는 편리함을 제공하며 데이터 접근성과 운영 효율성을 크게 향상시킵니다. SQL 전문 지식의 장벽을 제거함으로써 이 기술은 데이터 접근성을 민주화시키고 각 분야의 사용자들이 데이터를 검색하고 통찰을 얻는 데 도움을 줍니다. 실시간 통찰을 찾는 비즈니스 분석가나 데이터 집합을 탐색하는 일반 사용자를 위한 것이든, 자연어 명령의 직관적인 성격은 데이터 검색을 간단하게 합니다.</p>
<p>또한 이러한 모델에서 내재된 자동화는 쿼리 실행을 가속화하여 전반적인 효율성과 생산성을 높입니다. 오픈 소스 LLMs의 영향력은 광범위하며 다양한 산업 전반에 혁신과 변화를 격려합니다. 이 기술은 재무, 건강 관리 및 전자 상거래 분야와 같이 데이터 주도적 의사 결정이 중요한 분야에서 이해하기 쉬운 인사이트를 추출할 수 있도록 이해권자를 돕습니다. 더 나아가, 고급 분석 플랫폼과 인공 지능 시스템과의 통합을 통해 조직을 데이터 주도적 우수성으로 이끕니다. 탐구 문화를 육성하고 데이터 상호작용을 간소화함으로써 오픈 소스 LLMs는 데이터 자산의 모든 잠재력을 발휘함으로써 산업 전반에 혁신과 성장을 촉진합니다.</p>
<div class="content-ad"></div>
<h1>1. NL2SQL을 위한 사전 훈련 모델 (Mistral 7B)</h1>
<p>Mistral AI가 개발한 70억 개의 파라미터를 가진 언어 모델인 Mistral 7B는 인공 지능 분야에서 강력한 모델로 빠르게 인기를 얻고 있습니다.</p>
<ul>
<li>기본 모델로 위치 지정된 Mistral 7B는 자연어 처리에서 중요한 역할을 하는 가장 중요한 구조적 모델로 자리 잡았으며 대규모 언어 모델 환경 내에서 필수적인 코어 빌딩 블록의 중요성을 보여줍니다.</li>
<li>건축적 접근 방식으로 차별화된 Mistral 7B는 빠른 추론을 위해 그룹화된 쿼리 어텐션 (GQA)과 긴 시퀀스를 효율적으로 처리하기 위한 슬라이딩 윈도우 어텐션 (SWA)과 같은 혁신적인 기능을 활용하여 우수한 성능을 발휘합니다.</li>
<li>주로 영어에 초점을 맞추지만 코딩 능력도 갖춘 Mistral 7B는 특히 다른 모델들보다 더 넓은 컨텍스트에서 텍스트를 이해하고 생성할 수 있는 높은 문맥 윈도우를 가지고 있어 두각을 나타냅니다.</li>
<li>73억 개의 파라미터로 인상적인 Mistral 7B는 최신 언어 모델을 대표하는데, Apache 2.0 라이센스 하에 제한 없이 사용할 수 있습니다.</li>
<li>Mistral 7B는 모든 평가된 벤치마크에서 최고의 오픈 13B 모델 (Llama-2)보다 우수한 성과를 거두며 최고의 34B 모델 (Llama-1)보다 추론평가, 수학 및 코드 생성에서 뛰어난 성능을 보여줍니다.</li>
<li>Mistral-7B는 Llama2-13B보다 우수한 성능을 보이며 CodeLlama-7B와 경쟁력 있는 성과를 보이며 특히 추론, 수학 및 코드 생성 벤치마크에서 뛰어납니다.</li>
<li>더 큰 모델들에 비해 크기는 작지만, Mistral 7B는 텍스트 요약, 분류, 텍스트 완성 및 코드 완성을 포함한 다양한 자연어 작업에서 우수한 성과를 거둡니다.</li>
<li>이 모델이 자연어 쿼리를 구조화된 SQL 명령어로 변환하는 효과를 탐색하여 능력을 자세히 살펴봅시다.</li>
</ul>
<h2>Sliding Window Attention</h2>
<div class="content-ad"></div>
<ul>
<li>Mistral 7B은 전통적인 주의 메커니즘에서 발생하는 도전에 효과적으로 대처할 수 있는 슬라이딩 윈도우 어텐션(Sliding Window Attention, SWA) 메커니즘을 포함하고 있습니다. 전자는 토큰 수가 증가함에 따라 추론 중 지연 시간이 증가하고 처리량이 감소할 수 있으며, 시퀀스 길이와 메모리와 관련된 연산이 이차적으로 증가하고 메모리가 선형적으로 증가할 수 있습니다. 반면에 SWA는 각 토큰의 주의를 이전 레이어의 W개 토큰을 최대한으로 제한하여 주어진 윈도우 크기 W를 넘어서 주의를 확장합니다.</li>
<li>SWA는 트랜스포머의 계층 구조를 활용하여 위치 i의 숨겨진 상태가 입력 레이어의 토큰을 W x k 토큰까지 액세스할 수 있도록 지원합니다. 최종 레이어에서 W = 4096의 윈도우 크기로, SWA는 이론적으로 대략 131K 토큰의 주의 범위를 달성할 수 있습니다. 실제적으로 W = 4096 및 FlashAttention과 xFormers의 최적화 기법을 사용하여, 16K 토큰 시퀀스의 경우 바닐라 주의 기준에 비해 주목할만한 2배의 속도 향상이 가능합니다. 따라서, SWA는 주의 메커니즘의 성능을 혁신적으로 향상시킬 수 있는 강력하고 효율적인 접근 방식입니다.</li>
</ul>
<h3>b. 롤링 버퍼 캐시</h3>
<ul>
<li>롤링 버퍼 캐시를 구현함으로써, Mistral 7B는 고정된 주의 범위를 전략적으로 사용하여 캐시 크기를 효과적으로 제어합니다. 이 캐시는 W로 표시된 고정된 크기로, 캐시 내에서 특정 시간 단계 i에서 시간 단계 i mod W에 키와 값들을 효율적으로 저장합니다. 시퀀스가 진행되고 i가 W를 초과할 때, 캐시는 롤링 버퍼 메커니즘을 사용하여 이전 값들을 덮어쓰고 무한정으로 확장되는 것을 방지합니다. W = 3으로 설명된 이 접근 방식은 32k 토큰 시퀀스에 대해 8배의 캐시 메모리 사용량 감소를 실현함으로써, 모델의 품질을 희생하지 않고 달성합니다. 고정된 주의 범위는 효율적인 메모리 이용을 보장할 뿐만 아니라 Mistral 7B가 길이가 다른 시퀀스를 처리하는 데에 원활하게 기능하는 데에 기여합니다.</li>
</ul>
<h3>c. 사전 채움 및 청크 분할</h3>
<div class="content-ad"></div>
<ul>
<li>시퀀스 생성 과정에서는 문맥 정보에 기반하여 순차적으로 토큰을 예측하는데, (k, v) 캐시를 사용하여 효율적으로 최적화됩니다. 알려진 프롬프트로 미리 채워진 캐시를 활용하여 효율성을 높입니다. 긴 프롬프트를 관리하기 위해 지정된 윈도우 크기를 사용하여 작은 청크로 나누고, 각 청크를 사용하여 캐시를 미리 채웁니다. 이 전략적 접근 방식은 시퀀스 생성 프로세스 중 캐시 내부 및 현재 청크 전체에서 주의력을 계산하는 것을 포함합니다. 이 방법을 활용함으로써 Mistral 7B는 시퀀스 생성의 효율성을 향상시키며, 캐시에 저장된 미리 알려진 프롬프트를 효율적으로 활용하여 각 예측된 토큰을 이전 토큰과 조화롭게 정렬합니다.</li>
<li>언어 모델의 동적인 환경에서 Mistral 7B의 등장은 성능과 효율성 면에서 큰 도약을 의미합니다. 포괄적인 평가 파이프라인을 통해 Mistral 7B는 자신의 능력을 입증하며, 이전 제품인 Llama 2 7B 및 Llama 2 13B뿐만 아니라 Llama 1 34B와 같은 핵심 벤치마크에서 뛰어난 성능을 보여줌으로써 뛰어난 경쟁력을 나타냅니다.</li>
<li>Mistral 7B의 우월성은 모든 측정 항목에 걸쳐 명백히 드러나며, 해당 분야의 선도주자로서의 지위를 재확인합니다. 다양한 벤치마크에 대한 면밀한 재평가 과정은 Mistral 7B의 탁월한 능력을 일관되게 입증하며, 경쟁사를 뒤로 남깁니다.</li>
</ul>
<h2>크기 및 효율성 분석</h2>
<ul>
<li>Mistral 7B의 매력 중요 요소 중 하나는 혁신적인 &quot;동등한 모델 크기&quot; 계산 방식을 통한 효율성입니다. 추론, 이해 및 STEM 추론 등에서 평가한 결과, Mistral 7B는 세 배 이상 크기의 Llama 2 모델과 동등한 성능을 보여줍니다. 이 효율성은 과도한 매개변수 부담 없이 뛰어난 결과를 제공할 수 있는 Mistral 7B의 능력을 입증합니다.</li>
<li>Mistral 7B의 효율성을 더 자세히 살펴보면, 평가 결과에서 지식 압축에 대한 흥미로운 통찰력을 확인할 수 있습니다. 지식 벤치마크에서 1.9배 낮은 압축률을 달성하지만, 이는 Mistral 7B의 의도적으로 제한된 매개변수 수에 기인합니다. 이 제한은 저장된 지식 양을 제한하지만, Mistral 7B는 집중하고 효과적으로 매개변수를 활용하여 보상합니다.</li>
</ul>
<h1>평가의 차이점</h1>
<div class="content-ad"></div>
<p>불일치 사항을 투명하게 다루면서, 평가 규정의 변화를 유의하는 것이 중요합니다. 어떤 벤치마크에서는 Llama 2의 MBPP와 Mistral 7B의 평가 결과 사이에 차이가 발생합니다. TriviaQA에서 손으로 검증된 데이터를 사용하는 것이 Mistral 7B의 성능 지표의 신뢰성에 기여하는 강건한 평가 과정을 확인하게 됩니다.</p>
<h1>데이터셋</h1>
<p>아래 열로 구성된 구조 데이터베이스를 사용할 계획입니다. 다음 테이블에서 다양한 검색을 수행할 것입니다.</p>
<pre><code class="hljs language-js">transaction = [
        <span class="hljs-string">&quot;transaction_id&quot;</span>,
        <span class="hljs-string">&quot;transaction_amount&quot;</span>,
        <span class="hljs-string">&quot;transaction_date&quot;</span>,
        <span class="hljs-string">&quot;transaction_type&quot;</span>,
        <span class="hljs-string">&quot;transaction_status&quot;</span>,
        <span class="hljs-string">&quot;transaction_description&quot;</span>,
        <span class="hljs-string">&quot;transaction_source_account&quot;</span>,
        <span class="hljs-string">&quot;transaction_destination_account&quot;</span>,
        <span class="hljs-string">&quot;transaction_currency&quot;</span>,
        <span class="hljs-string">&quot;transaction_fee&quot;</span>
    ]
</code></pre>
<div class="content-ad"></div>
<h1>코드 구현</h1>
<ul>
<li>패키지 설치하기</li>
</ul>
<pre><code class="hljs language-js">!pip install git+<span class="hljs-attr">https</span>:<span class="hljs-comment">//github.com/huggingface/transformers.git </span>
!pip install deepspeed --upgrade
!pip install accelerate
!pip install sentencepiece
!pip install langchain
!pip install torch
!pip install bitsandbytes
</code></pre>
<ol start="2">
<li>패키지 불러오기</li>
</ol>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> difflib <span class="hljs-keyword">import</span> <span class="hljs-title class_">SequenceMatcher</span>
<span class="hljs-keyword">from</span> langchain.<span class="hljs-property">chains</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">LLMChain</span>
<span class="hljs-keyword">from</span> langchain <span class="hljs-keyword">import</span> <span class="hljs-title class_">PromptTemplate</span>, <span class="hljs-title class_">LLMChain</span>
<span class="hljs-keyword">from</span> langchain.<span class="hljs-property">llms</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">HuggingFacePipeline</span>
<span class="hljs-keyword">from</span> langchain_core.<span class="hljs-property">prompts</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">PromptTemplate</span>
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> <span class="hljs-title class_">LlamaTokenizer</span>, <span class="hljs-title class_">LlamaForCausalLM</span>, pipeline
</code></pre>
<ol start="3">
<li>모델 불러오기</li>
</ol>
<pre><code class="hljs language-js">base_model = <span class="hljs-title class_">LlamaForCausalLM</span>.<span class="hljs-title function_">from_pretrained</span>(
     <span class="hljs-string">&quot;mistralai/Mistral-7B-Instruct-v0.1&quot;</span>,
     load_in_8bit=<span class="hljs-title class_">True</span>,
     device_map=<span class="hljs-string">&#x27;auto&#x27;</span>,
    )
tokenizer = <span class="hljs-title class_">LlamaTokenizer</span>.<span class="hljs-title function_">from_pretrained</span>(<span class="hljs-string">&quot;mistralai/Mistral-7B-Instruct-v0.1&quot;</span>)
pipe = <span class="hljs-title function_">pipeline</span>(
        <span class="hljs-string">&quot;text-generation&quot;</span>,
        model=base_model,
        tokenizer=tokenizer,
        max_length=<span class="hljs-number">500</span>,
        temperature=<span class="hljs-number">0.3</span>,
        top_p=<span class="hljs-number">0.95</span>,
        repetition_penalty=<span class="hljs-number">1.2</span>
    )
local_llm = <span class="hljs-title class_">HuggingFacePipeline</span>(pipeline=pipe)
</code></pre>
<ol start="4">
<li>SequenceMatcher</li>
</ol>
<div class="content-ad"></div>
<p>이 Python 함수는 difflib 모듈의 SequenceMatcher 클래스를 활용하여 쿼리와 지정된 사전의 열 이름 간의 유사도 점수를 계산하여 쿼리 이해력과 대체를 향상시킵니다.</p>
<pre><code class="hljs language-js">def <span class="hljs-title function_">find_columns_match</span>(question, input_dict):
<span class="hljs-attr">try</span>:
  question_list = re.<span class="hljs-title function_">split</span>(r<span class="hljs-string">&#x27;\s|,|\.&#x27;</span>, question)
  <span class="hljs-keyword">for</span> index, string2 <span class="hljs-keyword">in</span> <span class="hljs-title function_">enumerate</span>(question_list):
    <span class="hljs-keyword">for</span> string1 <span class="hljs-keyword">in</span> input_dict.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;table1_columns&#x27;</span>):
      score = <span class="hljs-title class_">SequenceMatcher</span>(<span class="hljs-title class_">None</span>,string1.<span class="hljs-title function_">lower</span>(), string2.<span class="hljs-title function_">lower</span>()).<span class="hljs-title function_">ratio</span>()*<span class="hljs-number">100</span>
      <span class="hljs-keyword">if</span> score &gt; <span class="hljs-number">91</span>:
        question_list[index] = string1 + <span class="hljs-string">&quot;,&quot;</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot; &quot;</span>.<span class="hljs-title function_">join</span>(question_list)
  
<span class="hljs-attr">except</span>:
 <span class="hljs-keyword">return</span> question
</code></pre>
<p>이 Python 함수 query_generator은 제공된 테이블명, 열 목록 및 질문에 기반하여 SQL 쿼리를 생성합니다. 이는 템플릿 문자열을 활용하여 쿼리 생성 프로세스를 구조화하며, 테이블 명, 열 목록 및 질문에 대한 자리 표시자를 포함합니다. 그런 다음 PromptTemplate 객체를 사용하여 이러한 자리 표시자를 채워넣고 LLMChain을 통해 대형 언어 모델 (LLM)과 상호 작용하여 SQL 쿼리를 생성합니다. 마지막으로 생성된 SQL 쿼리를 출력합니다.</p>
<pre><code class="hljs language-js">def <span class="hljs-title function_">query_generator</span>(tble, cols, question):

  template = <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;Generate a SQL query using the following table name: {Table}, and columns as a list: {Columns}, to answer the following question:
  {question}.
  
  Output Query:
  
  &quot;</span><span class="hljs-string">&quot;&quot;</span>
  
  prompt = <span class="hljs-title class_">PromptTemplate</span>(template=template, input_variables=[<span class="hljs-string">&quot;Table&quot;</span>, <span class="hljs-string">&quot;question&quot;</span>, <span class="hljs-string">&quot;Columns&quot;</span>])
  
  llm_chain = <span class="hljs-title class_">LLMChain</span>(prompt=prompt, llm=local_llm)
  
  response = llm_chain.<span class="hljs-title function_">run</span>({<span class="hljs-string">&quot;Table&quot;</span>: tble, <span class="hljs-string">&quot;question&quot;</span>: question, <span class="hljs-string">&quot;Columns&quot;</span>: cols})
  <span class="hljs-title function_">print</span>(response)
</code></pre>
<div class="content-ad"></div>
<h1>표</h1>
<p>transaction = [
&quot;transaction_id&quot;,
&quot;transaction_amount&quot;,
&quot;transaction_date&quot;,
&quot;transaction_type&quot;,
&quot;transaction_status&quot;,
&quot;transaction_description&quot;,
&quot;transaction_source_account&quot;,
&quot;transaction_destination_account&quot;,
&quot;transaction_currency&quot;,
&quot;transaction_fee&quot;
]</p>
<p>inputs = [&quot;transaction_id가 10인 경우 transaction_amount, transaction_date, transaction_type,transaction_description을 검색하는 SQL 쿼리 생성&quot;,
&quot;transaction_status가 &#x27;completed&#x27;인 경우 transaction_id, transaction_date, transaction_type, transaction_source_account을 검색하는 SQL 쿼리 생성&quot;,
&quot;transaction_type 및 평균 transaction_amount의 개수를 검색하고 transaction_type로 정렬하는 SQL 쿼리 생성&quot;,
&quot;각 소스 계정별 총 거래 금액 목록을 검색하고 총 거래 금액을 내림차순으로 정렬하는 SQL 쿼리 생성&quot;,
&quot;각 거래 유형별 최대 거래 금액을 검색하고 거래 유형으로 정렬하는 SQL 쿼리 생성&quot;]</p>
<p>for input in inputs:
query_generator(&quot;transaction&quot;,transaction ,question=find_columns_match(input,transaction))</p>
<h1>응답</h1>
<ul>
<li>다음과 같은 테이블 이름을 사용하고 컬럼을 나열한 리스트를 사용하여 SQL 쿼리를 생성하십시오: transaction 및 [‘transaction_id’, ‘transaction_amount’, ‘transaction_date’, ‘transaction_type’, ‘transaction_status’, ‘transaction_description’, ‘transaction_source_account’, ‘transaction_destination_account’, ‘transaction_currency’, ‘transaction_fee’], 다음 질문에 대한 응답을 위해 SQL 쿼리를 생성하십시오: (‘transaction_id가 10인 경우 transaction_amount, transaction_date, transaction_type,transaction_description을 검색하는 SQL 쿼리 생성’).</li>
</ul>
<div class="content-ad"></div>
<pre><code class="hljs language-js">출력 쿼리: 

  <span class="hljs-variable constant_">SELECT</span> transaction_amount, transaction_date, transaction_type, transaction_description <span class="hljs-variable constant_">FROM</span> transaction <span class="hljs-variable constant_">WHERE</span> transaction_id = <span class="hljs-number">10</span>;
</code></pre>
<ol start="2">
<li>다음과 같은 테이블 이름인 transaction과 열 목록인 [‘transaction_id’, ‘transaction_amount’, ‘transaction_date’, ‘transaction_type’, ‘transaction_status’, ‘transaction_description’, ‘transaction_source_account’, ‘transaction_destination_account’, ‘transaction_currency’, ‘transaction_fee’]을 사용하여 다음 질문에 대한 SQL 쿼리를 생성하십시오:
(‘transaction_status가 ‘completed’인 경우 transaction_id, transaction_date, transaction_type, transaction_source_account를 검색하는 SQL 쿼리를 생성하십시오’).</li>
</ol>
<pre><code class="hljs language-js">출력 쿼리:
  <span class="hljs-variable constant_">SELECT</span> transaction_id, transaction_date, transaction_type, transaction_source_account <span class="hljs-variable constant_">FROM</span> transaction <span class="hljs-variable constant_">WHERE</span> transaction_status = <span class="hljs-string">&#x27;completed&#x27;</span>
</code></pre>
<ol start="3">
<li>다음과 같은 테이블 이름인 transaction과 열 목록인 [‘transaction_id’, ‘transaction_amount’, ‘transaction_date’, ‘transaction_type’, ‘transaction_status’, ‘transaction_description’, ‘transaction_source_account’, ‘transaction_destination_account’, ‘transaction_currency’, ‘transaction_fee’]을 사용하여 다음 질문에 대한 SQL 쿼리를 생성하십시오:
(‘transaction_type의 count와 평균 transaction_amount를 가져오고 transaction_type으로 정렬하십시오’).```</li>
</ol>
<div class="content-ad"></div>
<pre><code class="hljs language-js">결과 쿼리:

  <span class="hljs-variable constant_">SELECT</span> transaction_type, <span class="hljs-title function_">AVG</span>(transaction_amount) <span class="hljs-variable constant_">AS</span> avg_transaction_amount, <span class="hljs-title function_">COUNT</span>(*) <span class="hljs-variable constant_">AS</span> total_count
  <span class="hljs-variable constant_">FROM</span> transaction
  <span class="hljs-variable constant_">GROUP</span> <span class="hljs-variable constant_">BY</span> transaction_type
  <span class="hljs-variable constant_">ORDER</span> <span class="hljs-variable constant_">BY</span> transaction_type;
</code></pre>
<ol start="4">
<li>다음 테이블 이름과 열 목록을 사용하여 SQL 쿼리를 생성하십시오: transaction 및 열: [&#x27;transaction_id&#x27;, &#x27;transaction_amount&#x27;, &#x27;transaction_date&#x27;, &#x27;transaction_type&#x27;, &#x27;transaction_status&#x27;, &#x27;transaction_description&#x27;, &#x27;transaction_source_account&#x27;, &#x27;transaction_destination_account&#x27;, &#x27;transaction_currency&#x27;, &#x27;transaction_fee&#x27;], 다음 질문에 답하십시오:
(‘리스트에서 각 소스 계정의 총 거래 금액을 내림차순으로 정렬하여 조회하는 SQL 쿼리를 생성하세요’).</li>
</ol>
<pre><code class="hljs language-js">결과 쿼리:

       <span class="hljs-variable constant_">SELECT</span> transaction_source_account, <span class="hljs-title function_">SUM</span>(transaction_amount) <span class="hljs-variable constant_">AS</span> <span class="hljs-title class_">TotalTransactionAmount</span>
        <span class="hljs-variable constant_">FROM</span> transaction
        <span class="hljs-variable constant_">GROUP</span> <span class="hljs-variable constant_">BY</span> transaction_source_account
        <span class="hljs-variable constant_">ORDER</span> <span class="hljs-variable constant_">BY</span> <span class="hljs-title class_">TotalTransactionAmount</span> <span class="hljs-variable constant_">DESC</span>;
</code></pre>
<ol start="5">
<li>다음 테이블 이름과 열 목록을 사용하여 SQL 쿼리를 생성하십시오: transaction 및 열: [&#x27;transaction_id&#x27;, &#x27;transaction_amount&#x27;, &#x27;transaction_date&#x27;, &#x27;transaction_type&#x27;, &#x27;transaction_status&#x27;, &#x27;transaction_description&#x27;, &#x27;transaction_source_account&#x27;, &#x27;transaction_destination_account&#x27;, &#x27;transaction_currency&#x27;, &#x27;transaction_fee&#x27;], 다음 질문에 답하십시오:
(‘각 거래 유형의 최대 거래 금액을 찾아 거래 유형으로 정렬하는 SQL 쿼리를 생성하세요’).```</li>
</ol>
<div class="content-ad"></div>
<pre><code class="hljs language-js">출력 쿼리:

   <span class="hljs-variable constant_">SELECT</span> transaction_type, <span class="hljs-title function_">MAX</span>(transaction_amount) <span class="hljs-variable constant_">AS</span> max_transaction_amount
   <span class="hljs-variable constant_">FROM</span> transaction
   <span class="hljs-variable constant_">GROUP</span> <span class="hljs-variable constant_">BY</span> transaction_type
   <span class="hljs-variable constant_">ORDER</span> <span class="hljs-variable constant_">BY</span> transaction_type;
</code></pre>
<p>일반적인 추출은 효과적이지만, 연구 결과, 데이터를 세부 조정하여 LLM을 수행하면 우수한 결과를 얻을 수 있습니다. 세밀 조정 접근법을 채용해 봅시다.</p>
<h1>2 Fine-tune NL2SQL with Phi-3</h1>
<p>Phi-3를 만나보세요, Microsoft의 최신 오픈 AI 모델의 주요 성과입니다. Phi-3-mini, Phi-3-small 및 Phi-3-medium을 통해, 이 작은 언어 모델 (SLM)의 Phi-3 패밀리는 AI 모델의 세계를 혁신하도록 설계되었습니다. 38억 개의 파라미터를 사용하고 33조 개의 토큰으로 훈련된 Phi-3-mini는 높은 성능을 발휘하며 Mixtral 8x7B 및 GPT-3.5와 같은 큰 모델과 같은 성능을 보여줍니다. 게다가, 이 모델은 스마트폰 장치에서 효율적으로 작동할 수 있습니다. Phi-3의 성공은 훈련 데이터셋에 기인합니다. Phi-2의 데이터셋의 진화된 버전입니다. 상세히 걸러낸 웹 데이터 및 합성 입력을 통해 이러한 모델은 강도, 안전 및 대화 능력에 우선순위를 두어 다양한 응용프로그램에 적합합니다. 7B 및 14B 파라미터를 가진 Phi-3-small 및 Phi-3-medium은 효율 유지와 함께 Phi-3의 기능을 더욱 향상시키도록 설계되었습니다.</p>
<div class="content-ad"></div>
<h2>Phi 3 Architecture and Evaluation</h2>
<p>Phi-3 패밀리는 품질과 비용을 균형있게 유지하도록 설계된 다양한 모델을 제공하여 생성형 AI 애플리케이션을 개발하는 고객을 위한 옵션을 제공합니다.</p>
<p>Phi-3-mini: 이 모델은 38억 개의 파라미터를 갖추고 33조 개의 토큰으로 이루어진 광범위한 데이터셋을 기반으로 훈련되었습니다. 32개의 레이어, 32개의 어텐션 헤드, 그리고 3072개의 히든 디멘션을 갖는 트랜스포머 디코더 아키텍처를 채택했습니다. 디폴트 콘텍스트 길이는 4천 개의 토큰이며, 32K 어휘 사전을 사용하는 토크나이저를 활용합니다. 추가로, 128K 토큰의 콘텍스트 길이를 갖춘 확장 버전인 Phi-3-mini-128K도 있습니다.</p>
<p>Phi-3-small: 70억 개의 파라미터로 훈련된 Phi-3-small은 48조 개의 토큰을 사용합니다. 이 모델은 100K 어휘 사전과 8천 개의 디폴트 콘텍스트 길이를 갖추었습니다. 아키텍처는 32개의 레이어, 32개의 어텐션 헤드, 그리고 4096개의 히든 디멘션으로 이루어져 있습니다. 이 모델은 메모리 사용량을 최적화하기 위해 그룹화된 쿼리 어텐션과 번갈아가며 쓰이는 밀집/희소 어텐션을 활용합니다.</p>
<div class="content-ad"></div>
<p>Phi-3-medium: 이 미리보기 모델은 140억 개의 매개변수를 자랑하며 4.8조 개의 토큰으로 학습되었습니다. 40개의 레이어, 40개의 어텐션 헤드, 그리고 임베딩 크기는 5120입니다.</p>
<h2>훈련 방법:</h2>
<ul>
<li>훈련 데이터 구성: Phi-3 모델의 훈련 데이터는 신중하게 선별됩니다. 교육 수준별로 분류된 웹 데이터와 합성 LLM 생성 데이터로 구성되며 두 가지 이질적이고 순차적인 단계로 사전 훈련을 거칩니다.</li>
<li>사전 훈련 단계: 제1 단계는 일반 지식과 언어 이해에 중점을 둔 웹 소스를 사용합니다. 제2 단계는 논리 추론 및 특정 기술을 가르치기 위해 제1 단계의 웹 데이터와 합성 데이터를 더 많이 활용합니다.</li>
<li>사후 훈련 단계: 사전 훈련 후, Phi-3-mini는 감독형 세밀 조정 (SFT) 및 직접 선호도 최적화 (DPO)를 거쳤습니다. SFT는 수학, 코딩, 추론, 대화, 모델 신원, 안전 도메인 간에 높은 품질의 데이터를 선별하는 과정을 포함합니다.</li>
<li>DPO는 채팅 형식 데이터, 추론, 그리고 책임 있는 AI 노력에 초점을 맞춥니다.</li>
<li>맥락 확장: Phi-3-mini의 맥락 창 크기가 Long Rope 방법론을 사용하여 4k 토큰에서 128k 토큰으로 확장되었습니다. 이 확장은 맥락의 길이가 크게 증가함에도 일관된 성능을 유지합니다.</li>
<li>데이터 최적화: 훈련 데이터는 모델의 규모를 위한 &quot;데이터 최적&quot; 지점으로 보정됩니다. 웹 데이터는 지식과 추론의 적절한 균형을 보장하기 위해 필터링됩니다. 특히 작은 모델의 경우 이는 매우 중요합니다.</li>
<li>다른 모델과의 비교: Phi-3의 접근 방식은 이전 작업과 대조적으로, 해당 규모에 대한 데이터 품질에 중점을 두며 컴퓨팅이나 과도한 훈련 방법보다 데이터 최적화를 강조합니다. 벤치마크 비교는 Phi-3가 작은 모델 용량을 위한 최적화를 잘 보여줍니다.</li>
<li>Phi-3-medium 미리보기: 140억 개의 매개변수를 가진 Phi-3-medium은 Phi-3-mini와 유사하게 훈련되었지만 더 큰 규모로 이루어집니다. 일부 벤치마크에서는 7B에서 14B 매개변수로의 전환에서 큰 개선이 없어 계속해서 데이터 혼합을 개선 중임을 시사합니다.</li>
<li>사후 향상: 모델은 채팅 능력, 견고성, 그리고 안전성을 향상시키기 위해 감독형 세밀 조정 및 DPO를 통한 선호도 조정을 거칩니다.</li>
</ul>
<h2>안전성</h2>
<div class="content-ad"></div>
<p>Phi-3-mini은 Microsoft의 책임 있는 AI 원칙에 따라 만들어진 AI 모델입니다. 이 프로젝트는 개발 초기부터 안전을 우선시하는 원칙을 중요시하여 만들어졌습니다. 모델이 윤리 기준을 준수하고 잠재적인 피해를 최소화할 수 있는 능력을 보장하기 위해 포괄적인 전략이 채택되었습니다.</p>
<p>모델 학습 후에는, 해당 모델이 책임 있는 AI 기준을 충족하는지 확인하기 위해 면밀한 안전 조정이 이루어집니다. 게다가, Microsoft의 독립된 레드 팀이 Phi-3-mini를 검토하여 강화 및 안전 프로토콜을 강화할 수 있는 부분을 식별합니다.</p>
<p>자동화된 테스팅과 잠재적인 피해의 다양한 범주에 대한 평가는 프로세스의 중요한 부분입니다. 이러한 테스트는 모델의 출력물로부터 발생하는 모든 위험을 감지하고 해결하는 데 목표를 두고 있습니다.</p>
<p>더 나아가, Phi-3-mini는 의견 데이터 세트를 활용하여 응답을 더욱 개선합니다. 특정 테스트 중 확인된 잠재적인 피해 범주에 대응하기 위해 내부에서 생성된 데이터 세트가 사용됩니다.</p>
<div class="content-ad"></div>
<h2>코드 구현</h2>
<ul>
<li>패키지 설치</li>
</ul>
<pre><code class="hljs language-js"> !pip install -q -U bitsandbytes
 !pip install -q -U transformers
 !pip install -q -U xformers
 !pip install -q -U peft
 !pip install -q -U accelerate
 !pip install -q -U datasets
 !pip install -q -U trl
 !pip install -q -U einops
 !pip install -q -U nvidia-ml-py3
 !pip install -q -U huggingface_hub
</code></pre>
<ol start="2">
<li>패키지 가져오기</li>
</ol>
<div class="content-ad"></div>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForCausalLM, BitsAndBytesConfig, TrainingArguments, Trainer, DataCollatorForLanguageModeling
<span class="hljs-keyword">from</span> pynvml <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> time, torch
<span class="hljs-keyword">from</span> trl <span class="hljs-keyword">import</span> SFTTrainer
<span class="hljs-keyword">from</span> peft <span class="hljs-keyword">import</span> LoraConfig, PeftModel, get_peft_model, prepare_model_for_kbit_training
<span class="hljs-keyword">from</span> peft <span class="hljs-keyword">import</span> AutoPeftModelForCausalLM
</code></pre>
<ol start="3">
<li>데이터셋 불러오기</li>
</ol>
<pre><code class="hljs language-python">dataset = load_dataset(<span class="hljs-string">&quot;b-mc2/sql-create-context&quot;</span>)
dataset
</code></pre>
<ol start="4">
<li>데이터셋 형식화</li>
</ol>
<div class="content-ad"></div>
<pre><code class="hljs language-js">def <span class="hljs-title function_">create_prompt</span>(sample):
      system_prompt_template = <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&lt;s&gt;
            아래는 작업을 설명하는 지시사항입니다. 요청을 적절히 완료하는 응답을 작성하십시오.
            ### 지시사항: &lt;&lt;user_question&gt;&gt;
            ### 데이터베이스 스키마:
            &lt;&lt;database_schema&gt;&gt;
            ### 응답:
            &lt;&lt;user_response&gt;&gt;
            &lt;/s&gt;
            &quot;</span><span class="hljs-string">&quot;&quot;</span>
      user_message = sample[<span class="hljs-string">&#x27;question&#x27;</span>]
      user_response = sample[<span class="hljs-string">&#x27;answer&#x27;</span>]
      database_schema = sample[<span class="hljs-string">&#x27;context&#x27;</span>]
      prompt_template = system_prompt_template.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&quot;&lt;&lt;user_question&gt;&gt;&quot;</span>,f<span class="hljs-string">&quot;{user_message}&quot;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-string">&quot;&lt;&lt;user_response&gt;&gt;&quot;</span>,f<span class="hljs-string">&quot;{user_response}&quot;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-string">&quot;&lt;&lt;database_schema&gt;&gt;&quot;</span>,f<span class="hljs-string">&quot;{database_schema} &quot;</span>)

      <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;inputs&quot;</span>:prompt_template}


instruct_tune_dataset = dataset.<span class="hljs-title function_">map</span>(create_prompt)
<span class="hljs-title function_">print</span>(instruct_tune_dataset)

def <span class="hljs-title function_">print_gpu_utilization</span>():
    <span class="hljs-title function_">nvmlInit</span>()
    handle = <span class="hljs-title function_">nvmlDeviceGetHandleByIndex</span>(<span class="hljs-number">0</span>)
    info = <span class="hljs-title function_">nvmlDeviceGetMemoryInfo</span>(handle)
    <span class="hljs-title function_">print</span>(f<span class="hljs-string">&quot;GPU 메모리 사용량: {info.used//1024**2} MB.&quot;</span>)
</code></pre>
<ol start="5">
<li>토크나이저와 모델 로드</li>
</ol>
<pre><code class="hljs language-js">base_model_id = <span class="hljs-string">&quot;microsoft/Phi-3-mini-4k-instruct&quot;</span>

# 토크나이저 로드
tokenizer = <span class="hljs-title class_">AutoTokenizer</span>.<span class="hljs-title function_">from_pretrained</span>(base_model_id, use_fast=<span class="hljs-title class_">True</span>)
# fp16로 모델 로드
model = <span class="hljs-title class_">AutoModelForCausalLM</span>.<span class="hljs-title function_">from_pretrained</span>(base_model_id, trust_remote_code=<span class="hljs-title class_">True</span>, torch_dtype=torch.<span class="hljs-property">float16</span>, device_map={<span class="hljs-string">&quot;&quot;</span>: <span class="hljs-number">0</span>})
<span class="hljs-title function_">print</span>(<span class="hljs-title function_">print_gpu_utilization</span>())
</code></pre>
<ol start="6">
<li>모델 추론</li>
</ol>
<div class="content-ad"></div>
<h1>프롬프트 정의</h1>
<pre><code class="hljs language-bash">    prompt = [
        <span class="hljs-string">&quot;코코넛 밀크로 만든 치킨 카레 레시피를 작성해주세요.&quot;</span>,
        <span class="hljs-string">&quot;다음 문장을 프랑스어로 번역해주세요: &#x27;나는 빵과 치즈를 좋아해요!&#x27;&quot;</span>,
        <span class="hljs-string">&quot;유명한 20명의 인물을 인용해보세요.&quot;</span>,
        <span class="hljs-string">&quot;지금 달은 어디에 있나요?&quot;</span>
    ]

    <span class="hljs-comment"># 변수 초기화</span>
    duration = 0.0
    total_length = 0

    <span class="hljs-comment"># 프롬프트 반복</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(prompt)):
        <span class="hljs-comment"># 프롬프트 토큰화 및 GPU로 이동</span>
        inputs = tokenizer(prompt[i], return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).to(<span class="hljs-string">&quot;cuda:0&quot;</span>)

        <span class="hljs-comment"># 입력 텐서 인덱스를 torch.long으로 변환</span>
        inputs = {k: v.to(torch.long) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> inputs.items()}

        <span class="hljs-comment"># 시작 시간</span>
        start_time = time.time()

        <span class="hljs-comment"># 자동 캐스팅을 사용하여 추론 수행</span>
        with torch.cuda.amp.autocast(enabled=False):  <span class="hljs-comment"># 자동 캐스팅 비활성화</span>
            output = model.generate(**inputs, max_length=500)

        <span class="hljs-comment"># 소요 시간과 총 길이 계산</span>
        duration += <span class="hljs-built_in">float</span>(time.time() - start_time)
        total_length += len(output)

        <span class="hljs-comment"># 프롬프트당 토큰 속도 계산</span>
        tok_sec_prompt = round(len(output) / <span class="hljs-built_in">float</span>(time.time() - start_time), 3)

        <span class="hljs-comment"># 프롬프트당 토큰 속도 출력</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;프롬프트 --- %s 토큰/초 ---&quot;</span> % (tok_sec_prompt))

        <span class="hljs-comment"># 디코드된 출력 출력</span>
        <span class="hljs-built_in">print</span>(tokenizer.decode(output[0], skip_special_tokens=True))

    <span class="hljs-comment"># 평균 토큰 속도 계산</span>
    tok_sec = round(total_length / duration, 3)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;평균 --- %s 토큰/초 ---&quot;</span> % (tok_sec))
</code></pre>
<ol start="9">
<li>Fine-tuning되지 않은 Text to SQL</li>
</ol>
<pre><code class="hljs language-bash">    prompt = [
        <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;
        다음은 작업을 설명하는 지시사항입니다. 요청을 적절히 완료하는 응답을 작성하십시오.
        ### 지시사항 :
        각 도시의 역 중 가장 높은 위도를 가진 역순으로 모든 도시를 나열하십시오.
        데이터베이스 스키마:
        CREATE TABLE station (city VARCHAR, lat INTEGER)
        ### 응답:
        SELECT city, lat FROM station ORDER BY lat DESC;
        &quot;</span><span class="hljs-string">&quot;&quot;</span>,
        <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;
        다음은 작업을 설명하는 지시사항입니다. 요청을 적절히 완료하는 응답을 작성하십시오.
        ### 지시사항 :
        &#x27;각 선수가 20점 이상 및 10점 미만을 가지고 있으며 상위 10위 안에 있는 포지션은 무엇입니까?
        데이터베이스 스키마:
        CREATE TABLE player (POSITION VARCHAR, Points INTEGER, Ranking INTEGER)
        ### 응답:
        SELECT POSITION, Points, Ranking
        FROM player
        WHERE Points &gt; 20 AND Points &lt; 10 AND Ranking IN (1,2,3,4,5,6,7,8,9,10)
        &quot;</span><span class="hljs-string">&quot;&quot;</span>,
        <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;
        다음은 작업을 설명하는 지시사항입니다. 요청을 적절히 완료하는 응답을 작성하십시오.
        ### 지시사항 :
        노래를 가장 많이 연주한 밴드 맴버의 이름을 찾아보세요.
        데이터베이스 스키마:
        CREATE TABLE Songs (SongId VARCHAR); CREATE TABLE Band (firstname VARCHAR, id VARCHAR); CREATE TABLE Performance (bandmate VARCHAR)
        ### 응답:
        SELECT b.firstname
        FROM Band b
        JOIN Performance p ON b.id = p.bandmate
        GROUP BY b.firstname
        ORDER BY COUNT(*) DESC
        LIMIT 1;
        &quot;</span><span class="hljs-string">&quot;&quot;</span>
    ]

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(prompt)):
      model_inputs = tokenizer(prompt[i], return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).to(<span class="hljs-string">&quot;cuda:0&quot;</span>)
      start_time = time.time()
      output = model.generate(**model_inputs, max_length=500, no_repeat_ngram_size=10, pad_token_id=tokenizer.eos_token_id, eos_token_id=tokenizer.eos_token_id)[0]
      duration += <span class="hljs-built_in">float</span>(time.time() - start_time)
      total_length += len(output)
      tok_sec_prompt = round(len(output)/float(time.time() - start_time),3)
      <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;프롬프트 --- %s 토큰/초 ---&quot;</span> % (tok_sec_prompt))
      <span class="hljs-built_in">print</span>(print_gpu_utilization())
      <span class="hljs-built_in">print</span>(tokenizer.decode(output, skip_special_tokens=False))

    tok_sec = round(total_length/duration,3)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;평균 --- %s 토큰/초 ---&quot;</span> % (tok_sec))

    <span class="hljs-comment"># Fine-tuning</span>

    base_model_id = <span class="hljs-string">&quot;microsoft/Phi-3-mini-4k-instruct&quot;</span>

    tokenizer = AutoTokenizer.from_pretrained(base_model_id, add_eos_token=True, use_fast=True, max_length=250)
    tokenizer.padding_side = <span class="hljs-string">&#x27;right&#x27;</span>
    tokenizer.pad_token = tokenizer.eos_token

    compute_dtype = getattr(torch, <span class="hljs-string">&quot;float16&quot;</span>) <span class="hljs-comment"># Ampere (또는 최신) GPU를 사용하는 경우 bfloat16로 변경</span>
    bnb_config = BitsAndBytesConfig(
            load_in_4bit=True,
            bnb_4bit_quant_type=<span class="hljs-string">&quot;nf4&quot;</span>,
            bnb_4bit_compute_dtype=compute_dtype,
            bnb_4bit_use_double_quant=True,
    )
    model = AutoModelForCausalLM.from_pretrained(
              base_model_id, trust_remote_code=True, quantization_config=bnb_config, revision=<span class="hljs-string">&quot;refs/pr/23&quot;</span>, device_map={<span class="hljs-string">&quot;&quot;</span>: 0}, torch_dtype=<span class="hljs-string">&quot;auto&quot;</span>, flash_attn=True, flash_rotary=True, fused_dense=True
    )
    <span class="hljs-built_in">print</span>(print_gpu_utilization())

    model = prepare_model_for_kbit_training(model)
</code></pre>
<ol start="10">
<li>LoRA 매개변수</li>
</ol>
<div class="content-ad"></div>
<pre><code class="hljs language-js">peft_config = <span class="hljs-title class_">LoraConfig</span>(
            lora_alpha=<span class="hljs-number">16</span>,
            lora_dropout=<span class="hljs-number">0.05</span>,
            r=<span class="hljs-number">16</span>,
            bias=<span class="hljs-string">&quot;none&quot;</span>,
            task_type=<span class="hljs-string">&quot;CAUSAL_LM&quot;</span>,
          target_modules=[
            <span class="hljs-string">&#x27;q_proj&#x27;</span>,
            <span class="hljs-string">&#x27;k_proj&#x27;</span>,
            <span class="hljs-string">&#x27;v_proj&#x27;</span>,
            <span class="hljs-string">&#x27;dense&#x27;</span>,
            <span class="hljs-string">&#x27;fc1&#x27;</span>,
            <span class="hljs-string">&#x27;fc2&#x27;</span>,
        ])
</code></pre>
<ol start="9">
<li>Training Parameters</li>
</ol>
<pre><code class="hljs language-js">training_arguments = <span class="hljs-title class_">TrainingArguments</span>(
            output_dir=<span class="hljs-string">&quot;./phi3-results&quot;</span>,
            save_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,
            per_device_train_batch_size=<span class="hljs-number">4</span>,
            gradient_accumulation_steps=<span class="hljs-number">12</span>,
            log_level=<span class="hljs-string">&quot;debug&quot;</span>,
            save_steps=<span class="hljs-number">100</span>,
            logging_steps=<span class="hljs-number">25</span>,
            learning_rate=<span class="hljs-number">1e-4</span>,
            eval_steps=<span class="hljs-number">50</span>,
            optim=<span class="hljs-string">&#x27;paged_adamw_8bit&#x27;</span>,
            fp16=<span class="hljs-title class_">True</span>, #change to bf16 <span class="hljs-keyword">if</span> are using an <span class="hljs-title class_">Ampere</span> <span class="hljs-variable constant_">GPU</span>
            num_train_epochs=<span class="hljs-number">1</span>,
            max_steps=<span class="hljs-number">400</span>,
            warmup_steps=<span class="hljs-number">100</span>,
            lr_scheduler_type=<span class="hljs-string">&quot;linear&quot;</span>,
            seed=<span class="hljs-number">42</span>)
</code></pre>
<ol start="10">
<li>Data Prepare for the training</li>
</ol>
<div class="content-ad"></div>
<pre><code class="hljs language-js">train_dataset = instruct_tune_dataset.<span class="hljs-title function_">map</span>(batched=<span class="hljs-title class_">True</span>, remove_columns=[<span class="hljs-string">&#x27;answer&#x27;</span>, <span class="hljs-string">&#x27;question&#x27;</span>, <span class="hljs-string">&#x27;context&#x27;</span>])
train_dataset
</code></pre>
<ol start="11">
<li>Fine-Tuned</li>
</ol>
<pre><code class="hljs language-js">trainer = <span class="hljs-title class_">SFTTrainer</span>(
    model=model,
    train_dataset=train_dataset[<span class="hljs-string">&quot;train&quot;</span>],
    #eval_dataset=dataset[<span class="hljs-string">&#x27;test&#x27;</span>],
    peft_config=peft_config,
    dataset_text_field=<span class="hljs-string">&quot;inputs&quot;</span>,
    max_seq_length=<span class="hljs-number">1024</span>,
    tokenizer=tokenizer,
    args=training_arguments,
    packing=<span class="hljs-title class_">False</span>
)

trainer.<span class="hljs-title function_">train</span>()
</code></pre>
<ol start="12">
<li>Test inference with the fine-tuned adapter</li>
</ol>
<div class="content-ad"></div>
<pre><code class="hljs language-js">base_model_id = <span class="hljs-string">&quot;microsoft/Phi-3-mini-4k-instruct&quot;</span>
tokenizer = <span class="hljs-title class_">AutoTokenizer</span>.<span class="hljs-title function_">from_pretrained</span>(base_model_id, use_fast=<span class="hljs-title class_">True</span>)

compute_dtype = <span class="hljs-title function_">getattr</span>(torch, <span class="hljs-string">&quot;float16&quot;</span>)
bnb_config = <span class="hljs-title class_">BitsAndBytesConfig</span>(
        load_in_4bit=<span class="hljs-title class_">True</span>,
        bnb_4bit_quant_type=<span class="hljs-string">&quot;nf4&quot;</span>,
        bnb_4bit_compute_dtype=compute_dtype,
        bnb_4bit_use_double_quant=<span class="hljs-title class_">True</span>,
)
model = <span class="hljs-title class_">AutoModelForCausalLM</span>.<span class="hljs-title function_">from_pretrained</span>(
          base_model_id, trust_remote_code=<span class="hljs-title class_">True</span>, quantization_config=bnb_config, device_map={<span class="hljs-string">&quot;&quot;</span>: <span class="hljs-number">0</span>}
)
adapter = <span class="hljs-string">&quot;/content/phi3-results/checkpoint-400&quot;</span>
model = <span class="hljs-title class_">PeftModel</span>.<span class="hljs-title function_">from_pretrained</span>(model, adapter)
</code></pre>
<ol start="13">
<li>수행하기</li>
</ol>
<pre><code class="hljs language-js">database_schema = <span class="hljs-string">&#x27;CREATE TABLE station (city VARCHAR, lat INTEGER)&#x27;</span>
user_question = <span class="hljs-string">&quot;List all the cities in a decreasing order of each city&#x27;s stations&#x27; highest latitude.&quot;</span>

prompt_template = f<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;
Below is an instruction that describes a task. Write a response that appropriately completes the request.
### Instruction:
{user_question}
Database Schema:
{database_schema}
### Response:
&quot;</span><span class="hljs-string">&quot;&quot;</span>

question = <span class="hljs-string">&quot;&#x27;What are the positions with both players having more than 20 points and less than 10 points and are in Top 10 ranking&quot;</span>
context = <span class="hljs-string">&quot;CREATE TABLE player (POSITION VARCHAR, Points INTEGER, Ranking INTEGER)&quot;</span>

prompt_template1 = f<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;
Below is an instruction that describes a task. Write a response that appropriately completes the request.
### Instruction:
{question}
Database Schema:
{context}
### Response:
&quot;</span><span class="hljs-string">&quot;&quot;</span>

context = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;CREATE TABLE Songs (SongId VARCHAR); CREATE TABLE Band (firstname VARCHAR, id VARCHAR); CREATE TABLE Performance (bandmate VARCHAR)&#x27;</span><span class="hljs-string">&#x27;&#x27;</span>
question = <span class="hljs-string">&quot;Find the first name of the band mate that has performed in most songs.&quot;</span>

prompt_template2 = f<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;
Below is an instruction that describes a task. Write a response that appropriately completes the request.
### Instruction:
{question}
Database Schema:
{context}
### Response:
&quot;</span><span class="hljs-string">&quot;&quot;</span>

prompt = []
prompt.<span class="hljs-title function_">append</span>(prompt_template)
prompt.<span class="hljs-title function_">append</span>(prompt_template1)
prompt.<span class="hljs-title function_">append</span>(prompt_template2)

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-title function_">len</span>(prompt)):
  model_inputs = <span class="hljs-title function_">tokenizer</span>(prompt[i], return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).<span class="hljs-title function_">to</span>(<span class="hljs-string">&quot;cuda:0&quot;</span>)
  start_time = time.<span class="hljs-title function_">time</span>()
  output = model.<span class="hljs-title function_">generate</span>(**model_inputs, max_length=<span class="hljs-number">500</span>, no_repeat_ngram_size=<span class="hljs-number">10</span>, pad_token_id=tokenizer.<span class="hljs-property">eos_token_id</span>, eos_token_id=tokenizer.<span class="hljs-property">eos_token_id</span>)[<span class="hljs-number">0</span>]
  duration += <span class="hljs-title function_">float</span>(time.<span class="hljs-title function_">time</span>() - start_time)
  total_length += <span class="hljs-title function_">len</span>(output)
  tok_sec_prompt = <span class="hljs-title function_">round</span>(<span class="hljs-title function_">len</span>(output)/<span class="hljs-title function_">float</span>(time.<span class="hljs-title function_">time</span>() - start_time),<span class="hljs-number">3</span>)
  <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;Prompt --- %s tokens/seconds ---&quot;</span> % (tok_sec_prompt))
  <span class="hljs-title function_">print</span>(<span class="hljs-title function_">print_gpu_utilization</span>())
  <span class="hljs-title function_">print</span>(tokenizer.<span class="hljs-title function_">decode</span>(output, skip_special_tokens=<span class="hljs-title class_">False</span>))

tok_sec = <span class="hljs-title function_">round</span>(total_length/duration,<span class="hljs-number">3</span>)
<span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;Average --- %s tokens/seconds ---&quot;</span> % (tok_sec))
</code></pre>
<ol start="14">
<li>모델 저장하기</li>
</ol>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> locale
<span class="hljs-keyword">import</span> shutil
<span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> notebook_login
<span class="hljs-keyword">from</span> google.<span class="hljs-property">colab</span> <span class="hljs-keyword">import</span> drive

# <span class="hljs-title class_">Set</span> the preferred encoding to <span class="hljs-variable constant_">UTF</span>-<span class="hljs-number">8</span>
locale.<span class="hljs-property">getpreferredencoding</span> = <span class="hljs-attr">lambda</span>: <span class="hljs-string">&quot;UTF-8&quot;</span>

# <span class="hljs-title class_">Log</span> <span class="hljs-keyword">in</span> to the notebook
<span class="hljs-title function_">notebook_login</span>()

# <span class="hljs-title class_">Push</span> the fine-tuned adapter to the <span class="hljs-title class_">Hugging</span> <span class="hljs-title class_">Face</span> <span class="hljs-title class_">Hub</span>
trainer.<span class="hljs-title function_">push_to_hub</span>(commit_message=<span class="hljs-string">&quot;fine-tuned adapter&quot;</span>)

# <span class="hljs-title class_">Mount</span> <span class="hljs-title class_">Google</span> <span class="hljs-title class_">Drive</span>
drive.<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;/content/drive&#x27;</span>)

# <span class="hljs-title class_">Move</span> the trained model to <span class="hljs-title class_">Google</span> <span class="hljs-title class_">Drive</span>
shutil.<span class="hljs-title function_">move</span>(<span class="hljs-string">&#x27;/content/phi3-results&#x27;</span>, <span class="hljs-string">&#x27;/content/drive/MyDrive/PHI-3&#x27;</span>)

# <span class="hljs-title class_">Load</span> the trained model
trained_model = <span class="hljs-title class_">AutoPeftModelForCausalLM</span>.<span class="hljs-title function_">from_pretrained</span>(<span class="hljs-string">&quot;/content/drive/MyDrive/PHI-3/phi3-results/checkpoint-400&quot;</span>,
                                                         low_cpu_mem_usage=<span class="hljs-title class_">True</span>,
                                                         return_dict=<span class="hljs-title class_">True</span>,
                                                         torch_dtype=torch.<span class="hljs-property">float16</span>,
                                                         device_map=<span class="hljs-string">&#x27;auto&#x27;</span>,)

# <span class="hljs-title class_">Merge</span> and unload the trained model
lora_merged_model = trained_model.<span class="hljs-title function_">merge_and_unload</span>()

# <span class="hljs-title class_">Save</span> the merged model
lora_merged_model.<span class="hljs-title function_">save_pretrained</span>(<span class="hljs-string">&quot;/content/drive/MyDrive/PHI-3/phi3-results/lora_merged_model&quot;</span>, safe_serialization=<span class="hljs-title class_">True</span>)

# <span class="hljs-title class_">Save</span> the tokenizer <span class="hljs-keyword">for</span> the merged model
tokenizer.<span class="hljs-title function_">save_pretrained</span>(<span class="hljs-string">&quot;/content/drive/MyDrive/PHI-3/phi3-results/lora_merged_model&quot;</span>)

# <span class="hljs-title class_">Push</span> the merged model to the <span class="hljs-title class_">Hugging</span> <span class="hljs-title class_">Face</span> <span class="hljs-title class_">Hub</span>
lora_merged_model.<span class="hljs-title function_">push_to_hub</span>(repo_id=<span class="hljs-string">&quot;&quot;</span>, commit_message=<span class="hljs-string">&quot;merged model&quot;</span>)

# <span class="hljs-title class_">Push</span> the tokenizer to the <span class="hljs-title class_">Hugging</span> <span class="hljs-title class_">Face</span> <span class="hljs-title class_">Hub</span>
tokenizer.<span class="hljs-title function_">push_to_hub</span>(repo_id=<span class="hljs-string">&quot;&quot;</span>, commit_message=<span class="hljs-string">&quot;merged model&quot;</span>)
</code></pre>
<ol start="15">
<li>Perform Inference on Fine-tuned Model</li>
</ol>
<pre><code class="hljs language-js">peft_config = <span class="hljs-title class_">LoraConfig</span>(
            lora_alpha=<span class="hljs-number">16</span>,
            lora_dropout=<span class="hljs-number">0.05</span>,
            r=<span class="hljs-number">16</span>,
            bias=<span class="hljs-string">&quot;none&quot;</span>,
            task_type=<span class="hljs-string">&quot;CAUSAL_LM&quot;</span>,
    )

peft_model_id = <span class="hljs-string">&quot;username/phi3-results&quot;</span>
config = peft_config.<span class="hljs-title function_">from_pretrained</span>(peft_model_id)

model = <span class="hljs-title class_">AutoModelForCausalLM</span>.<span class="hljs-title function_">from_pretrained</span>(config.<span class="hljs-property">base_model_name_or_path</span>,
                                             return_dict=<span class="hljs-title class_">True</span>,
                                             load_in_4bit=<span class="hljs-title class_">True</span>,
                                             device_map=<span class="hljs-string">&quot;auto&quot;</span>,
                                             )

tokenizer = <span class="hljs-title class_">AutoTokenizer</span>.<span class="hljs-title function_">from_pretrained</span>(peft_model_id)

model = <span class="hljs-title class_">PeftModel</span>.<span class="hljs-title function_">from_pretrained</span>(model, peft_model_id)

<span class="hljs-title function_">print</span>(model.<span class="hljs-title function_">get_memory_footprint</span>())

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-title function_">len</span>(prompt)):
    model_inputs = <span class="hljs-title function_">tokenizer</span>(prompt[i], return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).<span class="hljs-title function_">to</span>(<span class="hljs-string">&quot;cuda:0&quot;</span>)
    start_time = time.<span class="hljs-title function_">time</span>()
    output = model.<span class="hljs-title function_">generate</span>(**model_inputs, max_length=<span class="hljs-number">500</span>, no_repeat_ngram_size=<span class="hljs-number">10</span>, pad_token_id=tokenizer.<span class="hljs-property">eos_token_id</span>, eos_token_id=tokenizer.<span class="hljs-property">eos_token_id</span>)[<span class="hljs-number">0</span>]
    duration += <span class="hljs-title function_">float</span>(time.<span class="hljs-title function_">time</span>() - start_time)
    total_length += <span class="hljs-title function_">len</span>(output)
    tok_sec_prompt = <span class="hljs-title function_">round</span>(<span class="hljs-title function_">len</span>(output)/<span class="hljs-title function_">float</span>(time.<span class="hljs-title function_">time</span>() - start_time), <span class="hljs-number">3</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;Prompt --- %s tokens/seconds ---&quot;</span> % (tok_sec_prompt))
    <span class="hljs-title function_">print</span>(<span class="hljs-title function_">print_gpu_utilization</span>())
    <span class="hljs-title function_">print</span>(f<span class="hljs-string">&quot;RESPONSE:\n {tokenizer.decode(output, skip_special_tokens=False)[len(prompt[i]):].split(&#x27;&lt;/&#x27;)[0]}&quot;</span>)

tok_sec = <span class="hljs-title function_">round</span>(total_length/duration, <span class="hljs-number">3</span>)
<span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;Average --- %s tokens/seconds ---&quot;</span> % (tok_sec))
</code></pre>
<h1>Conclusion</h1>
<div class="content-ad"></div>
<p>자연어 처리(NLP)와 SQL 쿼리 엔진의 결합은 데이터베이스와 상호 작용하는 것을 더 쉽고 효율적으로 만들었습니다. 이전에는 SQL에 대한 심층적인 이해가 필요했기 때문에 많은 사용자들에게 어려움이 있었습니다. 그러나 Mistral 7B와 Microsoft Phi-3와 같은 오픈 소스 대형 언어 모델(LLMs)은 이를 바꿨습니다. 이 모델들은 자연어 쿼리를 구조화된 SQL 쿼리로 신속하게 변환하여, 방대한 SQL 전문 지식이 필요 없게 했습니다.</p>
<p>Mistral 7B와 Microsoft Phi-3는 NLP 작업에서 우수한 성능을 발휘하는 탁월한 모델들입니다. 그들은 Grouped-Query Attention과 Sliding Window Attention과 같은 기능을 갖추어 더욱 효율적입니다. 크기가 작은 Microsoft Phi-3도 NLP 성능과 효율성에서 새로운 기준을 세우며, 복잡한 벤치마크에서 더 큰 모델들을 능가합니다.</p>
<p>오픈 소스 LLMs를 고급 분석 플랫폼과 AI 시스템에 통합함으로써 기업은 손쉽게 통찰을 추출할 수 있습니다. 이 기술은 금융, 건강 관리, 전자 상거래와 같은 산업들이 데이터 기반 결정을 내리는 방식을 변화시켰습니다. 이러한 모델들이 다양한 부문에 미치는 영향은 상당하며 혁신과 변혁을 촉진했습니다.</p>
<p>NLP와 SQL의 융합을 통해 오픈 소스 LLMs는 데이터 접근을 민주화시키고 효율성, 생산성, 기업 성공을 촉진했습니다. 이는 데이터 자산의 최대 잠재력을 발휘하도록 허용하여 이해당사자들이 실행 가능한 통찰을 추출하기 쉬워지고, 여러 부문에서 탐구와 혁신의 문화를 육성했습니다.</p>
<div class="content-ad"></div>
<p>노트북: phi3</p>
<p>제 이전 📝 글들을 확인해주세요.</p>
<h1>참고 자료</h1>
<ul>
<li>https://arxiv.org/pdf/2310.06825.pdf</li>
<li>https://artgor.medium.com/paper-review-mistral-7b-6acdf2f3132d</li>
<li>https://medium.com/dair-ai/papers-explained-mistral-7b-b9632dedf580</li>
<li>https://www.datacamp.com/tutorial/mistral-7b-tutorial</li>
<li>https://www.analyticsvidhya.com/blog/2023/11/from-gpt-to-mistral-7b-the-exciting-leap-forward-in-ai-conversations/</li>
<li>https://medium.com/@rubentak/mistral-7b-the-best-7-billion-parameter llm-yet-8b0aa03016f9</li>
<li>https://clarifai.com/mistralai/completion/models/mistral-7B-Instruc</li>
<li>https://iamgeekydude.com/2023/06/02/alpaca-llm-load-model-using-langchain-hf/</li>
<li>https://news.microsoft.com/source/features/ai/the-phi-3-small-language-models-with-big-potential/</li>
<li>https://huggingface.co/microsoft/Phi-3-mini-128k-instruct</li>
</ul></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"오픈 소스 LLM을 활용한 자연어를 SQL 쿼리로 변환하기","description":"","date":"2024-05-18 18:19","slug":"2024-05-18-NaturalLanguagetoSQLQueryusinganOpenSourceLLM","content":"\n\n# 소개\n\n데이터 활용의 동적인 풍경에서는 데이터베이스와 손쉽게 상호 작용할 수 있는 능력이 중요합니다. 전통적으로 이 상호 작용은 구조화된 쿼리 언어(SQL)에 대한 심층적인 이해가 필요하여 많은 사용자들에게 진입 장벽이 되었습니다. 그러나 자연어 처리(NLP)를 SQL 쿼리 엔진에 적용하여 이 풍경이 변화되었으며, 이를 통해 사용자들이 자연어 명령을 사용하여 데이터베이스와 소통할 수 있게 되었습니다. 이 첨단 기술은 인간의 언어를 SQL 쿼리로 순조롭게 번역하여 데이터를 검색하고 조작하는 방식을 혁신하고 있습니다.\n\n자연어 처리(NLP)에서 Mistral 7B 및 Microsoft Phi-3과 같은 모델은 주요 역할을 하며 성능과 효율성의 경계를 재정의하고 있습니다.\n\nMistral 7B는 NLP 작업에서 뛰어난 성능과 정밀도로 높이 평가 받고 있습니다. 그룹화된 쿼리 어텐션(GQA) 및 슬라이딩 윈도우 어텐션(SWA)과 같은 혁신적인 기능들을 갖춘 Mistral 7B는 수학 및 코드 생성을 포함한 다양한 벤치마크에서 우수한 성과를 거두고 있습니다. Code-Llama 7B의 코딩 능력에 가까워짐과 동시에 NLP 발전에서의 중요성을 강조하며 다양한 분야에서 우수성을 유지하고 있습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nPhi-3 는 작은 언어 모델(SLMs) 분야에서의 Microsoft의 최신 혁신으로, AI의 풍경을 변화시키는 대단한 제품입니다. Phi-3-mini, Phi-3-small 및 Phi-3-medium으로 구성된 이 모델군은 간결한 구성으로 뛰어난 성능을 제공합니다. 38억 개의 파라미터를 자랑하는 Phi-3-mini는 더 큰 모델들과 견줄 만한 성능을 발휘하면서도 스마트폰에서 효율적으로 동작합니다. Phi-3의 성공 뒤에는 견고함, 안전성 및 대화 능력을 중시하는 정교하게 선별된 학습 데이터셋이 있습니다. Phi-3-small 및 Phi-3-medium은 Phi-3의 능력을 더욱 확장하여 다양한 응용 분야에 대응합니다. 정교하게 설계된 아키텍처와 학습 방법을 통해 Phi-3은 AI 기술의 큰 발전을 상징하며, 다양한 생성형 AI 작업에 대한 우수한 성능과 효율성을 약속합니다.\n\nNLP와 SQL의 교차점을 탐색하여 Mistral 7B와 Microsoft Phi-3의 활용에 대해 알아봅니다. 이러한 모델들은 자연어 쿼리를 구조화된 SQL 쿼리로 원활하게 변환하여 데이터베이스 쿼리 작업에서 향상된 효율성과 정확도를 제공합니다.\n\n![](/assets/img/2024-05-18-NaturalLanguagetoSQLQueryusinganOpenSourceLLM_0.png)\n\n# 학습 목표\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n이 블로그 포스트에서는 오픈 소스 Mistral 7B 모델을 NL2SQL 작업에 활용하는 복잡성을 탐색할 것입니다. 또한 NL2SQL 애플리케이션을 위해 모델을 맞춤화하고 훈련하는 방법에 대해 논의할 것입니다. 기사의 나머지 부분은 다음과 같은 내용을 다룹니다.\n\n# 동기부여\n\n오픈 소스 LLMs를 활용하면 자연어 명령을 SQL 쿼리로 변환하는 복잡한 프로세스를 실행할 수 있습니다. 이 혁신적인 기술은 사용자가 수동 쿼리 작성 없이 데이터 요구 사항을 자연스럽게 표현하도록 자동화하며, 이로써 사용자의 입력을 분석하고 의미론적으로 정확한 SQL 쿼리를 생성하는 복잡한 알고리즘과 대규모 언어 모델이 활용됩니다. 이는 변환 프로세스를 간소화시키고 광범위한 사용자들에게 광범위한 SQL 지식이 없어도 데이터를 이용할 수 있게 합니다. 오픈 소스 LLMs는 편리함을 제공하며 데이터 접근성과 운영 효율성을 크게 향상시킵니다. SQL 전문 지식의 장벽을 제거함으로써 이 기술은 데이터 접근성을 민주화시키고 각 분야의 사용자들이 데이터를 검색하고 통찰을 얻는 데 도움을 줍니다. 실시간 통찰을 찾는 비즈니스 분석가나 데이터 집합을 탐색하는 일반 사용자를 위한 것이든, 자연어 명령의 직관적인 성격은 데이터 검색을 간단하게 합니다.\n\n또한 이러한 모델에서 내재된 자동화는 쿼리 실행을 가속화하여 전반적인 효율성과 생산성을 높입니다. 오픈 소스 LLMs의 영향력은 광범위하며 다양한 산업 전반에 혁신과 변화를 격려합니다. 이 기술은 재무, 건강 관리 및 전자 상거래 분야와 같이 데이터 주도적 의사 결정이 중요한 분야에서 이해하기 쉬운 인사이트를 추출할 수 있도록 이해권자를 돕습니다. 더 나아가, 고급 분석 플랫폼과 인공 지능 시스템과의 통합을 통해 조직을 데이터 주도적 우수성으로 이끕니다. 탐구 문화를 육성하고 데이터 상호작용을 간소화함으로써 오픈 소스 LLMs는 데이터 자산의 모든 잠재력을 발휘함으로써 산업 전반에 혁신과 성장을 촉진합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# 1. NL2SQL을 위한 사전 훈련 모델 (Mistral 7B)\n\nMistral AI가 개발한 70억 개의 파라미터를 가진 언어 모델인 Mistral 7B는 인공 지능 분야에서 강력한 모델로 빠르게 인기를 얻고 있습니다.\n\n- 기본 모델로 위치 지정된 Mistral 7B는 자연어 처리에서 중요한 역할을 하는 가장 중요한 구조적 모델로 자리 잡았으며 대규모 언어 모델 환경 내에서 필수적인 코어 빌딩 블록의 중요성을 보여줍니다.\n- 건축적 접근 방식으로 차별화된 Mistral 7B는 빠른 추론을 위해 그룹화된 쿼리 어텐션 (GQA)과 긴 시퀀스를 효율적으로 처리하기 위한 슬라이딩 윈도우 어텐션 (SWA)과 같은 혁신적인 기능을 활용하여 우수한 성능을 발휘합니다.\n- 주로 영어에 초점을 맞추지만 코딩 능력도 갖춘 Mistral 7B는 특히 다른 모델들보다 더 넓은 컨텍스트에서 텍스트를 이해하고 생성할 수 있는 높은 문맥 윈도우를 가지고 있어 두각을 나타냅니다.\n- 73억 개의 파라미터로 인상적인 Mistral 7B는 최신 언어 모델을 대표하는데, Apache 2.0 라이센스 하에 제한 없이 사용할 수 있습니다.\n- Mistral 7B는 모든 평가된 벤치마크에서 최고의 오픈 13B 모델 (Llama-2)보다 우수한 성과를 거두며 최고의 34B 모델 (Llama-1)보다 추론평가, 수학 및 코드 생성에서 뛰어난 성능을 보여줍니다.\n- Mistral-7B는 Llama2-13B보다 우수한 성능을 보이며 CodeLlama-7B와 경쟁력 있는 성과를 보이며 특히 추론, 수학 및 코드 생성 벤치마크에서 뛰어납니다.\n- 더 큰 모델들에 비해 크기는 작지만, Mistral 7B는 텍스트 요약, 분류, 텍스트 완성 및 코드 완성을 포함한 다양한 자연어 작업에서 우수한 성과를 거둡니다.\n- 이 모델이 자연어 쿼리를 구조화된 SQL 명령어로 변환하는 효과를 탐색하여 능력을 자세히 살펴봅시다.\n\n## Sliding Window Attention\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- Mistral 7B은 전통적인 주의 메커니즘에서 발생하는 도전에 효과적으로 대처할 수 있는 슬라이딩 윈도우 어텐션(Sliding Window Attention, SWA) 메커니즘을 포함하고 있습니다. 전자는 토큰 수가 증가함에 따라 추론 중 지연 시간이 증가하고 처리량이 감소할 수 있으며, 시퀀스 길이와 메모리와 관련된 연산이 이차적으로 증가하고 메모리가 선형적으로 증가할 수 있습니다. 반면에 SWA는 각 토큰의 주의를 이전 레이어의 W개 토큰을 최대한으로 제한하여 주어진 윈도우 크기 W를 넘어서 주의를 확장합니다.\n- SWA는 트랜스포머의 계층 구조를 활용하여 위치 i의 숨겨진 상태가 입력 레이어의 토큰을 W x k 토큰까지 액세스할 수 있도록 지원합니다. 최종 레이어에서 W = 4096의 윈도우 크기로, SWA는 이론적으로 대략 131K 토큰의 주의 범위를 달성할 수 있습니다. 실제적으로 W = 4096 및 FlashAttention과 xFormers의 최적화 기법을 사용하여, 16K 토큰 시퀀스의 경우 바닐라 주의 기준에 비해 주목할만한 2배의 속도 향상이 가능합니다. 따라서, SWA는 주의 메커니즘의 성능을 혁신적으로 향상시킬 수 있는 강력하고 효율적인 접근 방식입니다.\n\n### b. 롤링 버퍼 캐시\n\n- 롤링 버퍼 캐시를 구현함으로써, Mistral 7B는 고정된 주의 범위를 전략적으로 사용하여 캐시 크기를 효과적으로 제어합니다. 이 캐시는 W로 표시된 고정된 크기로, 캐시 내에서 특정 시간 단계 i에서 시간 단계 i mod W에 키와 값들을 효율적으로 저장합니다. 시퀀스가 진행되고 i가 W를 초과할 때, 캐시는 롤링 버퍼 메커니즘을 사용하여 이전 값들을 덮어쓰고 무한정으로 확장되는 것을 방지합니다. W = 3으로 설명된 이 접근 방식은 32k 토큰 시퀀스에 대해 8배의 캐시 메모리 사용량 감소를 실현함으로써, 모델의 품질을 희생하지 않고 달성합니다. 고정된 주의 범위는 효율적인 메모리 이용을 보장할 뿐만 아니라 Mistral 7B가 길이가 다른 시퀀스를 처리하는 데에 원활하게 기능하는 데에 기여합니다.\n\n### c. 사전 채움 및 청크 분할\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 시퀀스 생성 과정에서는 문맥 정보에 기반하여 순차적으로 토큰을 예측하는데, (k, v) 캐시를 사용하여 효율적으로 최적화됩니다. 알려진 프롬프트로 미리 채워진 캐시를 활용하여 효율성을 높입니다. 긴 프롬프트를 관리하기 위해 지정된 윈도우 크기를 사용하여 작은 청크로 나누고, 각 청크를 사용하여 캐시를 미리 채웁니다. 이 전략적 접근 방식은 시퀀스 생성 프로세스 중 캐시 내부 및 현재 청크 전체에서 주의력을 계산하는 것을 포함합니다. 이 방법을 활용함으로써 Mistral 7B는 시퀀스 생성의 효율성을 향상시키며, 캐시에 저장된 미리 알려진 프롬프트를 효율적으로 활용하여 각 예측된 토큰을 이전 토큰과 조화롭게 정렬합니다.\n- 언어 모델의 동적인 환경에서 Mistral 7B의 등장은 성능과 효율성 면에서 큰 도약을 의미합니다. 포괄적인 평가 파이프라인을 통해 Mistral 7B는 자신의 능력을 입증하며, 이전 제품인 Llama 2 7B 및 Llama 2 13B뿐만 아니라 Llama 1 34B와 같은 핵심 벤치마크에서 뛰어난 성능을 보여줌으로써 뛰어난 경쟁력을 나타냅니다.\n- Mistral 7B의 우월성은 모든 측정 항목에 걸쳐 명백히 드러나며, 해당 분야의 선도주자로서의 지위를 재확인합니다. 다양한 벤치마크에 대한 면밀한 재평가 과정은 Mistral 7B의 탁월한 능력을 일관되게 입증하며, 경쟁사를 뒤로 남깁니다.\n\n## 크기 및 효율성 분석\n\n- Mistral 7B의 매력 중요 요소 중 하나는 혁신적인 \"동등한 모델 크기\" 계산 방식을 통한 효율성입니다. 추론, 이해 및 STEM 추론 등에서 평가한 결과, Mistral 7B는 세 배 이상 크기의 Llama 2 모델과 동등한 성능을 보여줍니다. 이 효율성은 과도한 매개변수 부담 없이 뛰어난 결과를 제공할 수 있는 Mistral 7B의 능력을 입증합니다.\n- Mistral 7B의 효율성을 더 자세히 살펴보면, 평가 결과에서 지식 압축에 대한 흥미로운 통찰력을 확인할 수 있습니다. 지식 벤치마크에서 1.9배 낮은 압축률을 달성하지만, 이는 Mistral 7B의 의도적으로 제한된 매개변수 수에 기인합니다. 이 제한은 저장된 지식 양을 제한하지만, Mistral 7B는 집중하고 효과적으로 매개변수를 활용하여 보상합니다.\n\n# 평가의 차이점\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n불일치 사항을 투명하게 다루면서, 평가 규정의 변화를 유의하는 것이 중요합니다. 어떤 벤치마크에서는 Llama 2의 MBPP와 Mistral 7B의 평가 결과 사이에 차이가 발생합니다. TriviaQA에서 손으로 검증된 데이터를 사용하는 것이 Mistral 7B의 성능 지표의 신뢰성에 기여하는 강건한 평가 과정을 확인하게 됩니다.\n\n# 데이터셋\n\n아래 열로 구성된 구조 데이터베이스를 사용할 계획입니다. 다음 테이블에서 다양한 검색을 수행할 것입니다.\n\n```js\ntransaction = [\n        \"transaction_id\",\n        \"transaction_amount\",\n        \"transaction_date\",\n        \"transaction_type\",\n        \"transaction_status\",\n        \"transaction_description\",\n        \"transaction_source_account\",\n        \"transaction_destination_account\",\n        \"transaction_currency\",\n        \"transaction_fee\"\n    ]\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# 코드 구현\n\n- 패키지 설치하기\n\n```js\n!pip install git+https://github.com/huggingface/transformers.git \n!pip install deepspeed --upgrade\n!pip install accelerate\n!pip install sentencepiece\n!pip install langchain\n!pip install torch\n!pip install bitsandbytes\n``` \n\n2. 패키지 불러오기\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nimport os\nimport re\nimport torch\nfrom difflib import SequenceMatcher\nfrom langchain.chains import LLMChain\nfrom langchain import PromptTemplate, LLMChain\nfrom langchain.llms import HuggingFacePipeline\nfrom langchain_core.prompts import PromptTemplate\nfrom transformers import LlamaTokenizer, LlamaForCausalLM, pipeline\n```\n\n3. 모델 불러오기\n\n```js\nbase_model = LlamaForCausalLM.from_pretrained(\n     \"mistralai/Mistral-7B-Instruct-v0.1\",\n     load_in_8bit=True,\n     device_map='auto',\n    )\ntokenizer = LlamaTokenizer.from_pretrained(\"mistralai/Mistral-7B-Instruct-v0.1\")\npipe = pipeline(\n        \"text-generation\",\n        model=base_model,\n        tokenizer=tokenizer,\n        max_length=500,\n        temperature=0.3,\n        top_p=0.95,\n        repetition_penalty=1.2\n    )\nlocal_llm = HuggingFacePipeline(pipeline=pipe)\n```\n\n4. SequenceMatcher\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n이 Python 함수는 difflib 모듈의 SequenceMatcher 클래스를 활용하여 쿼리와 지정된 사전의 열 이름 간의 유사도 점수를 계산하여 쿼리 이해력과 대체를 향상시킵니다.\n\n```js\ndef find_columns_match(question, input_dict):\ntry:\n  question_list = re.split(r'\\s|,|\\.', question)\n  for index, string2 in enumerate(question_list):\n    for string1 in input_dict.get('table1_columns'):\n      score = SequenceMatcher(None,string1.lower(), string2.lower()).ratio()*100\n      if score \u003e 91:\n        question_list[index] = string1 + \",\"\n  return \" \".join(question_list)\n  \nexcept:\n return question\n```\n\n이 Python 함수 query_generator은 제공된 테이블명, 열 목록 및 질문에 기반하여 SQL 쿼리를 생성합니다. 이는 템플릿 문자열을 활용하여 쿼리 생성 프로세스를 구조화하며, 테이블 명, 열 목록 및 질문에 대한 자리 표시자를 포함합니다. 그런 다음 PromptTemplate 객체를 사용하여 이러한 자리 표시자를 채워넣고 LLMChain을 통해 대형 언어 모델 (LLM)과 상호 작용하여 SQL 쿼리를 생성합니다. 마지막으로 생성된 SQL 쿼리를 출력합니다.\n\n```js\ndef query_generator(tble, cols, question):\n\n  template = \"\"\"Generate a SQL query using the following table name: {Table}, and columns as a list: {Columns}, to answer the following question:\n  {question}.\n  \n  Output Query:\n  \n  \"\"\"\n  \n  prompt = PromptTemplate(template=template, input_variables=[\"Table\", \"question\", \"Columns\"])\n  \n  llm_chain = LLMChain(prompt=prompt, llm=local_llm)\n  \n  response = llm_chain.run({\"Table\": tble, \"question\": question, \"Columns\": cols})\n  print(response)\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# 표\n\n\ntransaction = [\n        \"transaction_id\",\n        \"transaction_amount\",\n        \"transaction_date\",\n        \"transaction_type\",\n        \"transaction_status\",\n        \"transaction_description\",\n        \"transaction_source_account\",\n        \"transaction_destination_account\",\n        \"transaction_currency\",\n        \"transaction_fee\"\n    ]\n\n    inputs = [\"transaction_id가 10인 경우 transaction_amount, transaction_date, transaction_type,transaction_description을 검색하는 SQL 쿼리 생성\",\n             \"transaction_status가 'completed'인 경우 transaction_id, transaction_date, transaction_type, transaction_source_account을 검색하는 SQL 쿼리 생성\",\n             \"transaction_type 및 평균 transaction_amount의 개수를 검색하고 transaction_type로 정렬하는 SQL 쿼리 생성\",\n             \"각 소스 계정별 총 거래 금액 목록을 검색하고 총 거래 금액을 내림차순으로 정렬하는 SQL 쿼리 생성\",\n             \"각 거래 유형별 최대 거래 금액을 검색하고 거래 유형으로 정렬하는 SQL 쿼리 생성\"]\n\n    for input in inputs:\n        query_generator(\"transaction\",transaction ,question=find_columns_match(input,transaction))\n\n\n# 응답\n\n- 다음과 같은 테이블 이름을 사용하고 컬럼을 나열한 리스트를 사용하여 SQL 쿼리를 생성하십시오: transaction 및 [‘transaction_id’, ‘transaction_amount’, ‘transaction_date’, ‘transaction_type’, ‘transaction_status’, ‘transaction_description’, ‘transaction_source_account’, ‘transaction_destination_account’, ‘transaction_currency’, ‘transaction_fee’], 다음 질문에 대한 응답을 위해 SQL 쿼리를 생성하십시오: (‘transaction_id가 10인 경우 transaction_amount, transaction_date, transaction_type,transaction_description을 검색하는 SQL 쿼리 생성’).\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\n출력 쿼리: \n\n  SELECT transaction_amount, transaction_date, transaction_type, transaction_description FROM transaction WHERE transaction_id = 10;\n```\n\n2. 다음과 같은 테이블 이름인 transaction과 열 목록인 [‘transaction_id’, ‘transaction_amount’, ‘transaction_date’, ‘transaction_type’, ‘transaction_status’, ‘transaction_description’, ‘transaction_source_account’, ‘transaction_destination_account’, ‘transaction_currency’, ‘transaction_fee’]을 사용하여 다음 질문에 대한 SQL 쿼리를 생성하십시오:\n(‘transaction_status가 ‘completed’인 경우 transaction_id, transaction_date, transaction_type, transaction_source_account를 검색하는 SQL 쿼리를 생성하십시오’).\n\n```js\n출력 쿼리:\n  SELECT transaction_id, transaction_date, transaction_type, transaction_source_account FROM transaction WHERE transaction_status = 'completed'\n```\n\n3. 다음과 같은 테이블 이름인 transaction과 열 목록인 [‘transaction_id’, ‘transaction_amount’, ‘transaction_date’, ‘transaction_type’, ‘transaction_status’, ‘transaction_description’, ‘transaction_source_account’, ‘transaction_destination_account’, ‘transaction_currency’, ‘transaction_fee’]을 사용하여 다음 질문에 대한 SQL 쿼리를 생성하십시오:\n(‘transaction_type의 count와 평균 transaction_amount를 가져오고 transaction_type으로 정렬하십시오’).```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\n결과 쿼리:\n\n  SELECT transaction_type, AVG(transaction_amount) AS avg_transaction_amount, COUNT(*) AS total_count\n  FROM transaction\n  GROUP BY transaction_type\n  ORDER BY transaction_type;\n```\n\n4. 다음 테이블 이름과 열 목록을 사용하여 SQL 쿼리를 생성하십시오: transaction 및 열: ['transaction_id', 'transaction_amount', 'transaction_date', 'transaction_type', 'transaction_status', 'transaction_description', 'transaction_source_account', 'transaction_destination_account', 'transaction_currency', 'transaction_fee'], 다음 질문에 답하십시오:\n(‘리스트에서 각 소스 계정의 총 거래 금액을 내림차순으로 정렬하여 조회하는 SQL 쿼리를 생성하세요’).\n\n```js\n결과 쿼리:\n\n       SELECT transaction_source_account, SUM(transaction_amount) AS TotalTransactionAmount\n        FROM transaction\n        GROUP BY transaction_source_account\n        ORDER BY TotalTransactionAmount DESC;\n```\n\n5. 다음 테이블 이름과 열 목록을 사용하여 SQL 쿼리를 생성하십시오: transaction 및 열: ['transaction_id', 'transaction_amount', 'transaction_date', 'transaction_type', 'transaction_status', 'transaction_description', 'transaction_source_account', 'transaction_destination_account', 'transaction_currency', 'transaction_fee'], 다음 질문에 답하십시오:\n(‘각 거래 유형의 최대 거래 금액을 찾아 거래 유형으로 정렬하는 SQL 쿼리를 생성하세요’).```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\n출력 쿼리:\n\n   SELECT transaction_type, MAX(transaction_amount) AS max_transaction_amount\n   FROM transaction\n   GROUP BY transaction_type\n   ORDER BY transaction_type;\n```\n\n일반적인 추출은 효과적이지만, 연구 결과, 데이터를 세부 조정하여 LLM을 수행하면 우수한 결과를 얻을 수 있습니다. 세밀 조정 접근법을 채용해 봅시다.\n\n# 2 Fine-tune NL2SQL with Phi-3\n\nPhi-3를 만나보세요, Microsoft의 최신 오픈 AI 모델의 주요 성과입니다. Phi-3-mini, Phi-3-small 및 Phi-3-medium을 통해, 이 작은 언어 모델 (SLM)의 Phi-3 패밀리는 AI 모델의 세계를 혁신하도록 설계되었습니다. 38억 개의 파라미터를 사용하고 33조 개의 토큰으로 훈련된 Phi-3-mini는 높은 성능을 발휘하며 Mixtral 8x7B 및 GPT-3.5와 같은 큰 모델과 같은 성능을 보여줍니다. 게다가, 이 모델은 스마트폰 장치에서 효율적으로 작동할 수 있습니다. Phi-3의 성공은 훈련 데이터셋에 기인합니다. Phi-2의 데이터셋의 진화된 버전입니다. 상세히 걸러낸 웹 데이터 및 합성 입력을 통해 이러한 모델은 강도, 안전 및 대화 능력에 우선순위를 두어 다양한 응용프로그램에 적합합니다. 7B 및 14B 파라미터를 가진 Phi-3-small 및 Phi-3-medium은 효율 유지와 함께 Phi-3의 기능을 더욱 향상시키도록 설계되었습니다.\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## Phi 3 Architecture and Evaluation\n\nPhi-3 패밀리는 품질과 비용을 균형있게 유지하도록 설계된 다양한 모델을 제공하여 생성형 AI 애플리케이션을 개발하는 고객을 위한 옵션을 제공합니다.\n\nPhi-3-mini: 이 모델은 38억 개의 파라미터를 갖추고 33조 개의 토큰으로 이루어진 광범위한 데이터셋을 기반으로 훈련되었습니다. 32개의 레이어, 32개의 어텐션 헤드, 그리고 3072개의 히든 디멘션을 갖는 트랜스포머 디코더 아키텍처를 채택했습니다. 디폴트 콘텍스트 길이는 4천 개의 토큰이며, 32K 어휘 사전을 사용하는 토크나이저를 활용합니다. 추가로, 128K 토큰의 콘텍스트 길이를 갖춘 확장 버전인 Phi-3-mini-128K도 있습니다.\n\nPhi-3-small: 70억 개의 파라미터로 훈련된 Phi-3-small은 48조 개의 토큰을 사용합니다. 이 모델은 100K 어휘 사전과 8천 개의 디폴트 콘텍스트 길이를 갖추었습니다. 아키텍처는 32개의 레이어, 32개의 어텐션 헤드, 그리고 4096개의 히든 디멘션으로 이루어져 있습니다. 이 모델은 메모리 사용량을 최적화하기 위해 그룹화된 쿼리 어텐션과 번갈아가며 쓰이는 밀집/희소 어텐션을 활용합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nPhi-3-medium: 이 미리보기 모델은 140억 개의 매개변수를 자랑하며 4.8조 개의 토큰으로 학습되었습니다. 40개의 레이어, 40개의 어텐션 헤드, 그리고 임베딩 크기는 5120입니다.\n\n## 훈련 방법:\n\n- 훈련 데이터 구성: Phi-3 모델의 훈련 데이터는 신중하게 선별됩니다. 교육 수준별로 분류된 웹 데이터와 합성 LLM 생성 데이터로 구성되며 두 가지 이질적이고 순차적인 단계로 사전 훈련을 거칩니다.\n- 사전 훈련 단계: 제1 단계는 일반 지식과 언어 이해에 중점을 둔 웹 소스를 사용합니다. 제2 단계는 논리 추론 및 특정 기술을 가르치기 위해 제1 단계의 웹 데이터와 합성 데이터를 더 많이 활용합니다.\n- 사후 훈련 단계: 사전 훈련 후, Phi-3-mini는 감독형 세밀 조정 (SFT) 및 직접 선호도 최적화 (DPO)를 거쳤습니다. SFT는 수학, 코딩, 추론, 대화, 모델 신원, 안전 도메인 간에 높은 품질의 데이터를 선별하는 과정을 포함합니다.\n- DPO는 채팅 형식 데이터, 추론, 그리고 책임 있는 AI 노력에 초점을 맞춥니다.\n- 맥락 확장: Phi-3-mini의 맥락 창 크기가 Long Rope 방법론을 사용하여 4k 토큰에서 128k 토큰으로 확장되었습니다. 이 확장은 맥락의 길이가 크게 증가함에도 일관된 성능을 유지합니다.\n- 데이터 최적화: 훈련 데이터는 모델의 규모를 위한 \"데이터 최적\" 지점으로 보정됩니다. 웹 데이터는 지식과 추론의 적절한 균형을 보장하기 위해 필터링됩니다. 특히 작은 모델의 경우 이는 매우 중요합니다.\n- 다른 모델과의 비교: Phi-3의 접근 방식은 이전 작업과 대조적으로, 해당 규모에 대한 데이터 품질에 중점을 두며 컴퓨팅이나 과도한 훈련 방법보다 데이터 최적화를 강조합니다. 벤치마크 비교는 Phi-3가 작은 모델 용량을 위한 최적화를 잘 보여줍니다.\n- Phi-3-medium 미리보기: 140억 개의 매개변수를 가진 Phi-3-medium은 Phi-3-mini와 유사하게 훈련되었지만 더 큰 규모로 이루어집니다. 일부 벤치마크에서는 7B에서 14B 매개변수로의 전환에서 큰 개선이 없어 계속해서 데이터 혼합을 개선 중임을 시사합니다.\n- 사후 향상: 모델은 채팅 능력, 견고성, 그리고 안전성을 향상시키기 위해 감독형 세밀 조정 및 DPO를 통한 선호도 조정을 거칩니다.\n\n## 안전성\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nPhi-3-mini은 Microsoft의 책임 있는 AI 원칙에 따라 만들어진 AI 모델입니다. 이 프로젝트는 개발 초기부터 안전을 우선시하는 원칙을 중요시하여 만들어졌습니다. 모델이 윤리 기준을 준수하고 잠재적인 피해를 최소화할 수 있는 능력을 보장하기 위해 포괄적인 전략이 채택되었습니다.\n\n모델 학습 후에는, 해당 모델이 책임 있는 AI 기준을 충족하는지 확인하기 위해 면밀한 안전 조정이 이루어집니다. 게다가, Microsoft의 독립된 레드 팀이 Phi-3-mini를 검토하여 강화 및 안전 프로토콜을 강화할 수 있는 부분을 식별합니다.\n\n자동화된 테스팅과 잠재적인 피해의 다양한 범주에 대한 평가는 프로세스의 중요한 부분입니다. 이러한 테스트는 모델의 출력물로부터 발생하는 모든 위험을 감지하고 해결하는 데 목표를 두고 있습니다.\n\n더 나아가, Phi-3-mini는 의견 데이터 세트를 활용하여 응답을 더욱 개선합니다. 특정 테스트 중 확인된 잠재적인 피해 범주에 대응하기 위해 내부에서 생성된 데이터 세트가 사용됩니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 코드 구현\n\n- 패키지 설치\n\n```js\n !pip install -q -U bitsandbytes\n !pip install -q -U transformers\n !pip install -q -U xformers\n !pip install -q -U peft\n !pip install -q -U accelerate\n !pip install -q -U datasets\n !pip install -q -U trl\n !pip install -q -U einops\n !pip install -q -U nvidia-ml-py3\n !pip install -q -U huggingface_hub\n```\n\n2. 패키지 가져오기\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```python\nfrom datasets import load_dataset\nfrom transformers import AutoTokenizer, AutoModelForCausalLM, BitsAndBytesConfig, TrainingArguments, Trainer, DataCollatorForLanguageModeling\nfrom pynvml import *\nimport time, torch\nfrom trl import SFTTrainer\nfrom peft import LoraConfig, PeftModel, get_peft_model, prepare_model_for_kbit_training\nfrom peft import AutoPeftModelForCausalLM\n```\n\n3. 데이터셋 불러오기\n\n```python\ndataset = load_dataset(\"b-mc2/sql-create-context\")\ndataset\n```\n\n4. 데이터셋 형식화\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\ndef create_prompt(sample):\n      system_prompt_template = \"\"\"\u003cs\u003e\n            아래는 작업을 설명하는 지시사항입니다. 요청을 적절히 완료하는 응답을 작성하십시오.\n            ### 지시사항: \u003c\u003cuser_question\u003e\u003e\n            ### 데이터베이스 스키마:\n            \u003c\u003cdatabase_schema\u003e\u003e\n            ### 응답:\n            \u003c\u003cuser_response\u003e\u003e\n            \u003c/s\u003e\n            \"\"\"\n      user_message = sample['question']\n      user_response = sample['answer']\n      database_schema = sample['context']\n      prompt_template = system_prompt_template.replace(\"\u003c\u003cuser_question\u003e\u003e\",f\"{user_message}\").replace(\"\u003c\u003cuser_response\u003e\u003e\",f\"{user_response}\").replace(\"\u003c\u003cdatabase_schema\u003e\u003e\",f\"{database_schema} \")\n\n      return {\"inputs\":prompt_template}\n\n\ninstruct_tune_dataset = dataset.map(create_prompt)\nprint(instruct_tune_dataset)\n\ndef print_gpu_utilization():\n    nvmlInit()\n    handle = nvmlDeviceGetHandleByIndex(0)\n    info = nvmlDeviceGetMemoryInfo(handle)\n    print(f\"GPU 메모리 사용량: {info.used//1024**2} MB.\")\n```\n\n5. 토크나이저와 모델 로드\n\n```js\nbase_model_id = \"microsoft/Phi-3-mini-4k-instruct\"\n\n# 토크나이저 로드\ntokenizer = AutoTokenizer.from_pretrained(base_model_id, use_fast=True)\n# fp16로 모델 로드\nmodel = AutoModelForCausalLM.from_pretrained(base_model_id, trust_remote_code=True, torch_dtype=torch.float16, device_map={\"\": 0})\nprint(print_gpu_utilization())\n```\n\n6. 모델 추론\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n# 프롬프트 정의\n\n\n```bash\n    prompt = [\n        \"코코넛 밀크로 만든 치킨 카레 레시피를 작성해주세요.\",\n        \"다음 문장을 프랑스어로 번역해주세요: '나는 빵과 치즈를 좋아해요!'\",\n        \"유명한 20명의 인물을 인용해보세요.\",\n        \"지금 달은 어디에 있나요?\"\n    ]\n\n    # 변수 초기화\n    duration = 0.0\n    total_length = 0\n\n    # 프롬프트 반복\n    for i in range(len(prompt)):\n        # 프롬프트 토큰화 및 GPU로 이동\n        inputs = tokenizer(prompt[i], return_tensors=\"pt\").to(\"cuda:0\")\n\n        # 입력 텐서 인덱스를 torch.long으로 변환\n        inputs = {k: v.to(torch.long) for k, v in inputs.items()}\n\n        # 시작 시간\n        start_time = time.time()\n\n        # 자동 캐스팅을 사용하여 추론 수행\n        with torch.cuda.amp.autocast(enabled=False):  # 자동 캐스팅 비활성화\n            output = model.generate(**inputs, max_length=500)\n\n        # 소요 시간과 총 길이 계산\n        duration += float(time.time() - start_time)\n        total_length += len(output)\n\n        # 프롬프트당 토큰 속도 계산\n        tok_sec_prompt = round(len(output) / float(time.time() - start_time), 3)\n\n        # 프롬프트당 토큰 속도 출력\n        print(\"프롬프트 --- %s 토큰/초 ---\" % (tok_sec_prompt))\n\n        # 디코드된 출력 출력\n        print(tokenizer.decode(output[0], skip_special_tokens=True))\n\n    # 평균 토큰 속도 계산\n    tok_sec = round(total_length / duration, 3)\n    print(\"평균 --- %s 토큰/초 ---\" % (tok_sec))\n```\n\n9. Fine-tuning되지 않은 Text to SQL\n\n```bash\n    prompt = [\n        \"\"\"\n        다음은 작업을 설명하는 지시사항입니다. 요청을 적절히 완료하는 응답을 작성하십시오.\n        ### 지시사항 :\n        각 도시의 역 중 가장 높은 위도를 가진 역순으로 모든 도시를 나열하십시오.\n        데이터베이스 스키마:\n        CREATE TABLE station (city VARCHAR, lat INTEGER)\n        ### 응답:\n        SELECT city, lat FROM station ORDER BY lat DESC;\n        \"\"\",\n        \"\"\"\n        다음은 작업을 설명하는 지시사항입니다. 요청을 적절히 완료하는 응답을 작성하십시오.\n        ### 지시사항 :\n        '각 선수가 20점 이상 및 10점 미만을 가지고 있으며 상위 10위 안에 있는 포지션은 무엇입니까?\n        데이터베이스 스키마:\n        CREATE TABLE player (POSITION VARCHAR, Points INTEGER, Ranking INTEGER)\n        ### 응답:\n        SELECT POSITION, Points, Ranking\n        FROM player\n        WHERE Points \u003e 20 AND Points \u003c 10 AND Ranking IN (1,2,3,4,5,6,7,8,9,10)\n        \"\"\",\n        \"\"\"\n        다음은 작업을 설명하는 지시사항입니다. 요청을 적절히 완료하는 응답을 작성하십시오.\n        ### 지시사항 :\n        노래를 가장 많이 연주한 밴드 맴버의 이름을 찾아보세요.\n        데이터베이스 스키마:\n        CREATE TABLE Songs (SongId VARCHAR); CREATE TABLE Band (firstname VARCHAR, id VARCHAR); CREATE TABLE Performance (bandmate VARCHAR)\n        ### 응답:\n        SELECT b.firstname\n        FROM Band b\n        JOIN Performance p ON b.id = p.bandmate\n        GROUP BY b.firstname\n        ORDER BY COUNT(*) DESC\n        LIMIT 1;\n        \"\"\"\n    ]\n\n    for i in range(len(prompt)):\n      model_inputs = tokenizer(prompt[i], return_tensors=\"pt\").to(\"cuda:0\")\n      start_time = time.time()\n      output = model.generate(**model_inputs, max_length=500, no_repeat_ngram_size=10, pad_token_id=tokenizer.eos_token_id, eos_token_id=tokenizer.eos_token_id)[0]\n      duration += float(time.time() - start_time)\n      total_length += len(output)\n      tok_sec_prompt = round(len(output)/float(time.time() - start_time),3)\n      print(\"프롬프트 --- %s 토큰/초 ---\" % (tok_sec_prompt))\n      print(print_gpu_utilization())\n      print(tokenizer.decode(output, skip_special_tokens=False))\n\n    tok_sec = round(total_length/duration,3)\n    print(\"평균 --- %s 토큰/초 ---\" % (tok_sec))\n\n    # Fine-tuning\n\n    base_model_id = \"microsoft/Phi-3-mini-4k-instruct\"\n\n    tokenizer = AutoTokenizer.from_pretrained(base_model_id, add_eos_token=True, use_fast=True, max_length=250)\n    tokenizer.padding_side = 'right'\n    tokenizer.pad_token = tokenizer.eos_token\n\n    compute_dtype = getattr(torch, \"float16\") # Ampere (또는 최신) GPU를 사용하는 경우 bfloat16로 변경\n    bnb_config = BitsAndBytesConfig(\n            load_in_4bit=True,\n            bnb_4bit_quant_type=\"nf4\",\n            bnb_4bit_compute_dtype=compute_dtype,\n            bnb_4bit_use_double_quant=True,\n    )\n    model = AutoModelForCausalLM.from_pretrained(\n              base_model_id, trust_remote_code=True, quantization_config=bnb_config, revision=\"refs/pr/23\", device_map={\"\": 0}, torch_dtype=\"auto\", flash_attn=True, flash_rotary=True, fused_dense=True\n    )\n    print(print_gpu_utilization())\n\n    model = prepare_model_for_kbit_training(model)\n```\n\n10. LoRA 매개변수\n\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\npeft_config = LoraConfig(\n            lora_alpha=16,\n            lora_dropout=0.05,\n            r=16,\n            bias=\"none\",\n            task_type=\"CAUSAL_LM\",\n          target_modules=[\n            'q_proj',\n            'k_proj',\n            'v_proj',\n            'dense',\n            'fc1',\n            'fc2',\n        ])\n```\n\n9. Training Parameters\n\n```js\ntraining_arguments = TrainingArguments(\n            output_dir=\"./phi3-results\",\n            save_strategy=\"epoch\",\n            per_device_train_batch_size=4,\n            gradient_accumulation_steps=12,\n            log_level=\"debug\",\n            save_steps=100,\n            logging_steps=25,\n            learning_rate=1e-4,\n            eval_steps=50,\n            optim='paged_adamw_8bit',\n            fp16=True, #change to bf16 if are using an Ampere GPU\n            num_train_epochs=1,\n            max_steps=400,\n            warmup_steps=100,\n            lr_scheduler_type=\"linear\",\n            seed=42)\n```\n\n10. Data Prepare for the training\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\ntrain_dataset = instruct_tune_dataset.map(batched=True, remove_columns=['answer', 'question', 'context'])\ntrain_dataset\n```\n\n11. Fine-Tuned\n\n```js\ntrainer = SFTTrainer(\n    model=model,\n    train_dataset=train_dataset[\"train\"],\n    #eval_dataset=dataset['test'],\n    peft_config=peft_config,\n    dataset_text_field=\"inputs\",\n    max_seq_length=1024,\n    tokenizer=tokenizer,\n    args=training_arguments,\n    packing=False\n)\n\ntrainer.train()\n```\n\n12. Test inference with the fine-tuned adapter\n \n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nbase_model_id = \"microsoft/Phi-3-mini-4k-instruct\"\ntokenizer = AutoTokenizer.from_pretrained(base_model_id, use_fast=True)\n\ncompute_dtype = getattr(torch, \"float16\")\nbnb_config = BitsAndBytesConfig(\n        load_in_4bit=True,\n        bnb_4bit_quant_type=\"nf4\",\n        bnb_4bit_compute_dtype=compute_dtype,\n        bnb_4bit_use_double_quant=True,\n)\nmodel = AutoModelForCausalLM.from_pretrained(\n          base_model_id, trust_remote_code=True, quantization_config=bnb_config, device_map={\"\": 0}\n)\nadapter = \"/content/phi3-results/checkpoint-400\"\nmodel = PeftModel.from_pretrained(model, adapter)\n```\n\n13. 수행하기\n\n```js\ndatabase_schema = 'CREATE TABLE station (city VARCHAR, lat INTEGER)'\nuser_question = \"List all the cities in a decreasing order of each city's stations' highest latitude.\"\n\nprompt_template = f\"\"\"\nBelow is an instruction that describes a task. Write a response that appropriately completes the request.\n### Instruction:\n{user_question}\nDatabase Schema:\n{database_schema}\n### Response:\n\"\"\"\n\nquestion = \"'What are the positions with both players having more than 20 points and less than 10 points and are in Top 10 ranking\"\ncontext = \"CREATE TABLE player (POSITION VARCHAR, Points INTEGER, Ranking INTEGER)\"\n\nprompt_template1 = f\"\"\"\nBelow is an instruction that describes a task. Write a response that appropriately completes the request.\n### Instruction:\n{question}\nDatabase Schema:\n{context}\n### Response:\n\"\"\"\n\ncontext = '''CREATE TABLE Songs (SongId VARCHAR); CREATE TABLE Band (firstname VARCHAR, id VARCHAR); CREATE TABLE Performance (bandmate VARCHAR)'''\nquestion = \"Find the first name of the band mate that has performed in most songs.\"\n\nprompt_template2 = f\"\"\"\nBelow is an instruction that describes a task. Write a response that appropriately completes the request.\n### Instruction:\n{question}\nDatabase Schema:\n{context}\n### Response:\n\"\"\"\n\nprompt = []\nprompt.append(prompt_template)\nprompt.append(prompt_template1)\nprompt.append(prompt_template2)\n\nfor i in range(len(prompt)):\n  model_inputs = tokenizer(prompt[i], return_tensors=\"pt\").to(\"cuda:0\")\n  start_time = time.time()\n  output = model.generate(**model_inputs, max_length=500, no_repeat_ngram_size=10, pad_token_id=tokenizer.eos_token_id, eos_token_id=tokenizer.eos_token_id)[0]\n  duration += float(time.time() - start_time)\n  total_length += len(output)\n  tok_sec_prompt = round(len(output)/float(time.time() - start_time),3)\n  print(\"Prompt --- %s tokens/seconds ---\" % (tok_sec_prompt))\n  print(print_gpu_utilization())\n  print(tokenizer.decode(output, skip_special_tokens=False))\n\ntok_sec = round(total_length/duration,3)\nprint(\"Average --- %s tokens/seconds ---\" % (tok_sec))\n```\n\n14. 모델 저장하기\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nimport locale\nimport shutil\nfrom huggingface_hub import notebook_login\nfrom google.colab import drive\n\n# Set the preferred encoding to UTF-8\nlocale.getpreferredencoding = lambda: \"UTF-8\"\n\n# Log in to the notebook\nnotebook_login()\n\n# Push the fine-tuned adapter to the Hugging Face Hub\ntrainer.push_to_hub(commit_message=\"fine-tuned adapter\")\n\n# Mount Google Drive\ndrive.mount('/content/drive')\n\n# Move the trained model to Google Drive\nshutil.move('/content/phi3-results', '/content/drive/MyDrive/PHI-3')\n\n# Load the trained model\ntrained_model = AutoPeftModelForCausalLM.from_pretrained(\"/content/drive/MyDrive/PHI-3/phi3-results/checkpoint-400\",\n                                                         low_cpu_mem_usage=True,\n                                                         return_dict=True,\n                                                         torch_dtype=torch.float16,\n                                                         device_map='auto',)\n\n# Merge and unload the trained model\nlora_merged_model = trained_model.merge_and_unload()\n\n# Save the merged model\nlora_merged_model.save_pretrained(\"/content/drive/MyDrive/PHI-3/phi3-results/lora_merged_model\", safe_serialization=True)\n\n# Save the tokenizer for the merged model\ntokenizer.save_pretrained(\"/content/drive/MyDrive/PHI-3/phi3-results/lora_merged_model\")\n\n# Push the merged model to the Hugging Face Hub\nlora_merged_model.push_to_hub(repo_id=\"\", commit_message=\"merged model\")\n\n# Push the tokenizer to the Hugging Face Hub\ntokenizer.push_to_hub(repo_id=\"\", commit_message=\"merged model\")\n```\n\n15. Perform Inference on Fine-tuned Model\n\n```js\npeft_config = LoraConfig(\n            lora_alpha=16,\n            lora_dropout=0.05,\n            r=16,\n            bias=\"none\",\n            task_type=\"CAUSAL_LM\",\n    )\n\npeft_model_id = \"username/phi3-results\"\nconfig = peft_config.from_pretrained(peft_model_id)\n\nmodel = AutoModelForCausalLM.from_pretrained(config.base_model_name_or_path,\n                                             return_dict=True,\n                                             load_in_4bit=True,\n                                             device_map=\"auto\",\n                                             )\n\ntokenizer = AutoTokenizer.from_pretrained(peft_model_id)\n\nmodel = PeftModel.from_pretrained(model, peft_model_id)\n\nprint(model.get_memory_footprint())\n\nfor i in range(len(prompt)):\n    model_inputs = tokenizer(prompt[i], return_tensors=\"pt\").to(\"cuda:0\")\n    start_time = time.time()\n    output = model.generate(**model_inputs, max_length=500, no_repeat_ngram_size=10, pad_token_id=tokenizer.eos_token_id, eos_token_id=tokenizer.eos_token_id)[0]\n    duration += float(time.time() - start_time)\n    total_length += len(output)\n    tok_sec_prompt = round(len(output)/float(time.time() - start_time), 3)\n    print(\"Prompt --- %s tokens/seconds ---\" % (tok_sec_prompt))\n    print(print_gpu_utilization())\n    print(f\"RESPONSE:\\n {tokenizer.decode(output, skip_special_tokens=False)[len(prompt[i]):].split('\u003c/')[0]}\")\n\ntok_sec = round(total_length/duration, 3)\nprint(\"Average --- %s tokens/seconds ---\" % (tok_sec))\n```\n\n# Conclusion\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n자연어 처리(NLP)와 SQL 쿼리 엔진의 결합은 데이터베이스와 상호 작용하는 것을 더 쉽고 효율적으로 만들었습니다. 이전에는 SQL에 대한 심층적인 이해가 필요했기 때문에 많은 사용자들에게 어려움이 있었습니다. 그러나 Mistral 7B와 Microsoft Phi-3와 같은 오픈 소스 대형 언어 모델(LLMs)은 이를 바꿨습니다. 이 모델들은 자연어 쿼리를 구조화된 SQL 쿼리로 신속하게 변환하여, 방대한 SQL 전문 지식이 필요 없게 했습니다.\n\nMistral 7B와 Microsoft Phi-3는 NLP 작업에서 우수한 성능을 발휘하는 탁월한 모델들입니다. 그들은 Grouped-Query Attention과 Sliding Window Attention과 같은 기능을 갖추어 더욱 효율적입니다. 크기가 작은 Microsoft Phi-3도 NLP 성능과 효율성에서 새로운 기준을 세우며, 복잡한 벤치마크에서 더 큰 모델들을 능가합니다.\n\n오픈 소스 LLMs를 고급 분석 플랫폼과 AI 시스템에 통합함으로써 기업은 손쉽게 통찰을 추출할 수 있습니다. 이 기술은 금융, 건강 관리, 전자 상거래와 같은 산업들이 데이터 기반 결정을 내리는 방식을 변화시켰습니다. 이러한 모델들이 다양한 부문에 미치는 영향은 상당하며 혁신과 변혁을 촉진했습니다.\n\nNLP와 SQL의 융합을 통해 오픈 소스 LLMs는 데이터 접근을 민주화시키고 효율성, 생산성, 기업 성공을 촉진했습니다. 이는 데이터 자산의 최대 잠재력을 발휘하도록 허용하여 이해당사자들이 실행 가능한 통찰을 추출하기 쉬워지고, 여러 부문에서 탐구와 혁신의 문화를 육성했습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n노트북: phi3\n\n제 이전 📝 글들을 확인해주세요.\n\n# 참고 자료\n\n- https://arxiv.org/pdf/2310.06825.pdf\n- https://artgor.medium.com/paper-review-mistral-7b-6acdf2f3132d\n- https://medium.com/dair-ai/papers-explained-mistral-7b-b9632dedf580\n- https://www.datacamp.com/tutorial/mistral-7b-tutorial\n- https://www.analyticsvidhya.com/blog/2023/11/from-gpt-to-mistral-7b-the-exciting-leap-forward-in-ai-conversations/\n- https://medium.com/@rubentak/mistral-7b-the-best-7-billion-parameter llm-yet-8b0aa03016f9\n- https://clarifai.com/mistralai/completion/models/mistral-7B-Instruc\n- https://iamgeekydude.com/2023/06/02/alpaca-llm-load-model-using-langchain-hf/\n- https://news.microsoft.com/source/features/ai/the-phi-3-small-language-models-with-big-potential/\n- https://huggingface.co/microsoft/Phi-3-mini-128k-instruct","ogImage":{"url":"/assets/img/2024-05-18-NaturalLanguagetoSQLQueryusinganOpenSourceLLM_0.png"},"coverImage":"/assets/img/2024-05-18-NaturalLanguagetoSQLQueryusinganOpenSourceLLM_0.png","tag":["Tech"],"readingTime":32},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    p: \"p\",\n    img: \"img\",\n    ul: \"ul\",\n    li: \"li\",\n    h2: \"h2\",\n    h3: \"h3\",\n    pre: \"pre\",\n    code: \"code\",\n    span: \"span\",\n    ol: \"ol\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h1, {\n      children: \"소개\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"데이터 활용의 동적인 풍경에서는 데이터베이스와 손쉽게 상호 작용할 수 있는 능력이 중요합니다. 전통적으로 이 상호 작용은 구조화된 쿼리 언어(SQL)에 대한 심층적인 이해가 필요하여 많은 사용자들에게 진입 장벽이 되었습니다. 그러나 자연어 처리(NLP)를 SQL 쿼리 엔진에 적용하여 이 풍경이 변화되었으며, 이를 통해 사용자들이 자연어 명령을 사용하여 데이터베이스와 소통할 수 있게 되었습니다. 이 첨단 기술은 인간의 언어를 SQL 쿼리로 순조롭게 번역하여 데이터를 검색하고 조작하는 방식을 혁신하고 있습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"자연어 처리(NLP)에서 Mistral 7B 및 Microsoft Phi-3과 같은 모델은 주요 역할을 하며 성능과 효율성의 경계를 재정의하고 있습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Mistral 7B는 NLP 작업에서 뛰어난 성능과 정밀도로 높이 평가 받고 있습니다. 그룹화된 쿼리 어텐션(GQA) 및 슬라이딩 윈도우 어텐션(SWA)과 같은 혁신적인 기능들을 갖춘 Mistral 7B는 수학 및 코드 생성을 포함한 다양한 벤치마크에서 우수한 성과를 거두고 있습니다. Code-Llama 7B의 코딩 능력에 가까워짐과 동시에 NLP 발전에서의 중요성을 강조하며 다양한 분야에서 우수성을 유지하고 있습니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Phi-3 는 작은 언어 모델(SLMs) 분야에서의 Microsoft의 최신 혁신으로, AI의 풍경을 변화시키는 대단한 제품입니다. Phi-3-mini, Phi-3-small 및 Phi-3-medium으로 구성된 이 모델군은 간결한 구성으로 뛰어난 성능을 제공합니다. 38억 개의 파라미터를 자랑하는 Phi-3-mini는 더 큰 모델들과 견줄 만한 성능을 발휘하면서도 스마트폰에서 효율적으로 동작합니다. Phi-3의 성공 뒤에는 견고함, 안전성 및 대화 능력을 중시하는 정교하게 선별된 학습 데이터셋이 있습니다. Phi-3-small 및 Phi-3-medium은 Phi-3의 능력을 더욱 확장하여 다양한 응용 분야에 대응합니다. 정교하게 설계된 아키텍처와 학습 방법을 통해 Phi-3은 AI 기술의 큰 발전을 상징하며, 다양한 생성형 AI 작업에 대한 우수한 성능과 효율성을 약속합니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"NLP와 SQL의 교차점을 탐색하여 Mistral 7B와 Microsoft Phi-3의 활용에 대해 알아봅니다. 이러한 모델들은 자연어 쿼리를 구조화된 SQL 쿼리로 원활하게 변환하여 데이터베이스 쿼리 작업에서 향상된 효율성과 정확도를 제공합니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/img/2024-05-18-NaturalLanguagetoSQLQueryusinganOpenSourceLLM_0.png\",\n        alt: \"\"\n      })\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"학습 목표\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이 블로그 포스트에서는 오픈 소스 Mistral 7B 모델을 NL2SQL 작업에 활용하는 복잡성을 탐색할 것입니다. 또한 NL2SQL 애플리케이션을 위해 모델을 맞춤화하고 훈련하는 방법에 대해 논의할 것입니다. 기사의 나머지 부분은 다음과 같은 내용을 다룹니다.\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"동기부여\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"오픈 소스 LLMs를 활용하면 자연어 명령을 SQL 쿼리로 변환하는 복잡한 프로세스를 실행할 수 있습니다. 이 혁신적인 기술은 사용자가 수동 쿼리 작성 없이 데이터 요구 사항을 자연스럽게 표현하도록 자동화하며, 이로써 사용자의 입력을 분석하고 의미론적으로 정확한 SQL 쿼리를 생성하는 복잡한 알고리즘과 대규모 언어 모델이 활용됩니다. 이는 변환 프로세스를 간소화시키고 광범위한 사용자들에게 광범위한 SQL 지식이 없어도 데이터를 이용할 수 있게 합니다. 오픈 소스 LLMs는 편리함을 제공하며 데이터 접근성과 운영 효율성을 크게 향상시킵니다. SQL 전문 지식의 장벽을 제거함으로써 이 기술은 데이터 접근성을 민주화시키고 각 분야의 사용자들이 데이터를 검색하고 통찰을 얻는 데 도움을 줍니다. 실시간 통찰을 찾는 비즈니스 분석가나 데이터 집합을 탐색하는 일반 사용자를 위한 것이든, 자연어 명령의 직관적인 성격은 데이터 검색을 간단하게 합니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"또한 이러한 모델에서 내재된 자동화는 쿼리 실행을 가속화하여 전반적인 효율성과 생산성을 높입니다. 오픈 소스 LLMs의 영향력은 광범위하며 다양한 산업 전반에 혁신과 변화를 격려합니다. 이 기술은 재무, 건강 관리 및 전자 상거래 분야와 같이 데이터 주도적 의사 결정이 중요한 분야에서 이해하기 쉬운 인사이트를 추출할 수 있도록 이해권자를 돕습니다. 더 나아가, 고급 분석 플랫폼과 인공 지능 시스템과의 통합을 통해 조직을 데이터 주도적 우수성으로 이끕니다. 탐구 문화를 육성하고 데이터 상호작용을 간소화함으로써 오픈 소스 LLMs는 데이터 자산의 모든 잠재력을 발휘함으로써 산업 전반에 혁신과 성장을 촉진합니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"1. NL2SQL을 위한 사전 훈련 모델 (Mistral 7B)\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Mistral AI가 개발한 70억 개의 파라미터를 가진 언어 모델인 Mistral 7B는 인공 지능 분야에서 강력한 모델로 빠르게 인기를 얻고 있습니다.\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"기본 모델로 위치 지정된 Mistral 7B는 자연어 처리에서 중요한 역할을 하는 가장 중요한 구조적 모델로 자리 잡았으며 대규모 언어 모델 환경 내에서 필수적인 코어 빌딩 블록의 중요성을 보여줍니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"건축적 접근 방식으로 차별화된 Mistral 7B는 빠른 추론을 위해 그룹화된 쿼리 어텐션 (GQA)과 긴 시퀀스를 효율적으로 처리하기 위한 슬라이딩 윈도우 어텐션 (SWA)과 같은 혁신적인 기능을 활용하여 우수한 성능을 발휘합니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"주로 영어에 초점을 맞추지만 코딩 능력도 갖춘 Mistral 7B는 특히 다른 모델들보다 더 넓은 컨텍스트에서 텍스트를 이해하고 생성할 수 있는 높은 문맥 윈도우를 가지고 있어 두각을 나타냅니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"73억 개의 파라미터로 인상적인 Mistral 7B는 최신 언어 모델을 대표하는데, Apache 2.0 라이센스 하에 제한 없이 사용할 수 있습니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Mistral 7B는 모든 평가된 벤치마크에서 최고의 오픈 13B 모델 (Llama-2)보다 우수한 성과를 거두며 최고의 34B 모델 (Llama-1)보다 추론평가, 수학 및 코드 생성에서 뛰어난 성능을 보여줍니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Mistral-7B는 Llama2-13B보다 우수한 성능을 보이며 CodeLlama-7B와 경쟁력 있는 성과를 보이며 특히 추론, 수학 및 코드 생성 벤치마크에서 뛰어납니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"더 큰 모델들에 비해 크기는 작지만, Mistral 7B는 텍스트 요약, 분류, 텍스트 완성 및 코드 완성을 포함한 다양한 자연어 작업에서 우수한 성과를 거둡니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"이 모델이 자연어 쿼리를 구조화된 SQL 명령어로 변환하는 효과를 탐색하여 능력을 자세히 살펴봅시다.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Sliding Window Attention\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Mistral 7B은 전통적인 주의 메커니즘에서 발생하는 도전에 효과적으로 대처할 수 있는 슬라이딩 윈도우 어텐션(Sliding Window Attention, SWA) 메커니즘을 포함하고 있습니다. 전자는 토큰 수가 증가함에 따라 추론 중 지연 시간이 증가하고 처리량이 감소할 수 있으며, 시퀀스 길이와 메모리와 관련된 연산이 이차적으로 증가하고 메모리가 선형적으로 증가할 수 있습니다. 반면에 SWA는 각 토큰의 주의를 이전 레이어의 W개 토큰을 최대한으로 제한하여 주어진 윈도우 크기 W를 넘어서 주의를 확장합니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"SWA는 트랜스포머의 계층 구조를 활용하여 위치 i의 숨겨진 상태가 입력 레이어의 토큰을 W x k 토큰까지 액세스할 수 있도록 지원합니다. 최종 레이어에서 W = 4096의 윈도우 크기로, SWA는 이론적으로 대략 131K 토큰의 주의 범위를 달성할 수 있습니다. 실제적으로 W = 4096 및 FlashAttention과 xFormers의 최적화 기법을 사용하여, 16K 토큰 시퀀스의 경우 바닐라 주의 기준에 비해 주목할만한 2배의 속도 향상이 가능합니다. 따라서, SWA는 주의 메커니즘의 성능을 혁신적으로 향상시킬 수 있는 강력하고 효율적인 접근 방식입니다.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"b. 롤링 버퍼 캐시\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"롤링 버퍼 캐시를 구현함으로써, Mistral 7B는 고정된 주의 범위를 전략적으로 사용하여 캐시 크기를 효과적으로 제어합니다. 이 캐시는 W로 표시된 고정된 크기로, 캐시 내에서 특정 시간 단계 i에서 시간 단계 i mod W에 키와 값들을 효율적으로 저장합니다. 시퀀스가 진행되고 i가 W를 초과할 때, 캐시는 롤링 버퍼 메커니즘을 사용하여 이전 값들을 덮어쓰고 무한정으로 확장되는 것을 방지합니다. W = 3으로 설명된 이 접근 방식은 32k 토큰 시퀀스에 대해 8배의 캐시 메모리 사용량 감소를 실현함으로써, 모델의 품질을 희생하지 않고 달성합니다. 고정된 주의 범위는 효율적인 메모리 이용을 보장할 뿐만 아니라 Mistral 7B가 길이가 다른 시퀀스를 처리하는 데에 원활하게 기능하는 데에 기여합니다.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"c. 사전 채움 및 청크 분할\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"시퀀스 생성 과정에서는 문맥 정보에 기반하여 순차적으로 토큰을 예측하는데, (k, v) 캐시를 사용하여 효율적으로 최적화됩니다. 알려진 프롬프트로 미리 채워진 캐시를 활용하여 효율성을 높입니다. 긴 프롬프트를 관리하기 위해 지정된 윈도우 크기를 사용하여 작은 청크로 나누고, 각 청크를 사용하여 캐시를 미리 채웁니다. 이 전략적 접근 방식은 시퀀스 생성 프로세스 중 캐시 내부 및 현재 청크 전체에서 주의력을 계산하는 것을 포함합니다. 이 방법을 활용함으로써 Mistral 7B는 시퀀스 생성의 효율성을 향상시키며, 캐시에 저장된 미리 알려진 프롬프트를 효율적으로 활용하여 각 예측된 토큰을 이전 토큰과 조화롭게 정렬합니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"언어 모델의 동적인 환경에서 Mistral 7B의 등장은 성능과 효율성 면에서 큰 도약을 의미합니다. 포괄적인 평가 파이프라인을 통해 Mistral 7B는 자신의 능력을 입증하며, 이전 제품인 Llama 2 7B 및 Llama 2 13B뿐만 아니라 Llama 1 34B와 같은 핵심 벤치마크에서 뛰어난 성능을 보여줌으로써 뛰어난 경쟁력을 나타냅니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Mistral 7B의 우월성은 모든 측정 항목에 걸쳐 명백히 드러나며, 해당 분야의 선도주자로서의 지위를 재확인합니다. 다양한 벤치마크에 대한 면밀한 재평가 과정은 Mistral 7B의 탁월한 능력을 일관되게 입증하며, 경쟁사를 뒤로 남깁니다.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"크기 및 효율성 분석\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Mistral 7B의 매력 중요 요소 중 하나는 혁신적인 \\\"동등한 모델 크기\\\" 계산 방식을 통한 효율성입니다. 추론, 이해 및 STEM 추론 등에서 평가한 결과, Mistral 7B는 세 배 이상 크기의 Llama 2 모델과 동등한 성능을 보여줍니다. 이 효율성은 과도한 매개변수 부담 없이 뛰어난 결과를 제공할 수 있는 Mistral 7B의 능력을 입증합니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Mistral 7B의 효율성을 더 자세히 살펴보면, 평가 결과에서 지식 압축에 대한 흥미로운 통찰력을 확인할 수 있습니다. 지식 벤치마크에서 1.9배 낮은 압축률을 달성하지만, 이는 Mistral 7B의 의도적으로 제한된 매개변수 수에 기인합니다. 이 제한은 저장된 지식 양을 제한하지만, Mistral 7B는 집중하고 효과적으로 매개변수를 활용하여 보상합니다.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"평가의 차이점\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"불일치 사항을 투명하게 다루면서, 평가 규정의 변화를 유의하는 것이 중요합니다. 어떤 벤치마크에서는 Llama 2의 MBPP와 Mistral 7B의 평가 결과 사이에 차이가 발생합니다. TriviaQA에서 손으로 검증된 데이터를 사용하는 것이 Mistral 7B의 성능 지표의 신뢰성에 기여하는 강건한 평가 과정을 확인하게 됩니다.\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"데이터셋\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"아래 열로 구성된 구조 데이터베이스를 사용할 계획입니다. 다음 테이블에서 다양한 검색을 수행할 것입니다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"transaction = [\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"transaction_id\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"transaction_amount\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"transaction_date\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"transaction_type\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"transaction_status\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"transaction_description\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"transaction_source_account\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"transaction_destination_account\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"transaction_currency\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"transaction_fee\\\"\"\n        }), \"\\n    ]\\n\"]\n      })\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"코드 구현\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"패키지 설치하기\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"!pip install git+\", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"https\"\n        }), \":\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"//github.com/huggingface/transformers.git \"\n        }), \"\\n!pip install deepspeed --upgrade\\n!pip install accelerate\\n!pip install sentencepiece\\n!pip install langchain\\n!pip install torch\\n!pip install bitsandbytes\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"2\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"패키지 불러오기\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" os\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" re\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" torch\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" difflib \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"SequenceMatcher\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" langchain.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"chains\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LLMChain\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" langchain \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"PromptTemplate\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LLMChain\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" langchain.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"llms\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"HuggingFacePipeline\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" langchain_core.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"prompts\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"PromptTemplate\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" transformers \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LlamaTokenizer\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LlamaForCausalLM\"\n        }), \", pipeline\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"3\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"모델 불러오기\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"base_model = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LlamaForCausalLM\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"from_pretrained\"\n        }), \"(\\n     \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"mistralai/Mistral-7B-Instruct-v0.1\\\"\"\n        }), \",\\n     load_in_8bit=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \",\\n     device_map=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'auto'\"\n        }), \",\\n    )\\ntokenizer = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LlamaTokenizer\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"from_pretrained\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"mistralai/Mistral-7B-Instruct-v0.1\\\"\"\n        }), \")\\npipe = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"pipeline\"\n        }), \"(\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"text-generation\\\"\"\n        }), \",\\n        model=base_model,\\n        tokenizer=tokenizer,\\n        max_length=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"500\"\n        }), \",\\n        temperature=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0.3\"\n        }), \",\\n        top_p=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0.95\"\n        }), \",\\n        repetition_penalty=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1.2\"\n        }), \"\\n    )\\nlocal_llm = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"HuggingFacePipeline\"\n        }), \"(pipeline=pipe)\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"4\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"SequenceMatcher\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이 Python 함수는 difflib 모듈의 SequenceMatcher 클래스를 활용하여 쿼리와 지정된 사전의 열 이름 간의 유사도 점수를 계산하여 쿼리 이해력과 대체를 향상시킵니다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"def \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"find_columns_match\"\n        }), \"(question, input_dict):\\n\", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"try\"\n        }), \":\\n  question_list = re.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"split\"\n        }), \"(r\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'\\\\s|,|\\\\.'\"\n        }), \", question)\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" index, string2 \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"in\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"enumerate\"\n        }), \"(question_list):\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" string1 \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"in\"\n        }), \" input_dict.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'table1_columns'\"\n        }), \"):\\n      score = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"SequenceMatcher\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"None\"\n        }), \",string1.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"lower\"\n        }), \"(), string2.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"lower\"\n        }), \"()).\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"ratio\"\n        }), \"()*\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"100\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" score \u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"91\"\n        }), \":\\n        question_list[index] = string1 + \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\",\\\"\"\n        }), \"\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\" \\\"\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"join\"\n        }), \"(question_list)\\n  \\n\", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"except\"\n        }), \":\\n \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" question\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이 Python 함수 query_generator은 제공된 테이블명, 열 목록 및 질문에 기반하여 SQL 쿼리를 생성합니다. 이는 템플릿 문자열을 활용하여 쿼리 생성 프로세스를 구조화하며, 테이블 명, 열 목록 및 질문에 대한 자리 표시자를 포함합니다. 그런 다음 PromptTemplate 객체를 사용하여 이러한 자리 표시자를 채워넣고 LLMChain을 통해 대형 언어 모델 (LLM)과 상호 작용하여 SQL 쿼리를 생성합니다. 마지막으로 생성된 SQL 쿼리를 출력합니다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"def \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"query_generator\"\n        }), \"(tble, cols, question):\\n\\n  template = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Generate a SQL query using the following table name: {Table}, and columns as a list: {Columns}, to answer the following question:\\n  {question}.\\n  \\n  Output Query:\\n  \\n  \\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \"\\n  \\n  prompt = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"PromptTemplate\"\n        }), \"(template=template, input_variables=[\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Table\\\"\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"question\\\"\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Columns\\\"\"\n        }), \"])\\n  \\n  llm_chain = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LLMChain\"\n        }), \"(prompt=prompt, llm=local_llm)\\n  \\n  response = llm_chain.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"run\"\n        }), \"({\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Table\\\"\"\n        }), \": tble, \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"question\\\"\"\n        }), \": question, \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Columns\\\"\"\n        }), \": cols})\\n  \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(response)\\n\"]\n      })\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"표\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"transaction = [\\n\\\"transaction_id\\\",\\n\\\"transaction_amount\\\",\\n\\\"transaction_date\\\",\\n\\\"transaction_type\\\",\\n\\\"transaction_status\\\",\\n\\\"transaction_description\\\",\\n\\\"transaction_source_account\\\",\\n\\\"transaction_destination_account\\\",\\n\\\"transaction_currency\\\",\\n\\\"transaction_fee\\\"\\n]\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"inputs = [\\\"transaction_id가 10인 경우 transaction_amount, transaction_date, transaction_type,transaction_description을 검색하는 SQL 쿼리 생성\\\",\\n\\\"transaction_status가 'completed'인 경우 transaction_id, transaction_date, transaction_type, transaction_source_account을 검색하는 SQL 쿼리 생성\\\",\\n\\\"transaction_type 및 평균 transaction_amount의 개수를 검색하고 transaction_type로 정렬하는 SQL 쿼리 생성\\\",\\n\\\"각 소스 계정별 총 거래 금액 목록을 검색하고 총 거래 금액을 내림차순으로 정렬하는 SQL 쿼리 생성\\\",\\n\\\"각 거래 유형별 최대 거래 금액을 검색하고 거래 유형으로 정렬하는 SQL 쿼리 생성\\\"]\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"for input in inputs:\\nquery_generator(\\\"transaction\\\",transaction ,question=find_columns_match(input,transaction))\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"응답\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"다음과 같은 테이블 이름을 사용하고 컬럼을 나열한 리스트를 사용하여 SQL 쿼리를 생성하십시오: transaction 및 [‘transaction_id’, ‘transaction_amount’, ‘transaction_date’, ‘transaction_type’, ‘transaction_status’, ‘transaction_description’, ‘transaction_source_account’, ‘transaction_destination_account’, ‘transaction_currency’, ‘transaction_fee’], 다음 질문에 대한 응답을 위해 SQL 쿼리를 생성하십시오: (‘transaction_id가 10인 경우 transaction_amount, transaction_date, transaction_type,transaction_description을 검색하는 SQL 쿼리 생성’).\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"출력 쿼리: \\n\\n  \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"SELECT\"\n        }), \" transaction_amount, transaction_date, transaction_type, transaction_description \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"FROM\"\n        }), \" transaction \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"WHERE\"\n        }), \" transaction_id = \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"10\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"2\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"다음과 같은 테이블 이름인 transaction과 열 목록인 [‘transaction_id’, ‘transaction_amount’, ‘transaction_date’, ‘transaction_type’, ‘transaction_status’, ‘transaction_description’, ‘transaction_source_account’, ‘transaction_destination_account’, ‘transaction_currency’, ‘transaction_fee’]을 사용하여 다음 질문에 대한 SQL 쿼리를 생성하십시오:\\n(‘transaction_status가 ‘completed’인 경우 transaction_id, transaction_date, transaction_type, transaction_source_account를 검색하는 SQL 쿼리를 생성하십시오’).\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"출력 쿼리:\\n  \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"SELECT\"\n        }), \" transaction_id, transaction_date, transaction_type, transaction_source_account \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"FROM\"\n        }), \" transaction \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"WHERE\"\n        }), \" transaction_status = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'completed'\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"3\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"다음과 같은 테이블 이름인 transaction과 열 목록인 [‘transaction_id’, ‘transaction_amount’, ‘transaction_date’, ‘transaction_type’, ‘transaction_status’, ‘transaction_description’, ‘transaction_source_account’, ‘transaction_destination_account’, ‘transaction_currency’, ‘transaction_fee’]을 사용하여 다음 질문에 대한 SQL 쿼리를 생성하십시오:\\n(‘transaction_type의 count와 평균 transaction_amount를 가져오고 transaction_type으로 정렬하십시오’).```\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"결과 쿼리:\\n\\n  \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"SELECT\"\n        }), \" transaction_type, \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"AVG\"\n        }), \"(transaction_amount) \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"AS\"\n        }), \" avg_transaction_amount, \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"COUNT\"\n        }), \"(*) \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"AS\"\n        }), \" total_count\\n  \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"FROM\"\n        }), \" transaction\\n  \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"GROUP\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"BY\"\n        }), \" transaction_type\\n  \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"ORDER\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"BY\"\n        }), \" transaction_type;\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"4\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"다음 테이블 이름과 열 목록을 사용하여 SQL 쿼리를 생성하십시오: transaction 및 열: ['transaction_id', 'transaction_amount', 'transaction_date', 'transaction_type', 'transaction_status', 'transaction_description', 'transaction_source_account', 'transaction_destination_account', 'transaction_currency', 'transaction_fee'], 다음 질문에 답하십시오:\\n(‘리스트에서 각 소스 계정의 총 거래 금액을 내림차순으로 정렬하여 조회하는 SQL 쿼리를 생성하세요’).\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"결과 쿼리:\\n\\n       \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"SELECT\"\n        }), \" transaction_source_account, \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"SUM\"\n        }), \"(transaction_amount) \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"AS\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"TotalTransactionAmount\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"FROM\"\n        }), \" transaction\\n        \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"GROUP\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"BY\"\n        }), \" transaction_source_account\\n        \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"ORDER\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"BY\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"TotalTransactionAmount\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"DESC\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"5\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"다음 테이블 이름과 열 목록을 사용하여 SQL 쿼리를 생성하십시오: transaction 및 열: ['transaction_id', 'transaction_amount', 'transaction_date', 'transaction_type', 'transaction_status', 'transaction_description', 'transaction_source_account', 'transaction_destination_account', 'transaction_currency', 'transaction_fee'], 다음 질문에 답하십시오:\\n(‘각 거래 유형의 최대 거래 금액을 찾아 거래 유형으로 정렬하는 SQL 쿼리를 생성하세요’).```\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"출력 쿼리:\\n\\n   \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"SELECT\"\n        }), \" transaction_type, \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"MAX\"\n        }), \"(transaction_amount) \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"AS\"\n        }), \" max_transaction_amount\\n   \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"FROM\"\n        }), \" transaction\\n   \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"GROUP\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"BY\"\n        }), \" transaction_type\\n   \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"ORDER\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"BY\"\n        }), \" transaction_type;\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"일반적인 추출은 효과적이지만, 연구 결과, 데이터를 세부 조정하여 LLM을 수행하면 우수한 결과를 얻을 수 있습니다. 세밀 조정 접근법을 채용해 봅시다.\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"2 Fine-tune NL2SQL with Phi-3\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Phi-3를 만나보세요, Microsoft의 최신 오픈 AI 모델의 주요 성과입니다. Phi-3-mini, Phi-3-small 및 Phi-3-medium을 통해, 이 작은 언어 모델 (SLM)의 Phi-3 패밀리는 AI 모델의 세계를 혁신하도록 설계되었습니다. 38억 개의 파라미터를 사용하고 33조 개의 토큰으로 훈련된 Phi-3-mini는 높은 성능을 발휘하며 Mixtral 8x7B 및 GPT-3.5와 같은 큰 모델과 같은 성능을 보여줍니다. 게다가, 이 모델은 스마트폰 장치에서 효율적으로 작동할 수 있습니다. Phi-3의 성공은 훈련 데이터셋에 기인합니다. Phi-2의 데이터셋의 진화된 버전입니다. 상세히 걸러낸 웹 데이터 및 합성 입력을 통해 이러한 모델은 강도, 안전 및 대화 능력에 우선순위를 두어 다양한 응용프로그램에 적합합니다. 7B 및 14B 파라미터를 가진 Phi-3-small 및 Phi-3-medium은 효율 유지와 함께 Phi-3의 기능을 더욱 향상시키도록 설계되었습니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Phi 3 Architecture and Evaluation\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Phi-3 패밀리는 품질과 비용을 균형있게 유지하도록 설계된 다양한 모델을 제공하여 생성형 AI 애플리케이션을 개발하는 고객을 위한 옵션을 제공합니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Phi-3-mini: 이 모델은 38억 개의 파라미터를 갖추고 33조 개의 토큰으로 이루어진 광범위한 데이터셋을 기반으로 훈련되었습니다. 32개의 레이어, 32개의 어텐션 헤드, 그리고 3072개의 히든 디멘션을 갖는 트랜스포머 디코더 아키텍처를 채택했습니다. 디폴트 콘텍스트 길이는 4천 개의 토큰이며, 32K 어휘 사전을 사용하는 토크나이저를 활용합니다. 추가로, 128K 토큰의 콘텍스트 길이를 갖춘 확장 버전인 Phi-3-mini-128K도 있습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Phi-3-small: 70억 개의 파라미터로 훈련된 Phi-3-small은 48조 개의 토큰을 사용합니다. 이 모델은 100K 어휘 사전과 8천 개의 디폴트 콘텍스트 길이를 갖추었습니다. 아키텍처는 32개의 레이어, 32개의 어텐션 헤드, 그리고 4096개의 히든 디멘션으로 이루어져 있습니다. 이 모델은 메모리 사용량을 최적화하기 위해 그룹화된 쿼리 어텐션과 번갈아가며 쓰이는 밀집/희소 어텐션을 활용합니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Phi-3-medium: 이 미리보기 모델은 140억 개의 매개변수를 자랑하며 4.8조 개의 토큰으로 학습되었습니다. 40개의 레이어, 40개의 어텐션 헤드, 그리고 임베딩 크기는 5120입니다.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"훈련 방법:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"훈련 데이터 구성: Phi-3 모델의 훈련 데이터는 신중하게 선별됩니다. 교육 수준별로 분류된 웹 데이터와 합성 LLM 생성 데이터로 구성되며 두 가지 이질적이고 순차적인 단계로 사전 훈련을 거칩니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"사전 훈련 단계: 제1 단계는 일반 지식과 언어 이해에 중점을 둔 웹 소스를 사용합니다. 제2 단계는 논리 추론 및 특정 기술을 가르치기 위해 제1 단계의 웹 데이터와 합성 데이터를 더 많이 활용합니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"사후 훈련 단계: 사전 훈련 후, Phi-3-mini는 감독형 세밀 조정 (SFT) 및 직접 선호도 최적화 (DPO)를 거쳤습니다. SFT는 수학, 코딩, 추론, 대화, 모델 신원, 안전 도메인 간에 높은 품질의 데이터를 선별하는 과정을 포함합니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"DPO는 채팅 형식 데이터, 추론, 그리고 책임 있는 AI 노력에 초점을 맞춥니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"맥락 확장: Phi-3-mini의 맥락 창 크기가 Long Rope 방법론을 사용하여 4k 토큰에서 128k 토큰으로 확장되었습니다. 이 확장은 맥락의 길이가 크게 증가함에도 일관된 성능을 유지합니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"데이터 최적화: 훈련 데이터는 모델의 규모를 위한 \\\"데이터 최적\\\" 지점으로 보정됩니다. 웹 데이터는 지식과 추론의 적절한 균형을 보장하기 위해 필터링됩니다. 특히 작은 모델의 경우 이는 매우 중요합니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"다른 모델과의 비교: Phi-3의 접근 방식은 이전 작업과 대조적으로, 해당 규모에 대한 데이터 품질에 중점을 두며 컴퓨팅이나 과도한 훈련 방법보다 데이터 최적화를 강조합니다. 벤치마크 비교는 Phi-3가 작은 모델 용량을 위한 최적화를 잘 보여줍니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Phi-3-medium 미리보기: 140억 개의 매개변수를 가진 Phi-3-medium은 Phi-3-mini와 유사하게 훈련되었지만 더 큰 규모로 이루어집니다. 일부 벤치마크에서는 7B에서 14B 매개변수로의 전환에서 큰 개선이 없어 계속해서 데이터 혼합을 개선 중임을 시사합니다.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"사후 향상: 모델은 채팅 능력, 견고성, 그리고 안전성을 향상시키기 위해 감독형 세밀 조정 및 DPO를 통한 선호도 조정을 거칩니다.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"안전성\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Phi-3-mini은 Microsoft의 책임 있는 AI 원칙에 따라 만들어진 AI 모델입니다. 이 프로젝트는 개발 초기부터 안전을 우선시하는 원칙을 중요시하여 만들어졌습니다. 모델이 윤리 기준을 준수하고 잠재적인 피해를 최소화할 수 있는 능력을 보장하기 위해 포괄적인 전략이 채택되었습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"모델 학습 후에는, 해당 모델이 책임 있는 AI 기준을 충족하는지 확인하기 위해 면밀한 안전 조정이 이루어집니다. 게다가, Microsoft의 독립된 레드 팀이 Phi-3-mini를 검토하여 강화 및 안전 프로토콜을 강화할 수 있는 부분을 식별합니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"자동화된 테스팅과 잠재적인 피해의 다양한 범주에 대한 평가는 프로세스의 중요한 부분입니다. 이러한 테스트는 모델의 출력물로부터 발생하는 모든 위험을 감지하고 해결하는 데 목표를 두고 있습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"더 나아가, Phi-3-mini는 의견 데이터 세트를 활용하여 응답을 더욱 개선합니다. 특정 테스트 중 확인된 잠재적인 피해 범주에 대응하기 위해 내부에서 생성된 데이터 세트가 사용됩니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"코드 구현\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"패키지 설치\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-js\",\n        children: \" !pip install -q -U bitsandbytes\\n !pip install -q -U transformers\\n !pip install -q -U xformers\\n !pip install -q -U peft\\n !pip install -q -U accelerate\\n !pip install -q -U datasets\\n !pip install -q -U trl\\n !pip install -q -U einops\\n !pip install -q -U nvidia-ml-py3\\n !pip install -q -U huggingface_hub\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"2\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"패키지 가져오기\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-python\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" datasets \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" load_dataset\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" transformers \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" AutoTokenizer, AutoModelForCausalLM, BitsAndBytesConfig, TrainingArguments, Trainer, DataCollatorForLanguageModeling\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" pynvml \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" *\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" time, torch\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" trl \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" SFTTrainer\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" peft \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" LoraConfig, PeftModel, get_peft_model, prepare_model_for_kbit_training\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" peft \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" AutoPeftModelForCausalLM\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"3\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"데이터셋 불러오기\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-python\",\n        children: [\"dataset = load_dataset(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"b-mc2/sql-create-context\\\"\"\n        }), \")\\ndataset\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"4\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"데이터셋 형식화\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"def \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"create_prompt\"\n        }), \"(sample):\\n      system_prompt_template = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\u003cs\u003e\\n            아래는 작업을 설명하는 지시사항입니다. 요청을 적절히 완료하는 응답을 작성하십시오.\\n            ### 지시사항: \u003c\u003cuser_question\u003e\u003e\\n            ### 데이터베이스 스키마:\\n            \u003c\u003cdatabase_schema\u003e\u003e\\n            ### 응답:\\n            \u003c\u003cuser_response\u003e\u003e\\n            \u003c/s\u003e\\n            \\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \"\\n      user_message = sample[\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'question'\"\n        }), \"]\\n      user_response = sample[\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'answer'\"\n        }), \"]\\n      database_schema = sample[\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'context'\"\n        }), \"]\\n      prompt_template = system_prompt_template.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"replace\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\u003c\u003cuser_question\u003e\u003e\\\"\"\n        }), \",f\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"{user_message}\\\"\"\n        }), \").\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"replace\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\u003c\u003cuser_response\u003e\u003e\\\"\"\n        }), \",f\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"{user_response}\\\"\"\n        }), \").\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"replace\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\u003c\u003cdatabase_schema\u003e\u003e\\\"\"\n        }), \",f\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"{database_schema} \\\"\"\n        }), \")\\n\\n      \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" {\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"inputs\\\"\"\n        }), \":prompt_template}\\n\\n\\ninstruct_tune_dataset = dataset.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"map\"\n        }), \"(create_prompt)\\n\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(instruct_tune_dataset)\\n\\ndef \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print_gpu_utilization\"\n        }), \"():\\n    \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"nvmlInit\"\n        }), \"()\\n    handle = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"nvmlDeviceGetHandleByIndex\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \")\\n    info = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"nvmlDeviceGetMemoryInfo\"\n        }), \"(handle)\\n    \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(f\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"GPU 메모리 사용량: {info.used//1024**2} MB.\\\"\"\n        }), \")\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"5\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"토크나이저와 모델 로드\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"base_model_id = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"microsoft/Phi-3-mini-4k-instruct\\\"\"\n        }), \"\\n\\n# 토크나이저 로드\\ntokenizer = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"AutoTokenizer\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"from_pretrained\"\n        }), \"(base_model_id, use_fast=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \")\\n# fp16로 모델 로드\\nmodel = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"AutoModelForCausalLM\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"from_pretrained\"\n        }), \"(base_model_id, trust_remote_code=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \", torch_dtype=torch.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"float16\"\n        }), \", device_map={\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"})\\n\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print_gpu_utilization\"\n        }), \"())\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"6\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"모델 추론\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"프롬프트 정의\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-bash\",\n        children: [\"    prompt = [\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"코코넛 밀크로 만든 치킨 카레 레시피를 작성해주세요.\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"다음 문장을 프랑스어로 번역해주세요: '나는 빵과 치즈를 좋아해요!'\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"유명한 20명의 인물을 인용해보세요.\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"지금 달은 어디에 있나요?\\\"\"\n        }), \"\\n    ]\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 변수 초기화\"\n        }), \"\\n    duration = 0.0\\n    total_length = 0\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 프롬프트 반복\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" i \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"in\"\n        }), \" range(len(prompt)):\\n        \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 프롬프트 토큰화 및 GPU로 이동\"\n        }), \"\\n        inputs = tokenizer(prompt[i], return_tensors=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"pt\\\"\"\n        }), \").to(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"cuda:0\\\"\"\n        }), \")\\n\\n        \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 입력 텐서 인덱스를 torch.long으로 변환\"\n        }), \"\\n        inputs = {k: v.to(torch.long) \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" k, v \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"in\"\n        }), \" inputs.items()}\\n\\n        \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 시작 시간\"\n        }), \"\\n        start_time = time.time()\\n\\n        \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 자동 캐스팅을 사용하여 추론 수행\"\n        }), \"\\n        with torch.cuda.amp.autocast(enabled=False):  \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 자동 캐스팅 비활성화\"\n        }), \"\\n            output = model.generate(**inputs, max_length=500)\\n\\n        \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 소요 시간과 총 길이 계산\"\n        }), \"\\n        duration += \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"float\"\n        }), \"(time.time() - start_time)\\n        total_length += len(output)\\n\\n        \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 프롬프트당 토큰 속도 계산\"\n        }), \"\\n        tok_sec_prompt = round(len(output) / \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"float\"\n        }), \"(time.time() - start_time), 3)\\n\\n        \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 프롬프트당 토큰 속도 출력\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"print\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"프롬프트 --- %s 토큰/초 ---\\\"\"\n        }), \" % (tok_sec_prompt))\\n\\n        \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 디코드된 출력 출력\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"print\"\n        }), \"(tokenizer.decode(output[0], skip_special_tokens=True))\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 평균 토큰 속도 계산\"\n        }), \"\\n    tok_sec = round(total_length / duration, 3)\\n    \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"print\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"평균 --- %s 토큰/초 ---\\\"\"\n        }), \" % (tok_sec))\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"9\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Fine-tuning되지 않은 Text to SQL\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-bash\",\n        children: [\"    prompt = [\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\n        다음은 작업을 설명하는 지시사항입니다. 요청을 적절히 완료하는 응답을 작성하십시오.\\n        ### 지시사항 :\\n        각 도시의 역 중 가장 높은 위도를 가진 역순으로 모든 도시를 나열하십시오.\\n        데이터베이스 스키마:\\n        CREATE TABLE station (city VARCHAR, lat INTEGER)\\n        ### 응답:\\n        SELECT city, lat FROM station ORDER BY lat DESC;\\n        \\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\n        다음은 작업을 설명하는 지시사항입니다. 요청을 적절히 완료하는 응답을 작성하십시오.\\n        ### 지시사항 :\\n        '각 선수가 20점 이상 및 10점 미만을 가지고 있으며 상위 10위 안에 있는 포지션은 무엇입니까?\\n        데이터베이스 스키마:\\n        CREATE TABLE player (POSITION VARCHAR, Points INTEGER, Ranking INTEGER)\\n        ### 응답:\\n        SELECT POSITION, Points, Ranking\\n        FROM player\\n        WHERE Points \u003e 20 AND Points \u003c 10 AND Ranking IN (1,2,3,4,5,6,7,8,9,10)\\n        \\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \",\\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\n        다음은 작업을 설명하는 지시사항입니다. 요청을 적절히 완료하는 응답을 작성하십시오.\\n        ### 지시사항 :\\n        노래를 가장 많이 연주한 밴드 맴버의 이름을 찾아보세요.\\n        데이터베이스 스키마:\\n        CREATE TABLE Songs (SongId VARCHAR); CREATE TABLE Band (firstname VARCHAR, id VARCHAR); CREATE TABLE Performance (bandmate VARCHAR)\\n        ### 응답:\\n        SELECT b.firstname\\n        FROM Band b\\n        JOIN Performance p ON b.id = p.bandmate\\n        GROUP BY b.firstname\\n        ORDER BY COUNT(*) DESC\\n        LIMIT 1;\\n        \\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \"\\n    ]\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" i \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"in\"\n        }), \" range(len(prompt)):\\n      model_inputs = tokenizer(prompt[i], return_tensors=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"pt\\\"\"\n        }), \").to(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"cuda:0\\\"\"\n        }), \")\\n      start_time = time.time()\\n      output = model.generate(**model_inputs, max_length=500, no_repeat_ngram_size=10, pad_token_id=tokenizer.eos_token_id, eos_token_id=tokenizer.eos_token_id)[0]\\n      duration += \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"float\"\n        }), \"(time.time() - start_time)\\n      total_length += len(output)\\n      tok_sec_prompt = round(len(output)/float(time.time() - start_time),3)\\n      \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"print\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"프롬프트 --- %s 토큰/초 ---\\\"\"\n        }), \" % (tok_sec_prompt))\\n      \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"print\"\n        }), \"(print_gpu_utilization())\\n      \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"print\"\n        }), \"(tokenizer.decode(output, skip_special_tokens=False))\\n\\n    tok_sec = round(total_length/duration,3)\\n    \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"print\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"평균 --- %s 토큰/초 ---\\\"\"\n        }), \" % (tok_sec))\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Fine-tuning\"\n        }), \"\\n\\n    base_model_id = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"microsoft/Phi-3-mini-4k-instruct\\\"\"\n        }), \"\\n\\n    tokenizer = AutoTokenizer.from_pretrained(base_model_id, add_eos_token=True, use_fast=True, max_length=250)\\n    tokenizer.padding_side = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'right'\"\n        }), \"\\n    tokenizer.pad_token = tokenizer.eos_token\\n\\n    compute_dtype = getattr(torch, \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"float16\\\"\"\n        }), \") \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Ampere (또는 최신) GPU를 사용하는 경우 bfloat16로 변경\"\n        }), \"\\n    bnb_config = BitsAndBytesConfig(\\n            load_in_4bit=True,\\n            bnb_4bit_quant_type=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"nf4\\\"\"\n        }), \",\\n            bnb_4bit_compute_dtype=compute_dtype,\\n            bnb_4bit_use_double_quant=True,\\n    )\\n    model = AutoModelForCausalLM.from_pretrained(\\n              base_model_id, trust_remote_code=True, quantization_config=bnb_config, revision=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"refs/pr/23\\\"\"\n        }), \", device_map={\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \": 0}, torch_dtype=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"auto\\\"\"\n        }), \", flash_attn=True, flash_rotary=True, fused_dense=True\\n    )\\n    \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"print\"\n        }), \"(print_gpu_utilization())\\n\\n    model = prepare_model_for_kbit_training(model)\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"10\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"LoRA 매개변수\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"peft_config = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LoraConfig\"\n        }), \"(\\n            lora_alpha=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"16\"\n        }), \",\\n            lora_dropout=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0.05\"\n        }), \",\\n            r=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"16\"\n        }), \",\\n            bias=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"none\\\"\"\n        }), \",\\n            task_type=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"CAUSAL_LM\\\"\"\n        }), \",\\n          target_modules=[\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'q_proj'\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'k_proj'\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'v_proj'\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'dense'\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'fc1'\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'fc2'\"\n        }), \",\\n        ])\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"9\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Training Parameters\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"training_arguments = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"TrainingArguments\"\n        }), \"(\\n            output_dir=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"./phi3-results\\\"\"\n        }), \",\\n            save_strategy=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"epoch\\\"\"\n        }), \",\\n            per_device_train_batch_size=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"4\"\n        }), \",\\n            gradient_accumulation_steps=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"12\"\n        }), \",\\n            log_level=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"debug\\\"\"\n        }), \",\\n            save_steps=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"100\"\n        }), \",\\n            logging_steps=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"25\"\n        }), \",\\n            learning_rate=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1e-4\"\n        }), \",\\n            eval_steps=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"50\"\n        }), \",\\n            optim=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'paged_adamw_8bit'\"\n        }), \",\\n            fp16=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \", #change to bf16 \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" are using an \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Ampere\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"GPU\"\n        }), \"\\n            num_train_epochs=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \",\\n            max_steps=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"400\"\n        }), \",\\n            warmup_steps=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"100\"\n        }), \",\\n            lr_scheduler_type=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"linear\\\"\"\n        }), \",\\n            seed=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"42\"\n        }), \")\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"10\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Data Prepare for the training\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"train_dataset = instruct_tune_dataset.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"map\"\n        }), \"(batched=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \", remove_columns=[\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'answer'\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'question'\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'context'\"\n        }), \"])\\ntrain_dataset\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"11\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Fine-Tuned\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"trainer = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"SFTTrainer\"\n        }), \"(\\n    model=model,\\n    train_dataset=train_dataset[\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"train\\\"\"\n        }), \"],\\n    #eval_dataset=dataset[\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'test'\"\n        }), \"],\\n    peft_config=peft_config,\\n    dataset_text_field=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"inputs\\\"\"\n        }), \",\\n    max_seq_length=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1024\"\n        }), \",\\n    tokenizer=tokenizer,\\n    args=training_arguments,\\n    packing=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"False\"\n        }), \"\\n)\\n\\ntrainer.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"train\"\n        }), \"()\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"12\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Test inference with the fine-tuned adapter\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"base_model_id = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"microsoft/Phi-3-mini-4k-instruct\\\"\"\n        }), \"\\ntokenizer = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"AutoTokenizer\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"from_pretrained\"\n        }), \"(base_model_id, use_fast=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \")\\n\\ncompute_dtype = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"getattr\"\n        }), \"(torch, \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"float16\\\"\"\n        }), \")\\nbnb_config = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"BitsAndBytesConfig\"\n        }), \"(\\n        load_in_4bit=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \",\\n        bnb_4bit_quant_type=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"nf4\\\"\"\n        }), \",\\n        bnb_4bit_compute_dtype=compute_dtype,\\n        bnb_4bit_use_double_quant=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \",\\n)\\nmodel = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"AutoModelForCausalLM\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"from_pretrained\"\n        }), \"(\\n          base_model_id, trust_remote_code=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \", quantization_config=bnb_config, device_map={\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"}\\n)\\nadapter = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"/content/phi3-results/checkpoint-400\\\"\"\n        }), \"\\nmodel = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"PeftModel\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"from_pretrained\"\n        }), \"(model, adapter)\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"13\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"수행하기\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"database_schema = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'CREATE TABLE station (city VARCHAR, lat INTEGER)'\"\n        }), \"\\nuser_question = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"List all the cities in a decreasing order of each city's stations' highest latitude.\\\"\"\n        }), \"\\n\\nprompt_template = f\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\nBelow is an instruction that describes a task. Write a response that appropriately completes the request.\\n### Instruction:\\n{user_question}\\nDatabase Schema:\\n{database_schema}\\n### Response:\\n\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \"\\n\\nquestion = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"'What are the positions with both players having more than 20 points and less than 10 points and are in Top 10 ranking\\\"\"\n        }), \"\\ncontext = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"CREATE TABLE player (POSITION VARCHAR, Points INTEGER, Ranking INTEGER)\\\"\"\n        }), \"\\n\\nprompt_template1 = f\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\nBelow is an instruction that describes a task. Write a response that appropriately completes the request.\\n### Instruction:\\n{question}\\nDatabase Schema:\\n{context}\\n### Response:\\n\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \"\\n\\ncontext = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"''\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'CREATE TABLE Songs (SongId VARCHAR); CREATE TABLE Band (firstname VARCHAR, id VARCHAR); CREATE TABLE Performance (bandmate VARCHAR)'\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"''\"\n        }), \"\\nquestion = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Find the first name of the band mate that has performed in most songs.\\\"\"\n        }), \"\\n\\nprompt_template2 = f\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\nBelow is an instruction that describes a task. Write a response that appropriately completes the request.\\n### Instruction:\\n{question}\\nDatabase Schema:\\n{context}\\n### Response:\\n\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \"\\n\\nprompt = []\\nprompt.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"append\"\n        }), \"(prompt_template)\\nprompt.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"append\"\n        }), \"(prompt_template1)\\nprompt.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"append\"\n        }), \"(prompt_template2)\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" i \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"in\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"range\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"len\"\n        }), \"(prompt)):\\n  model_inputs = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"tokenizer\"\n        }), \"(prompt[i], return_tensors=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"pt\\\"\"\n        }), \").\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"to\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"cuda:0\\\"\"\n        }), \")\\n  start_time = time.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"time\"\n        }), \"()\\n  output = model.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"generate\"\n        }), \"(**model_inputs, max_length=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"500\"\n        }), \", no_repeat_ngram_size=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"10\"\n        }), \", pad_token_id=tokenizer.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"eos_token_id\"\n        }), \", eos_token_id=tokenizer.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"eos_token_id\"\n        }), \")[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"]\\n  duration += \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"float\"\n        }), \"(time.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"time\"\n        }), \"() - start_time)\\n  total_length += \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"len\"\n        }), \"(output)\\n  tok_sec_prompt = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"round\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"len\"\n        }), \"(output)/\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"float\"\n        }), \"(time.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"time\"\n        }), \"() - start_time),\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"3\"\n        }), \")\\n  \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Prompt --- %s tokens/seconds ---\\\"\"\n        }), \" % (tok_sec_prompt))\\n  \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print_gpu_utilization\"\n        }), \"())\\n  \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(tokenizer.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"decode\"\n        }), \"(output, skip_special_tokens=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"False\"\n        }), \"))\\n\\ntok_sec = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"round\"\n        }), \"(total_length/duration,\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"3\"\n        }), \")\\n\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Average --- %s tokens/seconds ---\\\"\"\n        }), \" % (tok_sec))\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"14\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"모델 저장하기\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" locale\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" shutil\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" huggingface_hub \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" notebook_login\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" google.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"colab\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" drive\\n\\n# \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Set\"\n        }), \" the preferred encoding to \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"UTF\"\n        }), \"-\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"8\"\n        }), \"\\nlocale.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"getpreferredencoding\"\n        }), \" = \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"lambda\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"UTF-8\\\"\"\n        }), \"\\n\\n# \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Log\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"in\"\n        }), \" to the notebook\\n\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"notebook_login\"\n        }), \"()\\n\\n# \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Push\"\n        }), \" the fine-tuned adapter to the \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Hugging\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Face\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Hub\"\n        }), \"\\ntrainer.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"push_to_hub\"\n        }), \"(commit_message=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"fine-tuned adapter\\\"\"\n        }), \")\\n\\n# \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Mount\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Google\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Drive\"\n        }), \"\\ndrive.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"mount\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'/content/drive'\"\n        }), \")\\n\\n# \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Move\"\n        }), \" the trained model to \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Google\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Drive\"\n        }), \"\\nshutil.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"move\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'/content/phi3-results'\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'/content/drive/MyDrive/PHI-3'\"\n        }), \")\\n\\n# \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Load\"\n        }), \" the trained model\\ntrained_model = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"AutoPeftModelForCausalLM\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"from_pretrained\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"/content/drive/MyDrive/PHI-3/phi3-results/checkpoint-400\\\"\"\n        }), \",\\n                                                         low_cpu_mem_usage=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \",\\n                                                         return_dict=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \",\\n                                                         torch_dtype=torch.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"float16\"\n        }), \",\\n                                                         device_map=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'auto'\"\n        }), \",)\\n\\n# \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Merge\"\n        }), \" and unload the trained model\\nlora_merged_model = trained_model.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"merge_and_unload\"\n        }), \"()\\n\\n# \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Save\"\n        }), \" the merged model\\nlora_merged_model.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"save_pretrained\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"/content/drive/MyDrive/PHI-3/phi3-results/lora_merged_model\\\"\"\n        }), \", safe_serialization=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \")\\n\\n# \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Save\"\n        }), \" the tokenizer \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" the merged model\\ntokenizer.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"save_pretrained\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"/content/drive/MyDrive/PHI-3/phi3-results/lora_merged_model\\\"\"\n        }), \")\\n\\n# \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Push\"\n        }), \" the merged model to the \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Hugging\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Face\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Hub\"\n        }), \"\\nlora_merged_model.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"push_to_hub\"\n        }), \"(repo_id=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \", commit_message=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"merged model\\\"\"\n        }), \")\\n\\n# \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Push\"\n        }), \" the tokenizer to the \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Hugging\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Face\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Hub\"\n        }), \"\\ntokenizer.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"push_to_hub\"\n        }), \"(repo_id=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \", commit_message=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"merged model\\\"\"\n        }), \")\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      start: \"15\",\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Perform Inference on Fine-tuned Model\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"peft_config = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LoraConfig\"\n        }), \"(\\n            lora_alpha=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"16\"\n        }), \",\\n            lora_dropout=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0.05\"\n        }), \",\\n            r=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"16\"\n        }), \",\\n            bias=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"none\\\"\"\n        }), \",\\n            task_type=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"CAUSAL_LM\\\"\"\n        }), \",\\n    )\\n\\npeft_model_id = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"username/phi3-results\\\"\"\n        }), \"\\nconfig = peft_config.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"from_pretrained\"\n        }), \"(peft_model_id)\\n\\nmodel = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"AutoModelForCausalLM\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"from_pretrained\"\n        }), \"(config.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"base_model_name_or_path\"\n        }), \",\\n                                             return_dict=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \",\\n                                             load_in_4bit=\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"True\"\n        }), \",\\n                                             device_map=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"auto\\\"\"\n        }), \",\\n                                             )\\n\\ntokenizer = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"AutoTokenizer\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"from_pretrained\"\n        }), \"(peft_model_id)\\n\\nmodel = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"PeftModel\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"from_pretrained\"\n        }), \"(model, peft_model_id)\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(model.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get_memory_footprint\"\n        }), \"())\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" i \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"in\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"range\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"len\"\n        }), \"(prompt)):\\n    model_inputs = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"tokenizer\"\n        }), \"(prompt[i], return_tensors=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"pt\\\"\"\n        }), \").\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"to\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"cuda:0\\\"\"\n        }), \")\\n    start_time = time.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"time\"\n        }), \"()\\n    output = model.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"generate\"\n        }), \"(**model_inputs, max_length=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"500\"\n        }), \", no_repeat_ngram_size=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"10\"\n        }), \", pad_token_id=tokenizer.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"eos_token_id\"\n        }), \", eos_token_id=tokenizer.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"eos_token_id\"\n        }), \")[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"]\\n    duration += \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"float\"\n        }), \"(time.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"time\"\n        }), \"() - start_time)\\n    total_length += \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"len\"\n        }), \"(output)\\n    tok_sec_prompt = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"round\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"len\"\n        }), \"(output)/\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"float\"\n        }), \"(time.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"time\"\n        }), \"() - start_time), \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"3\"\n        }), \")\\n    \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Prompt --- %s tokens/seconds ---\\\"\"\n        }), \" % (tok_sec_prompt))\\n    \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print_gpu_utilization\"\n        }), \"())\\n    \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(f\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"RESPONSE:\\\\n {tokenizer.decode(output, skip_special_tokens=False)[len(prompt[i]):].split('\u003c/')[0]}\\\"\"\n        }), \")\\n\\ntok_sec = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"round\"\n        }), \"(total_length/duration, \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"3\"\n        }), \")\\n\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Average --- %s tokens/seconds ---\\\"\"\n        }), \" % (tok_sec))\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"Conclusion\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"자연어 처리(NLP)와 SQL 쿼리 엔진의 결합은 데이터베이스와 상호 작용하는 것을 더 쉽고 효율적으로 만들었습니다. 이전에는 SQL에 대한 심층적인 이해가 필요했기 때문에 많은 사용자들에게 어려움이 있었습니다. 그러나 Mistral 7B와 Microsoft Phi-3와 같은 오픈 소스 대형 언어 모델(LLMs)은 이를 바꿨습니다. 이 모델들은 자연어 쿼리를 구조화된 SQL 쿼리로 신속하게 변환하여, 방대한 SQL 전문 지식이 필요 없게 했습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Mistral 7B와 Microsoft Phi-3는 NLP 작업에서 우수한 성능을 발휘하는 탁월한 모델들입니다. 그들은 Grouped-Query Attention과 Sliding Window Attention과 같은 기능을 갖추어 더욱 효율적입니다. 크기가 작은 Microsoft Phi-3도 NLP 성능과 효율성에서 새로운 기준을 세우며, 복잡한 벤치마크에서 더 큰 모델들을 능가합니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"오픈 소스 LLMs를 고급 분석 플랫폼과 AI 시스템에 통합함으로써 기업은 손쉽게 통찰을 추출할 수 있습니다. 이 기술은 금융, 건강 관리, 전자 상거래와 같은 산업들이 데이터 기반 결정을 내리는 방식을 변화시켰습니다. 이러한 모델들이 다양한 부문에 미치는 영향은 상당하며 혁신과 변혁을 촉진했습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"NLP와 SQL의 융합을 통해 오픈 소스 LLMs는 데이터 접근을 민주화시키고 효율성, 생산성, 기업 성공을 촉진했습니다. 이는 데이터 자산의 최대 잠재력을 발휘하도록 허용하여 이해당사자들이 실행 가능한 통찰을 추출하기 쉬워지고, 여러 부문에서 탐구와 혁신의 문화를 육성했습니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"노트북: phi3\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"제 이전 📝 글들을 확인해주세요.\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"참고 자료\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"https://arxiv.org/pdf/2310.06825.pdf\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"https://artgor.medium.com/paper-review-mistral-7b-6acdf2f3132d\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"https://medium.com/dair-ai/papers-explained-mistral-7b-b9632dedf580\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"https://www.datacamp.com/tutorial/mistral-7b-tutorial\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"https://www.analyticsvidhya.com/blog/2023/11/from-gpt-to-mistral-7b-the-exciting-leap-forward-in-ai-conversations/\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"https://medium.com/@rubentak/mistral-7b-the-best-7-billion-parameter llm-yet-8b0aa03016f9\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"https://clarifai.com/mistralai/completion/models/mistral-7B-Instruc\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"https://iamgeekydude.com/2023/06/02/alpaca-llm-load-model-using-langchain-hf/\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"https://news.microsoft.com/source/features/ai/the-phi-3-small-language-models-with-big-potential/\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"https://huggingface.co/microsoft/Phi-3-mini-128k-instruct\"\n      }), \"\\n\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-18-NaturalLanguagetoSQLQueryusinganOpenSourceLLM"},"buildId":"ll1cGyplNwh83dpggeai1","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>