<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>재밌는 주제 프로덕션 환경에서 신뢰할 수 있는 딥러닝 스택 구축하는 방법 이에 대해 알아보도록 하죠 | ui-station</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://ui-station.github.io///post/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="재밌는 주제 프로덕션 환경에서 신뢰할 수 있는 딥러닝 스택 구축하는 방법 이에 대해 알아보도록 하죠 | ui-station" data-gatsby-head="true"/><meta property="og:title" content="재밌는 주제 프로덕션 환경에서 신뢰할 수 있는 딥러닝 스택 구축하는 방법 이에 대해 알아보도록 하죠 | ui-station" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://ui-station.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://ui-station.github.io///post/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction" data-gatsby-head="true"/><meta name="twitter:title" content="재밌는 주제 프로덕션 환경에서 신뢰할 수 있는 딥러닝 스택 구축하는 방법 이에 대해 알아보도록 하죠 | ui-station" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | ui-station" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-23 17:14" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BHFR6GTH9P"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-BHFR6GTH9P');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/_next/static/chunks/348-d11c34b645b13f5b.js" defer=""></script><script src="/_next/static/chunks/162-4172e84c8e2aa747.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-4f7b40c1114f0d09.js" defer=""></script><script src="/_next/static/YUMR4jSyk_WlOHHc7UfOk/_buildManifest.js" defer=""></script><script src="/_next/static/YUMR4jSyk_WlOHHc7UfOk/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UI STATION</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">재밌는 주제 프로덕션 환경에서 신뢰할 수 있는 딥러닝 스택 구축하는 방법 이에 대해 알아보도록 하죠</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="재밌는 주제 프로덕션 환경에서 신뢰할 수 있는 딥러닝 스택 구축하는 방법 이에 대해 알아보도록 하죠" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UI STATION</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 23, 2024</span><span class="posts_reading_time__f7YPP">18<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>Prometheus, Triton, 그리고 Grafana를 사용하여 엔드 투 엔드 모니터링 대시보드를 구축해보세요.</p>
<p>ML 시스템을 배포하기 전에, 엔지니어들은 로컬 및 대규모에서 어떻게 성능을 발휘할지 정확한 통찰력이 필요합니다. 병목 현상을 식별하고 예상치 못한 동작을 파악하기 위해.</p>
<p>클래식 ML 추론 파이프라인과 비교하면, 딥 러닝 시스템은 자원 소비, 복잡성 및 확장 가능성의 도전에 따라 낮은 지연 시간, 높은 처리량에 중점을 둔다는 것 때문에 보다 "중요한" 및 자세한 모니터링이 필요합니다. 특히, 컴퓨터 비전과 같은 자원 집중적인 응용 프로그램에서 딥 러닝 배포를 위해 ML 엔지니어들은 모니터링에 우선순위를 두어야 합니다.</p>
<p>이 글에서는 배포 설정 및 모니터링의 워크플로우에 대해 다루겠습니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h1>목차</h1>
<ol>
<li>성능 모니터링 파이프라인 설정 방법</li>
</ol>
<ul>
<li>컨테이너</li>
<li>설정 파일</li>
<li>도커 컴포즈</li>
</ul>
<ol start="2">
<li>메트릭 스크랩 구성</li>
</ol>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>프로메테우스 타겟을 추가하기</p>
<ul>
<li>그라파나 데이터소스 추가하기</li>
<li>헬스체크 대상 스크랩</li>
</ul>
<ol start="3">
<li>대시보드 생성</li>
</ol>
<ul>
<li>GPU 메트릭을 위한 패널</li>
<li>CPU/RAM 메트릭을 위한 패널</li>
</ul>
<ol start="4">
<li>시각화</li>
</ol>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>다음으로 넘어가기 전에 사용할 도구들을 살펴봅시다:</p>
<ul>
<li>도커는 가벼우고 휴대용한 컨테이너 내에서 애플리케이션을 개발, 배포, 실행할 수 있는 플랫폼입니다 — ML 엔지니어에게 꼭 필요한 도구입니다.</li>
<li>도커 컴포즈는 멀티 컨테이너 애플리케이션을 정의하고 구성하는 도구입니다.</li>
<li>cAdvisor는 구글에서 개발한 리소스 사용량 및 컨테이너 성능 지표를 제공해주는 오픈소스 도구입니다.</li>
<li>프로메테우스는 메트릭을 수집하고 저장하는 모니터링 및 경보 시스템으로, 프로메테우스에 대한 전문 지식은 ML/MLOps 엔지니어에게 큰 장점입니다.</li>
<li>그라파나는 모니터링 및 가시성 플랫폼으로, 배포된 시스템의 메트릭을 생성, 시각화, 경보 및 이해할 수 있게 해줍니다. 모니터링 대시보드를 관리하는 것은 MLOps 엔지니어에게 중요한 기술입니다.</li>
<li>Triton Inference Server는 NVIDIA에서 개발한 인기 있는 모델 서빙 프레임워크로, 복잡한 ML 모델을 프로덕션 환경에 배포하는 데 중요한 역할을 합니다. Triton에 대한 전문 지식은 MLOps 엔지니어에게 필수적인 기술입니다.</li>
</ul>
<h1>1. 도커 컴포즈 설정</h1>
<p>각 서비스가 무엇을 하는지 설명하고, 이러한 서비스를 캡슐화하고 실행할 도커 컴포즈를 준비하는 것부터 시작해봅시다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>다음과 같은 내용이 있습니다:</p>
<p><img src="/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_0.png" alt="이미지"></p>
<p>도커 컴포즈 모니터링 yaml 파일을 살펴보겠습니다.</p>
<pre><code class="hljs language-yaml"><span class="hljs-comment"># cat docker-compose-monitoring.yaml</span>
<span class="hljs-attr">version:</span> <span class="hljs-string">"3.4"</span>
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-yaml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">prometheus:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">prom/prometheus:latest</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"${PROMETHEUS_PORT}:${PROMETHEUS_PORT}"</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">prometheus</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"${MONITORING_CONFIGURATIONS}/prometheus.monitoring.yml:/etc/prometheus/prometheus.monitoring.yml"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run/docker.sock:/var/run/docker.sock:ro</span>
    <span class="hljs-attr">command:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"--config.file=/etc/prometheus/prometheus.monitoring.yml"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"--enable-feature=expand-external-labels"</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">cadvisor</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-attr">monitor-net:</span>
        <span class="hljs-attr">ipv4_address:</span> <span class="hljs-string">${PROM_IP}</span>
  <span class="hljs-attr">grafana:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">grafana/grafana-enterprise:8.2.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">grafana</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"${GRAFANA_PORT}:${GRAFANA_PORT}"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">${MONITORING_CONFIGURATIONS}/datasources:/etc/grafana/provisioning/datasources</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PWD}</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_SECURITY_ADMIN_USER=${GRAFANA_USER}</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-attr">monitor-net:</span>
        <span class="hljs-attr">ipv4_address:</span> <span class="hljs-string">${GRAFANA_IP}</span>
  <span class="hljs-attr">cadvisor:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">gcr.io/cadvisor/cadvisor:latest</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">cadvisor</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"${CADVISOR_PORT}:${CADVISOR_PORT}"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"/etc/localtime:/etc/localtime:ro"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"/etc/timezone:/etc/timezone:ro"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"/:/rootfs:ro"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"/var/run:/var/run:rw"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"/sys:/sys:ro"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"/var/lib/docker:/var/lib/docker:ro"</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-attr">monitor-net:</span>
        <span class="hljs-attr">ipv4_address:</span> <span class="hljs-string">${CADVISOR_IP}</span>
  <span class="hljs-attr">triton_server:</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">tis2109</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">nvcr.io/nvidia/tritonserver:21.09-py3</span>
    <span class="hljs-attr">privileged:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8002:8002"</span>
    <span class="hljs-attr">deploy:</span>
      <span class="hljs-attr">resources:</span>
        <span class="hljs-attr">reservations:</span>
          <span class="hljs-attr">devices:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">driver:</span> <span class="hljs-string">nvidia</span>
              <span class="hljs-attr">capabilities:</span> [<span class="hljs-string">gpu</span>]
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">${TRITON_MODELS_REPOSITORY}:/models</span>
    <span class="hljs-attr">command:</span>
      [
        <span class="hljs-string">"tritonserver"</span>,
        <span class="hljs-string">"--model-repository=/models"</span>,
        <span class="hljs-string">"--strict-model-config=false"</span>,
      ]
    <span class="hljs-attr">networks:</span>
      <span class="hljs-attr">monitor-net:</span>
        <span class="hljs-attr">ipv4_address:</span> <span class="hljs-string">${TRITON_IP}</span>
<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">monitor-net:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
    <span class="hljs-attr">internal:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">ipam:</span>
      <span class="hljs-attr">driver:</span> <span class="hljs-string">default</span>
      <span class="hljs-attr">config:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">subnet:</span> <span class="hljs-string">${SUBNET}</span>
          <span class="hljs-attr">gateway:</span> <span class="hljs-string">${GATEWAY}</span>
</code></pre>
<p>보시다시피, .yaml 설정에 일부 마스킹된 $'변수'가 있습니다. 이들은 .env 파일 내부에서 자동으로 상속되어 로컬 개발 및 CI/CD 파이프라인에서 최상의 관행을 따르는 흐름을 가지고 있습니다.</p>
<p>이제 .env 파일에 어떤 것이 있는지 살펴봅시다:</p>
<pre><code class="hljs language-yaml"><span class="hljs-comment"># == 모니터링 변수 ==</span>
<span class="hljs-string">PROMETHEUS_PORT=9090</span>
<span class="hljs-string">GRAFANA_PORT=3000</span>
<span class="hljs-string">CADVISOR_PORT=8080</span>
<span class="hljs-string">MONITORING_CONFIGURATIONS=&#x3C;your_configuration_files에</span> <span class="hljs-string">대한_경로></span>
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"># == 자격 증명 ==
<span class="hljs-variable constant_">GRAFANA_PWD</span>=admin
<span class="hljs-variable constant_">GRAFANA_USER</span>=admin
# == <span class="hljs-variable constant_">TIS</span> 변수 ==
<span class="hljs-variable constant_">TRITON_MODELS_REPOSITORY</span>=&#x3C;당신의_triton_모델_저장소_경로>
# == 기본 네트워크 ==
<span class="hljs-variable constant_">SUBNET</span>=<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>/<span class="hljs-number">16</span>
<span class="hljs-variable constant_">GATEWAY</span>=<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
# == 서브넷 <span class="hljs-variable constant_">IP</span> ==
<span class="hljs-variable constant_">TRITON_IP</span>=<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.3</span>
<span class="hljs-variable constant_">CADVISOR_IP</span>=<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.4</span>
<span class="hljs-variable constant_">PROM_IP</span>=<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span>
<span class="hljs-variable constant_">GRAFANA_IP</span>=<span class="hljs-number">172.72</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>
</code></pre>
<p>대부분의 변수가 설정되었지만, 여기서 살펴봐야 할 주요한 2가지 변수는 다음과 같습니다:</p>
<ul>
<li>MONITORING_CONFIGURATIONS
이것은 이러한 구조가 있는 폴더를 가리켜야 합니다</li>
</ul>
<pre><code class="hljs language-js">.<span class="hljs-property">__</span> monitoring
|  |_ datasources
|  | |_ datasources.<span class="hljs-property">yml</span>
|  |_ prometheus.<span class="hljs-property">monitoring</span>.<span class="hljs-property">yml</span>
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>TRITON_MODEL_REPOSITORY
모델 저장소의 구조는 다음과 같아야 합니다:</li>
</ul>
<pre><code class="hljs language-js">model_repository
└── prod_client1_encoder
    └── <span class="hljs-number">1</span>
        └──resnet50.<span class="hljs-property">engine</span>
    └── config.<span class="hljs-property">pbtxt</span>
</code></pre>
<p>프로메테우스 모니터링 파일인 prometheus.monitoring.yml에는 메트릭을 가져올 대상(컨테이너)을 추가할 것입니다.
데이터 소스 파일인 datasources.yml에는 그라파나 대시보드의 소스로 프로메테우스를 추가할 것입니다. 그렇게 하면 그라파나 UI를 열 때 나타날 것입니다.</p>
<h1>2. 프로메테우스 스크래핑 구성 정의</h1>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>그럼 Prometheus 대상을 구성해 보겠습니다. <code>prometheus.monitoring.yml</code> 파일에 작성하겠습니다.</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">global:</span>
  <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">15s</span>
  <span class="hljs-attr">evaluation_interval:</span> <span class="hljs-string">15s</span>
</code></pre>
<pre><code class="hljs language-yaml"><span class="hljs-attr">scrape_configs:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">"prometheus"</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">"172.17.0.5:9090"</span>]
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">"triton-server"</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">"172.72.0.3:8002"</span>]

  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">"cadvisor"</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">"172.72.0.4:8080"</span>]
</code></pre>
<p>3개의 대상이 있습니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>프로메테우스 — 모니터링 프로메테우스 자체를 유지하는 것이 건강한 모니터링을 위한 모범 사례로 작용합니다. 수천 개의 메트릭을 처리하면 병목 현상이 발생할 수 있으며 프로메테우스 자체의 자원 사용량을 알고 있는 것이 유용합니다.</li>
<li>Triton Server — 이것은 이 딥러닝 스택의 핵심에 있어 중요합니다. ML 모델을 제공하고 관리하기 때문입니다.
Triton은 인퍼런스 프로세스 전반에 걸쳐 다양한 메트릭을 제공하는 포트 8002의 내장된 프로메테우스 엔드포인트가 있습니다.</li>
<li>cAdvisor — 이 배포에서 컨테이너 전반의 CPU/RAM 사용량 정보를 얻기 위해 사용됩니다.</li>
</ul>
<p>모두 구성한 뒤, 컴포저를 시작하고 문제가 있는지 검사할 수 있습니다.
컨테이너를 시작해 봅시다.</p>
<pre><code class="hljs language-js">docker compose -f docker-compose-monitoring.<span class="hljs-property">yaml</span> up -d
</code></pre>
<p>프로메테우스 대상을 검사해 봅시다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>웹 브라우저로 가서 전체 Prometheus URL(IP:9090)을 입력해주세요.</li>
<li>상태 → 대상(Targets)으로 이동해주세요.</li>
<li>스크래핑 구성에서 각 대상이 정상인지 확인해주세요(녹색).</li>
</ul>
<p>이러한 사항을 확인한 후에는 Grafana에서 대시보드를 만들어 진행할 수 있습니다.</p>
<h1>#3 대시보드 생성하기</h1>
<p>Grafana WebUI 대시보드에 액세스하려면 브라우저를 열고 <code>localhost:3000</code>으로 이동해주세요. 여기서 3000은 Grafana 컨테이너를 실행하는 포트입니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>로그인 페이지로 이동하면 사용자 이름/암호 필드에 <code>admin/admin</code>을 사용하십시오. 더 높은 보안이 권장되지만, 이는 이 기사의 범위에 포함되지 않습니다.</p>
<p>Grafana 웹을 열었으면 다음을 수행해야 합니다:</p>
<ul>
<li>데이터 소스를 우리의 Prometheus 메트릭 스크래퍼 엔드포인트로 지정합니다.</li>
<li>새 대시보드 생성</li>
<li>관심 있는 메트릭을 집계/시각화하기 위해 차트 추가</li>
</ul>
<p>#3.1 Prometheus 데이터 소스</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>왼쪽 패널에서 기어 아이콘(설정)을 클릭하고 DataSources를 선택하세요.
다음과 같은 뷰가 나타날 것입니다:</p>
<p>"Add data source"를 클릭한 후 Time Series Databases 아래에서 <code>Prometheus</code>를 선택하세요. Grafana는 여러 종류의 메트릭 스크랩을 지원하고 있습니다. 여기서는 Prometheus를 사용할 것입니다. 이런 뷰가 나타날 것입니다:</p>
<img src="/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_1.png">
<p>여기에는 Prometheus 엔드포인트의 URL을 추가해야 합니다. 우리의 도커 컴포즈 배포에서는 <code>http://prometheus:9090</code>을 사용할 것입니다. 이 템플릿을 따르면 <code>http://container_name:container_port</code>가 됩니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<img src="/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_2.png">
<p>여기까지 오셨군요. 이제 데이터 원본 추가 섹션이 완료되었습니다.
이제 대시보드를 만들어보겠습니다.</p>
<h3>3.2 Grafana 대시보드 만들기</h3>
<p>왼쪽 패널에서 “+” 표시를 클릭하고 <code>Dashboard</code>를 선택하세요. 이렇게 하면 미리 정의된 패널 그룹이 있는 새 대시보드 페이지로 이동합니다. 우리는 모든 것을 처음부터 만들고 있으므로 <code>Empty Panels</code>만 사용하여 주요 지표를 표시할 것입니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>다음은 한 예제에 대한 따라할 프로세스입니다:</p>
<ul>
<li>새 쿼리를 추가하고 <code>promql</code> (Prometheus 쿼리 언어)를 정의합니다.</li>
<li>시각화 유형, 그래프 스타일, 범례를 구성합니다.</li>
</ul>
<p>다음은 비어 있는 패널의 모습입니다:</p>
<p>이제, 트리튼 추론 서버 모델 서빙 플랫폼을 모니터링하기 위해 몇 가지 사용자 정의 쿼리를 추가할 것입니다. 하지만 먼저 다음 참고 사항을 유념해야 합니다:</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>첫 번째 쿼리를 설정해보겠습니다. 이 쿼리는 성공적인 요청의 수를 고려하여 모델이 하나의 추론 요청을 수행하는 데 걸리는 시간(밀리초)을 측정할 것입니다. 우리는 시간이 지남에 따라 진행 상황을 보고 싶기 때문에 이 차트는 <code>시계열(time-series)</code>이 될 것입니다.
다음은 해당 지표를 작성하는 쿼리입니다:</p>
<pre><code class="hljs language-js">(<span class="hljs-title function_">irate</span>(nv_inference_compute_infer_duration_us{job=<span class="hljs-string">"triton-server"</span>}[$__rate_interval]) / <span class="hljs-number">1000</span>) / <span class="hljs-title function_">irate</span>(nv_inference_request_success{job=<span class="hljs-string">"triton-server"</span>}[$__rate_interval])
</code></pre>
<p>쿼리를 해석해 봅시다:</p>
<p>아래에서 쿼리의 모습을 확인할 수 있습니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>이 새 차트의 설정을 구성할 때, 오른쪽에 다음을 지정할 수 있습니다:</p>
<ul>
<li>차트 유형 — 직선 / 곡선 / T-스텝 라인 중 선택</li>
<li>메트릭 범위 — 메트릭 선택(예: 밀리초(ms))하고 low_range(예: 0)와 high_range(예: 100ms) 정의</li>
<li>사용자 지정 텍스트 — 범례 또는 다른 필드에 표시될 내용</li>
</ul>
<p>#3.3 시각화 완료</p>
<p>위의 흐름에 따라, 나머지 차트를 생성할 수 있습니다.
전체 성능 모니터링 차트를 컴파일하려면 나머지 패널을 추가하십시오. 다음 각각에 대해 새 패널을 만들고 해당 세부 정보로 채워넣습니다:</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>GPU 사용된 바이트 - VRAM 사용량의 백분율</li>
</ul>
<pre><code class="hljs language-js">쿼리: nv_gpu_memory_used_bytes{job=<span class="hljs-string">"triton-server"</span>}/nv_gpu_memory_total_bytes{job=<span class="hljs-string">"triton-server"</span>}
차트 유형: 파이
범례: {인스턴스}
</code></pre>
<ol start="2">
<li>GPU 활용도 - 전체 GPU 활용도</li>
</ol>
<pre><code class="hljs language-js">쿼리: nv_gpu_utilization{job=<span class="hljs-string">"triton-server"</span>}
차트 유형: 시계열
범례: <span class="hljs-variable constant_">NULL</span>
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ol start="3">
<li>입력 시간/요청 — 클라이언트가 입력 데이터를 Triton 서버로 보내는 데 걸린 시간.</li>
</ol>
<pre><code class="hljs language-js"><span class="hljs-title class_">Query</span>: (<span class="hljs-title function_">irate</span>(nv_inference_compute_input_duration_us{job=<span class="hljs-string">"triton-server"</span>}[$__rate_interval]) / <span class="hljs-number">1000</span>) / <span class="hljs-title function_">irate</span>(nv_inference_request_success{job=<span class="hljs-string">"triton-server"</span>}[$__rate_interval])
<span class="hljs-title class_">Chart</span> <span class="hljs-title class_">Type</span>: 시계열
<span class="hljs-title class_">Legend</span>: {model}-{version}
</code></pre>
<ol start="4">
<li>출력 시간/요청 — 서버가 클라이언트에게 출력을 보내는 데 걸린 시간.</li>
</ol>
<pre><code class="hljs language-js"><span class="hljs-title class_">Query</span>: (<span class="hljs-title function_">irate</span>(nv_inference_compute_output_duration_us{job=<span class="hljs-string">"triton-server"</span>}[$__rate_interval]) / <span class="hljs-number">1000</span>)/ <span class="hljs-title function_">irate</span>(nv_inference_request_success{job=<span class="hljs-string">"triton-server"</span>}[$__rate_interval])
<span class="hljs-title class_">Chart</span> <span class="hljs-title class_">Type</span>: 시계열
<span class="hljs-title class_">Legend</span>: {model}-{version}
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ol start="5">
<li>DB 비율 (#요청/#실행) — 성공적인 요청의 전체 요청 대비 비율</li>
</ol>
<pre><code class="hljs language-js">쿼리: sum by (모델,버전) (<span class="hljs-title function_">rate</span>(nv_inference_request_success{job=<span class="hljs-string">"triton-server"</span>}[$__rate_interval])/<span class="hljs-title function_">rate</span>(nv_inference_exec_count{job=<span class="hljs-string">"triton-server"</span>}[$__rate_interval]) )
차트 유형: 시계열
범례: {모델}-{버전}
</code></pre>
<ol start="6">
<li>대기 시간/요청 — 요청이 처리되기 전에 대기하는 시간</li>
</ol>
<pre><code class="hljs language-js">쿼리: sum by (모델,버전) ((<span class="hljs-title function_">irate</span>(nv_inference_queue_duration_us{job=<span class="hljs-string">"triton-server"</span>}[$__rate_interval]) / <span class="hljs-number">1000</span>) / <span class="hljs-title function_">irate</span>(nv_inference_request_success{job=<span class="hljs-string">"triton-server"</span>}[$__rate_interval]))
차트 유형: 시계열
범례: {모델}-{버전}
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ol start="7">
<li>집계된 입력/추론/출력 - 입력 출력 및 추론을 한 차트에 표시합니다.</li>
</ol>
<pre><code class="hljs language-js">질의:
<span class="hljs-attr">A</span>: <span class="hljs-title function_">rate</span>(nv_inference_compute_input_duration_us{job=<span class="hljs-string">"triton-server"</span>}[$__interval]) / <span class="hljs-number">1000</span>
<span class="hljs-attr">B</span>: <span class="hljs-title function_">rate</span>(nv_inference_compute_infer_duration_us{job=<span class="hljs-string">"triton-server"</span>}[$__interval]) / <span class="hljs-number">1000</span>
<span class="hljs-attr">C</span>: <span class="hljs-title function_">rate</span>(nv_inference_compute_output_duration_us{job=<span class="hljs-string">"triton-server"</span>}[$__interval]) / <span class="hljs-number">1000</span>

차트 유형: 시계열
범례: {모델}-{버전}
</code></pre>
<p>우리가 만든 완벽한 대시보드는 다음을 보여줍니다:</p>
<ul>
<li>GPU VRAM 이용률</li>
<li>클라이언트에서 서버로의 입력 송신 시간</li>
<li>서버 추론 요청 시간</li>
<li>서버에서 클라이언트로의 출력 송신 시간</li>
<li>성공 요청/전체 요청 비율</li>
</ul>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>이런 종류의 대시보드는 배포된 스택의 성능 및 스트레스 테스트 속에서의 동작을 모니터링하기 위한 시작점을 제시합니다.</p>
<p>이는 배포의 실패 및 위험 지점을 연구하는 구체적인 방법을 제공하며 SLI(서비스 수준 지표)를 모니터링하는 데 도움이 됩니다.</p>
<p>서비스 수준 지표는 SLA(서비스 수준 계약)를 준수하고 SLO(서비스 수준 목표)를 달성하기 위해 모니터링되는 메트릭입니다. 우리가 만든 대시보드는 제공되는 서비스 수준 계약을 준수하기 위한 목표에 도달하기 위한 가치 있는 통찰을 제공할 수 있습니다.</p>
<p>또한 이는 다중 복제본을 추가하거나 추론 서빙 프레임워크를 실행하는 여러 기계로의 확장 전략을 계획하는 데 도움이 됩니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h1>결론</h1>
<p>본 문서에서는 Prometheus와 Grafana를 사용하여 자사의 ML 애플리케이션 및 모델 서빙 프레임워크를 위한 성능 모니터링 스택을 설정하고 구축하는 방법을 소개했습니다.</p>
<p>도커 컴포즈 파일을 준비하는 것부터 시작하여 워크플로우의 각 단계를 설명하고 스택을 배포하고 데이터 원본을 구성하며 대시보드 패널을 생성하고 지표를 집계하는 과정을 마무리했습니다.</p>
<p>모니터링은 MLOps 시스템의 중요한 부분입니다!
이 튜토리얼을 따라 하면 테스트 환경에서 단일 배포로 ML 애플리케이션을 위한 모니터링 파이프라인을 구조화하고 배포하거나, 클라우드 시나리오 설정에서 여러 입력 소스를 결합하고 전체 스택 배포를 모니터링하는 단일 대시보드 소비자 지점을 갖도록 구성할 수 있습니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h1>더 많은 내용을 원하신다면!</h1>
<p>저는 미디엄에 새롭게 등장했습니다. 만약 이 글을 즐겨보셨다면 박수를 보내주시고 제 계정을 팔로우해주세요 - 정말로 감사하겠습니다! 🚀</p>
<p><img src="/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_3.png" alt="How to ensure your deep learning stack is fail-safe in production"></p>
<h1>더 많은 글 보기</h1>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>이 게시물과 관련성에 따라 정렬되었습니다.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"재밌는 주제 프로덕션 환경에서 신뢰할 수 있는 딥러닝 스택 구축하는 방법 이에 대해 알아보도록 하죠","description":"","date":"2024-05-23 17:14","slug":"2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction","content":"\nPrometheus, Triton, 그리고 Grafana를 사용하여 엔드 투 엔드 모니터링 대시보드를 구축해보세요.\n\nML 시스템을 배포하기 전에, 엔지니어들은 로컬 및 대규모에서 어떻게 성능을 발휘할지 정확한 통찰력이 필요합니다. 병목 현상을 식별하고 예상치 못한 동작을 파악하기 위해.\n\n클래식 ML 추론 파이프라인과 비교하면, 딥 러닝 시스템은 자원 소비, 복잡성 및 확장 가능성의 도전에 따라 낮은 지연 시간, 높은 처리량에 중점을 둔다는 것 때문에 보다 \"중요한\" 및 자세한 모니터링이 필요합니다. 특히, 컴퓨터 비전과 같은 자원 집중적인 응용 프로그램에서 딥 러닝 배포를 위해 ML 엔지니어들은 모니터링에 우선순위를 두어야 합니다.\n\n이 글에서는 배포 설정 및 모니터링의 워크플로우에 대해 다루겠습니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n# 목차\n\n1. 성능 모니터링 파이프라인 설정 방법\n\n- 컨테이너\n- 설정 파일\n- 도커 컴포즈\n\n2. 메트릭 스크랩 구성\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n프로메테우스 타겟을 추가하기\n\n- 그라파나 데이터소스 추가하기\n- 헬스체크 대상 스크랩\n\n3. 대시보드 생성\n\n- GPU 메트릭을 위한 패널\n- CPU/RAM 메트릭을 위한 패널\n\n4. 시각화\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n다음으로 넘어가기 전에 사용할 도구들을 살펴봅시다:\n\n- 도커는 가벼우고 휴대용한 컨테이너 내에서 애플리케이션을 개발, 배포, 실행할 수 있는 플랫폼입니다 — ML 엔지니어에게 꼭 필요한 도구입니다.\n- 도커 컴포즈는 멀티 컨테이너 애플리케이션을 정의하고 구성하는 도구입니다.\n- cAdvisor는 구글에서 개발한 리소스 사용량 및 컨테이너 성능 지표를 제공해주는 오픈소스 도구입니다.\n- 프로메테우스는 메트릭을 수집하고 저장하는 모니터링 및 경보 시스템으로, 프로메테우스에 대한 전문 지식은 ML/MLOps 엔지니어에게 큰 장점입니다.\n- 그라파나는 모니터링 및 가시성 플랫폼으로, 배포된 시스템의 메트릭을 생성, 시각화, 경보 및 이해할 수 있게 해줍니다. 모니터링 대시보드를 관리하는 것은 MLOps 엔지니어에게 중요한 기술입니다.\n- Triton Inference Server는 NVIDIA에서 개발한 인기 있는 모델 서빙 프레임워크로, 복잡한 ML 모델을 프로덕션 환경에 배포하는 데 중요한 역할을 합니다. Triton에 대한 전문 지식은 MLOps 엔지니어에게 필수적인 기술입니다.\n\n# 1. 도커 컴포즈 설정\n\n각 서비스가 무엇을 하는지 설명하고, 이러한 서비스를 캡슐화하고 실행할 도커 컴포즈를 준비하는 것부터 시작해봅시다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n다음과 같은 내용이 있습니다:\n\n![이미지](/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_0.png)\n\n도커 컴포즈 모니터링 yaml 파일을 살펴보겠습니다.\n\n```yaml\n# cat docker-compose-monitoring.yaml\nversion: \"3.4\"\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```yaml\nservices:\n  prometheus:\n    image: prom/prometheus:latest\n    ports:\n      - \"${PROMETHEUS_PORT}:${PROMETHEUS_PORT}\"\n    container_name: prometheus\n    restart: always\n    volumes:\n      - \"${MONITORING_CONFIGURATIONS}/prometheus.monitoring.yml:/etc/prometheus/prometheus.monitoring.yml\"\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n    command:\n      - \"--config.file=/etc/prometheus/prometheus.monitoring.yml\"\n      - \"--enable-feature=expand-external-labels\"\n    depends_on:\n      - cadvisor\n    networks:\n      monitor-net:\n        ipv4_address: ${PROM_IP}\n  grafana:\n    image: grafana/grafana-enterprise:8.2.0\n    container_name: grafana\n    ports:\n      - \"${GRAFANA_PORT}:${GRAFANA_PORT}\"\n    volumes:\n      - ${MONITORING_CONFIGURATIONS}/datasources:/etc/grafana/provisioning/datasources\n    environment:\n      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PWD}\n      - GF_SECURITY_ADMIN_USER=${GRAFANA_USER}\n    networks:\n      monitor-net:\n        ipv4_address: ${GRAFANA_IP}\n  cadvisor:\n    image: gcr.io/cadvisor/cadvisor:latest\n    container_name: cadvisor\n    restart: always\n    ports:\n      - \"${CADVISOR_PORT}:${CADVISOR_PORT}\"\n    volumes:\n      - \"/etc/localtime:/etc/localtime:ro\"\n      - \"/etc/timezone:/etc/timezone:ro\"\n      - \"/:/rootfs:ro\"\n      - \"/var/run:/var/run:rw\"\n      - \"/sys:/sys:ro\"\n      - \"/var/lib/docker:/var/lib/docker:ro\"\n    networks:\n      monitor-net:\n        ipv4_address: ${CADVISOR_IP}\n  triton_server:\n    container_name: tis2109\n    image: nvcr.io/nvidia/tritonserver:21.09-py3\n    privileged: true\n    ports:\n      - \"8002:8002\"\n    deploy:\n      resources:\n        reservations:\n          devices:\n            - driver: nvidia\n              capabilities: [gpu]\n    volumes:\n      - ${TRITON_MODELS_REPOSITORY}:/models\n    command:\n      [\n        \"tritonserver\",\n        \"--model-repository=/models\",\n        \"--strict-model-config=false\",\n      ]\n    networks:\n      monitor-net:\n        ipv4_address: ${TRITON_IP}\nnetworks:\n  monitor-net:\n    driver: bridge\n    internal: false\n    ipam:\n      driver: default\n      config:\n        - subnet: ${SUBNET}\n          gateway: ${GATEWAY}\n```\n\n보시다시피, .yaml 설정에 일부 마스킹된 $'변수'가 있습니다. 이들은 .env 파일 내부에서 자동으로 상속되어 로컬 개발 및 CI/CD 파이프라인에서 최상의 관행을 따르는 흐름을 가지고 있습니다.\n\n이제 .env 파일에 어떤 것이 있는지 살펴봅시다:\n\n```yaml\n# == 모니터링 변수 ==\nPROMETHEUS_PORT=9090\nGRAFANA_PORT=3000\nCADVISOR_PORT=8080\nMONITORING_CONFIGURATIONS=\u003cyour_configuration_files에 대한_경로\u003e\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# == 자격 증명 ==\nGRAFANA_PWD=admin\nGRAFANA_USER=admin\n# == TIS 변수 ==\nTRITON_MODELS_REPOSITORY=\u003c당신의_triton_모델_저장소_경로\u003e\n# == 기본 네트워크 ==\nSUBNET=172.17.0.0/16\nGATEWAY=172.17.0.1\n# == 서브넷 IP ==\nTRITON_IP=172.17.0.3\nCADVISOR_IP=172.17.0.4\nPROM_IP=172.17.0.5\nGRAFANA_IP=172.72.0.6\n```\n\n대부분의 변수가 설정되었지만, 여기서 살펴봐야 할 주요한 2가지 변수는 다음과 같습니다:\n\n- MONITORING_CONFIGURATIONS\n  이것은 이러한 구조가 있는 폴더를 가리켜야 합니다\n\n```js\n.__ monitoring\n|  |_ datasources\n|  | |_ datasources.yml\n|  |_ prometheus.monitoring.yml\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- TRITON_MODEL_REPOSITORY\n  모델 저장소의 구조는 다음과 같아야 합니다:\n\n```js\nmodel_repository\n└── prod_client1_encoder\n    └── 1\n        └──resnet50.engine\n    └── config.pbtxt\n```\n\n프로메테우스 모니터링 파일인 prometheus.monitoring.yml에는 메트릭을 가져올 대상(컨테이너)을 추가할 것입니다.\n데이터 소스 파일인 datasources.yml에는 그라파나 대시보드의 소스로 프로메테우스를 추가할 것입니다. 그렇게 하면 그라파나 UI를 열 때 나타날 것입니다.\n\n# 2. 프로메테우스 스크래핑 구성 정의\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n그럼 Prometheus 대상을 구성해 보겠습니다. `prometheus.monitoring.yml` 파일에 작성하겠습니다.\n\n```yaml\nglobal:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n```\n\n```yaml\nscrape_configs:\n  - job_name: \"prometheus\"\n    static_configs:\n      - targets: [\"172.17.0.5:9090\"]\n  - job_name: \"triton-server\"\n    static_configs:\n      - targets: [\"172.72.0.3:8002\"]\n\n  - job_name: \"cadvisor\"\n    static_configs:\n      - targets: [\"172.72.0.4:8080\"]\n```\n\n3개의 대상이 있습니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 프로메테우스 — 모니터링 프로메테우스 자체를 유지하는 것이 건강한 모니터링을 위한 모범 사례로 작용합니다. 수천 개의 메트릭을 처리하면 병목 현상이 발생할 수 있으며 프로메테우스 자체의 자원 사용량을 알고 있는 것이 유용합니다.\n- Triton Server — 이것은 이 딥러닝 스택의 핵심에 있어 중요합니다. ML 모델을 제공하고 관리하기 때문입니다.\n  Triton은 인퍼런스 프로세스 전반에 걸쳐 다양한 메트릭을 제공하는 포트 8002의 내장된 프로메테우스 엔드포인트가 있습니다.\n- cAdvisor — 이 배포에서 컨테이너 전반의 CPU/RAM 사용량 정보를 얻기 위해 사용됩니다.\n\n모두 구성한 뒤, 컴포저를 시작하고 문제가 있는지 검사할 수 있습니다.\n컨테이너를 시작해 봅시다.\n\n```js\ndocker compose -f docker-compose-monitoring.yaml up -d\n```\n\n프로메테우스 대상을 검사해 봅시다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 웹 브라우저로 가서 전체 Prometheus URL(IP:9090)을 입력해주세요.\n- 상태 → 대상(Targets)으로 이동해주세요.\n- 스크래핑 구성에서 각 대상이 정상인지 확인해주세요(녹색).\n\n이러한 사항을 확인한 후에는 Grafana에서 대시보드를 만들어 진행할 수 있습니다.\n\n# #3 대시보드 생성하기\n\nGrafana WebUI 대시보드에 액세스하려면 브라우저를 열고 `localhost:3000`으로 이동해주세요. 여기서 3000은 Grafana 컨테이너를 실행하는 포트입니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n로그인 페이지로 이동하면 사용자 이름/암호 필드에 `admin/admin`을 사용하십시오. 더 높은 보안이 권장되지만, 이는 이 기사의 범위에 포함되지 않습니다.\n\nGrafana 웹을 열었으면 다음을 수행해야 합니다:\n\n- 데이터 소스를 우리의 Prometheus 메트릭 스크래퍼 엔드포인트로 지정합니다.\n- 새 대시보드 생성\n- 관심 있는 메트릭을 집계/시각화하기 위해 차트 추가\n\n#3.1 Prometheus 데이터 소스\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n왼쪽 패널에서 기어 아이콘(설정)을 클릭하고 DataSources를 선택하세요.\n다음과 같은 뷰가 나타날 것입니다:\n\n\"Add data source\"를 클릭한 후 Time Series Databases 아래에서 `Prometheus`를 선택하세요. Grafana는 여러 종류의 메트릭 스크랩을 지원하고 있습니다. 여기서는 Prometheus를 사용할 것입니다. 이런 뷰가 나타날 것입니다:\n\n\u003cimg src=\"/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_1.png\" /\u003e\n\n여기에는 Prometheus 엔드포인트의 URL을 추가해야 합니다. 우리의 도커 컴포즈 배포에서는 `http://prometheus:9090`을 사용할 것입니다. 이 템플릿을 따르면 `http://container_name:container_port`가 됩니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n\u003cimg src=\"/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_2.png\" /\u003e\n\n여기까지 오셨군요. 이제 데이터 원본 추가 섹션이 완료되었습니다.\n이제 대시보드를 만들어보겠습니다.\n\n### 3.2 Grafana 대시보드 만들기\n\n왼쪽 패널에서 “+” 표시를 클릭하고 `Dashboard`를 선택하세요. 이렇게 하면 미리 정의된 패널 그룹이 있는 새 대시보드 페이지로 이동합니다. 우리는 모든 것을 처음부터 만들고 있으므로 `Empty Panels`만 사용하여 주요 지표를 표시할 것입니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n다음은 한 예제에 대한 따라할 프로세스입니다:\n\n- 새 쿼리를 추가하고 `promql` (Prometheus 쿼리 언어)를 정의합니다.\n- 시각화 유형, 그래프 스타일, 범례를 구성합니다.\n\n다음은 비어 있는 패널의 모습입니다:\n\n이제, 트리튼 추론 서버 모델 서빙 플랫폼을 모니터링하기 위해 몇 가지 사용자 정의 쿼리를 추가할 것입니다. 하지만 먼저 다음 참고 사항을 유념해야 합니다:\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n첫 번째 쿼리를 설정해보겠습니다. 이 쿼리는 성공적인 요청의 수를 고려하여 모델이 하나의 추론 요청을 수행하는 데 걸리는 시간(밀리초)을 측정할 것입니다. 우리는 시간이 지남에 따라 진행 상황을 보고 싶기 때문에 이 차트는 `시계열(time-series)`이 될 것입니다.\n다음은 해당 지표를 작성하는 쿼리입니다:\n\n```js\n(irate(nv_inference_compute_infer_duration_us{job=\"triton-server\"}[$__rate_interval]) / 1000) / irate(nv_inference_request_success{job=\"triton-server\"}[$__rate_interval])\n```\n\n쿼리를 해석해 봅시다:\n\n아래에서 쿼리의 모습을 확인할 수 있습니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n이 새 차트의 설정을 구성할 때, 오른쪽에 다음을 지정할 수 있습니다:\n\n- 차트 유형 — 직선 / 곡선 / T-스텝 라인 중 선택\n- 메트릭 범위 — 메트릭 선택(예: 밀리초(ms))하고 low_range(예: 0)와 high_range(예: 100ms) 정의\n- 사용자 지정 텍스트 — 범례 또는 다른 필드에 표시될 내용\n\n#3.3 시각화 완료\n\n위의 흐름에 따라, 나머지 차트를 생성할 수 있습니다.\n전체 성능 모니터링 차트를 컴파일하려면 나머지 패널을 추가하십시오. 다음 각각에 대해 새 패널을 만들고 해당 세부 정보로 채워넣습니다:\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- GPU 사용된 바이트 - VRAM 사용량의 백분율\n\n```js\n쿼리: nv_gpu_memory_used_bytes{job=\"triton-server\"}/nv_gpu_memory_total_bytes{job=\"triton-server\"}\n차트 유형: 파이\n범례: {인스턴스}\n```\n\n2. GPU 활용도 - 전체 GPU 활용도\n\n```js\n쿼리: nv_gpu_utilization{job=\"triton-server\"}\n차트 유형: 시계열\n범례: NULL\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n3. 입력 시간/요청 — 클라이언트가 입력 데이터를 Triton 서버로 보내는 데 걸린 시간.\n\n```js\nQuery: (irate(nv_inference_compute_input_duration_us{job=\"triton-server\"}[$__rate_interval]) / 1000) / irate(nv_inference_request_success{job=\"triton-server\"}[$__rate_interval])\nChart Type: 시계열\nLegend: {model}-{version}\n```\n\n4. 출력 시간/요청 — 서버가 클라이언트에게 출력을 보내는 데 걸린 시간.\n\n```js\nQuery: (irate(nv_inference_compute_output_duration_us{job=\"triton-server\"}[$__rate_interval]) / 1000)/ irate(nv_inference_request_success{job=\"triton-server\"}[$__rate_interval])\nChart Type: 시계열\nLegend: {model}-{version}\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n5. DB 비율 (#요청/#실행) — 성공적인 요청의 전체 요청 대비 비율\n\n```js\n쿼리: sum by (모델,버전) (rate(nv_inference_request_success{job=\"triton-server\"}[$__rate_interval])/rate(nv_inference_exec_count{job=\"triton-server\"}[$__rate_interval]) )\n차트 유형: 시계열\n범례: {모델}-{버전}\n```\n\n6. 대기 시간/요청 — 요청이 처리되기 전에 대기하는 시간\n\n```js\n쿼리: sum by (모델,버전) ((irate(nv_inference_queue_duration_us{job=\"triton-server\"}[$__rate_interval]) / 1000) / irate(nv_inference_request_success{job=\"triton-server\"}[$__rate_interval]))\n차트 유형: 시계열\n범례: {모델}-{버전}\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n7. 집계된 입력/추론/출력 - 입력 출력 및 추론을 한 차트에 표시합니다.\n\n```js\n질의:\nA: rate(nv_inference_compute_input_duration_us{job=\"triton-server\"}[$__interval]) / 1000\nB: rate(nv_inference_compute_infer_duration_us{job=\"triton-server\"}[$__interval]) / 1000\nC: rate(nv_inference_compute_output_duration_us{job=\"triton-server\"}[$__interval]) / 1000\n\n차트 유형: 시계열\n범례: {모델}-{버전}\n```\n\n우리가 만든 완벽한 대시보드는 다음을 보여줍니다:\n\n- GPU VRAM 이용률\n- 클라이언트에서 서버로의 입력 송신 시간\n- 서버 추론 요청 시간\n- 서버에서 클라이언트로의 출력 송신 시간\n- 성공 요청/전체 요청 비율\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n이런 종류의 대시보드는 배포된 스택의 성능 및 스트레스 테스트 속에서의 동작을 모니터링하기 위한 시작점을 제시합니다.\n\n이는 배포의 실패 및 위험 지점을 연구하는 구체적인 방법을 제공하며 SLI(서비스 수준 지표)를 모니터링하는 데 도움이 됩니다.\n\n서비스 수준 지표는 SLA(서비스 수준 계약)를 준수하고 SLO(서비스 수준 목표)를 달성하기 위해 모니터링되는 메트릭입니다. 우리가 만든 대시보드는 제공되는 서비스 수준 계약을 준수하기 위한 목표에 도달하기 위한 가치 있는 통찰을 제공할 수 있습니다.\n\n또한 이는 다중 복제본을 추가하거나 추론 서빙 프레임워크를 실행하는 여러 기계로의 확장 전략을 계획하는 데 도움이 됩니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n# 결론\n\n본 문서에서는 Prometheus와 Grafana를 사용하여 자사의 ML 애플리케이션 및 모델 서빙 프레임워크를 위한 성능 모니터링 스택을 설정하고 구축하는 방법을 소개했습니다.\n\n도커 컴포즈 파일을 준비하는 것부터 시작하여 워크플로우의 각 단계를 설명하고 스택을 배포하고 데이터 원본을 구성하며 대시보드 패널을 생성하고 지표를 집계하는 과정을 마무리했습니다.\n\n모니터링은 MLOps 시스템의 중요한 부분입니다!\n이 튜토리얼을 따라 하면 테스트 환경에서 단일 배포로 ML 애플리케이션을 위한 모니터링 파이프라인을 구조화하고 배포하거나, 클라우드 시나리오 설정에서 여러 입력 소스를 결합하고 전체 스택 배포를 모니터링하는 단일 대시보드 소비자 지점을 갖도록 구성할 수 있습니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n# 더 많은 내용을 원하신다면!\n\n저는 미디엄에 새롭게 등장했습니다. 만약 이 글을 즐겨보셨다면 박수를 보내주시고 제 계정을 팔로우해주세요 - 정말로 감사하겠습니다! 🚀\n\n![How to ensure your deep learning stack is fail-safe in production](/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_3.png)\n\n# 더 많은 글 보기\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n이 게시물과 관련성에 따라 정렬되었습니다.\n","ogImage":{"url":"/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_0.png"},"coverImage":"/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_0.png","tag":["Tech"],"readingTime":18},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003ePrometheus, Triton, 그리고 Grafana를 사용하여 엔드 투 엔드 모니터링 대시보드를 구축해보세요.\u003c/p\u003e\n\u003cp\u003eML 시스템을 배포하기 전에, 엔지니어들은 로컬 및 대규모에서 어떻게 성능을 발휘할지 정확한 통찰력이 필요합니다. 병목 현상을 식별하고 예상치 못한 동작을 파악하기 위해.\u003c/p\u003e\n\u003cp\u003e클래식 ML 추론 파이프라인과 비교하면, 딥 러닝 시스템은 자원 소비, 복잡성 및 확장 가능성의 도전에 따라 낮은 지연 시간, 높은 처리량에 중점을 둔다는 것 때문에 보다 \"중요한\" 및 자세한 모니터링이 필요합니다. 특히, 컴퓨터 비전과 같은 자원 집중적인 응용 프로그램에서 딥 러닝 배포를 위해 ML 엔지니어들은 모니터링에 우선순위를 두어야 합니다.\u003c/p\u003e\n\u003cp\u003e이 글에서는 배포 설정 및 모니터링의 워크플로우에 대해 다루겠습니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch1\u003e목차\u003c/h1\u003e\n\u003col\u003e\n\u003cli\u003e성능 모니터링 파이프라인 설정 방법\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003e컨테이너\u003c/li\u003e\n\u003cli\u003e설정 파일\u003c/li\u003e\n\u003cli\u003e도커 컴포즈\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003e메트릭 스크랩 구성\u003c/li\u003e\n\u003c/ol\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e프로메테우스 타겟을 추가하기\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e그라파나 데이터소스 추가하기\u003c/li\u003e\n\u003cli\u003e헬스체크 대상 스크랩\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e대시보드 생성\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003eGPU 메트릭을 위한 패널\u003c/li\u003e\n\u003cli\u003eCPU/RAM 메트릭을 위한 패널\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003e시각화\u003c/li\u003e\n\u003c/ol\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e다음으로 넘어가기 전에 사용할 도구들을 살펴봅시다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e도커는 가벼우고 휴대용한 컨테이너 내에서 애플리케이션을 개발, 배포, 실행할 수 있는 플랫폼입니다 — ML 엔지니어에게 꼭 필요한 도구입니다.\u003c/li\u003e\n\u003cli\u003e도커 컴포즈는 멀티 컨테이너 애플리케이션을 정의하고 구성하는 도구입니다.\u003c/li\u003e\n\u003cli\u003ecAdvisor는 구글에서 개발한 리소스 사용량 및 컨테이너 성능 지표를 제공해주는 오픈소스 도구입니다.\u003c/li\u003e\n\u003cli\u003e프로메테우스는 메트릭을 수집하고 저장하는 모니터링 및 경보 시스템으로, 프로메테우스에 대한 전문 지식은 ML/MLOps 엔지니어에게 큰 장점입니다.\u003c/li\u003e\n\u003cli\u003e그라파나는 모니터링 및 가시성 플랫폼으로, 배포된 시스템의 메트릭을 생성, 시각화, 경보 및 이해할 수 있게 해줍니다. 모니터링 대시보드를 관리하는 것은 MLOps 엔지니어에게 중요한 기술입니다.\u003c/li\u003e\n\u003cli\u003eTriton Inference Server는 NVIDIA에서 개발한 인기 있는 모델 서빙 프레임워크로, 복잡한 ML 모델을 프로덕션 환경에 배포하는 데 중요한 역할을 합니다. Triton에 대한 전문 지식은 MLOps 엔지니어에게 필수적인 기술입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003e1. 도커 컴포즈 설정\u003c/h1\u003e\n\u003cp\u003e각 서비스가 무엇을 하는지 설명하고, 이러한 서비스를 캡슐화하고 실행할 도커 컴포즈를 준비하는 것부터 시작해봅시다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e다음과 같은 내용이 있습니다:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_0.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e도커 컴포즈 모니터링 yaml 파일을 살펴보겠습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-comment\"\u003e# cat docker-compose-monitoring.yaml\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eversion:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"3.4\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003eservices:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eprometheus:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eprom/prometheus:latest\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"${PROMETHEUS_PORT}:${PROMETHEUS_PORT}\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003econtainer_name:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eprometheus\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003erestart:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ealways\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"${MONITORING_CONFIGURATIONS}/prometheus.monitoring.yml:/etc/prometheus/prometheus.monitoring.yml\"\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e/var/run/docker.sock:/var/run/docker.sock:ro\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ecommand:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"--config.file=/etc/prometheus/prometheus.monitoring.yml\"\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"--enable-feature=expand-external-labels\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003edepends_on:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecadvisor\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003enetworks:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003emonitor-net:\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eipv4_address:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${PROM_IP}\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003egrafana:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egrafana/grafana-enterprise:8.2.0\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003econtainer_name:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egrafana\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"${GRAFANA_PORT}:${GRAFANA_PORT}\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${MONITORING_CONFIGURATIONS}/datasources:/etc/grafana/provisioning/datasources\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eGF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PWD}\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eGF_SECURITY_ADMIN_USER=${GRAFANA_USER}\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003enetworks:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003emonitor-net:\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eipv4_address:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${GRAFANA_IP}\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ecadvisor:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egcr.io/cadvisor/cadvisor:latest\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003econtainer_name:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecadvisor\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003erestart:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ealways\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"${CADVISOR_PORT}:${CADVISOR_PORT}\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"/etc/localtime:/etc/localtime:ro\"\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"/etc/timezone:/etc/timezone:ro\"\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"/:/rootfs:ro\"\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"/var/run:/var/run:rw\"\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"/sys:/sys:ro\"\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"/var/lib/docker:/var/lib/docker:ro\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003enetworks:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003emonitor-net:\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eipv4_address:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${CADVISOR_IP}\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003etriton_server:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003econtainer_name:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etis2109\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003envcr.io/nvidia/tritonserver:21.09-py3\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eprivileged:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"8002:8002\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003edeploy:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eresources:\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ereservations:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003edevices:\u003c/span\u003e\n            \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edriver:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003envidia\u003c/span\u003e\n              \u003cspan class=\"hljs-attr\"\u003ecapabilities:\u003c/span\u003e [\u003cspan class=\"hljs-string\"\u003egpu\u003c/span\u003e]\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${TRITON_MODELS_REPOSITORY}:/models\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ecommand:\u003c/span\u003e\n      [\n        \u003cspan class=\"hljs-string\"\u003e\"tritonserver\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"--model-repository=/models\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"--strict-model-config=false\"\u003c/span\u003e,\n      ]\n    \u003cspan class=\"hljs-attr\"\u003enetworks:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003emonitor-net:\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eipv4_address:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${TRITON_IP}\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003enetworks:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003emonitor-net:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003edriver:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebridge\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003einternal:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eipam:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003edriver:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edefault\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003econfig:\u003c/span\u003e\n        \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esubnet:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${SUBNET}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003egateway:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${GATEWAY}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e보시다시피, .yaml 설정에 일부 마스킹된 $'변수'가 있습니다. 이들은 .env 파일 내부에서 자동으로 상속되어 로컬 개발 및 CI/CD 파이프라인에서 최상의 관행을 따르는 흐름을 가지고 있습니다.\u003c/p\u003e\n\u003cp\u003e이제 .env 파일에 어떤 것이 있는지 살펴봅시다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-comment\"\u003e# == 모니터링 변수 ==\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003ePROMETHEUS_PORT=9090\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003eGRAFANA_PORT=3000\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003eCADVISOR_PORT=8080\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003eMONITORING_CONFIGURATIONS=\u0026#x3C;your_configuration_files에\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e대한_경로\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# == 자격 증명 ==\n\u003cspan class=\"hljs-variable constant_\"\u003eGRAFANA_PWD\u003c/span\u003e=admin\n\u003cspan class=\"hljs-variable constant_\"\u003eGRAFANA_USER\u003c/span\u003e=admin\n# == \u003cspan class=\"hljs-variable constant_\"\u003eTIS\u003c/span\u003e 변수 ==\n\u003cspan class=\"hljs-variable constant_\"\u003eTRITON_MODELS_REPOSITORY\u003c/span\u003e=\u0026#x3C;당신의_triton_모델_저장소_경로\u003e\n# == 기본 네트워크 ==\n\u003cspan class=\"hljs-variable constant_\"\u003eSUBNET\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e172.17\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eGATEWAY\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e172.17\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e\n# == 서브넷 \u003cspan class=\"hljs-variable constant_\"\u003eIP\u003c/span\u003e ==\n\u003cspan class=\"hljs-variable constant_\"\u003eTRITON_IP\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e172.17\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.3\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eCADVISOR_IP\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e172.17\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003ePROM_IP\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e172.17\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eGRAFANA_IP\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e172.72\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.6\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e대부분의 변수가 설정되었지만, 여기서 살펴봐야 할 주요한 2가지 변수는 다음과 같습니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMONITORING_CONFIGURATIONS\n이것은 이러한 구조가 있는 폴더를 가리켜야 합니다\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e.\u003cspan class=\"hljs-property\"\u003e__\u003c/span\u003e monitoring\n|  |_ datasources\n|  | |_ datasources.\u003cspan class=\"hljs-property\"\u003eyml\u003c/span\u003e\n|  |_ prometheus.\u003cspan class=\"hljs-property\"\u003emonitoring\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eyml\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003eTRITON_MODEL_REPOSITORY\n모델 저장소의 구조는 다음과 같아야 합니다:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003emodel_repository\n└── prod_client1_encoder\n    └── \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n        └──resnet50.\u003cspan class=\"hljs-property\"\u003eengine\u003c/span\u003e\n    └── config.\u003cspan class=\"hljs-property\"\u003epbtxt\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e프로메테우스 모니터링 파일인 prometheus.monitoring.yml에는 메트릭을 가져올 대상(컨테이너)을 추가할 것입니다.\n데이터 소스 파일인 datasources.yml에는 그라파나 대시보드의 소스로 프로메테우스를 추가할 것입니다. 그렇게 하면 그라파나 UI를 열 때 나타날 것입니다.\u003c/p\u003e\n\u003ch1\u003e2. 프로메테우스 스크래핑 구성 정의\u003c/h1\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e그럼 Prometheus 대상을 구성해 보겠습니다. \u003ccode\u003eprometheus.monitoring.yml\u003c/code\u003e 파일에 작성하겠습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003eglobal:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003escrape_interval:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e15s\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eevaluation_interval:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e15s\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003escrape_configs:\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ejob_name:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"prometheus\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003estatic_configs:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etargets:\u003c/span\u003e [\u003cspan class=\"hljs-string\"\u003e\"172.17.0.5:9090\"\u003c/span\u003e]\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ejob_name:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003estatic_configs:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etargets:\u003c/span\u003e [\u003cspan class=\"hljs-string\"\u003e\"172.72.0.3:8002\"\u003c/span\u003e]\n\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ejob_name:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"cadvisor\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003estatic_configs:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etargets:\u003c/span\u003e [\u003cspan class=\"hljs-string\"\u003e\"172.72.0.4:8080\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e3개의 대상이 있습니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e프로메테우스 — 모니터링 프로메테우스 자체를 유지하는 것이 건강한 모니터링을 위한 모범 사례로 작용합니다. 수천 개의 메트릭을 처리하면 병목 현상이 발생할 수 있으며 프로메테우스 자체의 자원 사용량을 알고 있는 것이 유용합니다.\u003c/li\u003e\n\u003cli\u003eTriton Server — 이것은 이 딥러닝 스택의 핵심에 있어 중요합니다. ML 모델을 제공하고 관리하기 때문입니다.\nTriton은 인퍼런스 프로세스 전반에 걸쳐 다양한 메트릭을 제공하는 포트 8002의 내장된 프로메테우스 엔드포인트가 있습니다.\u003c/li\u003e\n\u003cli\u003ecAdvisor — 이 배포에서 컨테이너 전반의 CPU/RAM 사용량 정보를 얻기 위해 사용됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e모두 구성한 뒤, 컴포저를 시작하고 문제가 있는지 검사할 수 있습니다.\n컨테이너를 시작해 봅시다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edocker compose -f docker-compose-monitoring.\u003cspan class=\"hljs-property\"\u003eyaml\u003c/span\u003e up -d\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e프로메테우스 대상을 검사해 봅시다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e웹 브라우저로 가서 전체 Prometheus URL(IP:9090)을 입력해주세요.\u003c/li\u003e\n\u003cli\u003e상태 → 대상(Targets)으로 이동해주세요.\u003c/li\u003e\n\u003cli\u003e스크래핑 구성에서 각 대상이 정상인지 확인해주세요(녹색).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e이러한 사항을 확인한 후에는 Grafana에서 대시보드를 만들어 진행할 수 있습니다.\u003c/p\u003e\n\u003ch1\u003e#3 대시보드 생성하기\u003c/h1\u003e\n\u003cp\u003eGrafana WebUI 대시보드에 액세스하려면 브라우저를 열고 \u003ccode\u003elocalhost:3000\u003c/code\u003e으로 이동해주세요. 여기서 3000은 Grafana 컨테이너를 실행하는 포트입니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e로그인 페이지로 이동하면 사용자 이름/암호 필드에 \u003ccode\u003eadmin/admin\u003c/code\u003e을 사용하십시오. 더 높은 보안이 권장되지만, 이는 이 기사의 범위에 포함되지 않습니다.\u003c/p\u003e\n\u003cp\u003eGrafana 웹을 열었으면 다음을 수행해야 합니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e데이터 소스를 우리의 Prometheus 메트릭 스크래퍼 엔드포인트로 지정합니다.\u003c/li\u003e\n\u003cli\u003e새 대시보드 생성\u003c/li\u003e\n\u003cli\u003e관심 있는 메트릭을 집계/시각화하기 위해 차트 추가\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e#3.1 Prometheus 데이터 소스\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e왼쪽 패널에서 기어 아이콘(설정)을 클릭하고 DataSources를 선택하세요.\n다음과 같은 뷰가 나타날 것입니다:\u003c/p\u003e\n\u003cp\u003e\"Add data source\"를 클릭한 후 Time Series Databases 아래에서 \u003ccode\u003ePrometheus\u003c/code\u003e를 선택하세요. Grafana는 여러 종류의 메트릭 스크랩을 지원하고 있습니다. 여기서는 Prometheus를 사용할 것입니다. 이런 뷰가 나타날 것입니다:\u003c/p\u003e\n\u003cimg src=\"/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_1.png\"\u003e\n\u003cp\u003e여기에는 Prometheus 엔드포인트의 URL을 추가해야 합니다. 우리의 도커 컴포즈 배포에서는 \u003ccode\u003ehttp://prometheus:9090\u003c/code\u003e을 사용할 것입니다. 이 템플릿을 따르면 \u003ccode\u003ehttp://container_name:container_port\u003c/code\u003e가 됩니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cimg src=\"/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_2.png\"\u003e\n\u003cp\u003e여기까지 오셨군요. 이제 데이터 원본 추가 섹션이 완료되었습니다.\n이제 대시보드를 만들어보겠습니다.\u003c/p\u003e\n\u003ch3\u003e3.2 Grafana 대시보드 만들기\u003c/h3\u003e\n\u003cp\u003e왼쪽 패널에서 “+” 표시를 클릭하고 \u003ccode\u003eDashboard\u003c/code\u003e를 선택하세요. 이렇게 하면 미리 정의된 패널 그룹이 있는 새 대시보드 페이지로 이동합니다. 우리는 모든 것을 처음부터 만들고 있으므로 \u003ccode\u003eEmpty Panels\u003c/code\u003e만 사용하여 주요 지표를 표시할 것입니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e다음은 한 예제에 대한 따라할 프로세스입니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e새 쿼리를 추가하고 \u003ccode\u003epromql\u003c/code\u003e (Prometheus 쿼리 언어)를 정의합니다.\u003c/li\u003e\n\u003cli\u003e시각화 유형, 그래프 스타일, 범례를 구성합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e다음은 비어 있는 패널의 모습입니다:\u003c/p\u003e\n\u003cp\u003e이제, 트리튼 추론 서버 모델 서빙 플랫폼을 모니터링하기 위해 몇 가지 사용자 정의 쿼리를 추가할 것입니다. 하지만 먼저 다음 참고 사항을 유념해야 합니다:\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e첫 번째 쿼리를 설정해보겠습니다. 이 쿼리는 성공적인 요청의 수를 고려하여 모델이 하나의 추론 요청을 수행하는 데 걸리는 시간(밀리초)을 측정할 것입니다. 우리는 시간이 지남에 따라 진행 상황을 보고 싶기 때문에 이 차트는 \u003ccode\u003e시계열(time-series)\u003c/code\u003e이 될 것입니다.\n다음은 해당 지표를 작성하는 쿼리입니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e(\u003cspan class=\"hljs-title function_\"\u003eirate\u003c/span\u003e(nv_inference_compute_infer_duration_us{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}[$__rate_interval]) / \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e) / \u003cspan class=\"hljs-title function_\"\u003eirate\u003c/span\u003e(nv_inference_request_success{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}[$__rate_interval])\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e쿼리를 해석해 봅시다:\u003c/p\u003e\n\u003cp\u003e아래에서 쿼리의 모습을 확인할 수 있습니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e이 새 차트의 설정을 구성할 때, 오른쪽에 다음을 지정할 수 있습니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e차트 유형 — 직선 / 곡선 / T-스텝 라인 중 선택\u003c/li\u003e\n\u003cli\u003e메트릭 범위 — 메트릭 선택(예: 밀리초(ms))하고 low_range(예: 0)와 high_range(예: 100ms) 정의\u003c/li\u003e\n\u003cli\u003e사용자 지정 텍스트 — 범례 또는 다른 필드에 표시될 내용\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e#3.3 시각화 완료\u003c/p\u003e\n\u003cp\u003e위의 흐름에 따라, 나머지 차트를 생성할 수 있습니다.\n전체 성능 모니터링 차트를 컴파일하려면 나머지 패널을 추가하십시오. 다음 각각에 대해 새 패널을 만들고 해당 세부 정보로 채워넣습니다:\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003eGPU 사용된 바이트 - VRAM 사용량의 백분율\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e쿼리: nv_gpu_memory_used_bytes{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}/nv_gpu_memory_total_bytes{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}\n차트 유형: 파이\n범례: {인스턴스}\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eGPU 활용도 - 전체 GPU 활용도\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e쿼리: nv_gpu_utilization{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}\n차트 유형: 시계열\n범례: \u003cspan class=\"hljs-variable constant_\"\u003eNULL\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e입력 시간/요청 — 클라이언트가 입력 데이터를 Triton 서버로 보내는 데 걸린 시간.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-title class_\"\u003eQuery\u003c/span\u003e: (\u003cspan class=\"hljs-title function_\"\u003eirate\u003c/span\u003e(nv_inference_compute_input_duration_us{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}[$__rate_interval]) / \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e) / \u003cspan class=\"hljs-title function_\"\u003eirate\u003c/span\u003e(nv_inference_request_success{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}[$__rate_interval])\n\u003cspan class=\"hljs-title class_\"\u003eChart\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eType\u003c/span\u003e: 시계열\n\u003cspan class=\"hljs-title class_\"\u003eLegend\u003c/span\u003e: {model}-{version}\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003e출력 시간/요청 — 서버가 클라이언트에게 출력을 보내는 데 걸린 시간.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-title class_\"\u003eQuery\u003c/span\u003e: (\u003cspan class=\"hljs-title function_\"\u003eirate\u003c/span\u003e(nv_inference_compute_output_duration_us{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}[$__rate_interval]) / \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e)/ \u003cspan class=\"hljs-title function_\"\u003eirate\u003c/span\u003e(nv_inference_request_success{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}[$__rate_interval])\n\u003cspan class=\"hljs-title class_\"\u003eChart\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eType\u003c/span\u003e: 시계열\n\u003cspan class=\"hljs-title class_\"\u003eLegend\u003c/span\u003e: {model}-{version}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003col start=\"5\"\u003e\n\u003cli\u003eDB 비율 (#요청/#실행) — 성공적인 요청의 전체 요청 대비 비율\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e쿼리: sum by (모델,버전) (\u003cspan class=\"hljs-title function_\"\u003erate\u003c/span\u003e(nv_inference_request_success{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}[$__rate_interval])/\u003cspan class=\"hljs-title function_\"\u003erate\u003c/span\u003e(nv_inference_exec_count{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}[$__rate_interval]) )\n차트 유형: 시계열\n범례: {모델}-{버전}\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"6\"\u003e\n\u003cli\u003e대기 시간/요청 — 요청이 처리되기 전에 대기하는 시간\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e쿼리: sum by (모델,버전) ((\u003cspan class=\"hljs-title function_\"\u003eirate\u003c/span\u003e(nv_inference_queue_duration_us{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}[$__rate_interval]) / \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e) / \u003cspan class=\"hljs-title function_\"\u003eirate\u003c/span\u003e(nv_inference_request_success{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}[$__rate_interval]))\n차트 유형: 시계열\n범례: {모델}-{버전}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003col start=\"7\"\u003e\n\u003cli\u003e집계된 입력/추론/출력 - 입력 출력 및 추론을 한 차트에 표시합니다.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e질의:\n\u003cspan class=\"hljs-attr\"\u003eA\u003c/span\u003e: \u003cspan class=\"hljs-title function_\"\u003erate\u003c/span\u003e(nv_inference_compute_input_duration_us{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}[$__interval]) / \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eB\u003c/span\u003e: \u003cspan class=\"hljs-title function_\"\u003erate\u003c/span\u003e(nv_inference_compute_infer_duration_us{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}[$__interval]) / \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eC\u003c/span\u003e: \u003cspan class=\"hljs-title function_\"\u003erate\u003c/span\u003e(nv_inference_compute_output_duration_us{job=\u003cspan class=\"hljs-string\"\u003e\"triton-server\"\u003c/span\u003e}[$__interval]) / \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e\n\n차트 유형: 시계열\n범례: {모델}-{버전}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e우리가 만든 완벽한 대시보드는 다음을 보여줍니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eGPU VRAM 이용률\u003c/li\u003e\n\u003cli\u003e클라이언트에서 서버로의 입력 송신 시간\u003c/li\u003e\n\u003cli\u003e서버 추론 요청 시간\u003c/li\u003e\n\u003cli\u003e서버에서 클라이언트로의 출력 송신 시간\u003c/li\u003e\n\u003cli\u003e성공 요청/전체 요청 비율\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e이런 종류의 대시보드는 배포된 스택의 성능 및 스트레스 테스트 속에서의 동작을 모니터링하기 위한 시작점을 제시합니다.\u003c/p\u003e\n\u003cp\u003e이는 배포의 실패 및 위험 지점을 연구하는 구체적인 방법을 제공하며 SLI(서비스 수준 지표)를 모니터링하는 데 도움이 됩니다.\u003c/p\u003e\n\u003cp\u003e서비스 수준 지표는 SLA(서비스 수준 계약)를 준수하고 SLO(서비스 수준 목표)를 달성하기 위해 모니터링되는 메트릭입니다. 우리가 만든 대시보드는 제공되는 서비스 수준 계약을 준수하기 위한 목표에 도달하기 위한 가치 있는 통찰을 제공할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e또한 이는 다중 복제본을 추가하거나 추론 서빙 프레임워크를 실행하는 여러 기계로의 확장 전략을 계획하는 데 도움이 됩니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch1\u003e결론\u003c/h1\u003e\n\u003cp\u003e본 문서에서는 Prometheus와 Grafana를 사용하여 자사의 ML 애플리케이션 및 모델 서빙 프레임워크를 위한 성능 모니터링 스택을 설정하고 구축하는 방법을 소개했습니다.\u003c/p\u003e\n\u003cp\u003e도커 컴포즈 파일을 준비하는 것부터 시작하여 워크플로우의 각 단계를 설명하고 스택을 배포하고 데이터 원본을 구성하며 대시보드 패널을 생성하고 지표를 집계하는 과정을 마무리했습니다.\u003c/p\u003e\n\u003cp\u003e모니터링은 MLOps 시스템의 중요한 부분입니다!\n이 튜토리얼을 따라 하면 테스트 환경에서 단일 배포로 ML 애플리케이션을 위한 모니터링 파이프라인을 구조화하고 배포하거나, 클라우드 시나리오 설정에서 여러 입력 소스를 결합하고 전체 스택 배포를 모니터링하는 단일 대시보드 소비자 지점을 갖도록 구성할 수 있습니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch1\u003e더 많은 내용을 원하신다면!\u003c/h1\u003e\n\u003cp\u003e저는 미디엄에 새롭게 등장했습니다. 만약 이 글을 즐겨보셨다면 박수를 보내주시고 제 계정을 팔로우해주세요 - 정말로 감사하겠습니다! 🚀\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction_3.png\" alt=\"How to ensure your deep learning stack is fail-safe in production\"\u003e\u003c/p\u003e\n\u003ch1\u003e더 많은 글 보기\u003c/h1\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e이 게시물과 관련성에 따라 정렬되었습니다.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-23-Howtoensureyourdeeplearningstackisfail-safeinproduction"},"buildId":"YUMR4jSyk_WlOHHc7UfOk","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>