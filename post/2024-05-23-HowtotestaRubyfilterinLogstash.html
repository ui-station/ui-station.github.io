<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>루비 필터를 Logstash에서 테스트하는 방법 | ui-station</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://ui-station.github.io///post/2024-05-23-HowtotestaRubyfilterinLogstash" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="루비 필터를 Logstash에서 테스트하는 방법 | ui-station" data-gatsby-head="true"/><meta property="og:title" content="루비 필터를 Logstash에서 테스트하는 방법 | ui-station" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-23-HowtotestaRubyfilterinLogstash_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://ui-station.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://ui-station.github.io///post/2024-05-23-HowtotestaRubyfilterinLogstash" data-gatsby-head="true"/><meta name="twitter:title" content="루비 필터를 Logstash에서 테스트하는 방법 | ui-station" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-23-HowtotestaRubyfilterinLogstash_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | ui-station" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-23 12:49" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-V5DKFTZ6BX"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-V5DKFTZ6BX');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cd012fc8787133d0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cd012fc8787133d0.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/_next/static/chunks/348-d11c34b645b13f5b.js" defer=""></script><script src="/_next/static/chunks/551-3069cf29fe274aab.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-561ae49ab5aab7f5.js" defer=""></script><script src="/_next/static/R1x9p1CQYDDJESXyLXKOK/_buildManifest.js" defer=""></script><script src="/_next/static/R1x9p1CQYDDJESXyLXKOK/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UI STATION</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">루비 필터를 Logstash에서 테스트하는 방법</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="루비 필터를 Logstash에서 테스트하는 방법" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UI STATION</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 23, 2024</span><span class="posts_reading_time__f7YPP">9<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-23-HowtotestaRubyfilterinLogstash&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><p>이전 기사에서는 Logstash에서 코드를 공유하고 루비 필터에서 모듈을 만드는 방법을 보았습니다. 이 기사에서는 결과 이벤트가 예상대로인지 확인하기 위해 필터를 테스트하는 방법을 보여드릴 것입니다.</p>
<h1>이전 코드에 대해</h1>
<p>기억을 새기기 위해, 코드는 다음과 같았습니다:</p>
<pre><code class="hljs language-js"><span class="hljs-built_in">require</span> <span class="hljs-string">&#x27;./script/denormalized_by_prizes_utils.rb&#x27;</span>

# <span class="hljs-string">`params`</span>의 값은 로그스태시 구성에서 <span class="hljs-string">`script_params`</span>에 전달된 해시의 값입니다.
def <span class="hljs-title function_">register</span>(params)
    @keep_original_event = params[<span class="hljs-string">&quot;keep_original_event&quot;</span>]
end

# 필터 메소드는 이벤트를 수신하고 이벤트 목록을 반환해야 합니다.
# 이벤트를 삭제하면 반환 배열에 포함되지 않음을 의미합니다.
# 새 이벤트를 만드는 것은 반환된 배열에 <span class="hljs-title class_">LogStash</span>::<span class="hljs-title class_">Event</span>의 새 인스턴스만 추가하면 됩니다.
def <span class="hljs-title function_">filter</span>(event)
    
    items = <span class="hljs-title class_">Array</span>.<span class="hljs-property">new</span>

    # 원래 이벤트를 유지하려면
    originalEvent = <span class="hljs-title class_">LogStash</span>::<span class="hljs-title class_">Util</span>::<span class="hljs-title class_">DenormalizationByPrizesHelper</span>::<span class="hljs-title function_">getOriginalEvent</span>(event, @keep_original_event);
    <span class="hljs-keyword">if</span> not originalEvent.<span class="hljs-property">nil</span>?
        items.<span class="hljs-property">push</span> originalEvent
    end

    # 상품 항목을 가져옵니다 (정규화)
    prizes = <span class="hljs-title class_">LogStash</span>::<span class="hljs-title class_">Util</span>::<span class="hljs-title class_">DenormalizationByPrizesHelper</span>::<span class="hljs-title function_">getPrizes</span>(event);
    <span class="hljs-keyword">if</span> prizes.<span class="hljs-property">nil</span>?
        <span class="hljs-keyword">return</span> items
    end
   
    # 복제 기본 이벤트 생성
    eventBase = <span class="hljs-title class_">LogStash</span>::<span class="hljs-title class_">Util</span>::<span class="hljs-title class_">DenormalizationByPrizesHelper</span>::<span class="hljs-title function_">getEventBase</span>(event);

    # 필요한 수정으로 상품 항목별 이벤트 생성
    prizes.<span class="hljs-property">each</span> { |prize| 
        items.<span class="hljs-property">push</span> <span class="hljs-title class_">LogStash</span>::<span class="hljs-title class_">Util</span>::<span class="hljs-title class_">DenormalizationByPrizesHelper</span>::<span class="hljs-title function_">createEventForPrize</span>(eventBase, prize);
    }

    <span class="hljs-keyword">return</span> items;
end
</code></pre>
<div class="content-ad"></div>
<p>위 코드는 denormalized_by_prizes_utils.rb 파일 전체 내용입니다.</p>
<pre><code class="hljs language-rb"><span class="hljs-keyword">module</span> <span class="hljs-title class_">LogStash::Util::DenormalizationByPrizesHelper</span>
    <span class="hljs-keyword">include</span> <span class="hljs-title class_">LogStash::Util::Loggable</span>

    <span class="hljs-comment"># 원본 이벤트 유지 여부 확인</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">self</span>.getOriginalEvent(event, keepOriginalEvent)
        logger.debug(<span class="hljs-string">&#x27;keepOriginalEvent is :&#x27;</span> + keepOriginalEvent.to_s)
        <span class="hljs-keyword">if</span> keepOriginalEvent.to_s == <span class="hljs-string">&#x27;true&#x27;</span>
            event.set(<span class="hljs-string">&#x27;[@metadata][_index]&#x27;</span>, <span class="hljs-string">&#x27;prizes-original&#x27;</span>);
            <span class="hljs-keyword">return</span> event;
        <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>;
    <span class="hljs-keyword">end</span>

    <span class="hljs-comment"># 상금 아이템 얻기 (정규화)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">self</span>.getPrizes(event)
        prizes = event.get(<span class="hljs-string">&quot;prize&quot;</span>);
        <span class="hljs-keyword">if</span> prizes.<span class="hljs-literal">nil</span>?
            logger.warn(<span class="hljs-string">&quot;이벤트에 상금이 없습니다: &quot;</span> + event.to_s)
        <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">return</span> prizes;
    <span class="hljs-keyword">end</span>

    <span class="hljs-comment"># 클론 기본 이벤트 생성</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">self</span>.getEventBase(event)
        eventBase = event.clone();
        eventBase.set(<span class="hljs-string">&#x27;[@metadata][_index]&#x27;</span>, <span class="hljs-string">&#x27;prizes-denormalized&#x27;</span>);
        eventBase.remove(<span class="hljs-string">&quot;prize&quot;</span>);
        <span class="hljs-keyword">return</span> eventBase;
    <span class="hljs-keyword">end</span>

    <span class="hljs-comment"># 필요한 수정과 함께 현재 상금 아이템을 위한 이벤트 클론 생성</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">self</span>.createEventForPrize(eventBase, prize)
        eventPrize = eventBase.clone();
        <span class="hljs-comment"># 각 상금 아이템 값을 상금 객체로 복사</span>
        prize.each { |<span class="hljs-params">key,value</span>|
            eventPrize.set(<span class="hljs-string">&quot;[prize][&quot;</span> + key + <span class="hljs-string">&quot;]&quot;</span>, value)
        }
        <span class="hljs-keyword">return</span> eventPrize;
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h2>일반 구문</h2>
<p>이 섹션에서는 예상된 이벤트가 실제로 예상한 대로 생성되는지 확인하는 기능 테스트를 작성하는 방법을 보여줍니다.</p>
<div class="content-ad"></div>
<p>하나 이상의 테스트 케이스를 작성할 수 있으며 각 테스트 케이스마다 필요한 만큼의 테스트를 수행할 수 있습니다. 이러한 테스트는 루비 필터 파일 끝에 작성되어야 합니다. 즉, register/filter 함수를 포함하는 주 파일에 작성되어야 합니다.</p>
<p>필터 테스트는 다음과 같은 구문을 따라야 합니다:</p>
<pre><code class="hljs language-js">test <span class="hljs-string">&quot;테스트 케이스 이름&quot;</span> <span class="hljs-keyword">do</span>

    parameters <span class="hljs-keyword">do</span>
    { 
        # 필터에 전달할 매개변수
    }
    end
    
    in_event { 
        # 필터 프로세스에 도착하는 이벤트
    }

    # expect 메서드를 사용한 테스트

end
</code></pre>
<h1>저희 루비 필터에 테스트를 구현합니다.</h1>
<div class="content-ad"></div>
<p>예제에서는 역정규화를 구현했기 때문에 테스트에서 원본 이벤트를 잘 역정규화했는지 여러 경우(원본 이벤트 유지 여부, 상금 목록에 상금 하나 또는 둘의 예)를 확인할 것입니다.</p>
<h2>테스트 케이스</h2>
<p>따라서, 아래에 제시된 네 가지 테스트 케이스가 필요합니다:</p>
<pre><code class="hljs language-js">test <span class="hljs-string">&quot;Case 1: 이벤트에 상금 하나 / 원본 이벤트 유지하지 않음&quot;</span> <span class="hljs-keyword">do</span>

    parameters <span class="hljs-keyword">do</span>
    { 
        <span class="hljs-string">&quot;keep_original_event&quot;</span> =&gt; <span class="hljs-literal">false</span>
    }
    end

    in_event { 
        { 
            <span class="hljs-string">&quot;id&quot;</span>        =&gt; <span class="hljs-number">1</span>, 
            <span class="hljs-string">&quot;firstname&quot;</span> =&gt; <span class="hljs-string">&quot;Pierre&quot;</span>, 
            <span class="hljs-string">&quot;surname&quot;</span>   =&gt; <span class="hljs-string">&quot;Curie&quot;</span>,
            <span class="hljs-string">&quot;gender&quot;</span>    =&gt; <span class="hljs-string">&quot;male&quot;</span>,
            <span class="hljs-string">&quot;prize&quot;</span>     =&gt; [
                {
                    <span class="hljs-string">&quot;year&quot;</span> =&gt; <span class="hljs-number">1903</span>,
                    <span class="hljs-string">&quot;category&quot;</span> =&gt; <span class="hljs-string">&quot;physics&quot;</span>
                }
            ]
        } 
    }

    # expect 메소드를 사용한 테스트

end

test <span class="hljs-string">&quot;Case 2: 이벤트에 상금 하나 / 원본 이벤트 유지&quot;</span> <span class="hljs-keyword">do</span>

    parameters <span class="hljs-keyword">do</span>
    { 
        <span class="hljs-string">&quot;keep_original_event&quot;</span> =&gt; <span class="hljs-literal">true</span>
    }
    end

    in_event { 
        { 
            <span class="hljs-string">&quot;id&quot;</span>        =&gt; <span class="hljs-number">1</span>, 
            <span class="hljs-string">&quot;firstname&quot;</span> =&gt; <span class="hljs-string">&quot;Pierre&quot;</span>, 
            <span class="hljs-string">&quot;surname&quot;</span>   =&gt; <span class="hljs-string">&quot;Curie&quot;</span>,
            <span class="hljs-string">&quot;gender&quot;</span>    =&gt; <span class="hljs-string">&quot;male&quot;</span>,
            <span class="hljs-string">&quot;prize&quot;</span>     =&gt; [
                {
                    <span class="hljs-string">&quot;year&quot;</span> =&gt; <span class="hljs-number">1903</span>,
                    <span class="hljs-string">&quot;category&quot;</span> =&gt; <span class="hljs-string">&quot;physics&quot;</span>
                }
            ]
        } 
    }

    # expect 메소드를 사용한 테스트

end

test <span class="hljs-string">&quot;Case 3: 이벤트에 상금 둘 / 원본 이벤트 유지하지 않음&quot;</span> <span class="hljs-keyword">do</span>

    parameters <span class="hljs-keyword">do</span>
    { 
        <span class="hljs-string">&quot;keep_original_event&quot;</span> =&gt; <span class="hljs-literal">false</span>
    }
    end

    in_event { 
        { 
            <span class="hljs-string">&quot;id&quot;</span>        =&gt; <span class="hljs-number">2</span>, 
            <span class="hljs-string">&quot;firstname&quot;</span> =&gt; <span class="hljs-string">&quot;Marie&quot;</span>, 
            <span class="hljs-string">&quot;surname&quot;</span>   =&gt; <span class="hljs-string">&quot;Curie&quot;</span>,
            <span class="hljs-string">&quot;gender&quot;</span>    =&gt; <span class="hljs-string">&quot;female&quot;</span>,
            <span class="hljs-string">&quot;prize&quot;</span>     =&gt; [
                {
                    <span class="hljs-string">&quot;year&quot;</span> =&gt; <span class="hljs-number">1903</span>,
                    <span class="hljs-string">&quot;category&quot;</span> =&gt; <span class="hljs-string">&quot;physics&quot;</span>
                },
                {
                    <span class="hljs-string">&quot;year&quot;</span> =&gt; <span class="hljs-number">1911</span>,
                    <span class="hljs-string">&quot;category&quot;</span> =&gt; <span class="hljs-string">&quot;chemistry&quot;</span>
                }
            ]
        } 
    }

    # expect 메소드를 사용한 테스트

end

test <span class="hljs-string">&quot;Case 4: 이벤트에 상금 둘 / 원본 이벤트 유지&quot;</span> <span class="hljs-keyword">do</span>

    parameters <span class="hljs-keyword">do</span>
    { 
        <span class="hljs-string">&quot;keep_original_event&quot;</span> =&gt; <span class="hljs-literal">true</span>
    }
    end

    in_event { 
        { 
            <span class="hljs-string">&quot;id&quot;</span>        =&gt; <span class="hljs-number">2</span>, 
            <span class="hljs-string">&quot;firstname&quot;</span> =&gt; <span class="hljs-string">&quot;Marie&quot;</span>, 
            <span class="hljs-string">&quot;surname&quot;</span>   =&gt; <span class="hljs-string">&quot;Curie&quot;</span>,
            <span class="hljs-string">&quot;gender&quot;</span>    =&gt; <span class="hljs-string">&quot;female&quot;</span>,
            <span class="hljs-string">&quot;prize&quot;</span>     =&gt; [
                {
                    <span class="hljs-string">&quot;year&quot;</span> =&gt; <span class="hljs-number">1903</span>,
                    <span class="hljs-string">&quot;category&quot;</span> =&gt; <span class="hljs-string">&quot;physics&quot;</span>
                },
                {
                    <span class="hljs-string">&quot;year&quot;</span> =&gt; <span class="hljs-number">1911</span>,
                    <span class="hljs-string">&quot;category&quot;</span> =&gt; <span class="hljs-string">&quot;chemistry&quot;</span>
                }
            ]
        } 
    }

    # expect 메소드를 사용한 테스트

end
</code></pre>
<div class="content-ad"></div>
<h2>기능 테스트 구현</h2>
<p>이 글에서는 더 복잡한 테스트 케이스(마지막)만 구현할 것입니다. 다른 것들에 대해서도 원리는 동일하지만 서로 다른 테스트 케이스를 테스트하므로 예상 결과는 같지 않을 것입니다.</p>
<p>그래서 마지막 테스트 케이스에서 다음을 확인할 것입니다:</p>
<ul>
<li>원본이 변경 없이 출력에 포함되어 있는지 확인하기</li>
<li>&quot;prize&quot; 배열의 각 항목마다 문서를 생성하므로 두 항목은 두 개의 문서를 생성해야 합니다</li>
<li>생성된 각 항목이 올바른 공통 필드와 올바른 상금 필드를 포함하고 있는지 확인하기</li>
<li>결과적으로 출력에는 3개의 이벤트가 있어야 하며, 각 이벤트는 별도의 인덱스에 있어야 합니다</li>
</ul>
<div class="content-ad"></div>
<p>저희의 테스트는 다음과 같이 작성될 수 있어요:</p>
<pre><code class="hljs language-js">test <span class="hljs-string">&quot;Case 4: two prizes in event / keep original event&quot;</span> <span class="hljs-keyword">do</span>

    parameters <span class="hljs-keyword">do</span>
    { 
        <span class="hljs-string">&quot;keep_original_event&quot;</span> =&gt; <span class="hljs-literal">true</span>
    }
    end

    in_event { 
        { 
            <span class="hljs-string">&quot;id&quot;</span>        =&gt; <span class="hljs-number">2</span>, 
            <span class="hljs-string">&quot;firstname&quot;</span> =&gt; <span class="hljs-string">&quot;Marie&quot;</span>, 
            <span class="hljs-string">&quot;surname&quot;</span>   =&gt; <span class="hljs-string">&quot;Curie&quot;</span>,
            <span class="hljs-string">&quot;gender&quot;</span>    =&gt; <span class="hljs-string">&quot;female&quot;</span>,
            <span class="hljs-string">&quot;prize&quot;</span>     =&gt; [
                {
                    <span class="hljs-string">&quot;year&quot;</span> =&gt; <span class="hljs-number">1903</span>,
                    <span class="hljs-string">&quot;category&quot;</span> =&gt; <span class="hljs-string">&quot;physics&quot;</span>
                },
                {
                    <span class="hljs-string">&quot;year&quot;</span> =&gt; <span class="hljs-number">1911</span>,
                    <span class="hljs-string">&quot;category&quot;</span> =&gt; <span class="hljs-string">&quot;chemistry&quot;</span>
                }
            ]
        } 
    }

    <span class="hljs-title function_">expect</span>(<span class="hljs-string">&quot;Count of events&quot;</span>) <span class="hljs-keyword">do</span> |events|
        events.<span class="hljs-property">length</span> == <span class="hljs-number">3</span>
    end

    <span class="hljs-title function_">expect</span>(<span class="hljs-string">&quot;Each event has same shared fields&quot;</span>) <span class="hljs-keyword">do</span> |events|
        result = <span class="hljs-literal">true</span>
        events.<span class="hljs-property">each</span> { |event|
            result &amp;= event.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[id]&quot;</span>) == <span class="hljs-number">2</span>
            result &amp;= event.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[firstname]&quot;</span>) == <span class="hljs-string">&quot;Marie&quot;</span>
            result &amp;= event.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[surname]&quot;</span>) == <span class="hljs-string">&quot;Curie&quot;</span>
            result &amp;= event.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[gender]&quot;</span>) == <span class="hljs-string">&quot;female&quot;</span>
        }
        result
    end

    <span class="hljs-title function_">expect</span>(<span class="hljs-string">&quot;Each event has good _index&quot;</span>) <span class="hljs-keyword">do</span> |events|  
        result = <span class="hljs-literal">true</span>
        result &amp;= events[<span class="hljs-number">0</span>].<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[@metadata][_index]&quot;</span>) == <span class="hljs-string">&quot;prizes-original&quot;</span>
        result &amp;= events[<span class="hljs-number">1</span>].<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[@metadata][_index]&quot;</span>) == <span class="hljs-string">&quot;prizes-denormalized&quot;</span>
        result &amp;= events[<span class="hljs-number">2</span>].<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[@metadata][_index]&quot;</span>) == <span class="hljs-string">&quot;prizes-denormalized&quot;</span>
        result
    end

    <span class="hljs-title function_">expect</span>(<span class="hljs-string">&quot;Each event has good prize fields&quot;</span>) <span class="hljs-keyword">do</span> |events| 
        result = <span class="hljs-literal">true</span> 
        result &amp;= events[<span class="hljs-number">0</span>].<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[prize][0][year]&quot;</span>) == <span class="hljs-number">1903</span>
        result &amp;= events[<span class="hljs-number">0</span>].<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[prize][0][category]&quot;</span>) == <span class="hljs-string">&quot;physics&quot;</span>
        result &amp;= events[<span class="hljs-number">0</span>].<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[prize][1][year]&quot;</span>) == <span class="hljs-number">1911</span>
        result &amp;= events[<span class="hljs-number">0</span>].<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[prize][1][category]&quot;</span>) == <span class="hljs-string">&quot;chemistry&quot;</span>
        result &amp;= events[<span class="hljs-number">1</span>].<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[prize][year]&quot;</span>) == <span class="hljs-number">1903</span>
        result &amp;= events[<span class="hljs-number">1</span>].<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[prize][category]&quot;</span>) == <span class="hljs-string">&quot;physics&quot;</span>
        result &amp;= events[<span class="hljs-number">2</span>].<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[prize][year]&quot;</span>) == <span class="hljs-number">1911</span>
        result &amp;= events[<span class="hljs-number">2</span>].<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;[prize][category]&quot;</span>) == <span class="hljs-string">&quot;chemistry&quot;</span>
        result
    end

end
</code></pre>
<p>여러 개의 어설션을 갖는 <code>expect</code> 메서드를 사용할 때는, <code>&amp;&amp;</code> 또는 <code>&amp;=</code> 연산자를 사용하여 어설션 결과를 결합하는데 문법에 주의하세요.</p>
<p>우리의 테스트 케이스 구현이 준비되었어요. 모든 테스트 케이스는 Logstash 시작 시 실행되며 해당 파이프라인이 생성될 때 실행돼요. 실제로, Logstash는 Ruby 필터에 작성된 모든 테스트를 찾을 수 있어요. 그리고 Logstash 로그에서 모든 테스트 결과를 볼 수 있을 거예요.</p>
<div class="content-ad"></div>
<p>아래는 Markdown 형식으로 변경한 내용입니다.</p>
<p><img src="/assets/img/2024-05-23-HowtotestaRubyfilterinLogstash_0.png" alt="이미지1"/></p>
<p><img src="/assets/img/2024-05-23-HowtotestaRubyfilterinLogstash_1.png" alt="이미지2"/></p>
<p>테스트가 실패한 경우, 테스트 케이스 이름 및 필요한 모든 정보(매개변수, 입력 이벤트, 결과)를 명확히 확인할 수 있습니다. 최소한 하나의 테스트가 실패하면 연결된 파이프라인은 시작되지 않습니다.</p></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"루비 필터를 Logstash에서 테스트하는 방법","description":"","date":"2024-05-23 12:49","slug":"2024-05-23-HowtotestaRubyfilterinLogstash","content":"\n\n이전 기사에서는 Logstash에서 코드를 공유하고 루비 필터에서 모듈을 만드는 방법을 보았습니다. 이 기사에서는 결과 이벤트가 예상대로인지 확인하기 위해 필터를 테스트하는 방법을 보여드릴 것입니다.\n\n# 이전 코드에 대해\n\n기억을 새기기 위해, 코드는 다음과 같았습니다:\n\n```js\nrequire './script/denormalized_by_prizes_utils.rb'\n\n# `params`의 값은 로그스태시 구성에서 `script_params`에 전달된 해시의 값입니다.\ndef register(params)\n    @keep_original_event = params[\"keep_original_event\"]\nend\n\n# 필터 메소드는 이벤트를 수신하고 이벤트 목록을 반환해야 합니다.\n# 이벤트를 삭제하면 반환 배열에 포함되지 않음을 의미합니다.\n# 새 이벤트를 만드는 것은 반환된 배열에 LogStash::Event의 새 인스턴스만 추가하면 됩니다.\ndef filter(event)\n    \n    items = Array.new\n\n    # 원래 이벤트를 유지하려면\n    originalEvent = LogStash::Util::DenormalizationByPrizesHelper::getOriginalEvent(event, @keep_original_event);\n    if not originalEvent.nil?\n        items.push originalEvent\n    end\n\n    # 상품 항목을 가져옵니다 (정규화)\n    prizes = LogStash::Util::DenormalizationByPrizesHelper::getPrizes(event);\n    if prizes.nil?\n        return items\n    end\n   \n    # 복제 기본 이벤트 생성\n    eventBase = LogStash::Util::DenormalizationByPrizesHelper::getEventBase(event);\n\n    # 필요한 수정으로 상품 항목별 이벤트 생성\n    prizes.each { |prize| \n        items.push LogStash::Util::DenormalizationByPrizesHelper::createEventForPrize(eventBase, prize);\n    }\n\n    return items;\nend\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n위 코드는 denormalized_by_prizes_utils.rb 파일 전체 내용입니다.\n\n```rb\nmodule LogStash::Util::DenormalizationByPrizesHelper\n    include LogStash::Util::Loggable\n\n    # 원본 이벤트 유지 여부 확인\n    def self.getOriginalEvent(event, keepOriginalEvent)\n        logger.debug('keepOriginalEvent is :' + keepOriginalEvent.to_s)\n        if keepOriginalEvent.to_s == 'true'\n            event.set('[@metadata][_index]', 'prizes-original');\n            return event;\n        end\n        return nil;\n    end\n\n    # 상금 아이템 얻기 (정규화)\n    def self.getPrizes(event)\n        prizes = event.get(\"prize\");\n        if prizes.nil?\n            logger.warn(\"이벤트에 상금이 없습니다: \" + event.to_s)\n        end\n        return prizes;\n    end\n\n    # 클론 기본 이벤트 생성\n    def self.getEventBase(event)\n        eventBase = event.clone();\n        eventBase.set('[@metadata][_index]', 'prizes-denormalized');\n        eventBase.remove(\"prize\");\n        return eventBase;\n    end\n\n    # 필요한 수정과 함께 현재 상금 아이템을 위한 이벤트 클론 생성\n    def self.createEventForPrize(eventBase, prize)\n        eventPrize = eventBase.clone();\n        # 각 상금 아이템 값을 상금 객체로 복사\n        prize.each { |key,value|\n            eventPrize.set(\"[prize][\" + key + \"]\", value)\n        }\n        return eventPrize;\n    end\nend\n```\n\n## 일반 구문\n\n이 섹션에서는 예상된 이벤트가 실제로 예상한 대로 생성되는지 확인하는 기능 테스트를 작성하는 방법을 보여줍니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n하나 이상의 테스트 케이스를 작성할 수 있으며 각 테스트 케이스마다 필요한 만큼의 테스트를 수행할 수 있습니다. 이러한 테스트는 루비 필터 파일 끝에 작성되어야 합니다. 즉, register/filter 함수를 포함하는 주 파일에 작성되어야 합니다.\n\n필터 테스트는 다음과 같은 구문을 따라야 합니다:\n\n```js\ntest \"테스트 케이스 이름\" do\n\n    parameters do\n    { \n        # 필터에 전달할 매개변수\n    }\n    end\n    \n    in_event { \n        # 필터 프로세스에 도착하는 이벤트\n    }\n\n    # expect 메서드를 사용한 테스트\n\nend\n```\n\n# 저희 루비 필터에 테스트를 구현합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n예제에서는 역정규화를 구현했기 때문에 테스트에서 원본 이벤트를 잘 역정규화했는지 여러 경우(원본 이벤트 유지 여부, 상금 목록에 상금 하나 또는 둘의 예)를 확인할 것입니다.\n\n## 테스트 케이스\n\n따라서, 아래에 제시된 네 가지 테스트 케이스가 필요합니다:\n\n```js\ntest \"Case 1: 이벤트에 상금 하나 / 원본 이벤트 유지하지 않음\" do\n\n    parameters do\n    { \n        \"keep_original_event\" =\u003e false\n    }\n    end\n\n    in_event { \n        { \n            \"id\"        =\u003e 1, \n            \"firstname\" =\u003e \"Pierre\", \n            \"surname\"   =\u003e \"Curie\",\n            \"gender\"    =\u003e \"male\",\n            \"prize\"     =\u003e [\n                {\n                    \"year\" =\u003e 1903,\n                    \"category\" =\u003e \"physics\"\n                }\n            ]\n        } \n    }\n\n    # expect 메소드를 사용한 테스트\n\nend\n\ntest \"Case 2: 이벤트에 상금 하나 / 원본 이벤트 유지\" do\n\n    parameters do\n    { \n        \"keep_original_event\" =\u003e true\n    }\n    end\n\n    in_event { \n        { \n            \"id\"        =\u003e 1, \n            \"firstname\" =\u003e \"Pierre\", \n            \"surname\"   =\u003e \"Curie\",\n            \"gender\"    =\u003e \"male\",\n            \"prize\"     =\u003e [\n                {\n                    \"year\" =\u003e 1903,\n                    \"category\" =\u003e \"physics\"\n                }\n            ]\n        } \n    }\n\n    # expect 메소드를 사용한 테스트\n\nend\n\ntest \"Case 3: 이벤트에 상금 둘 / 원본 이벤트 유지하지 않음\" do\n\n    parameters do\n    { \n        \"keep_original_event\" =\u003e false\n    }\n    end\n\n    in_event { \n        { \n            \"id\"        =\u003e 2, \n            \"firstname\" =\u003e \"Marie\", \n            \"surname\"   =\u003e \"Curie\",\n            \"gender\"    =\u003e \"female\",\n            \"prize\"     =\u003e [\n                {\n                    \"year\" =\u003e 1903,\n                    \"category\" =\u003e \"physics\"\n                },\n                {\n                    \"year\" =\u003e 1911,\n                    \"category\" =\u003e \"chemistry\"\n                }\n            ]\n        } \n    }\n\n    # expect 메소드를 사용한 테스트\n\nend\n\ntest \"Case 4: 이벤트에 상금 둘 / 원본 이벤트 유지\" do\n\n    parameters do\n    { \n        \"keep_original_event\" =\u003e true\n    }\n    end\n\n    in_event { \n        { \n            \"id\"        =\u003e 2, \n            \"firstname\" =\u003e \"Marie\", \n            \"surname\"   =\u003e \"Curie\",\n            \"gender\"    =\u003e \"female\",\n            \"prize\"     =\u003e [\n                {\n                    \"year\" =\u003e 1903,\n                    \"category\" =\u003e \"physics\"\n                },\n                {\n                    \"year\" =\u003e 1911,\n                    \"category\" =\u003e \"chemistry\"\n                }\n            ]\n        } \n    }\n\n    # expect 메소드를 사용한 테스트\n\nend\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 기능 테스트 구현\n\n이 글에서는 더 복잡한 테스트 케이스(마지막)만 구현할 것입니다. 다른 것들에 대해서도 원리는 동일하지만 서로 다른 테스트 케이스를 테스트하므로 예상 결과는 같지 않을 것입니다.\n\n그래서 마지막 테스트 케이스에서 다음을 확인할 것입니다:\n\n- 원본이 변경 없이 출력에 포함되어 있는지 확인하기\n- \"prize\" 배열의 각 항목마다 문서를 생성하므로 두 항목은 두 개의 문서를 생성해야 합니다\n- 생성된 각 항목이 올바른 공통 필드와 올바른 상금 필드를 포함하고 있는지 확인하기\n- 결과적으로 출력에는 3개의 이벤트가 있어야 하며, 각 이벤트는 별도의 인덱스에 있어야 합니다\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n저희의 테스트는 다음과 같이 작성될 수 있어요:\n\n```js\ntest \"Case 4: two prizes in event / keep original event\" do\n\n    parameters do\n    { \n        \"keep_original_event\" =\u003e true\n    }\n    end\n\n    in_event { \n        { \n            \"id\"        =\u003e 2, \n            \"firstname\" =\u003e \"Marie\", \n            \"surname\"   =\u003e \"Curie\",\n            \"gender\"    =\u003e \"female\",\n            \"prize\"     =\u003e [\n                {\n                    \"year\" =\u003e 1903,\n                    \"category\" =\u003e \"physics\"\n                },\n                {\n                    \"year\" =\u003e 1911,\n                    \"category\" =\u003e \"chemistry\"\n                }\n            ]\n        } \n    }\n\n    expect(\"Count of events\") do |events|\n        events.length == 3\n    end\n\n    expect(\"Each event has same shared fields\") do |events|\n        result = true\n        events.each { |event|\n            result \u0026= event.get(\"[id]\") == 2\n            result \u0026= event.get(\"[firstname]\") == \"Marie\"\n            result \u0026= event.get(\"[surname]\") == \"Curie\"\n            result \u0026= event.get(\"[gender]\") == \"female\"\n        }\n        result\n    end\n\n    expect(\"Each event has good _index\") do |events|  \n        result = true\n        result \u0026= events[0].get(\"[@metadata][_index]\") == \"prizes-original\"\n        result \u0026= events[1].get(\"[@metadata][_index]\") == \"prizes-denormalized\"\n        result \u0026= events[2].get(\"[@metadata][_index]\") == \"prizes-denormalized\"\n        result\n    end\n\n    expect(\"Each event has good prize fields\") do |events| \n        result = true \n        result \u0026= events[0].get(\"[prize][0][year]\") == 1903\n        result \u0026= events[0].get(\"[prize][0][category]\") == \"physics\"\n        result \u0026= events[0].get(\"[prize][1][year]\") == 1911\n        result \u0026= events[0].get(\"[prize][1][category]\") == \"chemistry\"\n        result \u0026= events[1].get(\"[prize][year]\") == 1903\n        result \u0026= events[1].get(\"[prize][category]\") == \"physics\"\n        result \u0026= events[2].get(\"[prize][year]\") == 1911\n        result \u0026= events[2].get(\"[prize][category]\") == \"chemistry\"\n        result\n    end\n\nend\n```\n\n여러 개의 어설션을 갖는 `expect` 메서드를 사용할 때는, `\u0026\u0026` 또는 `\u0026=` 연산자를 사용하여 어설션 결과를 결합하는데 문법에 주의하세요.\n\n우리의 테스트 케이스 구현이 준비되었어요. 모든 테스트 케이스는 Logstash 시작 시 실행되며 해당 파이프라인이 생성될 때 실행돼요. 실제로, Logstash는 Ruby 필터에 작성된 모든 테스트를 찾을 수 있어요. 그리고 Logstash 로그에서 모든 테스트 결과를 볼 수 있을 거예요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n아래는 Markdown 형식으로 변경한 내용입니다.\n\n\n![이미지1](/assets/img/2024-05-23-HowtotestaRubyfilterinLogstash_0.png)\n\n![이미지2](/assets/img/2024-05-23-HowtotestaRubyfilterinLogstash_1.png)\n\n테스트가 실패한 경우, 테스트 케이스 이름 및 필요한 모든 정보(매개변수, 입력 이벤트, 결과)를 명확히 확인할 수 있습니다. 최소한 하나의 테스트가 실패하면 연결된 파이프라인은 시작되지 않습니다.\n","ogImage":{"url":"/assets/img/2024-05-23-HowtotestaRubyfilterinLogstash_0.png"},"coverImage":"/assets/img/2024-05-23-HowtotestaRubyfilterinLogstash_0.png","tag":["Tech"],"readingTime":9},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h1: \"h1\",\n    pre: \"pre\",\n    code: \"code\",\n    span: \"span\",\n    h2: \"h2\",\n    ul: \"ul\",\n    li: \"li\",\n    img: \"img\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"이전 기사에서는 Logstash에서 코드를 공유하고 루비 필터에서 모듈을 만드는 방법을 보았습니다. 이 기사에서는 결과 이벤트가 예상대로인지 확인하기 위해 필터를 테스트하는 방법을 보여드릴 것입니다.\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"이전 코드에 대해\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"기억을 새기기 위해, 코드는 다음과 같았습니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"require\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'./script/denormalized_by_prizes_utils.rb'\"\n        }), \"\\n\\n# \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"`params`\"\n        }), \"의 값은 로그스태시 구성에서 \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"`script_params`\"\n        }), \"에 전달된 해시의 값입니다.\\ndef \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"register\"\n        }), \"(params)\\n    @keep_original_event = params[\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"keep_original_event\\\"\"\n        }), \"]\\nend\\n\\n# 필터 메소드는 이벤트를 수신하고 이벤트 목록을 반환해야 합니다.\\n# 이벤트를 삭제하면 반환 배열에 포함되지 않음을 의미합니다.\\n# 새 이벤트를 만드는 것은 반환된 배열에 \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LogStash\"\n        }), \"::\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Event\"\n        }), \"의 새 인스턴스만 추가하면 됩니다.\\ndef \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"filter\"\n        }), \"(event)\\n    \\n    items = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Array\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"new\"\n        }), \"\\n\\n    # 원래 이벤트를 유지하려면\\n    originalEvent = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LogStash\"\n        }), \"::\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Util\"\n        }), \"::\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"DenormalizationByPrizesHelper\"\n        }), \"::\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"getOriginalEvent\"\n        }), \"(event, @keep_original_event);\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" not originalEvent.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"nil\"\n        }), \"?\\n        items.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"push\"\n        }), \" originalEvent\\n    end\\n\\n    # 상품 항목을 가져옵니다 (정규화)\\n    prizes = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LogStash\"\n        }), \"::\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Util\"\n        }), \"::\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"DenormalizationByPrizesHelper\"\n        }), \"::\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"getPrizes\"\n        }), \"(event);\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" prizes.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"nil\"\n        }), \"?\\n        \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" items\\n    end\\n   \\n    # 복제 기본 이벤트 생성\\n    eventBase = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LogStash\"\n        }), \"::\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Util\"\n        }), \"::\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"DenormalizationByPrizesHelper\"\n        }), \"::\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"getEventBase\"\n        }), \"(event);\\n\\n    # 필요한 수정으로 상품 항목별 이벤트 생성\\n    prizes.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"each\"\n        }), \" { |prize| \\n        items.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"push\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LogStash\"\n        }), \"::\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Util\"\n        }), \"::\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"DenormalizationByPrizesHelper\"\n        }), \"::\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"createEventForPrize\"\n        }), \"(eventBase, prize);\\n    }\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" items;\\nend\\n\"]\n      })\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"위 코드는 denormalized_by_prizes_utils.rb 파일 전체 내용입니다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-rb\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"module\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LogStash::Util::DenormalizationByPrizesHelper\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"include\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"LogStash::Util::Loggable\"\n        }), \"\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 원본 이벤트 유지 여부 확인\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"def\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"self\"\n        }), \".getOriginalEvent(event, keepOriginalEvent)\\n        logger.debug(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'keepOriginalEvent is :'\"\n        }), \" + keepOriginalEvent.to_s)\\n        \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" keepOriginalEvent.to_s == \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'true'\"\n        }), \"\\n            event.set(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'[@metadata][_index]'\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'prizes-original'\"\n        }), \");\\n            \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" event;\\n        \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"end\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \";\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"end\"\n        }), \"\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 상금 아이템 얻기 (정규화)\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"def\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"self\"\n        }), \".getPrizes(event)\\n        prizes = event.get(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"prize\\\"\"\n        }), \");\\n        \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" prizes.\", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \"?\\n            logger.warn(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"이벤트에 상금이 없습니다: \\\"\"\n        }), \" + event.to_s)\\n        \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"end\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" prizes;\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"end\"\n        }), \"\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 클론 기본 이벤트 생성\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"def\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"self\"\n        }), \".getEventBase(event)\\n        eventBase = event.clone();\\n        eventBase.set(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'[@metadata][_index]'\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'prizes-denormalized'\"\n        }), \");\\n        eventBase.remove(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"prize\\\"\"\n        }), \");\\n        \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" eventBase;\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"end\"\n        }), \"\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 필요한 수정과 함께 현재 상금 아이템을 위한 이벤트 클론 생성\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"def\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"self\"\n        }), \".createEventForPrize(eventBase, prize)\\n        eventPrize = eventBase.clone();\\n        \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 각 상금 아이템 값을 상금 객체로 복사\"\n        }), \"\\n        prize.each { |\", _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"key,value\"\n        }), \"|\\n            eventPrize.set(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[prize][\\\"\"\n        }), \" + key + \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"]\\\"\"\n        }), \", value)\\n        }\\n        \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" eventPrize;\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"end\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"end\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"일반 구문\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이 섹션에서는 예상된 이벤트가 실제로 예상한 대로 생성되는지 확인하는 기능 테스트를 작성하는 방법을 보여줍니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"하나 이상의 테스트 케이스를 작성할 수 있으며 각 테스트 케이스마다 필요한 만큼의 테스트를 수행할 수 있습니다. 이러한 테스트는 루비 필터 파일 끝에 작성되어야 합니다. 즉, register/filter 함수를 포함하는 주 파일에 작성되어야 합니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"필터 테스트는 다음과 같은 구문을 따라야 합니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"test \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"테스트 케이스 이름\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \"\\n\\n    parameters \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \"\\n    { \\n        # 필터에 전달할 매개변수\\n    }\\n    end\\n    \\n    in_event { \\n        # 필터 프로세스에 도착하는 이벤트\\n    }\\n\\n    # expect 메서드를 사용한 테스트\\n\\nend\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"저희 루비 필터에 테스트를 구현합니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"예제에서는 역정규화를 구현했기 때문에 테스트에서 원본 이벤트를 잘 역정규화했는지 여러 경우(원본 이벤트 유지 여부, 상금 목록에 상금 하나 또는 둘의 예)를 확인할 것입니다.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"테스트 케이스\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"따라서, 아래에 제시된 네 가지 테스트 케이스가 필요합니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"test \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Case 1: 이벤트에 상금 하나 / 원본 이벤트 유지하지 않음\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \"\\n\\n    parameters \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \"\\n    { \\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"keep_original_event\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"false\"\n        }), \"\\n    }\\n    end\\n\\n    in_event { \\n        { \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"id\\\"\"\n        }), \"        =\u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \", \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"firstname\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Pierre\\\"\"\n        }), \", \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"surname\\\"\"\n        }), \"   =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Curie\\\"\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"gender\\\"\"\n        }), \"    =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"male\\\"\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"prize\\\"\"\n        }), \"     =\u003e [\\n                {\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"year\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1903\"\n        }), \",\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"category\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"physics\\\"\"\n        }), \"\\n                }\\n            ]\\n        } \\n    }\\n\\n    # expect 메소드를 사용한 테스트\\n\\nend\\n\\ntest \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Case 2: 이벤트에 상금 하나 / 원본 이벤트 유지\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \"\\n\\n    parameters \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \"\\n    { \\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"keep_original_event\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"true\"\n        }), \"\\n    }\\n    end\\n\\n    in_event { \\n        { \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"id\\\"\"\n        }), \"        =\u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \", \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"firstname\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Pierre\\\"\"\n        }), \", \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"surname\\\"\"\n        }), \"   =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Curie\\\"\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"gender\\\"\"\n        }), \"    =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"male\\\"\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"prize\\\"\"\n        }), \"     =\u003e [\\n                {\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"year\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1903\"\n        }), \",\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"category\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"physics\\\"\"\n        }), \"\\n                }\\n            ]\\n        } \\n    }\\n\\n    # expect 메소드를 사용한 테스트\\n\\nend\\n\\ntest \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Case 3: 이벤트에 상금 둘 / 원본 이벤트 유지하지 않음\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \"\\n\\n    parameters \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \"\\n    { \\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"keep_original_event\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"false\"\n        }), \"\\n    }\\n    end\\n\\n    in_event { \\n        { \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"id\\\"\"\n        }), \"        =\u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"2\"\n        }), \", \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"firstname\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Marie\\\"\"\n        }), \", \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"surname\\\"\"\n        }), \"   =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Curie\\\"\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"gender\\\"\"\n        }), \"    =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"female\\\"\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"prize\\\"\"\n        }), \"     =\u003e [\\n                {\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"year\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1903\"\n        }), \",\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"category\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"physics\\\"\"\n        }), \"\\n                },\\n                {\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"year\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1911\"\n        }), \",\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"category\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"chemistry\\\"\"\n        }), \"\\n                }\\n            ]\\n        } \\n    }\\n\\n    # expect 메소드를 사용한 테스트\\n\\nend\\n\\ntest \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Case 4: 이벤트에 상금 둘 / 원본 이벤트 유지\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \"\\n\\n    parameters \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \"\\n    { \\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"keep_original_event\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"true\"\n        }), \"\\n    }\\n    end\\n\\n    in_event { \\n        { \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"id\\\"\"\n        }), \"        =\u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"2\"\n        }), \", \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"firstname\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Marie\\\"\"\n        }), \", \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"surname\\\"\"\n        }), \"   =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Curie\\\"\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"gender\\\"\"\n        }), \"    =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"female\\\"\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"prize\\\"\"\n        }), \"     =\u003e [\\n                {\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"year\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1903\"\n        }), \",\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"category\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"physics\\\"\"\n        }), \"\\n                },\\n                {\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"year\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1911\"\n        }), \",\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"category\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"chemistry\\\"\"\n        }), \"\\n                }\\n            ]\\n        } \\n    }\\n\\n    # expect 메소드를 사용한 테스트\\n\\nend\\n\"]\n      })\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"기능 테스트 구현\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이 글에서는 더 복잡한 테스트 케이스(마지막)만 구현할 것입니다. 다른 것들에 대해서도 원리는 동일하지만 서로 다른 테스트 케이스를 테스트하므로 예상 결과는 같지 않을 것입니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"그래서 마지막 테스트 케이스에서 다음을 확인할 것입니다:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"원본이 변경 없이 출력에 포함되어 있는지 확인하기\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"\\\"prize\\\" 배열의 각 항목마다 문서를 생성하므로 두 항목은 두 개의 문서를 생성해야 합니다\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"생성된 각 항목이 올바른 공통 필드와 올바른 상금 필드를 포함하고 있는지 확인하기\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"결과적으로 출력에는 3개의 이벤트가 있어야 하며, 각 이벤트는 별도의 인덱스에 있어야 합니다\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"저희의 테스트는 다음과 같이 작성될 수 있어요:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"test \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Case 4: two prizes in event / keep original event\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \"\\n\\n    parameters \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \"\\n    { \\n        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"keep_original_event\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"true\"\n        }), \"\\n    }\\n    end\\n\\n    in_event { \\n        { \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"id\\\"\"\n        }), \"        =\u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"2\"\n        }), \", \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"firstname\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Marie\\\"\"\n        }), \", \\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"surname\\\"\"\n        }), \"   =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Curie\\\"\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"gender\\\"\"\n        }), \"    =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"female\\\"\"\n        }), \",\\n            \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"prize\\\"\"\n        }), \"     =\u003e [\\n                {\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"year\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1903\"\n        }), \",\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"category\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"physics\\\"\"\n        }), \"\\n                },\\n                {\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"year\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1911\"\n        }), \",\\n                    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"category\\\"\"\n        }), \" =\u003e \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"chemistry\\\"\"\n        }), \"\\n                }\\n            ]\\n        } \\n    }\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"expect\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Count of events\\\"\"\n        }), \") \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" |events|\\n        events.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"length\"\n        }), \" == \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"3\"\n        }), \"\\n    end\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"expect\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Each event has same shared fields\\\"\"\n        }), \") \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" |events|\\n        result = \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"true\"\n        }), \"\\n        events.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"each\"\n        }), \" { |event|\\n            result \u0026= event.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[id]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"2\"\n        }), \"\\n            result \u0026= event.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[firstname]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Marie\\\"\"\n        }), \"\\n            result \u0026= event.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[surname]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Curie\\\"\"\n        }), \"\\n            result \u0026= event.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[gender]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"female\\\"\"\n        }), \"\\n        }\\n        result\\n    end\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"expect\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Each event has good _index\\\"\"\n        }), \") \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" |events|  \\n        result = \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"true\"\n        }), \"\\n        result \u0026= events[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"].\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[@metadata][_index]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"prizes-original\\\"\"\n        }), \"\\n        result \u0026= events[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"].\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[@metadata][_index]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"prizes-denormalized\\\"\"\n        }), \"\\n        result \u0026= events[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"2\"\n        }), \"].\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[@metadata][_index]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"prizes-denormalized\\\"\"\n        }), \"\\n        result\\n    end\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"expect\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Each event has good prize fields\\\"\"\n        }), \") \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" |events| \\n        result = \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"true\"\n        }), \" \\n        result \u0026= events[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"].\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[prize][0][year]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1903\"\n        }), \"\\n        result \u0026= events[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"].\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[prize][0][category]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"physics\\\"\"\n        }), \"\\n        result \u0026= events[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"].\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[prize][1][year]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1911\"\n        }), \"\\n        result \u0026= events[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"].\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[prize][1][category]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"chemistry\\\"\"\n        }), \"\\n        result \u0026= events[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"].\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[prize][year]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1903\"\n        }), \"\\n        result \u0026= events[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"].\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[prize][category]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"physics\\\"\"\n        }), \"\\n        result \u0026= events[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"2\"\n        }), \"].\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[prize][year]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1911\"\n        }), \"\\n        result \u0026= events[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"2\"\n        }), \"].\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"get\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"[prize][category]\\\"\"\n        }), \") == \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"chemistry\\\"\"\n        }), \"\\n        result\\n    end\\n\\nend\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"여러 개의 어설션을 갖는 \", _jsx(_components.code, {\n        children: \"expect\"\n      }), \" 메서드를 사용할 때는, \", _jsx(_components.code, {\n        children: \"\u0026\u0026\"\n      }), \" 또는 \", _jsx(_components.code, {\n        children: \"\u0026=\"\n      }), \" 연산자를 사용하여 어설션 결과를 결합하는데 문법에 주의하세요.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"우리의 테스트 케이스 구현이 준비되었어요. 모든 테스트 케이스는 Logstash 시작 시 실행되며 해당 파이프라인이 생성될 때 실행돼요. 실제로, Logstash는 Ruby 필터에 작성된 모든 테스트를 찾을 수 있어요. 그리고 Logstash 로그에서 모든 테스트 결과를 볼 수 있을 거예요.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"아래는 Markdown 형식으로 변경한 내용입니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/img/2024-05-23-HowtotestaRubyfilterinLogstash_0.png\",\n        alt: \"이미지1\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/img/2024-05-23-HowtotestaRubyfilterinLogstash_1.png\",\n        alt: \"이미지2\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"테스트가 실패한 경우, 테스트 케이스 이름 및 필요한 모든 정보(매개변수, 입력 이벤트, 결과)를 명확히 확인할 수 있습니다. 최소한 하나의 테스트가 실패하면 연결된 파이프라인은 시작되지 않습니다.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-23-HowtotestaRubyfilterinLogstash"},"buildId":"R1x9p1CQYDDJESXyLXKOK","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>