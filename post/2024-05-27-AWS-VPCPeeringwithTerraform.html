<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>테라폼으로 AWS-VPC 피어링하기 | ui-station</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://ui-station.github.io///post/2024-05-27-AWS-VPCPeeringwithTerraform" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="테라폼으로 AWS-VPC 피어링하기 | ui-station" data-gatsby-head="true"/><meta property="og:title" content="테라폼으로 AWS-VPC 피어링하기 | ui-station" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-27-AWS-VPCPeeringwithTerraform_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://ui-station.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://ui-station.github.io///post/2024-05-27-AWS-VPCPeeringwithTerraform" data-gatsby-head="true"/><meta name="twitter:title" content="테라폼으로 AWS-VPC 피어링하기 | ui-station" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-27-AWS-VPCPeeringwithTerraform_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | ui-station" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-27 17:35" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BHFR6GTH9P"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-BHFR6GTH9P');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/_next/static/chunks/348-d11c34b645b13f5b.js" defer=""></script><script src="/_next/static/chunks/162-4172e84c8e2aa747.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-4f7b40c1114f0d09.js" defer=""></script><script src="/_next/static/-dPCbnM2yhdKNgXe92VJV/_buildManifest.js" defer=""></script><script src="/_next/static/-dPCbnM2yhdKNgXe92VJV/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UI STATION</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">테라폼으로 AWS-VPC 피어링하기</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="테라폼으로 AWS-VPC 피어링하기" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UI STATION</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 27, 2024</span><span class="posts_reading_time__f7YPP">22<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-27-AWS-VPCPeeringwithTerraform&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p><img src="/assets/img/2024-05-27-AWS-VPCPeeringwithTerraform_0.png" alt="AWS VPC Peering with Terraform"></p>
<p>AWS에서 VPC는 무엇인가요?</p>
<p>AWS에서 VPC 피어링이란 무엇인가요?</p>
<p>Terraform은 무엇인가요?</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>이 글에서는 AWS에서 Terraform을 사용하여 VPC 피어링 프로세스를 자동화하는 단계를 살펴보겠습니다.</p>
<p>AWS에서 생성된 자원 목록</p>
<ul>
<li>EC2 (2대)</li>
<li>VPC (2개)</li>
<li>Internet Gateways (2개)</li>
<li>보안 그룹 (4개)</li>
<li>VPC 피어링 연결 (1개)</li>
<li>라우트 테이블 (2개)</li>
</ul>
<h1>프로젝트 구조</h1>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>terraform_project/
│
├── module/
│ ├── ec2/
│ │ ├── main.tf
│ │ ├── output.tf
│ │ └── variables.tf
│ ├── vpc/
│ │ ├── main.tf
│ │ ├── output.tf
│ │ └── variables.tf
│ └── ...
│
├── main.tf
├── variables.tf
└── variable.tfvars/
├── dev-env.tfvars
├── stage-env.tfvars
└── prod-env.tfvars</p>
<h2>단계 1: VPC를 위한 모듈 생성 및 가져오기</h2>
<p>modules/vpc-peering/main.tf</p>
<pre><code class="hljs language-js">terraform {
  required_providers {
    aws = {
      source                = <span class="hljs-string">"hashicorp/aws"</span>
      version               = <span class="hljs-string">"~> 5.0"</span>
      configuration_aliases = [aws.<span class="hljs-property">us_west</span>]
    }
  }
}

provider <span class="hljs-string">"aws"</span> {
  alias  = <span class="hljs-string">"us_west"</span>
  region = <span class="hljs-string">"us-west-1"</span>
}

resource <span class="hljs-string">"aws_vpc"</span> <span class="hljs-string">"main_vpc"</span> {
  cidr_block = <span class="hljs-keyword">var</span>.<span class="hljs-property">vpc_cidr</span>

  tags = {
    <span class="hljs-title class_">Name</span>       = <span class="hljs-keyword">var</span>.<span class="hljs-property">vpc_name</span>
    created_by = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
  }
}
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>지금, 프로젝트 루트의 main.tf 파일에 모듈을 가져오겠습니다.</p>
<pre><code class="hljs language-js">terraform {
  required_providers {
    aws = {
      source  = <span class="hljs-string">"hashicorp/aws"</span>
      version = <span class="hljs-string">"~> 5.0"</span>
    }
  }
}

provider <span class="hljs-string">"aws"</span> {
  region = <span class="hljs-string">"us-east-1"</span>
}

provider <span class="hljs-string">"aws"</span> {
  alias  = <span class="hljs-string">"us_west"</span>
  region = <span class="hljs-string">"us-west-1"</span>
}

<span class="hljs-variable language_">module</span> <span class="hljs-string">"vpc_A"</span> {
  source     = <span class="hljs-string">"./modules/vpc"</span>
  vpc_name   = <span class="hljs-keyword">var</span>.<span class="hljs-property">vpcs</span>[<span class="hljs-string">"vpc_A"</span>][<span class="hljs-string">"vpc_name"</span>]
  vpc_cidr   = <span class="hljs-keyword">var</span>.<span class="hljs-property">vpcs</span>[<span class="hljs-string">"vpc_A"</span>][<span class="hljs-string">"cidr_block"</span>]
  owner_name = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
}

<span class="hljs-variable language_">module</span> <span class="hljs-string">"vpc_B"</span> {
  source     = <span class="hljs-string">"./modules/vpc"</span>
  vpc_name   = <span class="hljs-keyword">var</span>.<span class="hljs-property">vpcs</span>[<span class="hljs-string">"vpc_B"</span>][<span class="hljs-string">"vpc_name"</span>]
  vpc_cidr   = <span class="hljs-keyword">var</span>.<span class="hljs-property">vpcs</span>[<span class="hljs-string">"vpc_B"</span>][<span class="hljs-string">"cidr_block"</span>]
  owner_name = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
  providers = {
    aws = aws.<span class="hljs-property">us_west</span>
  }
}
</code></pre>
<h2>Step 2: Subnets용 모듈을 만들어 import해보세요.</h2>
<p>modules/subnets/main.tf</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">terraform {
  required_providers {
    aws = {
      source  = <span class="hljs-string">"hashicorp/aws"</span>
      version = <span class="hljs-string">"~> 5.0"</span>
      # configuration_aliases = [aws.<span class="hljs-property">us_west</span>]
    }
  }
}

provider <span class="hljs-string">"aws"</span> {
  alias  = <span class="hljs-string">"us_west"</span>
  region = <span class="hljs-string">"us-west-1"</span>
}

resource <span class="hljs-string">"aws_subnet"</span> <span class="hljs-string">"main_subnet"</span> {
  vpc_id            = <span class="hljs-keyword">var</span>.<span class="hljs-property">vpc_id</span>
  cidr_block        = <span class="hljs-keyword">var</span>.<span class="hljs-property">subnet_cidr</span>
  availability_zone = <span class="hljs-keyword">var</span>.<span class="hljs-property">availability_zone</span>

  tags = {
    <span class="hljs-title class_">Name</span>       = <span class="hljs-keyword">var</span>.<span class="hljs-property">subnet_name</span>
    created_by = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
  }
}
</code></pre>
<p>이제 프로젝트 루트의 main.tf 파일에 모듈을 가져 오겠습니다.</p>
<pre><code class="hljs language-js"><span class="hljs-variable language_">module</span> <span class="hljs-string">"subnetsForvpc_A"</span> {
  for_each          = <span class="hljs-keyword">var</span>.<span class="hljs-property">subnetsForvpc_A</span>
  source            = <span class="hljs-string">"./modules/subnets"</span>
  vpc_id            = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_A</span>.<span class="hljs-property">vpc_id</span>
  subnet_cidr       = <span class="hljs-keyword">var</span>.<span class="hljs-property">subnetsForvpc_A</span>[each.<span class="hljs-property">key</span>][<span class="hljs-string">"subnet_cidr"</span>]
  subnet_name       = <span class="hljs-keyword">var</span>.<span class="hljs-property">subnetsForvpc_A</span>[each.<span class="hljs-property">key</span>][<span class="hljs-string">"subnet_name"</span>]
  availability_zone = <span class="hljs-keyword">var</span>.<span class="hljs-property">subnetsForvpc_A</span>[each.<span class="hljs-property">key</span>][<span class="hljs-string">"availability_zone"</span>]
  owner_name        = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
}

<span class="hljs-variable language_">module</span> <span class="hljs-string">"subnetsForvpc_B"</span> {
  for_each          = <span class="hljs-keyword">var</span>.<span class="hljs-property">subnetsForvpc_B</span>
  source            = <span class="hljs-string">"./modules/subnets"</span>
  vpc_id            = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_B</span>.<span class="hljs-property">vpc_id</span>
  subnet_cidr       = <span class="hljs-keyword">var</span>.<span class="hljs-property">subnetsForvpc_B</span>[each.<span class="hljs-property">key</span>][<span class="hljs-string">"subnet_cidr"</span>]
  subnet_name       = <span class="hljs-keyword">var</span>.<span class="hljs-property">subnetsForvpc_B</span>[each.<span class="hljs-property">key</span>][<span class="hljs-string">"subnet_name"</span>]
  availability_zone = <span class="hljs-keyword">var</span>.<span class="hljs-property">subnetsForvpc_B</span>[each.<span class="hljs-property">key</span>][<span class="hljs-string">"availability_zone"</span>]
  owner_name        = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
  providers = {
    aws = aws.<span class="hljs-property">us_west</span>
  }
}
</code></pre>
<h2>단계 3: 보안 그룹 모듈을 생성하고 가져 오기</h2>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>modules/security-groups/main.tf</p>
<pre><code class="hljs language-js">terraform {
  required_providers {
    aws = {
      source                = <span class="hljs-string">"hashicorp/aws"</span>
      version               = <span class="hljs-string">"~> 5.0"</span>
      configuration_aliases = [aws.<span class="hljs-property">us_west</span>]
    }
  }
}

provider <span class="hljs-string">"aws"</span> {
  alias  = <span class="hljs-string">"us_west"</span>
  region = <span class="hljs-string">"us-west-1"</span>
}

resource <span class="hljs-string">"aws_security_group"</span> <span class="hljs-string">"allow_ssh"</span> {
  name        = <span class="hljs-keyword">var</span>.<span class="hljs-property">sg_name</span>
  description = <span class="hljs-keyword">var</span>.<span class="hljs-property">sg_description</span>
  vpc_id      = <span class="hljs-keyword">var</span>.<span class="hljs-property">vpc_id</span>

  ingress {
    description = <span class="hljs-keyword">var</span>.<span class="hljs-property">ingress_description</span>
    from_port   = <span class="hljs-keyword">var</span>.<span class="hljs-property">ingress_from_port</span>
    to_port     = <span class="hljs-keyword">var</span>.<span class="hljs-property">ingress_to_port</span>
    protocol    = <span class="hljs-keyword">var</span>.<span class="hljs-property">ingress_protocol</span>
    cidr_blocks = <span class="hljs-keyword">var</span>.<span class="hljs-property">ingress_cidr_blocks</span>
  }

  egress {
    from_port   = <span class="hljs-string">"0"</span>
    to_port     = <span class="hljs-string">"0"</span>
    protocol    = <span class="hljs-string">"-1"</span>
    cidr_blocks = [<span class="hljs-string">"0.0.0.0/0"</span>]
  }

  tags = {
    <span class="hljs-title class_">Name</span>       = <span class="hljs-keyword">var</span>.<span class="hljs-property">sg_name</span>
    created_by = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
  }
}
</code></pre>
<p>보안 그룹을 위해, 저는 main.tf 파일에서 프로젝트 루트로 모듈을 두 번 가져왔습니다. 첫 번째 보안 그룹은 EC2로 SSH를 허용하고, 두 번째는 EC2에서 ICMP 패킷의 흐름을 허용합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-variable language_">module</span> <span class="hljs-string">"ssh_sg_vpcA"</span> {
  source              = <span class="hljs-string">"./modules/security-groups"</span>
  sg_name             = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"sg_name"</span>]
  sg_description      = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"sg_description"</span>]
  ingress_description = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"ingress_description"</span>]
  ingress_from_port   = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"ingress_from_port"</span>]
  ingress_to_port     = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"ingress_to_port"</span>]
  ingress_protocol    = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"ingress_protocol"</span>]
  ingress_cidr_blocks = <span class="hljs-keyword">var</span>.<span class="hljs-property">sg_cidr_blocks</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"ingress_cidr_blocks"</span>]
  owner_name          = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
  vpc_id              = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_A</span>.<span class="hljs-property">vpc_id</span>
}

<span class="hljs-variable language_">module</span> <span class="hljs-string">"ssh_sg_vpcB"</span> {
  source              = <span class="hljs-string">"./modules/security-groups"</span>
  sg_name             = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"sg_name"</span>]
  sg_description      = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"sg_description"</span>]
  ingress_description = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"ingress_description"</span>]
  ingress_from_port   = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"ingress_from_port"</span>]
  ingress_to_port     = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"ingress_to_port"</span>]
  ingress_protocol    = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"ingress_protocol"</span>]
  ingress_cidr_blocks = <span class="hljs-keyword">var</span>.<span class="hljs-property">sg_cidr_blocks</span>[<span class="hljs-string">"ssh_sg"</span>][<span class="hljs-string">"ingress_cidr_blocks"</span>]
  owner_name          = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
  vpc_id              = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_B</span>.<span class="hljs-property">vpc_id</span>
  providers = {
    aws = aws.<span class="hljs-property">us_west</span>
  }
}

<span class="hljs-variable language_">module</span> <span class="hljs-string">"icmp_sg_vpcA"</span> {
  source              = <span class="hljs-string">"./modules/security-groups"</span>
  sg_name             = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"sg_name"</span>]
  sg_description      = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"sg_description"</span>]
  ingress_description = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"ingress_description"</span>]
  ingress_from_port   = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"ingress_from_port"</span>]
  ingress_to_port     = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"ingress_to_port"</span>]
  ingress_protocol    = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"ingress_protocol"</span>]
  ingress_cidr_blocks = <span class="hljs-keyword">var</span>.<span class="hljs-property">sg_cidr_blocks</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"ingress_cidr_blocks_for_vpcA"</span>]
  owner_name          = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
  vpc_id              = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_A</span>.<span class="hljs-property">vpc_id</span>
}

<span class="hljs-variable language_">module</span> <span class="hljs-string">"icmp_sg_vpcB"</span> {
  source              = <span class="hljs-string">"./modules/security-groups"</span>
  sg_name             = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"sg_name"</span>]
  sg_description      = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"sg_description"</span>]
  ingress_description = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"ingress_description"</span>]
  ingress_from_port   = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"ingress_from_port"</span>]
  ingress_to_port     = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"ingress_to_port"</span>]
  ingress_protocol    = <span class="hljs-keyword">var</span>.<span class="hljs-property">sgs</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"ingress_protocol"</span>]
  ingress_cidr_blocks = <span class="hljs-keyword">var</span>.<span class="hljs-property">sg_cidr_blocks</span>[<span class="hljs-string">"icmp_sg"</span>][<span class="hljs-string">"ingress_cidr_blocks_for_vpcB"</span>]
  owner_name          = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
  vpc_id              = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_B</span>.<span class="hljs-property">vpc_id</span>
  providers = {
    aws = aws.<span class="hljs-property">us_west</span>
  }
}
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>단계 4: EC2를 위한 모듈 생성 및 가져오기</h2>
<p>modules/ec2/main.tf</p>
<pre><code class="hljs language-js">terraform {
  required_providers {
    aws = {
      source                = <span class="hljs-string">"hashicorp/aws"</span>
      version               = <span class="hljs-string">"~> 5.0"</span>
      configuration_aliases = [aws.<span class="hljs-property">us_west</span>]
    }
  }
}

provider <span class="hljs-string">"aws"</span> {
  alias  = <span class="hljs-string">"us_west"</span>
  region = <span class="hljs-string">"us-west-1"</span>
}

resource <span class="hljs-string">"aws_instance"</span> <span class="hljs-string">"my_ec2"</span> {

  ami                         = <span class="hljs-keyword">var</span>.<span class="hljs-property">ami_id</span>
  instance_type               = <span class="hljs-keyword">var</span>.<span class="hljs-property">instance_type</span>
  subnet_id                   = <span class="hljs-keyword">var</span>.<span class="hljs-property">subnet_id</span>
  associate_public_ip_address = <span class="hljs-literal">true</span>
  key_name                    = <span class="hljs-keyword">var</span>.<span class="hljs-property">key_name</span>

  tags = {
    <span class="hljs-title class_">Name</span>       = <span class="hljs-keyword">var</span>.<span class="hljs-property">ec2_name</span>
    created_by = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
  }
}

resource <span class="hljs-string">"aws_network_interface_sg_attachment"</span> <span class="hljs-string">"ssh_sg_attachment"</span> {
  security_group_id    = <span class="hljs-keyword">var</span>.<span class="hljs-property">ssh_sg_id</span>
  network_interface_id = aws_instance.<span class="hljs-property">my_ec2</span>.<span class="hljs-property">primary_network_interface_id</span>
}

resource <span class="hljs-string">"aws_network_interface_sg_attachment"</span> <span class="hljs-string">"icmp_sg_attachment"</span> {
  security_group_id    = <span class="hljs-keyword">var</span>.<span class="hljs-property">icmp_sg_id</span>
  network_interface_id = aws_instance.<span class="hljs-property">my_ec2</span>.<span class="hljs-property">primary_network_interface_id</span>
}
</code></pre>
<p>이제 모듈을 프로젝트 루트의 main.tf 파일에 가져오겠습니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>module "ec2_vpcA" {
source = "./modules/ec2"
subnet_id = module.subnetsForvpc_A["subnet1"].subnet_id
ami_id = var.ec2s["ec2_vpcA"]["ami_id"]
instance_type = var.ec2s["ec2_vpcA"]["instance_type"]
ec2_name = var.ec2s["ec2_vpcA"]["ec2_name"]
key_name = var.ec2s["ec2_vpcA"]["key_name"]
ssh_sg_id = module.ssh_sg_vpcA.sg_id
icmp_sg_id = module.icmp_sg_vpcA.sg_id
owner_name = var.owner_name
}</p>
<p>module "ec2_vpcB" {
source = "./modules/ec2"
subnet_id = module.subnetsForvpc_B["subnet1"].subnet_id
ami_id = var.ec2s["ec2_vpcB"]["ami_id"]
instance_type = var.ec2s["ec2_vpcB"]["instance_type"]
ec2_name = var.ec2s["ec2_vpcB"]["ec2_name"]
key_name = var.ec2s["ec2_vpcB"]["key_name"]
ssh_sg_id = module.ssh_sg_vpcB.sg_id
icmp_sg_id = module.icmp_sg_vpcB.sg_id
owner_name = var.owner_name
providers = {
aws = aws.us_west
}
}</p>
<h2>Step 5: Create modules for Internet Gateways and importing them</h2>
<p>modules/internet-gateways/main.tf</p>
<p>terraform {
required_providers {
aws = {
source = "hashicorp/aws"
version = "~> 5.0"
configuration_aliases = [aws.us_west]
}
}
}</p>
<p>provider "aws" {
alias = "us_west"
region = "us-west-1"
}</p>
<p>resource "aws_internet_gateway" "i_gw" {
vpc_id = var.vpc_id</p>
<p>tags = {
Name = var.igw_name
created_by = var.owner_name
}
}</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>이제, 프로젝트 루트의 main.tf 파일에 모듈을 가져오겠습니다.</p>
<pre><code class="hljs language-js"><span class="hljs-variable language_">module</span> <span class="hljs-string">"igw_vpcA"</span> {
  source     = <span class="hljs-string">"./modules/internet-gateways"</span>
  vpc_id     = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_A</span>.<span class="hljs-property">vpc_id</span>
  igw_name   = <span class="hljs-keyword">var</span>.<span class="hljs-property">igws</span>[<span class="hljs-string">"igw_vpcA"</span>][<span class="hljs-string">"name"</span>]
  owner_name = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
}

<span class="hljs-variable language_">module</span> <span class="hljs-string">"igw_vpcB"</span> {
  source     = <span class="hljs-string">"./modules/internet-gateways"</span>
  vpc_id     = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_B</span>.<span class="hljs-property">vpc_id</span>
  igw_name   = <span class="hljs-keyword">var</span>.<span class="hljs-property">igws</span>[<span class="hljs-string">"igw_vpcB"</span>][<span class="hljs-string">"name"</span>]
  owner_name = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
  providers = {
    aws = aws.<span class="hljs-property">us_west</span>
  }
}
</code></pre>
<h2>단계 6: VPC Peering, VPC Peering accepter, VPC Peering configure용 모듈 생성 및 가져오기</h2>
<p>모듈 - VPC Peering (modules/vpc-peering/main.tf)</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-kotlin">테라폼 {
  필수_제공자 {
    aws = {
      소스 = <span class="hljs-string">"hashicorp/aws"</span>
      버전 = <span class="hljs-string">"~> 5.0"</span>
      구성_별칭 = [aws.us_west]
    }
  }
}

제공자 <span class="hljs-string">"aws"</span> {
  별칭  = <span class="hljs-string">"us_west"</span>
  지역 = <span class="hljs-string">"us-west-1"</span>
}

리소스 <span class="hljs-string">"aws_vpc_peering_connection"</span> <span class="hljs-string">"vpc_peering"</span> {
  peer_vpc_id = <span class="hljs-keyword">var</span>.peer_vpc_id
  vpc_id      = <span class="hljs-keyword">var</span>.vpc_id
  peer_region = <span class="hljs-string">"us-west-1"</span>
  tags = {
    이름       = <span class="hljs-keyword">var</span>.vpcpeer_name
    생성자 = <span class="hljs-keyword">var</span>.owner_name
  }
}
</code></pre>
<p>모듈 — VPC 피어링 수락자 (modules/vpc-peering-accepter/main.tf)</p>
<pre><code class="hljs language-kotlin">테라폼 {
  필수_제공자 {
    aws = {
      소스 = <span class="hljs-string">"hashicorp/aws"</span>
      버전 = <span class="hljs-string">"~> 5.0"</span>
      구성_별칭 = [aws.us_west]
    }
  }
}

제공자 <span class="hljs-string">"aws"</span> {
  별칭  = <span class="hljs-string">"us_west"</span>
  지역 = <span class="hljs-string">"us-west-1"</span>
}

리소스 <span class="hljs-string">"aws_vpc_peering_connection_accepter"</span> <span class="hljs-string">"peer_vpc_AB"</span> {
  provider = aws.us_west

  vpc_peering_connection_id = <span class="hljs-keyword">var</span>.vpc_peering_id
  auto_accept               = <span class="hljs-literal">true</span>

  tags = {
    쪽       = <span class="hljs-string">"수락자"</span>
    소유자_이름 = <span class="hljs-keyword">var</span>.owner_name
  }
}
</code></pre>
<p>모듈 — VPC 피어링 구성 (modules/vpc-peering-configure/main.tf)</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">terraform {
  required_providers {
    aws = {
      source                = <span class="hljs-string">"hashicorp/aws"</span>
      version               = <span class="hljs-string">"~> 5.0"</span>
      configuration_aliases = [aws.<span class="hljs-property">us_west</span>]
    }
  }
}

provider <span class="hljs-string">"aws"</span> {
  alias  = <span class="hljs-string">"us_west"</span>
  region = <span class="hljs-string">"us-west-1"</span>
}

resource <span class="hljs-string">"aws_vpc_peering_connection_options"</span> <span class="hljs-string">"vpc_peering_configure"</span> {
  vpc_peering_connection_id = <span class="hljs-keyword">var</span>.<span class="hljs-property">vpc_peering_connection_id</span>
}
</code></pre>
<p>이제, 위의 모든 모듈을 루트의 main.tf 파일로 가져오겠습니다.</p>
<pre><code class="hljs language-js"><span class="hljs-variable language_">module</span> <span class="hljs-string">"vpc_peering"</span> {
  source       = <span class="hljs-string">"./modules/vpc-peering"</span>
  peer_vpc_id  = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_B</span>.<span class="hljs-property">vpc_id</span>
  vpc_id       = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_A</span>.<span class="hljs-property">vpc_id</span>
  vpcpeer_name = <span class="hljs-keyword">var</span>.<span class="hljs-property">vpcpeer_name</span>
  owner_name   = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
}

<span class="hljs-variable language_">module</span> <span class="hljs-string">"vpc_peering_accepter"</span> {
  source         = <span class="hljs-string">"./modules/vpc-peering-accepter"</span>
  vpc_peering_id = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_peering</span>.<span class="hljs-property">aws_vpc_peering_connection_id</span>
  owner_name     = <span class="hljs-keyword">var</span>.<span class="hljs-property">owner_name</span>
  providers = {
    aws = aws.<span class="hljs-property">us_west</span>
  }
}

<span class="hljs-variable language_">module</span> <span class="hljs-string">"vpc_peering_configureA"</span> {
  source                    = <span class="hljs-string">"./modules/vpc_peer_configure"</span>
  vpc_peering_connection_id = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_peering_accepter</span>.<span class="hljs-property">aws_vpc_peering_connection_accepter</span>
}

<span class="hljs-variable language_">module</span> <span class="hljs-string">"vpc_peering_configureB"</span> {
  source                    = <span class="hljs-string">"./modules/vpc_peer_configure"</span>
  vpc_peering_connection_id = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_peering_accepter</span>.<span class="hljs-property">aws_vpc_peering_connection_accepter</span>
  providers = {
    aws = aws.<span class="hljs-property">us_west</span>
  }
}
</code></pre>
<h2>단계 7: 라우트 테이블을 위한 모듈 만들기 및 가져오기</h2>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>modules/route-tables/main.tf</p>
<pre><code class="hljs language-js">terraform {
  required_providers {
    aws = {
      source                = <span class="hljs-string">"hashicorp/aws"</span>
      version               = <span class="hljs-string">"~> 5.0"</span>
      configuration_aliases = [aws.<span class="hljs-property">us_west</span>]
    }
  }
}

provider <span class="hljs-string">"aws"</span> {
  alias  = <span class="hljs-string">"us_west"</span>
  region = <span class="hljs-string">"us-west-1"</span>
}

resource <span class="hljs-string">"aws_route"</span> <span class="hljs-string">"route"</span> {
  route_table_id            = <span class="hljs-keyword">var</span>.<span class="hljs-property">route_table_id</span>
  destination_cidr_block    = <span class="hljs-keyword">var</span>.<span class="hljs-property">destination_cidr_block</span>
  gateway_id                = <span class="hljs-keyword">var</span>.<span class="hljs-property">gateway_id</span> != <span class="hljs-string">""</span> ? <span class="hljs-keyword">var</span>.<span class="hljs-property">gateway_id</span> : <span class="hljs-literal">null</span>
  vpc_peering_connection_id = <span class="hljs-keyword">var</span>.<span class="hljs-property">vpc_peering_connection_id</span> != <span class="hljs-string">""</span> ? <span class="hljs-keyword">var</span>.<span class="hljs-property">vpc_peering_connection_id</span> : <span class="hljs-literal">null</span>
}
</code></pre>
<p>이제 프로젝트 루트의 main.tf 파일에 모듈을 가져와보겠습니다.</p>
<pre><code class="hljs language-js"><span class="hljs-variable language_">module</span> <span class="hljs-string">"route_table_vpcA_pcgw"</span> {
  source                    = <span class="hljs-string">"./modules/route-table"</span>
  route_table_id            = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_A</span>.<span class="hljs-property">default_route_table_id</span>
  destination_cidr_block    = <span class="hljs-keyword">var</span>.<span class="hljs-property">destination_cidr_blocks_for_routetable</span>[<span class="hljs-string">"for_route_vpcA"</span>][<span class="hljs-string">"pcgw_cidr"</span>]
  vpc_peering_connection_id = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_peering</span>.<span class="hljs-property">aws_vpc_peering_connection_id</span>
  gateway_id                = <span class="hljs-string">""</span>
}

<span class="hljs-variable language_">module</span> <span class="hljs-string">"route_table_vpcB_pcgw"</span> {
  source                    = <span class="hljs-string">"./modules/route-table"</span>
  route_table_id            = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_B</span>.<span class="hljs-property">default_route_table_id</span>
  destination_cidr_block    = <span class="hljs-keyword">var</span>.<span class="hljs-property">destination_cidr_blocks_for_routetable</span>[<span class="hljs-string">"for_route_vpcB"</span>][<span class="hljs-string">"pcgw_cidr"</span>]
  vpc_peering_connection_id = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_peering</span>.<span class="hljs-property">aws_vpc_peering_connection_id</span>
  gateway_id                = <span class="hljs-string">""</span>
  providers = {
    aws = aws.<span class="hljs-property">us_west</span>
  }
}

<span class="hljs-variable language_">module</span> <span class="hljs-string">"route_table_vpcA_igw"</span> {
  source                    = <span class="hljs-string">"./modules/route-table"</span>
  route_table_id            = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_A</span>.<span class="hljs-property">default_route_table_id</span>
  destination_cidr_block    = <span class="hljs-keyword">var</span>.<span class="hljs-property">destination_cidr_blocks_for_routetable</span>[<span class="hljs-string">"for_route_vpcA"</span>][<span class="hljs-string">"igw_cidr"</span>]
  gateway_id                = <span class="hljs-variable language_">module</span>.<span class="hljs-property">igw_vpcA</span>.<span class="hljs-property">igw_id</span>
  vpc_peering_connection_id = <span class="hljs-string">""</span>
}

<span class="hljs-variable language_">module</span> <span class="hljs-string">"route_table_vpcB_igw"</span> {
  source                    = <span class="hljs-string">"./modules/route-table"</span>
  route_table_id            = <span class="hljs-variable language_">module</span>.<span class="hljs-property">vpc_B</span>.<span class="hljs-property">default_route_table_id</span>
  destination_cidr_block    = <span class="hljs-keyword">var</span>.<span class="hljs-property">destination_cidr_blocks_for_routetable</span>[<span class="hljs-string">"for_route_vpcB"</span>][<span class="hljs-string">"igw_cidr"</span>]
  gateway_id                = <span class="hljs-variable language_">module</span>.<span class="hljs-property">igw_vpcB</span>.<span class="hljs-property">igw_id</span>
  vpc_peering_connection_id = <span class="hljs-string">""</span>
  providers = {
    aws = aws.<span class="hljs-property">us_west</span>
  }
}
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2>단계 8: dev-env.tfvars 파일 작성</h2>
<p>variable.tfvars/dev-env.tfvars</p>
<pre><code class="hljs language-js">owner_name = <span class="hljs-string">"NIKUNJ"</span>

vpcs = {
  <span class="hljs-string">"vpc_A"</span> = {
    vpc_name   = <span class="hljs-string">"vpc-us-east1"</span>
    cidr_block = <span class="hljs-string">"10.1.0.0/16"</span>
  }
  <span class="hljs-string">"vpc_B"</span> = {
    vpc_name   = <span class="hljs-string">"vpc-us-west1"</span>
    cidr_block = <span class="hljs-string">"10.2.0.0/16"</span>
  }
}

vpc_A에 대한 서브넷 목록 = {
  <span class="hljs-string">"subnet1"</span> = {
    subnet_cidr       = <span class="hljs-string">"10.1.0.0/20"</span>
    subnet_name       = <span class="hljs-string">"subnet-us-east1a"</span>
    availability_zone = <span class="hljs-string">"us-east-1a"</span>
  }
  <span class="hljs-string">"subnet2"</span> = {
    subnet_cidr       = <span class="hljs-string">"10.1.16.0/20"</span>
    subnet_name       = <span class="hljs-string">"subnet-us-east1b"</span>
    availability_zone = <span class="hljs-string">"us-east-1b"</span>
  }
  <span class="hljs-string">"subnet3"</span> = {
    subnet_cidr       = <span class="hljs-string">"10.1.32.0/20"</span>
    subnet_name       = <span class="hljs-string">"subnet-us-east1c"</span>
    availability_zone = <span class="hljs-string">"us-east-1c"</span>
  }
}

vpc_B에 대한 서브넷 목록 = {
  <span class="hljs-string">"subnet1"</span> = {
    subnet_cidr       = <span class="hljs-string">"10.2.0.0/20"</span>
    subnet_name       = <span class="hljs-string">"subnet-us-west1a"</span>
    availability_zone = <span class="hljs-string">"us-west-1a"</span>
  }
  <span class="hljs-string">"subnet2"</span> = {
    subnet_cidr       = <span class="hljs-string">"10.2.16.0/20"</span>
    subnet_name       = <span class="hljs-string">"subnet-us-west1b"</span>
    availability_zone = <span class="hljs-string">"us-west-1b"</span>
  }
}

보안 그룹 목록 = {
  <span class="hljs-string">"ssh_sg"</span> = {
    sg_name             = <span class="hljs-string">"allow_ssh"</span>
    sg_description      = <span class="hljs-string">"내 IP에서 SSH 허용"</span>
    ingress_description = <span class="hljs-string">"내 IP를 위한 SSH"</span>
    ingress_from_port   = <span class="hljs-string">"22"</span>
    ingress_to_port     = <span class="hljs-string">"22"</span>
    ingress_protocol    = <span class="hljs-string">"tcp"</span>
  }
  <span class="hljs-string">"icmp_sg"</span> = {
    sg_name             = <span class="hljs-string">"allow_ping_traffic"</span>
    sg_description      = <span class="hljs-string">"내 IP에서 ping 허용"</span>
    ingress_description = <span class="hljs-string">"내 IP로부터의 ping"</span>
    ingress_from_port   = <span class="hljs-string">"8"</span>
    ingress_to_port     = <span class="hljs-string">"0"</span>
    ingress_protocol    = <span class="hljs-string">"icmp"</span>
  }
}

sg_cidr_blocks = {
  <span class="hljs-string">"ssh_sg"</span> = {
    ingress_cidr_blocks = [<span class="hljs-string">"12.34.56.78/32"</span>] # ec2로의 <span class="hljs-variable constant_">SSH</span>가 허용된 <span class="hljs-variable constant_">IP</span>를 언급
  }
  <span class="hljs-string">"icmp_sg"</span> = {
    ingress_cidr_blocks_for_vpcA = [<span class="hljs-string">"10.2.0.0/16"</span>]
    ingress_cidr_blocks_for_vpcB = [<span class="hljs-string">"10.1.0.0/16"</span>]
  }
}

ec2 목록 = {
  <span class="hljs-string">"ec2_vpcA"</span> = {
    ami_id        = <span class="hljs-string">"ami-0e8a34246278c21e4"</span>
    instance_type = <span class="hljs-string">"t2.micro"</span>
    ec2_name      = <span class="hljs-string">"ec2-us-east1"</span>
    key_name      = <span class="hljs-string">"us-east-1-demo"</span>
  }
  <span class="hljs-string">"ec2_vpcB"</span> = {
    ami_id        = <span class="hljs-string">"ami-09ab9d570789dfdd4"</span>
    instance_type = <span class="hljs-string">"t2.micro"</span>
    ec2_name      = <span class="hljs-string">"ec2-us-west1"</span>
    key_name      = <span class="hljs-string">"us-west-1-demo"</span>
  }
}

인터넷 게이트웨이 목록 = {
  <span class="hljs-string">"igw_vpcA"</span> = {
    name = <span class="hljs-string">"igw_vpcA"</span>
  }
  <span class="hljs-string">"igw_vpcB"</span> = {
    name = <span class="hljs-string">"igw_vpcB"</span>
  }
}

<span class="hljs-variable constant_">VPC</span> 피어링 이름 = <span class="hljs-string">"vpc_AB_peering"</span>

route 테이블용 대상 <span class="hljs-variable constant_">CIDR</span> 블록 = {
  <span class="hljs-string">"for_route_vpcA"</span> = {
    pcgw_cidr = <span class="hljs-string">"10.2.0.0/16"</span>
    igw_cidr  = <span class="hljs-string">"0.0.0.0/0"</span>
  }
  <span class="hljs-string">"for_route_vpcB"</span> = {
    pcgw_cidr = <span class="hljs-string">"10.1.0.0/16"</span>
    igw_cidr  = <span class="hljs-string">"0.0.0.0/0"</span>
  }
}
</code></pre>
<h2>단계 9: 작업 디렉토리 초기화</h2>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>작업 디렉토리에서 terraform init 명령을 실행하세요. 이 명령은 필요한 모든 공급자 및 모듈을 다운로드하고 백엔드를 초기화합니다.</li>
</ul>
<h2>단계 10: 테라폼 실행 계획 생성</h2>
<ul>
<li>작업 디렉토리에서 terraform plan 명령을 실행하세요. 실행 계획을 제공합니다.</li>
</ul>
<h2>단계 11: terraform apply 실행</h2>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>작업 디렉토리에서 terraform apply 명령을 실행하면 AWS에 필요한 모든 리소스가 생성됩니다.</li>
</ul>
<h2>단계 12: 연결 확인</h2>
<ul>
<li>SSH를 사용하여 EC2 인스턴스 중 하나에 연결하고 다른 EC2 인스턴스의 사설 IP를 사용하여 핑을 보냅니다.</li>
<li>모든 것이 잘 되었다면 ICMP 데이터 패킷이 성공적으로 전송됩니다.</li>
</ul>
<p>여기까지입니다. 이제 Terraform을 사용하여 AWS VPC 피어링 연결을 생성하는 방법을 배웠습니다. 이제 여러분은 이것을 사용하고 필요에 따라 수정할 수 있습니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>전체 코드는 여기에서 찾을 수 있어요.</p>
<p>이 가이드가 도움이 되었다면 👏 버튼을 클릭해 주세요. 댓글도 자유롭게 남겨주세요.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"테라폼으로 AWS-VPC 피어링하기","description":"","date":"2024-05-27 17:35","slug":"2024-05-27-AWS-VPCPeeringwithTerraform","content":"\n![AWS VPC Peering with Terraform](/assets/img/2024-05-27-AWS-VPCPeeringwithTerraform_0.png)\n\nAWS에서 VPC는 무엇인가요?\n\nAWS에서 VPC 피어링이란 무엇인가요?\n\nTerraform은 무엇인가요?\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n이 글에서는 AWS에서 Terraform을 사용하여 VPC 피어링 프로세스를 자동화하는 단계를 살펴보겠습니다.\n\nAWS에서 생성된 자원 목록\n\n- EC2 (2대)\n- VPC (2개)\n- Internet Gateways (2개)\n- 보안 그룹 (4개)\n- VPC 피어링 연결 (1개)\n- 라우트 테이블 (2개)\n\n# 프로젝트 구조\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nterraform_project/\n│\n├── module/\n│ ├── ec2/\n│ │ ├── main.tf\n│ │ ├── output.tf\n│ │ └── variables.tf\n│ ├── vpc/\n│ │ ├── main.tf\n│ │ ├── output.tf\n│ │ └── variables.tf\n│ └── ...\n│\n├── main.tf\n├── variables.tf\n└── variable.tfvars/\n├── dev-env.tfvars\n├── stage-env.tfvars\n└── prod-env.tfvars\n\n## 단계 1: VPC를 위한 모듈 생성 및 가져오기\n\nmodules/vpc-peering/main.tf\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source                = \"hashicorp/aws\"\n      version               = \"~\u003e 5.0\"\n      configuration_aliases = [aws.us_west]\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nresource \"aws_vpc\" \"main_vpc\" {\n  cidr_block = var.vpc_cidr\n\n  tags = {\n    Name       = var.vpc_name\n    created_by = var.owner_name\n  }\n}\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n지금, 프로젝트 루트의 main.tf 파일에 모듈을 가져오겠습니다.\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~\u003e 5.0\"\n    }\n  }\n}\n\nprovider \"aws\" {\n  region = \"us-east-1\"\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nmodule \"vpc_A\" {\n  source     = \"./modules/vpc\"\n  vpc_name   = var.vpcs[\"vpc_A\"][\"vpc_name\"]\n  vpc_cidr   = var.vpcs[\"vpc_A\"][\"cidr_block\"]\n  owner_name = var.owner_name\n}\n\nmodule \"vpc_B\" {\n  source     = \"./modules/vpc\"\n  vpc_name   = var.vpcs[\"vpc_B\"][\"vpc_name\"]\n  vpc_cidr   = var.vpcs[\"vpc_B\"][\"cidr_block\"]\n  owner_name = var.owner_name\n  providers = {\n    aws = aws.us_west\n  }\n}\n```\n\n## Step 2: Subnets용 모듈을 만들어 import해보세요.\n\nmodules/subnets/main.tf\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~\u003e 5.0\"\n      # configuration_aliases = [aws.us_west]\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nresource \"aws_subnet\" \"main_subnet\" {\n  vpc_id            = var.vpc_id\n  cidr_block        = var.subnet_cidr\n  availability_zone = var.availability_zone\n\n  tags = {\n    Name       = var.subnet_name\n    created_by = var.owner_name\n  }\n}\n```\n\n이제 프로젝트 루트의 main.tf 파일에 모듈을 가져 오겠습니다.\n\n```js\nmodule \"subnetsForvpc_A\" {\n  for_each          = var.subnetsForvpc_A\n  source            = \"./modules/subnets\"\n  vpc_id            = module.vpc_A.vpc_id\n  subnet_cidr       = var.subnetsForvpc_A[each.key][\"subnet_cidr\"]\n  subnet_name       = var.subnetsForvpc_A[each.key][\"subnet_name\"]\n  availability_zone = var.subnetsForvpc_A[each.key][\"availability_zone\"]\n  owner_name        = var.owner_name\n}\n\nmodule \"subnetsForvpc_B\" {\n  for_each          = var.subnetsForvpc_B\n  source            = \"./modules/subnets\"\n  vpc_id            = module.vpc_B.vpc_id\n  subnet_cidr       = var.subnetsForvpc_B[each.key][\"subnet_cidr\"]\n  subnet_name       = var.subnetsForvpc_B[each.key][\"subnet_name\"]\n  availability_zone = var.subnetsForvpc_B[each.key][\"availability_zone\"]\n  owner_name        = var.owner_name\n  providers = {\n    aws = aws.us_west\n  }\n}\n```\n\n## 단계 3: 보안 그룹 모듈을 생성하고 가져 오기\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nmodules/security-groups/main.tf\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source                = \"hashicorp/aws\"\n      version               = \"~\u003e 5.0\"\n      configuration_aliases = [aws.us_west]\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nresource \"aws_security_group\" \"allow_ssh\" {\n  name        = var.sg_name\n  description = var.sg_description\n  vpc_id      = var.vpc_id\n\n  ingress {\n    description = var.ingress_description\n    from_port   = var.ingress_from_port\n    to_port     = var.ingress_to_port\n    protocol    = var.ingress_protocol\n    cidr_blocks = var.ingress_cidr_blocks\n  }\n\n  egress {\n    from_port   = \"0\"\n    to_port     = \"0\"\n    protocol    = \"-1\"\n    cidr_blocks = [\"0.0.0.0/0\"]\n  }\n\n  tags = {\n    Name       = var.sg_name\n    created_by = var.owner_name\n  }\n}\n```\n\n보안 그룹을 위해, 저는 main.tf 파일에서 프로젝트 루트로 모듈을 두 번 가져왔습니다. 첫 번째 보안 그룹은 EC2로 SSH를 허용하고, 두 번째는 EC2에서 ICMP 패킷의 흐름을 허용합니다.\n\n```js\nmodule \"ssh_sg_vpcA\" {\n  source              = \"./modules/security-groups\"\n  sg_name             = var.sgs[\"ssh_sg\"][\"sg_name\"]\n  sg_description      = var.sgs[\"ssh_sg\"][\"sg_description\"]\n  ingress_description = var.sgs[\"ssh_sg\"][\"ingress_description\"]\n  ingress_from_port   = var.sgs[\"ssh_sg\"][\"ingress_from_port\"]\n  ingress_to_port     = var.sgs[\"ssh_sg\"][\"ingress_to_port\"]\n  ingress_protocol    = var.sgs[\"ssh_sg\"][\"ingress_protocol\"]\n  ingress_cidr_blocks = var.sg_cidr_blocks[\"ssh_sg\"][\"ingress_cidr_blocks\"]\n  owner_name          = var.owner_name\n  vpc_id              = module.vpc_A.vpc_id\n}\n\nmodule \"ssh_sg_vpcB\" {\n  source              = \"./modules/security-groups\"\n  sg_name             = var.sgs[\"ssh_sg\"][\"sg_name\"]\n  sg_description      = var.sgs[\"ssh_sg\"][\"sg_description\"]\n  ingress_description = var.sgs[\"ssh_sg\"][\"ingress_description\"]\n  ingress_from_port   = var.sgs[\"ssh_sg\"][\"ingress_from_port\"]\n  ingress_to_port     = var.sgs[\"ssh_sg\"][\"ingress_to_port\"]\n  ingress_protocol    = var.sgs[\"ssh_sg\"][\"ingress_protocol\"]\n  ingress_cidr_blocks = var.sg_cidr_blocks[\"ssh_sg\"][\"ingress_cidr_blocks\"]\n  owner_name          = var.owner_name\n  vpc_id              = module.vpc_B.vpc_id\n  providers = {\n    aws = aws.us_west\n  }\n}\n\nmodule \"icmp_sg_vpcA\" {\n  source              = \"./modules/security-groups\"\n  sg_name             = var.sgs[\"icmp_sg\"][\"sg_name\"]\n  sg_description      = var.sgs[\"icmp_sg\"][\"sg_description\"]\n  ingress_description = var.sgs[\"icmp_sg\"][\"ingress_description\"]\n  ingress_from_port   = var.sgs[\"icmp_sg\"][\"ingress_from_port\"]\n  ingress_to_port     = var.sgs[\"icmp_sg\"][\"ingress_to_port\"]\n  ingress_protocol    = var.sgs[\"icmp_sg\"][\"ingress_protocol\"]\n  ingress_cidr_blocks = var.sg_cidr_blocks[\"icmp_sg\"][\"ingress_cidr_blocks_for_vpcA\"]\n  owner_name          = var.owner_name\n  vpc_id              = module.vpc_A.vpc_id\n}\n\nmodule \"icmp_sg_vpcB\" {\n  source              = \"./modules/security-groups\"\n  sg_name             = var.sgs[\"icmp_sg\"][\"sg_name\"]\n  sg_description      = var.sgs[\"icmp_sg\"][\"sg_description\"]\n  ingress_description = var.sgs[\"icmp_sg\"][\"ingress_description\"]\n  ingress_from_port   = var.sgs[\"icmp_sg\"][\"ingress_from_port\"]\n  ingress_to_port     = var.sgs[\"icmp_sg\"][\"ingress_to_port\"]\n  ingress_protocol    = var.sgs[\"icmp_sg\"][\"ingress_protocol\"]\n  ingress_cidr_blocks = var.sg_cidr_blocks[\"icmp_sg\"][\"ingress_cidr_blocks_for_vpcB\"]\n  owner_name          = var.owner_name\n  vpc_id              = module.vpc_B.vpc_id\n  providers = {\n    aws = aws.us_west\n  }\n}\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 단계 4: EC2를 위한 모듈 생성 및 가져오기\n\nmodules/ec2/main.tf\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source                = \"hashicorp/aws\"\n      version               = \"~\u003e 5.0\"\n      configuration_aliases = [aws.us_west]\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nresource \"aws_instance\" \"my_ec2\" {\n\n  ami                         = var.ami_id\n  instance_type               = var.instance_type\n  subnet_id                   = var.subnet_id\n  associate_public_ip_address = true\n  key_name                    = var.key_name\n\n  tags = {\n    Name       = var.ec2_name\n    created_by = var.owner_name\n  }\n}\n\nresource \"aws_network_interface_sg_attachment\" \"ssh_sg_attachment\" {\n  security_group_id    = var.ssh_sg_id\n  network_interface_id = aws_instance.my_ec2.primary_network_interface_id\n}\n\nresource \"aws_network_interface_sg_attachment\" \"icmp_sg_attachment\" {\n  security_group_id    = var.icmp_sg_id\n  network_interface_id = aws_instance.my_ec2.primary_network_interface_id\n}\n```\n\n이제 모듈을 프로젝트 루트의 main.tf 파일에 가져오겠습니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nmodule \"ec2_vpcA\" {\nsource = \"./modules/ec2\"\nsubnet_id = module.subnetsForvpc_A[\"subnet1\"].subnet_id\nami_id = var.ec2s[\"ec2_vpcA\"][\"ami_id\"]\ninstance_type = var.ec2s[\"ec2_vpcA\"][\"instance_type\"]\nec2_name = var.ec2s[\"ec2_vpcA\"][\"ec2_name\"]\nkey_name = var.ec2s[\"ec2_vpcA\"][\"key_name\"]\nssh_sg_id = module.ssh_sg_vpcA.sg_id\nicmp_sg_id = module.icmp_sg_vpcA.sg_id\nowner_name = var.owner_name\n}\n\nmodule \"ec2_vpcB\" {\nsource = \"./modules/ec2\"\nsubnet_id = module.subnetsForvpc_B[\"subnet1\"].subnet_id\nami_id = var.ec2s[\"ec2_vpcB\"][\"ami_id\"]\ninstance_type = var.ec2s[\"ec2_vpcB\"][\"instance_type\"]\nec2_name = var.ec2s[\"ec2_vpcB\"][\"ec2_name\"]\nkey_name = var.ec2s[\"ec2_vpcB\"][\"key_name\"]\nssh_sg_id = module.ssh_sg_vpcB.sg_id\nicmp_sg_id = module.icmp_sg_vpcB.sg_id\nowner_name = var.owner_name\nproviders = {\naws = aws.us_west\n}\n}\n\n## Step 5: Create modules for Internet Gateways and importing them\n\nmodules/internet-gateways/main.tf\n\nterraform {\nrequired_providers {\naws = {\nsource = \"hashicorp/aws\"\nversion = \"~\u003e 5.0\"\nconfiguration_aliases = [aws.us_west]\n}\n}\n}\n\nprovider \"aws\" {\nalias = \"us_west\"\nregion = \"us-west-1\"\n}\n\nresource \"aws_internet_gateway\" \"i_gw\" {\nvpc_id = var.vpc_id\n\ntags = {\nName = var.igw_name\ncreated_by = var.owner_name\n}\n}\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n이제, 프로젝트 루트의 main.tf 파일에 모듈을 가져오겠습니다.\n\n```js\nmodule \"igw_vpcA\" {\n  source     = \"./modules/internet-gateways\"\n  vpc_id     = module.vpc_A.vpc_id\n  igw_name   = var.igws[\"igw_vpcA\"][\"name\"]\n  owner_name = var.owner_name\n}\n\nmodule \"igw_vpcB\" {\n  source     = \"./modules/internet-gateways\"\n  vpc_id     = module.vpc_B.vpc_id\n  igw_name   = var.igws[\"igw_vpcB\"][\"name\"]\n  owner_name = var.owner_name\n  providers = {\n    aws = aws.us_west\n  }\n}\n```\n\n## 단계 6: VPC Peering, VPC Peering accepter, VPC Peering configure용 모듈 생성 및 가져오기\n\n모듈 - VPC Peering (modules/vpc-peering/main.tf)\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```kotlin\n테라폼 {\n  필수_제공자 {\n    aws = {\n      소스 = \"hashicorp/aws\"\n      버전 = \"~\u003e 5.0\"\n      구성_별칭 = [aws.us_west]\n    }\n  }\n}\n\n제공자 \"aws\" {\n  별칭  = \"us_west\"\n  지역 = \"us-west-1\"\n}\n\n리소스 \"aws_vpc_peering_connection\" \"vpc_peering\" {\n  peer_vpc_id = var.peer_vpc_id\n  vpc_id      = var.vpc_id\n  peer_region = \"us-west-1\"\n  tags = {\n    이름       = var.vpcpeer_name\n    생성자 = var.owner_name\n  }\n}\n```\n\n모듈 — VPC 피어링 수락자 (modules/vpc-peering-accepter/main.tf)\n\n```kotlin\n테라폼 {\n  필수_제공자 {\n    aws = {\n      소스 = \"hashicorp/aws\"\n      버전 = \"~\u003e 5.0\"\n      구성_별칭 = [aws.us_west]\n    }\n  }\n}\n\n제공자 \"aws\" {\n  별칭  = \"us_west\"\n  지역 = \"us-west-1\"\n}\n\n리소스 \"aws_vpc_peering_connection_accepter\" \"peer_vpc_AB\" {\n  provider = aws.us_west\n\n  vpc_peering_connection_id = var.vpc_peering_id\n  auto_accept               = true\n\n  tags = {\n    쪽       = \"수락자\"\n    소유자_이름 = var.owner_name\n  }\n}\n```\n\n모듈 — VPC 피어링 구성 (modules/vpc-peering-configure/main.tf)\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source                = \"hashicorp/aws\"\n      version               = \"~\u003e 5.0\"\n      configuration_aliases = [aws.us_west]\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nresource \"aws_vpc_peering_connection_options\" \"vpc_peering_configure\" {\n  vpc_peering_connection_id = var.vpc_peering_connection_id\n}\n```\n\n이제, 위의 모든 모듈을 루트의 main.tf 파일로 가져오겠습니다.\n\n```js\nmodule \"vpc_peering\" {\n  source       = \"./modules/vpc-peering\"\n  peer_vpc_id  = module.vpc_B.vpc_id\n  vpc_id       = module.vpc_A.vpc_id\n  vpcpeer_name = var.vpcpeer_name\n  owner_name   = var.owner_name\n}\n\nmodule \"vpc_peering_accepter\" {\n  source         = \"./modules/vpc-peering-accepter\"\n  vpc_peering_id = module.vpc_peering.aws_vpc_peering_connection_id\n  owner_name     = var.owner_name\n  providers = {\n    aws = aws.us_west\n  }\n}\n\nmodule \"vpc_peering_configureA\" {\n  source                    = \"./modules/vpc_peer_configure\"\n  vpc_peering_connection_id = module.vpc_peering_accepter.aws_vpc_peering_connection_accepter\n}\n\nmodule \"vpc_peering_configureB\" {\n  source                    = \"./modules/vpc_peer_configure\"\n  vpc_peering_connection_id = module.vpc_peering_accepter.aws_vpc_peering_connection_accepter\n  providers = {\n    aws = aws.us_west\n  }\n}\n```\n\n## 단계 7: 라우트 테이블을 위한 모듈 만들기 및 가져오기\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nmodules/route-tables/main.tf\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source                = \"hashicorp/aws\"\n      version               = \"~\u003e 5.0\"\n      configuration_aliases = [aws.us_west]\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_west\"\n  region = \"us-west-1\"\n}\n\nresource \"aws_route\" \"route\" {\n  route_table_id            = var.route_table_id\n  destination_cidr_block    = var.destination_cidr_block\n  gateway_id                = var.gateway_id != \"\" ? var.gateway_id : null\n  vpc_peering_connection_id = var.vpc_peering_connection_id != \"\" ? var.vpc_peering_connection_id : null\n}\n```\n\n이제 프로젝트 루트의 main.tf 파일에 모듈을 가져와보겠습니다.\n\n```js\nmodule \"route_table_vpcA_pcgw\" {\n  source                    = \"./modules/route-table\"\n  route_table_id            = module.vpc_A.default_route_table_id\n  destination_cidr_block    = var.destination_cidr_blocks_for_routetable[\"for_route_vpcA\"][\"pcgw_cidr\"]\n  vpc_peering_connection_id = module.vpc_peering.aws_vpc_peering_connection_id\n  gateway_id                = \"\"\n}\n\nmodule \"route_table_vpcB_pcgw\" {\n  source                    = \"./modules/route-table\"\n  route_table_id            = module.vpc_B.default_route_table_id\n  destination_cidr_block    = var.destination_cidr_blocks_for_routetable[\"for_route_vpcB\"][\"pcgw_cidr\"]\n  vpc_peering_connection_id = module.vpc_peering.aws_vpc_peering_connection_id\n  gateway_id                = \"\"\n  providers = {\n    aws = aws.us_west\n  }\n}\n\nmodule \"route_table_vpcA_igw\" {\n  source                    = \"./modules/route-table\"\n  route_table_id            = module.vpc_A.default_route_table_id\n  destination_cidr_block    = var.destination_cidr_blocks_for_routetable[\"for_route_vpcA\"][\"igw_cidr\"]\n  gateway_id                = module.igw_vpcA.igw_id\n  vpc_peering_connection_id = \"\"\n}\n\nmodule \"route_table_vpcB_igw\" {\n  source                    = \"./modules/route-table\"\n  route_table_id            = module.vpc_B.default_route_table_id\n  destination_cidr_block    = var.destination_cidr_blocks_for_routetable[\"for_route_vpcB\"][\"igw_cidr\"]\n  gateway_id                = module.igw_vpcB.igw_id\n  vpc_peering_connection_id = \"\"\n  providers = {\n    aws = aws.us_west\n  }\n}\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## 단계 8: dev-env.tfvars 파일 작성\n\nvariable.tfvars/dev-env.tfvars\n\n```js\nowner_name = \"NIKUNJ\"\n\nvpcs = {\n  \"vpc_A\" = {\n    vpc_name   = \"vpc-us-east1\"\n    cidr_block = \"10.1.0.0/16\"\n  }\n  \"vpc_B\" = {\n    vpc_name   = \"vpc-us-west1\"\n    cidr_block = \"10.2.0.0/16\"\n  }\n}\n\nvpc_A에 대한 서브넷 목록 = {\n  \"subnet1\" = {\n    subnet_cidr       = \"10.1.0.0/20\"\n    subnet_name       = \"subnet-us-east1a\"\n    availability_zone = \"us-east-1a\"\n  }\n  \"subnet2\" = {\n    subnet_cidr       = \"10.1.16.0/20\"\n    subnet_name       = \"subnet-us-east1b\"\n    availability_zone = \"us-east-1b\"\n  }\n  \"subnet3\" = {\n    subnet_cidr       = \"10.1.32.0/20\"\n    subnet_name       = \"subnet-us-east1c\"\n    availability_zone = \"us-east-1c\"\n  }\n}\n\nvpc_B에 대한 서브넷 목록 = {\n  \"subnet1\" = {\n    subnet_cidr       = \"10.2.0.0/20\"\n    subnet_name       = \"subnet-us-west1a\"\n    availability_zone = \"us-west-1a\"\n  }\n  \"subnet2\" = {\n    subnet_cidr       = \"10.2.16.0/20\"\n    subnet_name       = \"subnet-us-west1b\"\n    availability_zone = \"us-west-1b\"\n  }\n}\n\n보안 그룹 목록 = {\n  \"ssh_sg\" = {\n    sg_name             = \"allow_ssh\"\n    sg_description      = \"내 IP에서 SSH 허용\"\n    ingress_description = \"내 IP를 위한 SSH\"\n    ingress_from_port   = \"22\"\n    ingress_to_port     = \"22\"\n    ingress_protocol    = \"tcp\"\n  }\n  \"icmp_sg\" = {\n    sg_name             = \"allow_ping_traffic\"\n    sg_description      = \"내 IP에서 ping 허용\"\n    ingress_description = \"내 IP로부터의 ping\"\n    ingress_from_port   = \"8\"\n    ingress_to_port     = \"0\"\n    ingress_protocol    = \"icmp\"\n  }\n}\n\nsg_cidr_blocks = {\n  \"ssh_sg\" = {\n    ingress_cidr_blocks = [\"12.34.56.78/32\"] # ec2로의 SSH가 허용된 IP를 언급\n  }\n  \"icmp_sg\" = {\n    ingress_cidr_blocks_for_vpcA = [\"10.2.0.0/16\"]\n    ingress_cidr_blocks_for_vpcB = [\"10.1.0.0/16\"]\n  }\n}\n\nec2 목록 = {\n  \"ec2_vpcA\" = {\n    ami_id        = \"ami-0e8a34246278c21e4\"\n    instance_type = \"t2.micro\"\n    ec2_name      = \"ec2-us-east1\"\n    key_name      = \"us-east-1-demo\"\n  }\n  \"ec2_vpcB\" = {\n    ami_id        = \"ami-09ab9d570789dfdd4\"\n    instance_type = \"t2.micro\"\n    ec2_name      = \"ec2-us-west1\"\n    key_name      = \"us-west-1-demo\"\n  }\n}\n\n인터넷 게이트웨이 목록 = {\n  \"igw_vpcA\" = {\n    name = \"igw_vpcA\"\n  }\n  \"igw_vpcB\" = {\n    name = \"igw_vpcB\"\n  }\n}\n\nVPC 피어링 이름 = \"vpc_AB_peering\"\n\nroute 테이블용 대상 CIDR 블록 = {\n  \"for_route_vpcA\" = {\n    pcgw_cidr = \"10.2.0.0/16\"\n    igw_cidr  = \"0.0.0.0/0\"\n  }\n  \"for_route_vpcB\" = {\n    pcgw_cidr = \"10.1.0.0/16\"\n    igw_cidr  = \"0.0.0.0/0\"\n  }\n}\n```\n\n## 단계 9: 작업 디렉토리 초기화\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 작업 디렉토리에서 terraform init 명령을 실행하세요. 이 명령은 필요한 모든 공급자 및 모듈을 다운로드하고 백엔드를 초기화합니다.\n\n## 단계 10: 테라폼 실행 계획 생성\n\n- 작업 디렉토리에서 terraform plan 명령을 실행하세요. 실행 계획을 제공합니다.\n\n## 단계 11: terraform apply 실행\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 작업 디렉토리에서 terraform apply 명령을 실행하면 AWS에 필요한 모든 리소스가 생성됩니다.\n\n## 단계 12: 연결 확인\n\n- SSH를 사용하여 EC2 인스턴스 중 하나에 연결하고 다른 EC2 인스턴스의 사설 IP를 사용하여 핑을 보냅니다.\n- 모든 것이 잘 되었다면 ICMP 데이터 패킷이 성공적으로 전송됩니다.\n\n여기까지입니다. 이제 Terraform을 사용하여 AWS VPC 피어링 연결을 생성하는 방법을 배웠습니다. 이제 여러분은 이것을 사용하고 필요에 따라 수정할 수 있습니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n전체 코드는 여기에서 찾을 수 있어요.\n\n이 가이드가 도움이 되었다면 👏 버튼을 클릭해 주세요. 댓글도 자유롭게 남겨주세요.\n","ogImage":{"url":"/assets/img/2024-05-27-AWS-VPCPeeringwithTerraform_0.png"},"coverImage":"/assets/img/2024-05-27-AWS-VPCPeeringwithTerraform_0.png","tag":["Tech"],"readingTime":22},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-05-27-AWS-VPCPeeringwithTerraform_0.png\" alt=\"AWS VPC Peering with Terraform\"\u003e\u003c/p\u003e\n\u003cp\u003eAWS에서 VPC는 무엇인가요?\u003c/p\u003e\n\u003cp\u003eAWS에서 VPC 피어링이란 무엇인가요?\u003c/p\u003e\n\u003cp\u003eTerraform은 무엇인가요?\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e이 글에서는 AWS에서 Terraform을 사용하여 VPC 피어링 프로세스를 자동화하는 단계를 살펴보겠습니다.\u003c/p\u003e\n\u003cp\u003eAWS에서 생성된 자원 목록\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eEC2 (2대)\u003c/li\u003e\n\u003cli\u003eVPC (2개)\u003c/li\u003e\n\u003cli\u003eInternet Gateways (2개)\u003c/li\u003e\n\u003cli\u003e보안 그룹 (4개)\u003c/li\u003e\n\u003cli\u003eVPC 피어링 연결 (1개)\u003c/li\u003e\n\u003cli\u003e라우트 테이블 (2개)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003e프로젝트 구조\u003c/h1\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eterraform_project/\n│\n├── module/\n│ ├── ec2/\n│ │ ├── main.tf\n│ │ ├── output.tf\n│ │ └── variables.tf\n│ ├── vpc/\n│ │ ├── main.tf\n│ │ ├── output.tf\n│ │ └── variables.tf\n│ └── ...\n│\n├── main.tf\n├── variables.tf\n└── variable.tfvars/\n├── dev-env.tfvars\n├── stage-env.tfvars\n└── prod-env.tfvars\u003c/p\u003e\n\u003ch2\u003e단계 1: VPC를 위한 모듈 생성 및 가져오기\u003c/h2\u003e\n\u003cp\u003emodules/vpc-peering/main.tf\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eterraform {\n  required_providers {\n    aws = {\n      source                = \u003cspan class=\"hljs-string\"\u003e\"hashicorp/aws\"\u003c/span\u003e\n      version               = \u003cspan class=\"hljs-string\"\u003e\"~\u003e 5.0\"\u003c/span\u003e\n      configuration_aliases = [aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e]\n    }\n  }\n}\n\nprovider \u003cspan class=\"hljs-string\"\u003e\"aws\"\u003c/span\u003e {\n  alias  = \u003cspan class=\"hljs-string\"\u003e\"us_west\"\u003c/span\u003e\n  region = \u003cspan class=\"hljs-string\"\u003e\"us-west-1\"\u003c/span\u003e\n}\n\nresource \u003cspan class=\"hljs-string\"\u003e\"aws_vpc\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"main_vpc\"\u003c/span\u003e {\n  cidr_block = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_cidr\u003c/span\u003e\n\n  tags = {\n    \u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e       = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_name\u003c/span\u003e\n    created_by = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e지금, 프로젝트 루트의 main.tf 파일에 모듈을 가져오겠습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eterraform {\n  required_providers {\n    aws = {\n      source  = \u003cspan class=\"hljs-string\"\u003e\"hashicorp/aws\"\u003c/span\u003e\n      version = \u003cspan class=\"hljs-string\"\u003e\"~\u003e 5.0\"\u003c/span\u003e\n    }\n  }\n}\n\nprovider \u003cspan class=\"hljs-string\"\u003e\"aws\"\u003c/span\u003e {\n  region = \u003cspan class=\"hljs-string\"\u003e\"us-east-1\"\u003c/span\u003e\n}\n\nprovider \u003cspan class=\"hljs-string\"\u003e\"aws\"\u003c/span\u003e {\n  alias  = \u003cspan class=\"hljs-string\"\u003e\"us_west\"\u003c/span\u003e\n  region = \u003cspan class=\"hljs-string\"\u003e\"us-west-1\"\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"vpc_A\"\u003c/span\u003e {\n  source     = \u003cspan class=\"hljs-string\"\u003e\"./modules/vpc\"\u003c/span\u003e\n  vpc_name   = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpcs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"vpc_A\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"vpc_name\"\u003c/span\u003e]\n  vpc_cidr   = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpcs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"vpc_A\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"cidr_block\"\u003c/span\u003e]\n  owner_name = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"vpc_B\"\u003c/span\u003e {\n  source     = \u003cspan class=\"hljs-string\"\u003e\"./modules/vpc\"\u003c/span\u003e\n  vpc_name   = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpcs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"vpc_B\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"vpc_name\"\u003c/span\u003e]\n  vpc_cidr   = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpcs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"vpc_B\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"cidr_block\"\u003c/span\u003e]\n  owner_name = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n  providers = {\n    aws = aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eStep 2: Subnets용 모듈을 만들어 import해보세요.\u003c/h2\u003e\n\u003cp\u003emodules/subnets/main.tf\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eterraform {\n  required_providers {\n    aws = {\n      source  = \u003cspan class=\"hljs-string\"\u003e\"hashicorp/aws\"\u003c/span\u003e\n      version = \u003cspan class=\"hljs-string\"\u003e\"~\u003e 5.0\"\u003c/span\u003e\n      # configuration_aliases = [aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e]\n    }\n  }\n}\n\nprovider \u003cspan class=\"hljs-string\"\u003e\"aws\"\u003c/span\u003e {\n  alias  = \u003cspan class=\"hljs-string\"\u003e\"us_west\"\u003c/span\u003e\n  region = \u003cspan class=\"hljs-string\"\u003e\"us-west-1\"\u003c/span\u003e\n}\n\nresource \u003cspan class=\"hljs-string\"\u003e\"aws_subnet\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"main_subnet\"\u003c/span\u003e {\n  vpc_id            = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_id\u003c/span\u003e\n  cidr_block        = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esubnet_cidr\u003c/span\u003e\n  availability_zone = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eavailability_zone\u003c/span\u003e\n\n  tags = {\n    \u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e       = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esubnet_name\u003c/span\u003e\n    created_by = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이제 프로젝트 루트의 main.tf 파일에 모듈을 가져 오겠습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"subnetsForvpc_A\"\u003c/span\u003e {\n  for_each          = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esubnetsForvpc_A\u003c/span\u003e\n  source            = \u003cspan class=\"hljs-string\"\u003e\"./modules/subnets\"\u003c/span\u003e\n  vpc_id            = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_A\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_id\u003c/span\u003e\n  subnet_cidr       = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esubnetsForvpc_A\u003c/span\u003e[each.\u003cspan class=\"hljs-property\"\u003ekey\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"subnet_cidr\"\u003c/span\u003e]\n  subnet_name       = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esubnetsForvpc_A\u003c/span\u003e[each.\u003cspan class=\"hljs-property\"\u003ekey\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"subnet_name\"\u003c/span\u003e]\n  availability_zone = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esubnetsForvpc_A\u003c/span\u003e[each.\u003cspan class=\"hljs-property\"\u003ekey\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"availability_zone\"\u003c/span\u003e]\n  owner_name        = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"subnetsForvpc_B\"\u003c/span\u003e {\n  for_each          = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esubnetsForvpc_B\u003c/span\u003e\n  source            = \u003cspan class=\"hljs-string\"\u003e\"./modules/subnets\"\u003c/span\u003e\n  vpc_id            = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_B\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_id\u003c/span\u003e\n  subnet_cidr       = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esubnetsForvpc_B\u003c/span\u003e[each.\u003cspan class=\"hljs-property\"\u003ekey\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"subnet_cidr\"\u003c/span\u003e]\n  subnet_name       = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esubnetsForvpc_B\u003c/span\u003e[each.\u003cspan class=\"hljs-property\"\u003ekey\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"subnet_name\"\u003c/span\u003e]\n  availability_zone = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esubnetsForvpc_B\u003c/span\u003e[each.\u003cspan class=\"hljs-property\"\u003ekey\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"availability_zone\"\u003c/span\u003e]\n  owner_name        = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n  providers = {\n    aws = aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e단계 3: 보안 그룹 모듈을 생성하고 가져 오기\u003c/h2\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003emodules/security-groups/main.tf\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eterraform {\n  required_providers {\n    aws = {\n      source                = \u003cspan class=\"hljs-string\"\u003e\"hashicorp/aws\"\u003c/span\u003e\n      version               = \u003cspan class=\"hljs-string\"\u003e\"~\u003e 5.0\"\u003c/span\u003e\n      configuration_aliases = [aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e]\n    }\n  }\n}\n\nprovider \u003cspan class=\"hljs-string\"\u003e\"aws\"\u003c/span\u003e {\n  alias  = \u003cspan class=\"hljs-string\"\u003e\"us_west\"\u003c/span\u003e\n  region = \u003cspan class=\"hljs-string\"\u003e\"us-west-1\"\u003c/span\u003e\n}\n\nresource \u003cspan class=\"hljs-string\"\u003e\"aws_security_group\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"allow_ssh\"\u003c/span\u003e {\n  name        = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esg_name\u003c/span\u003e\n  description = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esg_description\u003c/span\u003e\n  vpc_id      = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_id\u003c/span\u003e\n\n  ingress {\n    description = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eingress_description\u003c/span\u003e\n    from_port   = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eingress_from_port\u003c/span\u003e\n    to_port     = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eingress_to_port\u003c/span\u003e\n    protocol    = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eingress_protocol\u003c/span\u003e\n    cidr_blocks = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eingress_cidr_blocks\u003c/span\u003e\n  }\n\n  egress {\n    from_port   = \u003cspan class=\"hljs-string\"\u003e\"0\"\u003c/span\u003e\n    to_port     = \u003cspan class=\"hljs-string\"\u003e\"0\"\u003c/span\u003e\n    protocol    = \u003cspan class=\"hljs-string\"\u003e\"-1\"\u003c/span\u003e\n    cidr_blocks = [\u003cspan class=\"hljs-string\"\u003e\"0.0.0.0/0\"\u003c/span\u003e]\n  }\n\n  tags = {\n    \u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e       = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esg_name\u003c/span\u003e\n    created_by = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e보안 그룹을 위해, 저는 main.tf 파일에서 프로젝트 루트로 모듈을 두 번 가져왔습니다. 첫 번째 보안 그룹은 EC2로 SSH를 허용하고, 두 번째는 EC2에서 ICMP 패킷의 흐름을 허용합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"ssh_sg_vpcA\"\u003c/span\u003e {\n  source              = \u003cspan class=\"hljs-string\"\u003e\"./modules/security-groups\"\u003c/span\u003e\n  sg_name             = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"sg_name\"\u003c/span\u003e]\n  sg_description      = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"sg_description\"\u003c/span\u003e]\n  ingress_description = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_description\"\u003c/span\u003e]\n  ingress_from_port   = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_from_port\"\u003c/span\u003e]\n  ingress_to_port     = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_to_port\"\u003c/span\u003e]\n  ingress_protocol    = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_protocol\"\u003c/span\u003e]\n  ingress_cidr_blocks = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esg_cidr_blocks\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_cidr_blocks\"\u003c/span\u003e]\n  owner_name          = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n  vpc_id              = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_A\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_id\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"ssh_sg_vpcB\"\u003c/span\u003e {\n  source              = \u003cspan class=\"hljs-string\"\u003e\"./modules/security-groups\"\u003c/span\u003e\n  sg_name             = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"sg_name\"\u003c/span\u003e]\n  sg_description      = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"sg_description\"\u003c/span\u003e]\n  ingress_description = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_description\"\u003c/span\u003e]\n  ingress_from_port   = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_from_port\"\u003c/span\u003e]\n  ingress_to_port     = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_to_port\"\u003c/span\u003e]\n  ingress_protocol    = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_protocol\"\u003c/span\u003e]\n  ingress_cidr_blocks = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esg_cidr_blocks\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_cidr_blocks\"\u003c/span\u003e]\n  owner_name          = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n  vpc_id              = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_B\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_id\u003c/span\u003e\n  providers = {\n    aws = aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e\n  }\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"icmp_sg_vpcA\"\u003c/span\u003e {\n  source              = \u003cspan class=\"hljs-string\"\u003e\"./modules/security-groups\"\u003c/span\u003e\n  sg_name             = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"sg_name\"\u003c/span\u003e]\n  sg_description      = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"sg_description\"\u003c/span\u003e]\n  ingress_description = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_description\"\u003c/span\u003e]\n  ingress_from_port   = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_from_port\"\u003c/span\u003e]\n  ingress_to_port     = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_to_port\"\u003c/span\u003e]\n  ingress_protocol    = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_protocol\"\u003c/span\u003e]\n  ingress_cidr_blocks = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esg_cidr_blocks\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_cidr_blocks_for_vpcA\"\u003c/span\u003e]\n  owner_name          = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n  vpc_id              = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_A\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_id\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"icmp_sg_vpcB\"\u003c/span\u003e {\n  source              = \u003cspan class=\"hljs-string\"\u003e\"./modules/security-groups\"\u003c/span\u003e\n  sg_name             = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"sg_name\"\u003c/span\u003e]\n  sg_description      = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"sg_description\"\u003c/span\u003e]\n  ingress_description = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_description\"\u003c/span\u003e]\n  ingress_from_port   = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_from_port\"\u003c/span\u003e]\n  ingress_to_port     = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_to_port\"\u003c/span\u003e]\n  ingress_protocol    = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esgs\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_protocol\"\u003c/span\u003e]\n  ingress_cidr_blocks = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esg_cidr_blocks\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"ingress_cidr_blocks_for_vpcB\"\u003c/span\u003e]\n  owner_name          = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n  vpc_id              = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_B\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_id\u003c/span\u003e\n  providers = {\n    aws = aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e단계 4: EC2를 위한 모듈 생성 및 가져오기\u003c/h2\u003e\n\u003cp\u003emodules/ec2/main.tf\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eterraform {\n  required_providers {\n    aws = {\n      source                = \u003cspan class=\"hljs-string\"\u003e\"hashicorp/aws\"\u003c/span\u003e\n      version               = \u003cspan class=\"hljs-string\"\u003e\"~\u003e 5.0\"\u003c/span\u003e\n      configuration_aliases = [aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e]\n    }\n  }\n}\n\nprovider \u003cspan class=\"hljs-string\"\u003e\"aws\"\u003c/span\u003e {\n  alias  = \u003cspan class=\"hljs-string\"\u003e\"us_west\"\u003c/span\u003e\n  region = \u003cspan class=\"hljs-string\"\u003e\"us-west-1\"\u003c/span\u003e\n}\n\nresource \u003cspan class=\"hljs-string\"\u003e\"aws_instance\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"my_ec2\"\u003c/span\u003e {\n\n  ami                         = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eami_id\u003c/span\u003e\n  instance_type               = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003einstance_type\u003c/span\u003e\n  subnet_id                   = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esubnet_id\u003c/span\u003e\n  associate_public_ip_address = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  key_name                    = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ekey_name\u003c/span\u003e\n\n  tags = {\n    \u003cspan class=\"hljs-title class_\"\u003eName\u003c/span\u003e       = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eec2_name\u003c/span\u003e\n    created_by = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n  }\n}\n\nresource \u003cspan class=\"hljs-string\"\u003e\"aws_network_interface_sg_attachment\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"ssh_sg_attachment\"\u003c/span\u003e {\n  security_group_id    = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003essh_sg_id\u003c/span\u003e\n  network_interface_id = aws_instance.\u003cspan class=\"hljs-property\"\u003emy_ec2\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eprimary_network_interface_id\u003c/span\u003e\n}\n\nresource \u003cspan class=\"hljs-string\"\u003e\"aws_network_interface_sg_attachment\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"icmp_sg_attachment\"\u003c/span\u003e {\n  security_group_id    = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eicmp_sg_id\u003c/span\u003e\n  network_interface_id = aws_instance.\u003cspan class=\"hljs-property\"\u003emy_ec2\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eprimary_network_interface_id\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이제 모듈을 프로젝트 루트의 main.tf 파일에 가져오겠습니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003emodule \"ec2_vpcA\" {\nsource = \"./modules/ec2\"\nsubnet_id = module.subnetsForvpc_A[\"subnet1\"].subnet_id\nami_id = var.ec2s[\"ec2_vpcA\"][\"ami_id\"]\ninstance_type = var.ec2s[\"ec2_vpcA\"][\"instance_type\"]\nec2_name = var.ec2s[\"ec2_vpcA\"][\"ec2_name\"]\nkey_name = var.ec2s[\"ec2_vpcA\"][\"key_name\"]\nssh_sg_id = module.ssh_sg_vpcA.sg_id\nicmp_sg_id = module.icmp_sg_vpcA.sg_id\nowner_name = var.owner_name\n}\u003c/p\u003e\n\u003cp\u003emodule \"ec2_vpcB\" {\nsource = \"./modules/ec2\"\nsubnet_id = module.subnetsForvpc_B[\"subnet1\"].subnet_id\nami_id = var.ec2s[\"ec2_vpcB\"][\"ami_id\"]\ninstance_type = var.ec2s[\"ec2_vpcB\"][\"instance_type\"]\nec2_name = var.ec2s[\"ec2_vpcB\"][\"ec2_name\"]\nkey_name = var.ec2s[\"ec2_vpcB\"][\"key_name\"]\nssh_sg_id = module.ssh_sg_vpcB.sg_id\nicmp_sg_id = module.icmp_sg_vpcB.sg_id\nowner_name = var.owner_name\nproviders = {\naws = aws.us_west\n}\n}\u003c/p\u003e\n\u003ch2\u003eStep 5: Create modules for Internet Gateways and importing them\u003c/h2\u003e\n\u003cp\u003emodules/internet-gateways/main.tf\u003c/p\u003e\n\u003cp\u003eterraform {\nrequired_providers {\naws = {\nsource = \"hashicorp/aws\"\nversion = \"~\u003e 5.0\"\nconfiguration_aliases = [aws.us_west]\n}\n}\n}\u003c/p\u003e\n\u003cp\u003eprovider \"aws\" {\nalias = \"us_west\"\nregion = \"us-west-1\"\n}\u003c/p\u003e\n\u003cp\u003eresource \"aws_internet_gateway\" \"i_gw\" {\nvpc_id = var.vpc_id\u003c/p\u003e\n\u003cp\u003etags = {\nName = var.igw_name\ncreated_by = var.owner_name\n}\n}\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e이제, 프로젝트 루트의 main.tf 파일에 모듈을 가져오겠습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"igw_vpcA\"\u003c/span\u003e {\n  source     = \u003cspan class=\"hljs-string\"\u003e\"./modules/internet-gateways\"\u003c/span\u003e\n  vpc_id     = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_A\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_id\u003c/span\u003e\n  igw_name   = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eigws\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"igw_vpcA\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e]\n  owner_name = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"igw_vpcB\"\u003c/span\u003e {\n  source     = \u003cspan class=\"hljs-string\"\u003e\"./modules/internet-gateways\"\u003c/span\u003e\n  vpc_id     = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_B\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_id\u003c/span\u003e\n  igw_name   = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eigws\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"igw_vpcB\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e]\n  owner_name = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n  providers = {\n    aws = aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e단계 6: VPC Peering, VPC Peering accepter, VPC Peering configure용 모듈 생성 및 가져오기\u003c/h2\u003e\n\u003cp\u003e모듈 - VPC Peering (modules/vpc-peering/main.tf)\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-kotlin\"\u003e테라폼 {\n  필수_제공자 {\n    aws = {\n      소스 = \u003cspan class=\"hljs-string\"\u003e\"hashicorp/aws\"\u003c/span\u003e\n      버전 = \u003cspan class=\"hljs-string\"\u003e\"~\u003e 5.0\"\u003c/span\u003e\n      구성_별칭 = [aws.us_west]\n    }\n  }\n}\n\n제공자 \u003cspan class=\"hljs-string\"\u003e\"aws\"\u003c/span\u003e {\n  별칭  = \u003cspan class=\"hljs-string\"\u003e\"us_west\"\u003c/span\u003e\n  지역 = \u003cspan class=\"hljs-string\"\u003e\"us-west-1\"\u003c/span\u003e\n}\n\n리소스 \u003cspan class=\"hljs-string\"\u003e\"aws_vpc_peering_connection\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"vpc_peering\"\u003c/span\u003e {\n  peer_vpc_id = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.peer_vpc_id\n  vpc_id      = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.vpc_id\n  peer_region = \u003cspan class=\"hljs-string\"\u003e\"us-west-1\"\u003c/span\u003e\n  tags = {\n    이름       = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.vpcpeer_name\n    생성자 = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.owner_name\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e모듈 — VPC 피어링 수락자 (modules/vpc-peering-accepter/main.tf)\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-kotlin\"\u003e테라폼 {\n  필수_제공자 {\n    aws = {\n      소스 = \u003cspan class=\"hljs-string\"\u003e\"hashicorp/aws\"\u003c/span\u003e\n      버전 = \u003cspan class=\"hljs-string\"\u003e\"~\u003e 5.0\"\u003c/span\u003e\n      구성_별칭 = [aws.us_west]\n    }\n  }\n}\n\n제공자 \u003cspan class=\"hljs-string\"\u003e\"aws\"\u003c/span\u003e {\n  별칭  = \u003cspan class=\"hljs-string\"\u003e\"us_west\"\u003c/span\u003e\n  지역 = \u003cspan class=\"hljs-string\"\u003e\"us-west-1\"\u003c/span\u003e\n}\n\n리소스 \u003cspan class=\"hljs-string\"\u003e\"aws_vpc_peering_connection_accepter\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"peer_vpc_AB\"\u003c/span\u003e {\n  provider = aws.us_west\n\n  vpc_peering_connection_id = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.vpc_peering_id\n  auto_accept               = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\n  tags = {\n    쪽       = \u003cspan class=\"hljs-string\"\u003e\"수락자\"\u003c/span\u003e\n    소유자_이름 = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.owner_name\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e모듈 — VPC 피어링 구성 (modules/vpc-peering-configure/main.tf)\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eterraform {\n  required_providers {\n    aws = {\n      source                = \u003cspan class=\"hljs-string\"\u003e\"hashicorp/aws\"\u003c/span\u003e\n      version               = \u003cspan class=\"hljs-string\"\u003e\"~\u003e 5.0\"\u003c/span\u003e\n      configuration_aliases = [aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e]\n    }\n  }\n}\n\nprovider \u003cspan class=\"hljs-string\"\u003e\"aws\"\u003c/span\u003e {\n  alias  = \u003cspan class=\"hljs-string\"\u003e\"us_west\"\u003c/span\u003e\n  region = \u003cspan class=\"hljs-string\"\u003e\"us-west-1\"\u003c/span\u003e\n}\n\nresource \u003cspan class=\"hljs-string\"\u003e\"aws_vpc_peering_connection_options\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"vpc_peering_configure\"\u003c/span\u003e {\n  vpc_peering_connection_id = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_peering_connection_id\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이제, 위의 모든 모듈을 루트의 main.tf 파일로 가져오겠습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"vpc_peering\"\u003c/span\u003e {\n  source       = \u003cspan class=\"hljs-string\"\u003e\"./modules/vpc-peering\"\u003c/span\u003e\n  peer_vpc_id  = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_B\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_id\u003c/span\u003e\n  vpc_id       = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_A\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_id\u003c/span\u003e\n  vpcpeer_name = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpcpeer_name\u003c/span\u003e\n  owner_name   = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"vpc_peering_accepter\"\u003c/span\u003e {\n  source         = \u003cspan class=\"hljs-string\"\u003e\"./modules/vpc-peering-accepter\"\u003c/span\u003e\n  vpc_peering_id = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_peering\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eaws_vpc_peering_connection_id\u003c/span\u003e\n  owner_name     = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eowner_name\u003c/span\u003e\n  providers = {\n    aws = aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e\n  }\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"vpc_peering_configureA\"\u003c/span\u003e {\n  source                    = \u003cspan class=\"hljs-string\"\u003e\"./modules/vpc_peer_configure\"\u003c/span\u003e\n  vpc_peering_connection_id = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_peering_accepter\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eaws_vpc_peering_connection_accepter\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"vpc_peering_configureB\"\u003c/span\u003e {\n  source                    = \u003cspan class=\"hljs-string\"\u003e\"./modules/vpc_peer_configure\"\u003c/span\u003e\n  vpc_peering_connection_id = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_peering_accepter\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eaws_vpc_peering_connection_accepter\u003c/span\u003e\n  providers = {\n    aws = aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e단계 7: 라우트 테이블을 위한 모듈 만들기 및 가져오기\u003c/h2\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003emodules/route-tables/main.tf\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eterraform {\n  required_providers {\n    aws = {\n      source                = \u003cspan class=\"hljs-string\"\u003e\"hashicorp/aws\"\u003c/span\u003e\n      version               = \u003cspan class=\"hljs-string\"\u003e\"~\u003e 5.0\"\u003c/span\u003e\n      configuration_aliases = [aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e]\n    }\n  }\n}\n\nprovider \u003cspan class=\"hljs-string\"\u003e\"aws\"\u003c/span\u003e {\n  alias  = \u003cspan class=\"hljs-string\"\u003e\"us_west\"\u003c/span\u003e\n  region = \u003cspan class=\"hljs-string\"\u003e\"us-west-1\"\u003c/span\u003e\n}\n\nresource \u003cspan class=\"hljs-string\"\u003e\"aws_route\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"route\"\u003c/span\u003e {\n  route_table_id            = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eroute_table_id\u003c/span\u003e\n  destination_cidr_block    = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edestination_cidr_block\u003c/span\u003e\n  gateway_id                = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003egateway_id\u003c/span\u003e != \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e ? \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003egateway_id\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n  vpc_peering_connection_id = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_peering_connection_id\u003c/span\u003e != \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e ? \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_peering_connection_id\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이제 프로젝트 루트의 main.tf 파일에 모듈을 가져와보겠습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"route_table_vpcA_pcgw\"\u003c/span\u003e {\n  source                    = \u003cspan class=\"hljs-string\"\u003e\"./modules/route-table\"\u003c/span\u003e\n  route_table_id            = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_A\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edefault_route_table_id\u003c/span\u003e\n  destination_cidr_block    = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edestination_cidr_blocks_for_routetable\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"for_route_vpcA\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"pcgw_cidr\"\u003c/span\u003e]\n  vpc_peering_connection_id = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_peering\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eaws_vpc_peering_connection_id\u003c/span\u003e\n  gateway_id                = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"route_table_vpcB_pcgw\"\u003c/span\u003e {\n  source                    = \u003cspan class=\"hljs-string\"\u003e\"./modules/route-table\"\u003c/span\u003e\n  route_table_id            = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_B\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edefault_route_table_id\u003c/span\u003e\n  destination_cidr_block    = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edestination_cidr_blocks_for_routetable\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"for_route_vpcB\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"pcgw_cidr\"\u003c/span\u003e]\n  vpc_peering_connection_id = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_peering\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eaws_vpc_peering_connection_id\u003c/span\u003e\n  gateway_id                = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n  providers = {\n    aws = aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e\n  }\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"route_table_vpcA_igw\"\u003c/span\u003e {\n  source                    = \u003cspan class=\"hljs-string\"\u003e\"./modules/route-table\"\u003c/span\u003e\n  route_table_id            = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_A\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edefault_route_table_id\u003c/span\u003e\n  destination_cidr_block    = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edestination_cidr_blocks_for_routetable\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"for_route_vpcA\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"igw_cidr\"\u003c/span\u003e]\n  gateway_id                = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eigw_vpcA\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eigw_id\u003c/span\u003e\n  vpc_peering_connection_id = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"route_table_vpcB_igw\"\u003c/span\u003e {\n  source                    = \u003cspan class=\"hljs-string\"\u003e\"./modules/route-table\"\u003c/span\u003e\n  route_table_id            = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003evpc_B\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edefault_route_table_id\u003c/span\u003e\n  destination_cidr_block    = \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edestination_cidr_blocks_for_routetable\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"for_route_vpcB\"\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e\"igw_cidr\"\u003c/span\u003e]\n  gateway_id                = \u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eigw_vpcB\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eigw_id\u003c/span\u003e\n  vpc_peering_connection_id = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n  providers = {\n    aws = aws.\u003cspan class=\"hljs-property\"\u003eus_west\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch2\u003e단계 8: dev-env.tfvars 파일 작성\u003c/h2\u003e\n\u003cp\u003evariable.tfvars/dev-env.tfvars\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eowner_name = \u003cspan class=\"hljs-string\"\u003e\"NIKUNJ\"\u003c/span\u003e\n\nvpcs = {\n  \u003cspan class=\"hljs-string\"\u003e\"vpc_A\"\u003c/span\u003e = {\n    vpc_name   = \u003cspan class=\"hljs-string\"\u003e\"vpc-us-east1\"\u003c/span\u003e\n    cidr_block = \u003cspan class=\"hljs-string\"\u003e\"10.1.0.0/16\"\u003c/span\u003e\n  }\n  \u003cspan class=\"hljs-string\"\u003e\"vpc_B\"\u003c/span\u003e = {\n    vpc_name   = \u003cspan class=\"hljs-string\"\u003e\"vpc-us-west1\"\u003c/span\u003e\n    cidr_block = \u003cspan class=\"hljs-string\"\u003e\"10.2.0.0/16\"\u003c/span\u003e\n  }\n}\n\nvpc_A에 대한 서브넷 목록 = {\n  \u003cspan class=\"hljs-string\"\u003e\"subnet1\"\u003c/span\u003e = {\n    subnet_cidr       = \u003cspan class=\"hljs-string\"\u003e\"10.1.0.0/20\"\u003c/span\u003e\n    subnet_name       = \u003cspan class=\"hljs-string\"\u003e\"subnet-us-east1a\"\u003c/span\u003e\n    availability_zone = \u003cspan class=\"hljs-string\"\u003e\"us-east-1a\"\u003c/span\u003e\n  }\n  \u003cspan class=\"hljs-string\"\u003e\"subnet2\"\u003c/span\u003e = {\n    subnet_cidr       = \u003cspan class=\"hljs-string\"\u003e\"10.1.16.0/20\"\u003c/span\u003e\n    subnet_name       = \u003cspan class=\"hljs-string\"\u003e\"subnet-us-east1b\"\u003c/span\u003e\n    availability_zone = \u003cspan class=\"hljs-string\"\u003e\"us-east-1b\"\u003c/span\u003e\n  }\n  \u003cspan class=\"hljs-string\"\u003e\"subnet3\"\u003c/span\u003e = {\n    subnet_cidr       = \u003cspan class=\"hljs-string\"\u003e\"10.1.32.0/20\"\u003c/span\u003e\n    subnet_name       = \u003cspan class=\"hljs-string\"\u003e\"subnet-us-east1c\"\u003c/span\u003e\n    availability_zone = \u003cspan class=\"hljs-string\"\u003e\"us-east-1c\"\u003c/span\u003e\n  }\n}\n\nvpc_B에 대한 서브넷 목록 = {\n  \u003cspan class=\"hljs-string\"\u003e\"subnet1\"\u003c/span\u003e = {\n    subnet_cidr       = \u003cspan class=\"hljs-string\"\u003e\"10.2.0.0/20\"\u003c/span\u003e\n    subnet_name       = \u003cspan class=\"hljs-string\"\u003e\"subnet-us-west1a\"\u003c/span\u003e\n    availability_zone = \u003cspan class=\"hljs-string\"\u003e\"us-west-1a\"\u003c/span\u003e\n  }\n  \u003cspan class=\"hljs-string\"\u003e\"subnet2\"\u003c/span\u003e = {\n    subnet_cidr       = \u003cspan class=\"hljs-string\"\u003e\"10.2.16.0/20\"\u003c/span\u003e\n    subnet_name       = \u003cspan class=\"hljs-string\"\u003e\"subnet-us-west1b\"\u003c/span\u003e\n    availability_zone = \u003cspan class=\"hljs-string\"\u003e\"us-west-1b\"\u003c/span\u003e\n  }\n}\n\n보안 그룹 목록 = {\n  \u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e = {\n    sg_name             = \u003cspan class=\"hljs-string\"\u003e\"allow_ssh\"\u003c/span\u003e\n    sg_description      = \u003cspan class=\"hljs-string\"\u003e\"내 IP에서 SSH 허용\"\u003c/span\u003e\n    ingress_description = \u003cspan class=\"hljs-string\"\u003e\"내 IP를 위한 SSH\"\u003c/span\u003e\n    ingress_from_port   = \u003cspan class=\"hljs-string\"\u003e\"22\"\u003c/span\u003e\n    ingress_to_port     = \u003cspan class=\"hljs-string\"\u003e\"22\"\u003c/span\u003e\n    ingress_protocol    = \u003cspan class=\"hljs-string\"\u003e\"tcp\"\u003c/span\u003e\n  }\n  \u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e = {\n    sg_name             = \u003cspan class=\"hljs-string\"\u003e\"allow_ping_traffic\"\u003c/span\u003e\n    sg_description      = \u003cspan class=\"hljs-string\"\u003e\"내 IP에서 ping 허용\"\u003c/span\u003e\n    ingress_description = \u003cspan class=\"hljs-string\"\u003e\"내 IP로부터의 ping\"\u003c/span\u003e\n    ingress_from_port   = \u003cspan class=\"hljs-string\"\u003e\"8\"\u003c/span\u003e\n    ingress_to_port     = \u003cspan class=\"hljs-string\"\u003e\"0\"\u003c/span\u003e\n    ingress_protocol    = \u003cspan class=\"hljs-string\"\u003e\"icmp\"\u003c/span\u003e\n  }\n}\n\nsg_cidr_blocks = {\n  \u003cspan class=\"hljs-string\"\u003e\"ssh_sg\"\u003c/span\u003e = {\n    ingress_cidr_blocks = [\u003cspan class=\"hljs-string\"\u003e\"12.34.56.78/32\"\u003c/span\u003e] # ec2로의 \u003cspan class=\"hljs-variable constant_\"\u003eSSH\u003c/span\u003e가 허용된 \u003cspan class=\"hljs-variable constant_\"\u003eIP\u003c/span\u003e를 언급\n  }\n  \u003cspan class=\"hljs-string\"\u003e\"icmp_sg\"\u003c/span\u003e = {\n    ingress_cidr_blocks_for_vpcA = [\u003cspan class=\"hljs-string\"\u003e\"10.2.0.0/16\"\u003c/span\u003e]\n    ingress_cidr_blocks_for_vpcB = [\u003cspan class=\"hljs-string\"\u003e\"10.1.0.0/16\"\u003c/span\u003e]\n  }\n}\n\nec2 목록 = {\n  \u003cspan class=\"hljs-string\"\u003e\"ec2_vpcA\"\u003c/span\u003e = {\n    ami_id        = \u003cspan class=\"hljs-string\"\u003e\"ami-0e8a34246278c21e4\"\u003c/span\u003e\n    instance_type = \u003cspan class=\"hljs-string\"\u003e\"t2.micro\"\u003c/span\u003e\n    ec2_name      = \u003cspan class=\"hljs-string\"\u003e\"ec2-us-east1\"\u003c/span\u003e\n    key_name      = \u003cspan class=\"hljs-string\"\u003e\"us-east-1-demo\"\u003c/span\u003e\n  }\n  \u003cspan class=\"hljs-string\"\u003e\"ec2_vpcB\"\u003c/span\u003e = {\n    ami_id        = \u003cspan class=\"hljs-string\"\u003e\"ami-09ab9d570789dfdd4\"\u003c/span\u003e\n    instance_type = \u003cspan class=\"hljs-string\"\u003e\"t2.micro\"\u003c/span\u003e\n    ec2_name      = \u003cspan class=\"hljs-string\"\u003e\"ec2-us-west1\"\u003c/span\u003e\n    key_name      = \u003cspan class=\"hljs-string\"\u003e\"us-west-1-demo\"\u003c/span\u003e\n  }\n}\n\n인터넷 게이트웨이 목록 = {\n  \u003cspan class=\"hljs-string\"\u003e\"igw_vpcA\"\u003c/span\u003e = {\n    name = \u003cspan class=\"hljs-string\"\u003e\"igw_vpcA\"\u003c/span\u003e\n  }\n  \u003cspan class=\"hljs-string\"\u003e\"igw_vpcB\"\u003c/span\u003e = {\n    name = \u003cspan class=\"hljs-string\"\u003e\"igw_vpcB\"\u003c/span\u003e\n  }\n}\n\n\u003cspan class=\"hljs-variable constant_\"\u003eVPC\u003c/span\u003e 피어링 이름 = \u003cspan class=\"hljs-string\"\u003e\"vpc_AB_peering\"\u003c/span\u003e\n\nroute 테이블용 대상 \u003cspan class=\"hljs-variable constant_\"\u003eCIDR\u003c/span\u003e 블록 = {\n  \u003cspan class=\"hljs-string\"\u003e\"for_route_vpcA\"\u003c/span\u003e = {\n    pcgw_cidr = \u003cspan class=\"hljs-string\"\u003e\"10.2.0.0/16\"\u003c/span\u003e\n    igw_cidr  = \u003cspan class=\"hljs-string\"\u003e\"0.0.0.0/0\"\u003c/span\u003e\n  }\n  \u003cspan class=\"hljs-string\"\u003e\"for_route_vpcB\"\u003c/span\u003e = {\n    pcgw_cidr = \u003cspan class=\"hljs-string\"\u003e\"10.1.0.0/16\"\u003c/span\u003e\n    igw_cidr  = \u003cspan class=\"hljs-string\"\u003e\"0.0.0.0/0\"\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e단계 9: 작업 디렉토리 초기화\u003c/h2\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e작업 디렉토리에서 terraform init 명령을 실행하세요. 이 명령은 필요한 모든 공급자 및 모듈을 다운로드하고 백엔드를 초기화합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e단계 10: 테라폼 실행 계획 생성\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e작업 디렉토리에서 terraform plan 명령을 실행하세요. 실행 계획을 제공합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e단계 11: terraform apply 실행\u003c/h2\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e작업 디렉토리에서 terraform apply 명령을 실행하면 AWS에 필요한 모든 리소스가 생성됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e단계 12: 연결 확인\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eSSH를 사용하여 EC2 인스턴스 중 하나에 연결하고 다른 EC2 인스턴스의 사설 IP를 사용하여 핑을 보냅니다.\u003c/li\u003e\n\u003cli\u003e모든 것이 잘 되었다면 ICMP 데이터 패킷이 성공적으로 전송됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e여기까지입니다. 이제 Terraform을 사용하여 AWS VPC 피어링 연결을 생성하는 방법을 배웠습니다. 이제 여러분은 이것을 사용하고 필요에 따라 수정할 수 있습니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e전체 코드는 여기에서 찾을 수 있어요.\u003c/p\u003e\n\u003cp\u003e이 가이드가 도움이 되었다면 👏 버튼을 클릭해 주세요. 댓글도 자유롭게 남겨주세요.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-27-AWS-VPCPeeringwithTerraform"},"buildId":"-dPCbnM2yhdKNgXe92VJV","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>