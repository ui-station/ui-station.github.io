<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>S3 ì´ë²¤íŠ¸ ì•Œë¦¼ì„ ì‚¬ìš©í•˜ì—¬ ì¸ë„¤ì¼ ìƒì„±í•˜ê¸° | ui-station</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://ui-station.github.io///post/2024-05-17-UseS3eventnotificationstogeneratethumbnails" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="S3 ì´ë²¤íŠ¸ ì•Œë¦¼ì„ ì‚¬ìš©í•˜ì—¬ ì¸ë„¤ì¼ ìƒì„±í•˜ê¸° | ui-station" data-gatsby-head="true"/><meta property="og:title" content="S3 ì´ë²¤íŠ¸ ì•Œë¦¼ì„ ì‚¬ìš©í•˜ì—¬ ì¸ë„¤ì¼ ìƒì„±í•˜ê¸° | ui-station" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://ui-station.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://ui-station.github.io///post/2024-05-17-UseS3eventnotificationstogeneratethumbnails" data-gatsby-head="true"/><meta name="twitter:title" content="S3 ì´ë²¤íŠ¸ ì•Œë¦¼ì„ ì‚¬ìš©í•˜ì—¬ ì¸ë„¤ì¼ ìƒì„±í•˜ê¸° | ui-station" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | ui-station" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-17 18:32" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-V5DKFTZ6BX"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-V5DKFTZ6BX');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cd012fc8787133d0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cd012fc8787133d0.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/_next/static/chunks/348-d11c34b645b13f5b.js" defer=""></script><script src="/_next/static/chunks/551-3069cf29fe274aab.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-561ae49ab5aab7f5.js" defer=""></script><script src="/_next/static/PgdIX9e0tvkvkdAmDT6qR/_buildManifest.js" defer=""></script><script src="/_next/static/PgdIX9e0tvkvkdAmDT6qR/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UI STATION</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">S3 ì´ë²¤íŠ¸ ì•Œë¦¼ì„ ì‚¬ìš©í•˜ì—¬ ì¸ë„¤ì¼ ìƒì„±í•˜ê¸°</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="S3 ì´ë²¤íŠ¸ ì•Œë¦¼ì„ ì‚¬ìš©í•˜ì—¬ ì¸ë„¤ì¼ ìƒì„±í•˜ê¸°" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UI STATION</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 17, 2024</span><span class="posts_reading_time__f7YPP">18<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-17-UseS3eventnotificationstogeneratethumbnails&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><h2>ì´ë²¤íŠ¸ ê¸°ë°˜ ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜</h2>
<p><img src="/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_0.png" alt="ì´ë¯¸ì§€"/></p>
<p>ì•ˆë…•í•˜ì„¸ìš”!</p>
<p>ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŒŒì¼ì„ í´ë¼ìš°ë“œì— ì €ì¥í•˜ëŠ” ê²ƒì€ íŒŒì¼ ì§€ì†ì„±ì˜ í•œ ë°©ë²•ìœ¼ë¡œ ë§¤ìš° ì¼ë°˜ì ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì–´ë””ì—ì„œ ì–´ë–»ê²Œ ì‚¬ìš©ë ì§€ì— ëŒ€í•œ ë§ì€ ìœ ì—°ì„±ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<p>AWSëŠ” ê°ì²´ë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ìœ¼ë¡œ ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ S3 (Simple Storage Service)ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ëŠ” ë†’ì€ ê°€ìš©ì„±, í™•ì¥ì„± ë° ì„±ëŠ¥ì„ ê°–ì¶”ê³  ìˆìŠµë‹ˆë‹¤. ì£¼ë¡œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì €ì¥ ì„œë¹„ìŠ¤ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>
<p>S3ëŠ” ë²„í‚· ì•ˆì—ì„œ ê°ì²´ ì‘ì—…ì— ëŒ€í•œ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ë„ ì œê³µí•©ë‹ˆë‹¤. ì´ëŠ” ê°ì²´ ìƒì„±, ì—…ë°ì´íŠ¸, ì´ë™, ì‚­ì œ ë“±ì˜ ì‘ì—…ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ S3 ì´ë²¤íŠ¸ ì•Œë¦¼ì´ë¼ê³  í•©ë‹ˆë‹¤.</p>
<p>ì´ ë¬¸ì„œì—ì„œëŠ” ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•  ë•Œë§ˆë‹¤ í•´ë‹¹ ì´ë¯¸ì§€ì— ëŒ€í•œ ì„¬ë„¤ì¼ì„ ìƒì„±í•˜ëŠ” ì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<p>ìš°ë¦¬ëŠ” ì´ë²¤íŠ¸ ì•Œë¦¼ì„ ìˆ˜ì‹ í•˜ê³  ì„¬ë„¤ì¼ì„ ìƒì„±í•˜ëŠ” Goë¡œ ì‘ì„±ëœ ëŒë‹¤ í•¨ìˆ˜ë¥¼ ê°€ì§ˆ ê²ƒì…ë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<p>í•´ë³´ìêµ¬ìš”!</p>
<h1>ìš”êµ¬ ì‚¬í•­</h1>
<ul>
<li>AWS ê³„ì •</li>
<li>ì¢‹ì•„í•˜ëŠ” ì½”ë“œ í¸ì§‘ê¸° (ì €ëŠ” Visual Studio Codeë¥¼ ì‚¬ìš©í•  ì˜ˆì •ì…ë‹ˆë‹¤)</li>
<li>GitHub ê³„ì •</li>
</ul>
<h1>ì•„í‚¤í…ì²˜</h1>
<div class="content-ad"></div>
<img src="/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_1.png"/>
<p>ë²„í‚·ì„ êµ¬ì„±í•˜ì—¬ ê°ì²´ ì´ë²¤íŠ¸ë¥¼ SNS í† í”½ìœ¼ë¡œ ë³´ë‚´ê³  í•´ë‹¹ ë©”ì‹œì§€ë¥¼ ìƒì„±í•œ ì¸ë„¤ì¼ì„ S3 ë²„í‚·ì— ì—…ë¡œë“œí•  ëŒë‹¤ë¡œ ì „ì†¡í•  ê²ƒì…ë‹ˆë‹¤.</p>
<p>S3 ë²„í‚· ì´ë²¤íŠ¸ì— ëŒë‹¤ë¥¼ ì§ì ‘ ëŒ€ìƒìœ¼ë¡œ ì§€ì •í•˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤. ì´ìœ ëŠ” ê° ì´ë²¤íŠ¸ ì•Œë¦¼ì— ëŒ€í•´ í•˜ë‚˜ì˜ ëŒ€ìƒ ìœ í˜•ë§Œ ì§€ì •í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. SNS í† í”½ì„ ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ SQS ëŒ€ê¸°ì—´, ì´ë©”ì¼, ì „í™” ì•Œë¦¼ ë° SNSê°€ ì§€ì›í•˜ëŠ” ê¸°íƒ€ ì—¬ëŸ¬ ëŒ€ìƒìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ì „íŒŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h1>Terraformì„ ì‚¬ìš©í•˜ì—¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸°</h1>
<div class="content-ad"></div>
<h2>ì´ë¯¸ì§€ S3 ë²„í‚·</h2>
<p>ì‹œì‘í•˜ë ¤ë©´ ìš°ë¦¬ì˜ í…Œë¼í¼ í´ë”ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ í”„ë¡œì íŠ¸ì˜ ë£¨íŠ¸ ë ˆë²¨ì— iacë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”. ê·¸ ì•ˆì— providers.tfë¼ëŠ” íŒŒì¼ì„ ìƒì„±í•´ AWS í”„ë¡œë°”ì´ë”ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆë„ë¡ ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”:</p>
<pre><code class="hljs language-js">terraform {
  required_providers {
    aws = {
      source  = <span class="hljs-string">&quot;hashicorp/aws&quot;</span>
      version = <span class="hljs-string">&quot;~&gt; 5.0&quot;</span>
    }
  }
}

<span class="hljs-comment">// Regionì€ AWS_REGION í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì„¤ì •ë©ë‹ˆë‹¤</span>
provider <span class="hljs-string">&quot;aws&quot;</span> {
}
</code></pre>
<p>ë§Œì•½ í…Œë¼í¼ì´ ì¸í”„ë¼ ìƒíƒœë¥¼ ì¶”ì í•˜ë„ë¡ í•˜ë ¤ë©´, AWSì—ì„œ S3 ë²„í‚·ì„ ìƒì„±í•˜ê³  ìƒíƒœ ë°±ì—”ë“œë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì½”ë“œì—ì„œì²˜ëŸ¼ í•˜ì‹œë©´ ë©ë‹ˆë‹¤:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">terraform {
  required_providers {
    aws = {
      source  = <span class="hljs-string">&quot;hashicorp/aws&quot;</span>
      version = <span class="hljs-string">&quot;~&gt; 5.0&quot;</span>
    }
  }

  backend <span class="hljs-string">&quot;s3&quot;</span> {
    bucket = <span class="hljs-string">&quot;terraform-medium-api-notification&quot;</span> <span class="hljs-comment">// ì—¬ê¸°ê°€ ìƒíƒœ ë²„í‚·ì…ë‹ˆë‹¤</span>
    key    = <span class="hljs-string">&quot;thumbnail-generator/state&quot;</span>
  }
}

<span class="hljs-comment">// AWS_REGION í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì§€ì—­ ì„¤ì •ë¨</span>
provider <span class="hljs-string">&quot;aws&quot;</span> {
}
</code></pre>
<p>ì´ì œ ì´ë¯¸ì§€ë¥¼ í˜¸ìŠ¤íŒ…í•˜ëŠ” S3 ë²„í‚·ì„ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.</p>
<p>iac í´ë”ì— s3.tfë¼ëŠ” íŒŒì¼ì„ ë§Œë“¤ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”:</p>
<pre><code class="hljs language-js">resource <span class="hljs-string">&quot;aws_s3_bucket&quot;</span> <span class="hljs-string">&quot;my-app-images&quot;</span> {
  bucket = <span class="hljs-string">&quot;my-super-app-images&quot;</span> <span class="hljs-comment">// ë²„í‚·ì— ê³ ìœ í•œ ì´ë¦„ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”</span>
}

resource <span class="hljs-string">&quot;aws_s3_object&quot;</span> <span class="hljs-string">&quot;images_folder&quot;</span> {
  bucket = aws_s3_bucket.<span class="hljs-property">my</span>-app-images.<span class="hljs-property">bucket</span>
  key    = <span class="hljs-string">&quot;images/&quot;</span>
}

resource <span class="hljs-string">&quot;aws_s3_object&quot;</span> <span class="hljs-string">&quot;thumbnails_folder&quot;</span> {
  bucket = aws_s3_bucket.<span class="hljs-property">my</span>-app-images.<span class="hljs-property">bucket</span>
  key    = <span class="hljs-string">&quot;thumbnails/&quot;</span>
}
</code></pre>
<div class="content-ad"></div>
<p>ë²„í‚· ì†ì„±ì—ì„œëŠ” ë²„í‚·ì— ê³ ìœ í•œ ì´ë¦„ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ì™œëƒí•˜ë©´ S3 ë²„í‚· ì´ë¦„ì€ ëª¨ë“  AWS ì „ì—­ì—ì„œ ê³ ìœ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ë¦„ì„ ì œê³µí•˜ì§€ ì•Šìœ¼ë ¤ë©´ ë¹„ì›Œë‘ê³  AWSê°€ ê³ ìœ í•œ ë²„í‚· ì´ë¦„ì„ í• ë‹¹í•´ ì¤„ ê²ƒì…ë‹ˆë‹¤.</p>
<p>ì´ ì½”ë“œëŠ” ì´ë¯¸ì§€/ ë° ì¸ë„¤ì¼/ ë‘ ê°œì˜ í´ë”ê°€ ìˆëŠ” S3 ë²„í‚·ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ í´ë”ë“¤ì€ íŒŒì¼ì„ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.</p>
<h2>SNSë¥¼ ì‚¬ìš©í•œ ë©”ì‹œì§•</h2>
<p>ì´ì œ ì•Œë¦¼ ì£¼ì œì™€ ë©”ì‹œì§€ ëŒ€ê¸°ì—´ì„ ì„¤ì •í•´ ë´…ì‹œë‹¤.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-yaml"><span class="hljs-comment"># messaging.tf</span>

<span class="hljs-string">resource</span> <span class="hljs-string">&quot;aws_sns_topic&quot;</span> <span class="hljs-string">&quot;topic&quot;</span> {
  <span class="hljs-string">name</span>   <span class="hljs-string">=</span> <span class="hljs-string">&quot;image-events&quot;</span>
}
</code></pre>
<pre><code class="hljs language-yaml"><span class="hljs-comment"># variables.tf</span>

<span class="hljs-string">variable</span> <span class="hljs-string">&quot;region&quot;</span> {
  <span class="hljs-string">description</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;Default region of your resources&quot;</span>
  <span class="hljs-string">type</span>        <span class="hljs-string">=</span> <span class="hljs-string">string</span>
  <span class="hljs-string">default</span>     <span class="hljs-string">=</span> <span class="hljs-string">&quot;eu-central-1&quot;</span> <span class="hljs-comment"># Set as your default region here</span>
}

<span class="hljs-string">variable</span> <span class="hljs-string">&quot;account_id&quot;</span> {
  <span class="hljs-string">description</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;The ID of the default AWS account&quot;</span>
  <span class="hljs-string">type</span>        <span class="hljs-string">=</span> <span class="hljs-string">string</span>
}
</code></pre>
<div class="content-ad"></div>
<p>ê·¸ë¦¬ê³  variables.tfvarsë¼ëŠ” ë˜ ë‹¤ë¥¸ íŒŒì¼ì„ ë§Œë“¤ì–´ ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”:</p>
<pre><code class="hljs language-js">region = <span class="hljs-string">&quot;eu-central-1&quot;</span> <span class="hljs-comment">// ì›í•˜ëŠ” ì§€ì—­ì„ ì„¤ì •í•˜ì„¸ìš”</span>
</code></pre>
<p>ë‚˜ì¤‘ì— í…Œë¼í¼ ëª…ë ¹ì–´ì— ì „ë‹¬í•  account_idëŠ” ë‚˜ì¤‘ì— ì¸ìˆ˜ë¡œ ì „ë‹¬í•  ê²ƒì…ë‹ˆë‹¤.</p>
<h2>S3 ì´ë²¤íŠ¸ ì•Œë¦¼</h2>
<div class="content-ad"></div>
<p>ì´ì œ S3ì— ëŒ€í•œ ì´ë²¤íŠ¸ ì•Œë¦¼ì„ ì„¤ì •í•´ ë´…ì‹œë‹¤.</p>
<p>s3.tf íŒŒì¼ì— ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì—¬ ë²„í‚· ì•Œë¦¼ì„ ì„¤ì •í•˜ì„¸ìš”:</p>
<pre><code class="hljs language-js">resource <span class="hljs-string">&quot;aws_s3_bucket_notification&quot;</span> <span class="hljs-string">&quot;images_put_notification&quot;</span> {
  bucket = aws_s3_bucket.<span class="hljs-property">my</span>-app-images.<span class="hljs-property">id</span>
  topic {
    topic_arn = aws_sns_topic.<span class="hljs-property">topic</span>.<span class="hljs-property">arn</span>
    filter_prefix = <span class="hljs-string">&quot;images/&quot;</span>
    events = [<span class="hljs-string">&quot;s3:ObjectCreated:*&quot;</span>]
  }
}
</code></pre>
<p>ì´ë¥¼ í™œì„±í™”í•˜ë ¤ë©´ S3 ë²„í‚·ì´ í•´ë‹¹ topicìœ¼ë¡œ ì•Œë¦¼ì„ ë°œí–‰í•  ìˆ˜ ìˆë„ë¡ SNS topicì— ì •ì±…ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. messaging.tf íŒŒì¼ë¡œ ì´ë™í•˜ì—¬ ë‹¤ìŒ ì •ì±…ì„ ì¶”ê°€í•˜ì„¸ìš”:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">ë¦¬ì†ŒìŠ¤ <span class="hljs-string">&quot;aws_sns_topic&quot;</span> <span class="hljs-string">&quot;topic&quot;</span> {
  name   = <span class="hljs-string">&quot;image-events&quot;</span>
  policy = data.<span class="hljs-property">aws_iam_policy_document</span>.<span class="hljs-property">sns</span>-topic-policy.<span class="hljs-property">json</span>
}

ë°ì´í„° <span class="hljs-string">&quot;aws_iam_policy_document&quot;</span> <span class="hljs-string">&quot;sns-topic-policy&quot;</span> {
  policy_id = <span class="hljs-string">&quot;arn:aws:sns:${var.region}:${var.account_id}:image-events/SNSS3NotificationPolicy&quot;</span>
  statement {
    sid    = <span class="hljs-string">&quot;s3-allow-send-messages&quot;</span>
    effect = <span class="hljs-string">&quot;Allow&quot;</span>
    principals {
      type        = <span class="hljs-string">&quot;Service&quot;</span>
      identifiers = [<span class="hljs-string">&quot;s3.amazonaws.com&quot;</span>]
    }
    actions = [
      <span class="hljs-string">&quot;SNS:Publish&quot;</span>,
    ]
    resources = [
      <span class="hljs-string">&quot;arn:aws:sns:${var.region}:${var.account_id}:image-events&quot;</span>,
    ]
    condition {
      test     = <span class="hljs-string">&quot;ArnEquals&quot;</span>
      variable = <span class="hljs-string">&quot;aws:SourceArn&quot;</span>
      values = [
        aws_s3_bucket.<span class="hljs-property">my</span>-app-images.<span class="hljs-property">arn</span>
      ]
    }
  }
}
</code></pre>
<p>ì—¬ê¸°ì„œëŠ” sns-topic-policy ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê³  í•´ë‹¹ ë¦¬ì†ŒìŠ¤ë¥¼ policy ì†ì„±ì— ì „ë‹¬í•˜ëŠ” topic ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
<h2>ê¸°ë³¸ ëŒë‹¤ ì¶”ê°€í•˜ê¸°</h2>
<p>ì´ì œ ëŒë‹¤ì˜ ê¸°ë°˜ ì¸í”„ë¼ë¥¼ ì¶”ê°€í•˜ê¸°ë§Œ ë‚¨ì•˜ìŠµë‹ˆë‹¤. ì´í›„ì— ì½”ë“œë¥¼ ì¶”ê°€í•  ê¸°ë³¸ ëŒë‹¤ë¥¼ ì„¤ì •í•  ê²ƒì…ë‹ˆë‹¤. Go ì–¸ì–´ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<p>ë¨¼ì €, ëŒë‹¤ í•¨ìˆ˜ë¥¼ ì´ˆê¸°í™”í•  ê¸°ë³¸ ì½”ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ iac í´ë”ì— lambda_init_codeë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”. ì—¬ê¸°ì„œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ê°€ì ¸ì™€ì„œ ë©”ì¸ ì»´íŒŒì¼ëœ íŒŒì¼ì„ ì§ì ‘ ì‚¬ìš©í•˜ê±°ë‚˜ README.md íŒŒì¼ì˜ ì§€ì‹œì— ë”°ë¼ ìƒˆë¡œìš´ ì‹¤í–‰ ê°€ëŠ¥ íŒŒì¼ì„ ì»´íŒŒì¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ì´ì œ ìƒˆ íŒŒì¼ lambdas.tfë¥¼ ìƒì„±í•˜ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì—¬ ëŒë‹¤ ì¸í”„ë¼ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<pre><code class="hljs language-js">resource <span class="hljs-string">&quot;aws_iam_role&quot;</span> <span class="hljs-string">&quot;iam_for_lambda&quot;</span> {
  name               = <span class="hljs-string">&quot;thumbnail-generator-lambda-role&quot;</span>
  assume_role_policy = data.<span class="hljs-property">aws_iam_policy_document</span>.<span class="hljs-property">assume_role</span>.<span class="hljs-property">json</span>
  inline_policy {
    name   = <span class="hljs-string">&quot;DefaultPolicy&quot;</span>
    policy = data.<span class="hljs-property">aws_iam_policy_document</span>.<span class="hljs-property">lambda_role_policies</span>.<span class="hljs-property">json</span>
  }
}
resource <span class="hljs-string">&quot;aws_lambda_function&quot;</span> <span class="hljs-string">&quot;lambda&quot;</span> {
  filename      = data.<span class="hljs-property">archive_file</span>.<span class="hljs-property">lambda</span>.<span class="hljs-property">output_path</span>
  function_name = <span class="hljs-string">&quot;thumbnail-generator&quot;</span>
  role          = aws_iam_role.<span class="hljs-property">iam_for_lambda</span>.<span class="hljs-property">arn</span>
  handler       = <span class="hljs-string">&quot;main&quot;</span>
  runtime       = <span class="hljs-string">&quot;go1.x&quot;</span>
  timeout       = <span class="hljs-number">15</span>
}

data <span class="hljs-string">&quot;archive_file&quot;</span> <span class="hljs-string">&quot;lambda&quot;</span> {
  type        = <span class="hljs-string">&quot;zip&quot;</span>
  source_file = <span class="hljs-string">&quot;./lambda_init_code/main&quot;</span>
  output_path = <span class="hljs-string">&quot;thumbnail_generator_lambda_function_payload.zip&quot;</span>
}

data <span class="hljs-string">&quot;aws_iam_policy_document&quot;</span> <span class="hljs-string">&quot;assume_role&quot;</span> {
  statement {
    effect = <span class="hljs-string">&quot;Allow&quot;</span>
    principals {
      type        = <span class="hljs-string">&quot;Service&quot;</span>
      identifiers = [<span class="hljs-string">&quot;lambda.amazonaws.com&quot;</span>]
    }
    actions = [<span class="hljs-string">&quot;sts:AssumeRole&quot;</span>]
  }
}

data <span class="hljs-string">&quot;aws_iam_policy_document&quot;</span> <span class="hljs-string">&quot;lambda_role_policies&quot;</span> {
  statement {
    effect = <span class="hljs-string">&quot;Allow&quot;</span>
    actions = [
      <span class="hljs-string">&quot;logs:CreateLogGroup&quot;</span>,
      <span class="hljs-string">&quot;logs:CreateLogStream&quot;</span>,
      <span class="hljs-string">&quot;logs:PutLogEvents&quot;</span>,
    ]
    resources = [<span class="hljs-string">&quot;arn:aws:logs:*:*:*&quot;</span>]
  }
}
</code></pre>
<p>ì´ë ‡ê²Œ í•˜ë©´ ëŸ°íƒ€ì„ìœ¼ë¡œ Goë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒë‹¤ í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ê³  ì—­í• ì„ ë§Œë“¤ë©°, ëŒë‹¤ í•¨ìˆ˜ê°€ ì´ ì—­í• ì„ ê°€ì •í•˜ê³  í´ë¼ìš°ë“œì›Œì¹˜ì— ë¡œê¹…í•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<p>ë‹¤ìŒìœ¼ë¡œ, ëŒë‹¤ê°€ íŠ¸ë¦¬ê±°ë  ìˆ˜ ìˆë„ë¡ SNS ì£¼ì œì— ëŒ€í•œ êµ¬ë…ì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. lambdas.tf íŒŒì¼ì— ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<pre><code class="hljs language-js">resource <span class="hljs-string">&quot;aws_sns_topic_subscription&quot;</span> <span class="hljs-string">&quot;topic_subscription&quot;</span> {
  topic_arn = aws_sns_topic.<span class="hljs-property">topic</span>.<span class="hljs-property">arn</span>
  protocol  = <span class="hljs-string">&quot;lambda&quot;</span>
  endpoint  = aws_lambda_function.<span class="hljs-property">lambda</span>.<span class="hljs-property">arn</span>
}

resource <span class="hljs-string">&quot;aws_lambda_permission&quot;</span> <span class="hljs-string">&quot;apigw_lambda&quot;</span> {
  statement_id  = <span class="hljs-string">&quot;AllowExecutionFromSNS&quot;</span>
  action        = <span class="hljs-string">&quot;lambda:InvokeFunction&quot;</span>
  function_name = aws_lambda_function.<span class="hljs-property">lambda</span>.<span class="hljs-property">arn</span>
  principal     = <span class="hljs-string">&quot;sns.amazonaws.com&quot;</span>
  source_arn    = aws_sns_topic.<span class="hljs-property">topic</span>.<span class="hljs-property">arn</span>
}
</code></pre>
<p>ìµœì¢… lambdas.tf íŒŒì¼ì´ ë‹¤ìŒê³¼ ê°™ì´ ë˜ë„ë¡ ë§Œë“¤ì–´ë³´ì„¸ìš”:</p>
<pre><code class="hljs language-js">resource <span class="hljs-string">&quot;aws_iam_role&quot;</span> <span class="hljs-string">&quot;iam_for_lambda&quot;</span> {
  name               = <span class="hljs-string">&quot;thumbnail-generator-lambda-role&quot;</span>
  assume_role_policy = data.<span class="hljs-property">aws_iam_policy_document</span>.<span class="hljs-property">assume_role</span>.<span class="hljs-property">json</span>
  inline_policy {
    name   = <span class="hljs-string">&quot;DefaultPolicy&quot;</span>
    policy = data.<span class="hljs-property">aws_iam_policy_document</span>.<span class="hljs-property">lambda_role_policies</span>.<span class="hljs-property">json</span>
  }
}

resource <span class="hljs-string">&quot;aws_lambda_function&quot;</span> <span class="hljs-string">&quot;lambda&quot;</span> {
  filename      = data.<span class="hljs-property">archive_file</span>.<span class="hljs-property">lambda</span>.<span class="hljs-property">output_path</span>
  function_name = <span class="hljs-string">&quot;thumbnail-generator&quot;</span>
  role          = aws_iam_role.<span class="hljs-property">iam_for_lambda</span>.<span class="hljs-property">arn</span>
  handler       = <span class="hljs-string">&quot;main&quot;</span>
  runtime       = <span class="hljs-string">&quot;go1.x&quot;</span>
  timeout       = <span class="hljs-number">15</span>
}

resource <span class="hljs-string">&quot;aws_sns_topic_subscription&quot;</span> <span class="hljs-string">&quot;topic_subscription&quot;</span> {
  topic_arn = aws_sns_topic.<span class="hljs-property">topic</span>.<span class="hljs-property">arn</span>
  protocol  = <span class="hljs-string">&quot;lambda&quot;</span>
  endpoint  = aws_lambda_function.<span class="hljs-property">lambda</span>.<span class="hljs-property">arn</span>
}

resource <span class="hljs-string">&quot;aws_lambda_permission&quot;</span> <span class="hljs-string">&quot;apigw_lambda&quot;</span> {
  statement_id  = <span class="hljs-string">&quot;AllowExecutionFromSNS&quot;</span>
  action        = <span class="hljs-string">&quot;lambda:InvokeFunction&quot;</span>
  function_name = aws_lambda_function.<span class="hljs-property">lambda</span>.<span class="hljs-property">arn</span>
  principal     = <span class="hljs-string">&quot;sns.amazonaws.com&quot;</span>
  source_arn    = aws_sns_topic.<span class="hljs-property">topic</span>.<span class="hljs-property">arn</span>
}

data <span class="hljs-string">&quot;archive_file&quot;</span> <span class="hljs-string">&quot;lambda&quot;</span> {
  type        = <span class="hljs-string">&quot;zip&quot;</span>
  source_file = <span class="hljs-string">&quot;./lambda_init_code/main&quot;</span>
  output_path = <span class="hljs-string">&quot;thumbnail_generator_lambda_function_payload.zip&quot;</span>
}

data <span class="hljs-string">&quot;aws_iam_policy_document&quot;</span> <span class="hljs-string">&quot;assume_role&quot;</span> {
  statement {
    effect = <span class="hljs-string">&quot;Allow&quot;</span>
    principals {
      type        = <span class="hljs-string">&quot;Service&quot;</span>
      identifiers = [<span class="hljs-string">&quot;lambda.amazonaws.com&quot;</span>]
    }
    actions = [<span class="hljs-string">&quot;sts:AssumeRole&quot;</span>]
  }
}

data <span class="hljs-string">&quot;aws_iam_policy_document&quot;</span> <span class="hljs-string">&quot;lambda_role_policies&quot;</span> {
  statement {
    effect = <span class="hljs-string">&quot;Allow&quot;</span>
    actions = [
      <span class="hljs-string">&quot;logs:CreateLogGroup&quot;</span>,
      <span class="hljs-string">&quot;logs:CreateLogStream&quot;</span>,
      <span class="hljs-string">&quot;logs:PutLogEvents&quot;</span>
    ]
    resources = [<span class="hljs-string">&quot;arn:aws:logs:*:*:*&quot;</span>]
  }

  statement {
    effect = <span class="hljs-string">&quot;Allow&quot;</span>
    actions = [
      <span class="hljs-string">&quot;s3:GetObject&quot;</span>,
    ]
    resources = [
      <span class="hljs-title function_">format</span>(<span class="hljs-string">&quot;%s/%s*&quot;</span>, aws_s3_bucket.<span class="hljs-property">my</span>-app-images.<span class="hljs-property">arn</span>, aws_s3_object.<span class="hljs-property">images_folder</span>.<span class="hljs-property">key</span>)
    ]
  }

  statement {
    effect = <span class="hljs-string">&quot;Allow&quot;</span>
    actions = [
      <span class="hljs-string">&quot;s3:PutObject&quot;</span>,
    ]
    resources = [
      <span class="hljs-title function_">format</span>(<span class="hljs-string">&quot;%s/%s*&quot;</span>, aws_s3_bucket.<span class="hljs-property">my</span>-app-images.<span class="hljs-property">arn</span>, aws_s3_object.<span class="hljs-property">thumbnails_folder</span>.<span class="hljs-property">key</span>)
    ]
  }
}
</code></pre>
<div class="content-ad"></div>
<p>ìš°ë¦¬ì˜ SNS í† í”½ì´ ëŒë‹¤ë¥¼ ì´ë²¤íŠ¸ì™€ í•¨ê»˜ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œì„ ë¶€ì—¬í•  ê²ƒì…ë‹ˆë‹¤.</p>
<p>ëŒë‹¤ëŠ” 15ì´ˆì˜ ì œí•œ ì‹œê°„ì„ ê°–ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ê¸°ë³¸ ì œí•œ ì‹œê°„ì´ 3ì´ˆì´ê¸° ë•Œë¬¸ì— S3ë¡œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê³  ì—…ë¡œë“œí•˜ëŠ” ì‘ì—…ì€ ì´ë¯¸ì§€ í¬ê¸°ì— ë”°ë¼ 3ì´ˆë³´ë‹¤ ë” ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ëŠ” S3 ì‘ì—…ì´ ì¸í„°ë„·ì„ í†µê³¼í•˜ê¸° ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ê³  ì‹¶ë‹¤ë©´ VPCë¥¼ ìƒì„±í•˜ê³  ëŒë‹¤ì™€ VPC ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë§Œë“¤ì–´ S3 ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì—°ê²°ì´ ì¸í„°ë„·ì´ ì•„ë‹Œ AWS ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h2>ì¸í”„ë¼ ë°°í¬í•˜ê¸°</h2>
<p>ì´ì œ ìš°ë¦¬ê°€ ì½”ë“œë¡œ ì •ì˜í•œ ì¸í”„ë¼ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•´ GitHub ì•¡ì…˜ì„ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<p>ì½”ë“œì— .github/workflows í´ë”ë¥¼ ë§Œë“¤ê³  deploy-infra.yml íŒŒì¼ì„ ì¶”ê°€í•˜ì—¬ GitHub ì•¡ì…˜ ì›Œí¬í”Œë¡œìš°ë¥¼ ì •ì˜í•˜ì„¸ìš”:</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">Infrastructure</span>
<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">main</span>
    <span class="hljs-attr">paths:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">iac/**/*</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">.github/workflows/deploy-infra.yml</span>

<span class="hljs-attr">defaults:</span>
  <span class="hljs-attr">run:</span>
    <span class="hljs-attr">working-directory:</span> <span class="hljs-string">iac/</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">terraform:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;Terraform&#x27;</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-comment"># GitHub Actions ëŸ¬ë„ˆì— ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì²´í¬ì•„ì›ƒ</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Configure</span> <span class="hljs-string">AWS</span> <span class="hljs-string">Credentials</span> <span class="hljs-string">Action</span> <span class="hljs-string">For</span> <span class="hljs-string">GitHub</span> <span class="hljs-string">Actions</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">aws-actions/configure-aws-credentials@v1</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">aws-access-key-id:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.AWS_ACCESS_KEY</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">aws-secret-access-key:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.AWS_SECRET_ACCESS_KEY</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">aws-region:</span> <span class="hljs-string">eu-central-1</span>

      <span class="hljs-comment"># ìµœì‹  ë²„ì „ì˜ Terraform CLI ì„¤ì¹˜ ë° Terraform Cloud ì‚¬ìš©ì API í† í°ì„ ì‚¬ìš©í•˜ì—¬ Terraform CLI êµ¬ì„± íŒŒì¼ ì„¤ì •</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Terraform</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">hashicorp/setup-terraform@v3</span>

      <span class="hljs-comment"># Terraform ì›Œí‚¹ ë””ë ‰í„°ë¦¬ë¥¼ ì´ˆê¸°í™”í•˜ê³  ì´ˆê¸° íŒŒì¼ì„ ìƒì„±í•˜ê±°ë‚˜ ê¸°ì¡´ íŒŒì¼ì„ ë¡œë“œí•˜ê³  ëª¨ë“ˆ ë‹¤ìš´ë¡œë“œ ë“±ì„ ìˆ˜í–‰</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Terraform</span> <span class="hljs-string">Init</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">terraform</span> <span class="hljs-string">init</span>

      <span class="hljs-comment"># ëª¨ë“  Terraform êµ¬ì„± íŒŒì¼ì´ ê·œë²”ì  í˜•ì‹ì„ ì¤€ìˆ˜í•˜ëŠ”ì§€ í™•ì¸</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Terraform</span> <span class="hljs-string">Format</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">terraform</span> <span class="hljs-string">fmt</span> <span class="hljs-string">-check</span>

      <span class="hljs-comment"># Terraform ì‹¤í–‰ ê³„íš ìƒì„±</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Terraform</span> <span class="hljs-string">Plan</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          terraform plan -out=plan -input=false -var-file=&quot;variables.tfvars&quot; -var account_id=${{ secrets.AWS_ACCOUNT_ID }}
</span>
      <span class="hljs-comment"># &quot;main&quot;ìœ¼ë¡œ í‘¸ì‹œë˜ë©´ Terraform êµ¬ì„± íŒŒì¼ì— ë”°ë¼ ì¸í”„ë¼ë¥¼ êµ¬ì¶• ë˜ëŠ” ë³€ê²½í•¨</span>
      <span class="hljs-comment"># ì°¸ê³ : &quot;Terraform Cloud&quot;ì— ëŒ€í•´ &quot;strict&quot; ìƒíƒœ ê²€ì‚¬ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤. ìì„¸í•œ ì •ë³´ëŠ” ì•„ë˜ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”: https://help.github.com/en/github/administering-a-repository/types-of-required-status-checks</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Terraform</span> <span class="hljs-string">Apply</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">terraform</span> <span class="hljs-string">apply</span> <span class="hljs-string">-auto-approve</span> <span class="hljs-string">-input=false</span> <span class="hljs-string">plan</span>
</code></pre>
<ul>
<li>AWS_ACCESS_KEY â€” ìì›ì„ ìƒì„±í•  ê¶Œí•œì´ ìˆëŠ” AWSì˜ ì•¡ì„¸ìŠ¤ í‚¤ì…ë‹ˆë‹¤</li>
<li>AWS_SECRET_ACCESS_KEY â€” ì•¡ì„¸ìŠ¤ í‚¤ì™€ ì—°ê²°ëœ AWS ì‹œí¬ë¦¿</li>
<li>AWS_ACCOUNT_ID â€” AWS ëŒ€ì‹œë³´ë“œ ì˜¤ë¥¸ìª½ ìƒë‹¨ì— ìˆëŠ” ê³„ì • IDì…ë‹ˆë‹¤</li>
<li>YOUR_REGION â€” ì¸í”„ë¼ë¥¼ ë°°í¬í•  ê¸°ë³¸ ì§€ì—­</li>
</ul>
<p>ì´ì œ ì½”ë“œë¥¼ GitHubì— í‘¸ì‹œí•˜ê³  ì›Œí¬í”Œë¡œìš°ê°€ ì™„ë£Œë˜ë©´ ì¸í”„ë¼ê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•´ë³´ì„¸ìš”.</p>
<div class="content-ad"></div>
<p>í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ì´ë¯¸ì§€/ í´ë”ì— íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  CloudWatchì—ì„œ ëŒë‹¤ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>S3ëŠ” ë‘ ê°œì˜ í´ë”ë¡œ ìƒì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:</p>
<p><img src="/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_2.png" alt="image"/></p>
<p>SNSëŠ” êµ¬ë…ì´ ìˆëŠ” ìƒíƒœë¡œ ìƒì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:</p>
<div class="content-ad"></div>
<img src="/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_3.png"/>
<p>Lambdaë¥¼ SNS íŠ¸ë¦¬ê±°ì™€ í•¨ê»˜ ìƒì„±í•´ì•¼í•©ë‹ˆë‹¤:</p>
<img src="/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_4.png"/>
<h1>Lambda êµ¬í˜„</h1>
<div class="content-ad"></div>
<p>ì¸í”„ë¼ê°€ ì„¤ì¹˜ë˜ì—ˆìœ¼ë¯€ë¡œ ì¸ë„¤ì¼ ìƒì„±ê¸° ì½”ë“œë¥¼ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<p>ë£¨íŠ¸ ë ˆë²¨ì— srcì´ë¼ëŠ” ìƒˆ í´ë”ë¥¼ ìƒì„±í•˜ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ Go ëª¨ë“ˆì„ ì´ˆê¸°í™”í•´ë³´ì„¸ìš”:</p>
<pre><code class="hljs language-js">go mod init example.<span class="hljs-property">com</span>/thumbnail-generator
go get github.<span class="hljs-property">com</span>/aws/aws-lambda-go
go get github.<span class="hljs-property">com</span>/aws/aws-sdk-go-v2
go get github.<span class="hljs-property">com</span>/aws/aws-sdk-go-v2/service/s3
go get github.<span class="hljs-property">com</span>/aws/aws-sdk-go-v2/config
go get github.<span class="hljs-property">com</span>/disintegration/imaging
</code></pre>
<p>ì›í•˜ëŠ” ê²½ìš° example.com/thumbnail-generatorë¥¼ ì„ í˜¸í•˜ëŠ” ëª¨ë“ˆ ì´ë¦„ìœ¼ë¡œ êµì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<p>ì´ì œ main.go íŒŒì¼ì„ ë§Œë“¤ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”:</p>
<pre><code class="hljs language-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;bytes&quot;</span>
	<span class="hljs-string">&quot;context&quot;</span>
	<span class="hljs-string">&quot;encoding/json&quot;</span>
	<span class="hljs-string">&quot;fmt&quot;</span>
	<span class="hljs-string">&quot;image&quot;</span>
	<span class="hljs-string">&quot;image/png&quot;</span>
	<span class="hljs-string">&quot;io&quot;</span>
	<span class="hljs-string">&quot;log&quot;</span>
	<span class="hljs-string">&quot;strings&quot;</span>

	<span class="hljs-string">&quot;github.com/aws/aws-lambda-go/events&quot;</span>
	<span class="hljs-string">&quot;github.com/aws/aws-lambda-go/lambda&quot;</span>
	<span class="hljs-string">&quot;github.com/aws/aws-sdk-go-v2/aws&quot;</span>
	<span class="hljs-string">&quot;github.com/aws/aws-sdk-go-v2/config&quot;</span>
	<span class="hljs-string">&quot;github.com/aws/aws-sdk-go-v2/service/s3&quot;</span>
	<span class="hljs-string">&quot;github.com/disintegration/imaging&quot;</span>
)

<span class="hljs-keyword">type</span> awsClient <span class="hljs-keyword">struct</span> {
	s3  s3.Client
	ctx *context.Context
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handleRequest</span><span class="hljs-params">(ctx context.Context, event events.SNSEvent)</span></span> <span class="hljs-type">error</span> {
	awsConfig, err := config.LoadDefaultConfig(ctx)

	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatalf(<span class="hljs-string">&quot;AWS ê¸°ë³¸ êµ¬ì„±ì„ ë¶ˆëŸ¬ ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤&quot;</span>)
		<span class="hljs-keyword">return</span> err
	}

	awsClient := awsClient{s3: *s3.NewFromConfig(awsConfig), ctx: &amp;ctx}

	<span class="hljs-keyword">for</span> _, record := <span class="hljs-keyword">range</span> event.Records {
		<span class="hljs-keyword">var</span> imageEvent events.S3Event

		err := json.Unmarshal([]<span class="hljs-type">byte</span>(record.SNS.Message), &amp;imageEvent)

		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			log.Fatalf(<span class="hljs-string">&quot;SNS ë©”ì‹œì§€ %sì„ S3 ì´ë²¤íŠ¸ ë ˆì½”ë“œë¡œ ì–¸ë§ˆìƒ¬í•˜ëŠ” ë™ì•ˆ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: %v&quot;</span>, record.SNS.Message, err)
			<span class="hljs-keyword">return</span> err
		}

		<span class="hljs-keyword">for</span> _, imageRecord := <span class="hljs-keyword">range</span> imageEvent.Records {
			bucketName := imageRecord.S3.Bucket.Name
			objectKey := imageRecord.S3.Object.Key

			file, err := awsClient.downloadFile(bucketName, objectKey)

			log.Printf(<span class="hljs-string">&quot;ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì„±ê³µ&quot;</span>)

			<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
				log.Fatalf(<span class="hljs-string">&quot;ë²„í‚· %sì—ì„œ íŒŒì¼ %sì„ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤&quot;</span>, bucketName, objectKey)
				<span class="hljs-keyword">return</span> err
			}

			thumbnail, err := createThumbnail(file)

			<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
				log.Fatalf(<span class="hljs-string">&quot;ë²„í‚· %sì˜ íŒŒì¼ %sì— ëŒ€í•œ ì„¬ë„¤ì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì˜¤ë¥˜: %v&quot;</span>, bucketName, objectKey, err)
				<span class="hljs-keyword">return</span> err
			}

			log.Printf(<span class="hljs-string">&quot;ì„¬ë„¤ì¼ ìƒì„± ì„±ê³µ&quot;</span>)

			err = awsClient.uploadFile(bucketName, objectKey, thumbnail)

			log.Printf(<span class="hljs-string">&quot;ì„¬ë„¤ì¼ ì—…ë¡œë“œ ì„±ê³µ&quot;</span>)

			<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
				log.Fatalf(<span class="hljs-string">&quot;ë²„í‚· %sì— íŒŒì¼ %sì„ thumbnails/ì— ì—…ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤&quot;</span>, bucketName, objectKey)
				<span class="hljs-keyword">return</span> err
			}
		}
	}

	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createThumbnail</span><span class="hljs-params">(reader io.Reader)</span></span> (*bytes.Buffer, <span class="hljs-type">error</span>) {
	srcImage, _, err := image.Decode(reader)

	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatalf(<span class="hljs-string">&quot;ì˜¤ë¥˜ë¡œ ì¸í•´ íŒŒì¼ì„ ë””ì½”ë”©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: %v&quot;</span>, err)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}

	<span class="hljs-comment">// 80x80 í¬ê¸°ì˜ ì„¬ë„¤ì¼ ìƒì„±</span>
	thumbnail := imaging.Thumbnail(srcImage, <span class="hljs-number">80</span>, <span class="hljs-number">80</span>, imaging.Lanczos)

	<span class="hljs-keyword">var</span> bufferBytes []<span class="hljs-type">byte</span>
	buffer := bytes.NewBuffer(bufferBytes)

	err = png.Encode(buffer, thumbnail)

	<span class="hljs-keyword">return</span> buffer, err
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(client *awsClient)</span></span> downloadFile(bucketName <span class="hljs-type">string</span>, objectKey <span class="hljs-type">string</span>) (*bytes.Reader, <span class="hljs-type">error</span>) {
	result, err := client.s3.GetObject(*client.ctx, &amp;s3.GetObjectInput{
		Bucket: aws.String(bucketName),
		Key:    aws.String(objectKey),
	})

	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatalf(<span class="hljs-string">&quot;ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ %v:%v. ì›ì¸: %v&quot;</span>, bucketName, objectKey, err)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}

	<span class="hljs-keyword">defer</span> result.Body.Close()

	body, err := io.ReadAll(result.Body)

	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatalf(<span class="hljs-string">&quot;íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ. ì˜¤ë¥˜: %s&quot;</span>, err)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}

	file := bytes.NewReader(body)

	<span class="hljs-keyword">return</span> file, err
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(client *awsClient)</span></span> uploadFile(bucketName <span class="hljs-type">string</span>, originalObjectKey <span class="hljs-type">string</span>, thumbnail io.Reader) <span class="hljs-type">error</span> {
	objectKeyParts := strings.Split(originalObjectKey, <span class="hljs-string">&quot;/&quot;</span>)
	fileNameWithoutExtensions := strings.Split(objectKeyParts[<span class="hljs-built_in">len</span>(objectKeyParts)<span class="hljs-number">-1</span>], <span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">0</span>]
	objectKey := fmt.Sprintf(<span class="hljs-string">&quot;thumbnails/%s_thumbnail.png&quot;</span>, fileNameWithoutExtensions)

	_, err := client.s3.PutObject(*client.ctx, &amp;s3.PutObjectInput{
		Bucket: aws.String(bucketName),
		Key:    aws.String(objectKey),
		Body:   thumbnail,
	})

	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatalf(<span class="hljs-string">&quot;%vì„(ë¥¼) %vì˜ %vì— ì—…ë¡œë“œí•  ìˆ˜ ì—†ìŒ. ì›ì¸: %v\n&quot;</span>,
			originalObjectKey, bucketName, objectKey, err)
	}

	<span class="hljs-keyword">return</span> err
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	lambda.Start(handleRequest)
}
</code></pre>
<p>ì´ì œ GitHub workflowë¥¼ ì„¤ì •í•˜ì—¬ ëŒë‹¤ ì½”ë“œë¥¼ ë°°í¬í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<p>.github/workflows í´ë”ì— deploy-lambda.ymlì´ë¼ëŠ” ìƒˆ íŒŒì¼ì„ ì¶”ê°€í•˜ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”:```</p>
<div class="content-ad"></div>
<pre><code class="hljs language-bash">name: Deploy Thumbnail Generator Lambda
on:
  push:
    branches:
      - main
    paths:
      - src/**/*
      - .github/workflows/deploy-lambda.yml

defaults:
  run:
    working-directory: src/

<span class="hljs-built_in">jobs</span>:
  terraform:
    name: <span class="hljs-string">&#x27;Deploy Thumbnail Generator Lambda&#x27;</span>
    runs-on: ubuntu-latest
    steps:
      <span class="hljs-comment"># Checkout the repository to the GitHub Actions runner</span>
      - name: Checkout
        uses: actions/checkout@v3

      - uses: actions/setup-go@v4.1.0
        with:
          go-version: <span class="hljs-string">&#x27;1.22.0&#x27;</span>

      - name: Configure AWS Credentials Action For GitHub Actions
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: <span class="hljs-variable">${ secrets.AWS_ACCESS_KEY }</span>
          aws-secret-access-key: <span class="hljs-variable">${ secrets.AWS_SECRET_ACCESS_KEY }</span>
          aws-region: eu-central-1

      - name: Build Lambda
        run: GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -o build/main .

      - name: Zip build
        run: zip -r -j main.zip ./build

      - name: Update Lambda code
        run: aws lambda update-function-code --function-name=thumbnail-generator --zip-file=fileb://main.zip
</code></pre>
<p>ì½”ë“œë¥¼ ì»¤ë°‹í•˜ê³  ë ˆí¬ì§€í† ë¦¬ì— í‘¸ì‹œí•˜ë©´ ë¹Œë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>
<p>ì™„ë£Œë˜ë©´ Lambda í˜ì´ì§€ì˜ &quot;ìµœì¢… ìˆ˜ì •&quot; ì†ì„±ì„ í™•ì¸í•˜ì—¬ ë°°í¬ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<img src="/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_5.png"/>
<div class="content-ad"></div>
<p>í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ S3 ë²„í‚·ì˜ images/ í´ë”ì— ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤. ì—…ë¡œë“œê°€ ì„±ê³µí•˜ë©´ ì ì‹œ ê¸°ë‹¤ë¦° í›„ ìƒˆë¡œ ë§Œë“  ì„¬ë„¤ì¼ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h1>ê²°ë¡ </h1>
<p>ì´ ê¸€ì—ì„œëŠ” Terraform ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ë¥¼ ì‚¬ìš©í•˜ì—¬ S3 ë²„í‚·, ëŒë‹¤, SNS, SNS ì•Œë¦¼ ë“±ì„ ìƒì„±í•˜ê³  ì—°ê²°í•˜ëŠ” ë°©ë²•ì„ ë°°ì› ìŠµë‹ˆë‹¤.</p>
<p>ë˜í•œ S3 ì´ë²¤íŠ¸ë¥¼ SNS í† í”½ì— ë³´ë‚´ì–´ ì´ë¥¼ ë‹¤ë¥¸ ì†ŒìŠ¤(ë‹¤ë¥¸ SNS í† í”½ í¬í•¨)ë¡œ í™•ì‚°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ë„ ë°°ì› ìŠµë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<p>ì €í¬ëŠ” Goë¡œ ì‘ì„±ëœ ëŒë‹¤ í•¨ìˆ˜ë„ ë§Œë“¤ì—ˆì–´ìš”. ì´ í•¨ìˆ˜ëŠ” SNS ë©”ì‹œì§€ë¥¼ í†µí•´ í˜¸ì¶œë˜ì–´ S3 ë²„í‚·ì—ì„œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê³  ì´ë¯¸ì§€ì—ì„œ ì¸ë„¤ì¼ì„ ìƒì„±í•œ ë‹¤ìŒ ì´ ì¸ë„¤ì¼ì„ S3ì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.</p>
<p>ì´ ê¸€ì˜ ì½”ë“œëŠ” ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>
<p>ì¦ê±°ìš´ ì½”ë”©í•˜ì„¸ìš”! ğŸ’»</p></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"S3 ì´ë²¤íŠ¸ ì•Œë¦¼ì„ ì‚¬ìš©í•˜ì—¬ ì¸ë„¤ì¼ ìƒì„±í•˜ê¸°","description":"","date":"2024-05-17 18:32","slug":"2024-05-17-UseS3eventnotificationstogeneratethumbnails","content":"\n\n## ì´ë²¤íŠ¸ ê¸°ë°˜ ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜\n\n![ì´ë¯¸ì§€](/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_0.png)\n\nì•ˆë…•í•˜ì„¸ìš”!\n\nì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŒŒì¼ì„ í´ë¼ìš°ë“œì— ì €ì¥í•˜ëŠ” ê²ƒì€ íŒŒì¼ ì§€ì†ì„±ì˜ í•œ ë°©ë²•ìœ¼ë¡œ ë§¤ìš° ì¼ë°˜ì ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì–´ë””ì—ì„œ ì–´ë–»ê²Œ ì‚¬ìš©ë ì§€ì— ëŒ€í•œ ë§ì€ ìœ ì—°ì„±ì„ ì œê³µí•©ë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nAWSëŠ” ê°ì²´ë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ìœ¼ë¡œ ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ S3 (Simple Storage Service)ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ëŠ” ë†’ì€ ê°€ìš©ì„±, í™•ì¥ì„± ë° ì„±ëŠ¥ì„ ê°–ì¶”ê³  ìˆìŠµë‹ˆë‹¤. ì£¼ë¡œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì €ì¥ ì„œë¹„ìŠ¤ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.\n\nS3ëŠ” ë²„í‚· ì•ˆì—ì„œ ê°ì²´ ì‘ì—…ì— ëŒ€í•œ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ë„ ì œê³µí•©ë‹ˆë‹¤. ì´ëŠ” ê°ì²´ ìƒì„±, ì—…ë°ì´íŠ¸, ì´ë™, ì‚­ì œ ë“±ì˜ ì‘ì—…ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ S3 ì´ë²¤íŠ¸ ì•Œë¦¼ì´ë¼ê³  í•©ë‹ˆë‹¤.\n\nì´ ë¬¸ì„œì—ì„œëŠ” ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•  ë•Œë§ˆë‹¤ í•´ë‹¹ ì´ë¯¸ì§€ì— ëŒ€í•œ ì„¬ë„¤ì¼ì„ ìƒì„±í•˜ëŠ” ì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.\n\nìš°ë¦¬ëŠ” ì´ë²¤íŠ¸ ì•Œë¦¼ì„ ìˆ˜ì‹ í•˜ê³  ì„¬ë„¤ì¼ì„ ìƒì„±í•˜ëŠ” Goë¡œ ì‘ì„±ëœ ëŒë‹¤ í•¨ìˆ˜ë¥¼ ê°€ì§ˆ ê²ƒì…ë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\ní•´ë³´ìêµ¬ìš”!\n\n# ìš”êµ¬ ì‚¬í•­\n\n- AWS ê³„ì •\n- ì¢‹ì•„í•˜ëŠ” ì½”ë“œ í¸ì§‘ê¸° (ì €ëŠ” Visual Studio Codeë¥¼ ì‚¬ìš©í•  ì˜ˆì •ì…ë‹ˆë‹¤)\n- GitHub ê³„ì •\n\n# ì•„í‚¤í…ì²˜\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\u003cimg src=\"/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_1.png\" /\u003e\n\në²„í‚·ì„ êµ¬ì„±í•˜ì—¬ ê°ì²´ ì´ë²¤íŠ¸ë¥¼ SNS í† í”½ìœ¼ë¡œ ë³´ë‚´ê³  í•´ë‹¹ ë©”ì‹œì§€ë¥¼ ìƒì„±í•œ ì¸ë„¤ì¼ì„ S3 ë²„í‚·ì— ì—…ë¡œë“œí•  ëŒë‹¤ë¡œ ì „ì†¡í•  ê²ƒì…ë‹ˆë‹¤.\n\nS3 ë²„í‚· ì´ë²¤íŠ¸ì— ëŒë‹¤ë¥¼ ì§ì ‘ ëŒ€ìƒìœ¼ë¡œ ì§€ì •í•˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤. ì´ìœ ëŠ” ê° ì´ë²¤íŠ¸ ì•Œë¦¼ì— ëŒ€í•´ í•˜ë‚˜ì˜ ëŒ€ìƒ ìœ í˜•ë§Œ ì§€ì •í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. SNS í† í”½ì„ ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ SQS ëŒ€ê¸°ì—´, ì´ë©”ì¼, ì „í™” ì•Œë¦¼ ë° SNSê°€ ì§€ì›í•˜ëŠ” ê¸°íƒ€ ì—¬ëŸ¬ ëŒ€ìƒìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ì „íŒŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n# Terraformì„ ì‚¬ìš©í•˜ì—¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸°\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## ì´ë¯¸ì§€ S3 ë²„í‚·\n\nì‹œì‘í•˜ë ¤ë©´ ìš°ë¦¬ì˜ í…Œë¼í¼ í´ë”ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ í”„ë¡œì íŠ¸ì˜ ë£¨íŠ¸ ë ˆë²¨ì— iacë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”. ê·¸ ì•ˆì— providers.tfë¼ëŠ” íŒŒì¼ì„ ìƒì„±í•´ AWS í”„ë¡œë°”ì´ë”ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆë„ë¡ ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”:\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~\u003e 5.0\"\n    }\n  }\n}\n\n// Regionì€ AWS_REGION í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì„¤ì •ë©ë‹ˆë‹¤\nprovider \"aws\" {\n}\n```\n\në§Œì•½ í…Œë¼í¼ì´ ì¸í”„ë¼ ìƒíƒœë¥¼ ì¶”ì í•˜ë„ë¡ í•˜ë ¤ë©´, AWSì—ì„œ S3 ë²„í‚·ì„ ìƒì„±í•˜ê³  ìƒíƒœ ë°±ì—”ë“œë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì½”ë“œì—ì„œì²˜ëŸ¼ í•˜ì‹œë©´ ë©ë‹ˆë‹¤:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nterraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~\u003e 5.0\"\n    }\n  }\n\n  backend \"s3\" {\n    bucket = \"terraform-medium-api-notification\" // ì—¬ê¸°ê°€ ìƒíƒœ ë²„í‚·ì…ë‹ˆë‹¤\n    key    = \"thumbnail-generator/state\"\n  }\n}\n\n// AWS_REGION í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì§€ì—­ ì„¤ì •ë¨\nprovider \"aws\" {\n}\n```\n\nì´ì œ ì´ë¯¸ì§€ë¥¼ í˜¸ìŠ¤íŒ…í•˜ëŠ” S3 ë²„í‚·ì„ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.\n\niac í´ë”ì— s3.tfë¼ëŠ” íŒŒì¼ì„ ë§Œë“¤ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”:\n\n```js\nresource \"aws_s3_bucket\" \"my-app-images\" {\n  bucket = \"my-super-app-images\" // ë²„í‚·ì— ê³ ìœ í•œ ì´ë¦„ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”\n}\n\nresource \"aws_s3_object\" \"images_folder\" {\n  bucket = aws_s3_bucket.my-app-images.bucket\n  key    = \"images/\"\n}\n\nresource \"aws_s3_object\" \"thumbnails_folder\" {\n  bucket = aws_s3_bucket.my-app-images.bucket\n  key    = \"thumbnails/\"\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\në²„í‚· ì†ì„±ì—ì„œëŠ” ë²„í‚·ì— ê³ ìœ í•œ ì´ë¦„ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ì™œëƒí•˜ë©´ S3 ë²„í‚· ì´ë¦„ì€ ëª¨ë“  AWS ì „ì—­ì—ì„œ ê³ ìœ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ë¦„ì„ ì œê³µí•˜ì§€ ì•Šìœ¼ë ¤ë©´ ë¹„ì›Œë‘ê³  AWSê°€ ê³ ìœ í•œ ë²„í‚· ì´ë¦„ì„ í• ë‹¹í•´ ì¤„ ê²ƒì…ë‹ˆë‹¤.\n\nì´ ì½”ë“œëŠ” ì´ë¯¸ì§€/ ë° ì¸ë„¤ì¼/ ë‘ ê°œì˜ í´ë”ê°€ ìˆëŠ” S3 ë²„í‚·ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ í´ë”ë“¤ì€ íŒŒì¼ì„ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.\n\n## SNSë¥¼ ì‚¬ìš©í•œ ë©”ì‹œì§•\n\nì´ì œ ì•Œë¦¼ ì£¼ì œì™€ ë©”ì‹œì§€ ëŒ€ê¸°ì—´ì„ ì„¤ì •í•´ ë´…ì‹œë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```yaml\n# messaging.tf\n\nresource \"aws_sns_topic\" \"topic\" {\n  name   = \"image-events\"\n}\n```\n\n```yaml\n# variables.tf\n\nvariable \"region\" {\n  description = \"Default region of your resources\"\n  type        = string\n  default     = \"eu-central-1\" # Set as your default region here\n}\n\nvariable \"account_id\" {\n  description = \"The ID of the default AWS account\"\n  type        = string\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nê·¸ë¦¬ê³  variables.tfvarsë¼ëŠ” ë˜ ë‹¤ë¥¸ íŒŒì¼ì„ ë§Œë“¤ì–´ ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”:\n\n```js\nregion = \"eu-central-1\" // ì›í•˜ëŠ” ì§€ì—­ì„ ì„¤ì •í•˜ì„¸ìš”\n```\n\në‚˜ì¤‘ì— í…Œë¼í¼ ëª…ë ¹ì–´ì— ì „ë‹¬í•  account_idëŠ” ë‚˜ì¤‘ì— ì¸ìˆ˜ë¡œ ì „ë‹¬í•  ê²ƒì…ë‹ˆë‹¤.\n\n## S3 ì´ë²¤íŠ¸ ì•Œë¦¼\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì´ì œ S3ì— ëŒ€í•œ ì´ë²¤íŠ¸ ì•Œë¦¼ì„ ì„¤ì •í•´ ë´…ì‹œë‹¤.\n\ns3.tf íŒŒì¼ì— ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì—¬ ë²„í‚· ì•Œë¦¼ì„ ì„¤ì •í•˜ì„¸ìš”:\n\n```js\nresource \"aws_s3_bucket_notification\" \"images_put_notification\" {\n  bucket = aws_s3_bucket.my-app-images.id\n  topic {\n    topic_arn = aws_sns_topic.topic.arn\n    filter_prefix = \"images/\"\n    events = [\"s3:ObjectCreated:*\"]\n  }\n}\n```\n\nì´ë¥¼ í™œì„±í™”í•˜ë ¤ë©´ S3 ë²„í‚·ì´ í•´ë‹¹ topicìœ¼ë¡œ ì•Œë¦¼ì„ ë°œí–‰í•  ìˆ˜ ìˆë„ë¡ SNS topicì— ì •ì±…ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. messaging.tf íŒŒì¼ë¡œ ì´ë™í•˜ì—¬ ë‹¤ìŒ ì •ì±…ì„ ì¶”ê°€í•˜ì„¸ìš”:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\në¦¬ì†ŒìŠ¤ \"aws_sns_topic\" \"topic\" {\n  name   = \"image-events\"\n  policy = data.aws_iam_policy_document.sns-topic-policy.json\n}\n\në°ì´í„° \"aws_iam_policy_document\" \"sns-topic-policy\" {\n  policy_id = \"arn:aws:sns:${var.region}:${var.account_id}:image-events/SNSS3NotificationPolicy\"\n  statement {\n    sid    = \"s3-allow-send-messages\"\n    effect = \"Allow\"\n    principals {\n      type        = \"Service\"\n      identifiers = [\"s3.amazonaws.com\"]\n    }\n    actions = [\n      \"SNS:Publish\",\n    ]\n    resources = [\n      \"arn:aws:sns:${var.region}:${var.account_id}:image-events\",\n    ]\n    condition {\n      test     = \"ArnEquals\"\n      variable = \"aws:SourceArn\"\n      values = [\n        aws_s3_bucket.my-app-images.arn\n      ]\n    }\n  }\n}\n```\n\nì—¬ê¸°ì„œëŠ” sns-topic-policy ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê³  í•´ë‹¹ ë¦¬ì†ŒìŠ¤ë¥¼ policy ì†ì„±ì— ì „ë‹¬í•˜ëŠ” topic ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.\n\n## ê¸°ë³¸ ëŒë‹¤ ì¶”ê°€í•˜ê¸°\n\nì´ì œ ëŒë‹¤ì˜ ê¸°ë°˜ ì¸í”„ë¼ë¥¼ ì¶”ê°€í•˜ê¸°ë§Œ ë‚¨ì•˜ìŠµë‹ˆë‹¤. ì´í›„ì— ì½”ë“œë¥¼ ì¶”ê°€í•  ê¸°ë³¸ ëŒë‹¤ë¥¼ ì„¤ì •í•  ê²ƒì…ë‹ˆë‹¤. Go ì–¸ì–´ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•  ì˜ˆì •ì…ë‹ˆë‹¤.\n \n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\në¨¼ì €, ëŒë‹¤ í•¨ìˆ˜ë¥¼ ì´ˆê¸°í™”í•  ê¸°ë³¸ ì½”ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ iac í´ë”ì— lambda_init_codeë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”. ì—¬ê¸°ì„œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ê°€ì ¸ì™€ì„œ ë©”ì¸ ì»´íŒŒì¼ëœ íŒŒì¼ì„ ì§ì ‘ ì‚¬ìš©í•˜ê±°ë‚˜ README.md íŒŒì¼ì˜ ì§€ì‹œì— ë”°ë¼ ìƒˆë¡œìš´ ì‹¤í–‰ ê°€ëŠ¥ íŒŒì¼ì„ ì»´íŒŒì¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì´ì œ ìƒˆ íŒŒì¼ lambdas.tfë¥¼ ìƒì„±í•˜ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì—¬ ëŒë‹¤ ì¸í”„ë¼ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n```js\nresource \"aws_iam_role\" \"iam_for_lambda\" {\n  name               = \"thumbnail-generator-lambda-role\"\n  assume_role_policy = data.aws_iam_policy_document.assume_role.json\n  inline_policy {\n    name   = \"DefaultPolicy\"\n    policy = data.aws_iam_policy_document.lambda_role_policies.json\n  }\n}\nresource \"aws_lambda_function\" \"lambda\" {\n  filename      = data.archive_file.lambda.output_path\n  function_name = \"thumbnail-generator\"\n  role          = aws_iam_role.iam_for_lambda.arn\n  handler       = \"main\"\n  runtime       = \"go1.x\"\n  timeout       = 15\n}\n\ndata \"archive_file\" \"lambda\" {\n  type        = \"zip\"\n  source_file = \"./lambda_init_code/main\"\n  output_path = \"thumbnail_generator_lambda_function_payload.zip\"\n}\n\ndata \"aws_iam_policy_document\" \"assume_role\" {\n  statement {\n    effect = \"Allow\"\n    principals {\n      type        = \"Service\"\n      identifiers = [\"lambda.amazonaws.com\"]\n    }\n    actions = [\"sts:AssumeRole\"]\n  }\n}\n\ndata \"aws_iam_policy_document\" \"lambda_role_policies\" {\n  statement {\n    effect = \"Allow\"\n    actions = [\n      \"logs:CreateLogGroup\",\n      \"logs:CreateLogStream\",\n      \"logs:PutLogEvents\",\n    ]\n    resources = [\"arn:aws:logs:*:*:*\"]\n  }\n}\n```\n\nì´ë ‡ê²Œ í•˜ë©´ ëŸ°íƒ€ì„ìœ¼ë¡œ Goë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒë‹¤ í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ê³  ì—­í• ì„ ë§Œë“¤ë©°, ëŒë‹¤ í•¨ìˆ˜ê°€ ì´ ì—­í• ì„ ê°€ì •í•˜ê³  í´ë¼ìš°ë“œì›Œì¹˜ì— ë¡œê¹…í•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\në‹¤ìŒìœ¼ë¡œ, ëŒë‹¤ê°€ íŠ¸ë¦¬ê±°ë  ìˆ˜ ìˆë„ë¡ SNS ì£¼ì œì— ëŒ€í•œ êµ¬ë…ì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. lambdas.tf íŒŒì¼ì— ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n```js\nresource \"aws_sns_topic_subscription\" \"topic_subscription\" {\n  topic_arn = aws_sns_topic.topic.arn\n  protocol  = \"lambda\"\n  endpoint  = aws_lambda_function.lambda.arn\n}\n\nresource \"aws_lambda_permission\" \"apigw_lambda\" {\n  statement_id  = \"AllowExecutionFromSNS\"\n  action        = \"lambda:InvokeFunction\"\n  function_name = aws_lambda_function.lambda.arn\n  principal     = \"sns.amazonaws.com\"\n  source_arn    = aws_sns_topic.topic.arn\n}\n```\n\nìµœì¢… lambdas.tf íŒŒì¼ì´ ë‹¤ìŒê³¼ ê°™ì´ ë˜ë„ë¡ ë§Œë“¤ì–´ë³´ì„¸ìš”:\n\n```js\nresource \"aws_iam_role\" \"iam_for_lambda\" {\n  name               = \"thumbnail-generator-lambda-role\"\n  assume_role_policy = data.aws_iam_policy_document.assume_role.json\n  inline_policy {\n    name   = \"DefaultPolicy\"\n    policy = data.aws_iam_policy_document.lambda_role_policies.json\n  }\n}\n\nresource \"aws_lambda_function\" \"lambda\" {\n  filename      = data.archive_file.lambda.output_path\n  function_name = \"thumbnail-generator\"\n  role          = aws_iam_role.iam_for_lambda.arn\n  handler       = \"main\"\n  runtime       = \"go1.x\"\n  timeout       = 15\n}\n\nresource \"aws_sns_topic_subscription\" \"topic_subscription\" {\n  topic_arn = aws_sns_topic.topic.arn\n  protocol  = \"lambda\"\n  endpoint  = aws_lambda_function.lambda.arn\n}\n\nresource \"aws_lambda_permission\" \"apigw_lambda\" {\n  statement_id  = \"AllowExecutionFromSNS\"\n  action        = \"lambda:InvokeFunction\"\n  function_name = aws_lambda_function.lambda.arn\n  principal     = \"sns.amazonaws.com\"\n  source_arn    = aws_sns_topic.topic.arn\n}\n\ndata \"archive_file\" \"lambda\" {\n  type        = \"zip\"\n  source_file = \"./lambda_init_code/main\"\n  output_path = \"thumbnail_generator_lambda_function_payload.zip\"\n}\n\ndata \"aws_iam_policy_document\" \"assume_role\" {\n  statement {\n    effect = \"Allow\"\n    principals {\n      type        = \"Service\"\n      identifiers = [\"lambda.amazonaws.com\"]\n    }\n    actions = [\"sts:AssumeRole\"]\n  }\n}\n\ndata \"aws_iam_policy_document\" \"lambda_role_policies\" {\n  statement {\n    effect = \"Allow\"\n    actions = [\n      \"logs:CreateLogGroup\",\n      \"logs:CreateLogStream\",\n      \"logs:PutLogEvents\"\n    ]\n    resources = [\"arn:aws:logs:*:*:*\"]\n  }\n\n  statement {\n    effect = \"Allow\"\n    actions = [\n      \"s3:GetObject\",\n    ]\n    resources = [\n      format(\"%s/%s*\", aws_s3_bucket.my-app-images.arn, aws_s3_object.images_folder.key)\n    ]\n  }\n\n  statement {\n    effect = \"Allow\"\n    actions = [\n      \"s3:PutObject\",\n    ]\n    resources = [\n      format(\"%s/%s*\", aws_s3_bucket.my-app-images.arn, aws_s3_object.thumbnails_folder.key)\n    ]\n  }\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nìš°ë¦¬ì˜ SNS í† í”½ì´ ëŒë‹¤ë¥¼ ì´ë²¤íŠ¸ì™€ í•¨ê»˜ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œì„ ë¶€ì—¬í•  ê²ƒì…ë‹ˆë‹¤.\n\nëŒë‹¤ëŠ” 15ì´ˆì˜ ì œí•œ ì‹œê°„ì„ ê°–ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ê¸°ë³¸ ì œí•œ ì‹œê°„ì´ 3ì´ˆì´ê¸° ë•Œë¬¸ì— S3ë¡œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê³  ì—…ë¡œë“œí•˜ëŠ” ì‘ì—…ì€ ì´ë¯¸ì§€ í¬ê¸°ì— ë”°ë¼ 3ì´ˆë³´ë‹¤ ë” ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ëŠ” S3 ì‘ì—…ì´ ì¸í„°ë„·ì„ í†µê³¼í•˜ê¸° ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ê³  ì‹¶ë‹¤ë©´ VPCë¥¼ ìƒì„±í•˜ê³  ëŒë‹¤ì™€ VPC ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë§Œë“¤ì–´ S3 ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì—°ê²°ì´ ì¸í„°ë„·ì´ ì•„ë‹Œ AWS ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n## ì¸í”„ë¼ ë°°í¬í•˜ê¸°\n\nì´ì œ ìš°ë¦¬ê°€ ì½”ë“œë¡œ ì •ì˜í•œ ì¸í”„ë¼ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•´ GitHub ì•¡ì…˜ì„ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì½”ë“œì— .github/workflows í´ë”ë¥¼ ë§Œë“¤ê³  deploy-infra.yml íŒŒì¼ì„ ì¶”ê°€í•˜ì—¬ GitHub ì•¡ì…˜ ì›Œí¬í”Œë¡œìš°ë¥¼ ì •ì˜í•˜ì„¸ìš”:\n\n```yml\nname: Deploy Infrastructure\non:\n  push:\n    branches:\n      - main\n    paths:\n      - iac/**/*\n      - .github/workflows/deploy-infra.yml\n\ndefaults:\n  run:\n    working-directory: iac/\n\njobs:\n  terraform:\n    name: 'Terraform'\n    runs-on: ubuntu-latest\n    steps:\n      # GitHub Actions ëŸ¬ë„ˆì— ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì²´í¬ì•„ì›ƒ\n      - name: Checkout\n        uses: actions/checkout@v3\n\n      - name: Configure AWS Credentials Action For GitHub Actions\n        uses: aws-actions/configure-aws-credentials@v1\n        with:\n          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY }}\n          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\n          aws-region: eu-central-1\n\n      # ìµœì‹  ë²„ì „ì˜ Terraform CLI ì„¤ì¹˜ ë° Terraform Cloud ì‚¬ìš©ì API í† í°ì„ ì‚¬ìš©í•˜ì—¬ Terraform CLI êµ¬ì„± íŒŒì¼ ì„¤ì •\n      - name: Setup Terraform\n        uses: hashicorp/setup-terraform@v3\n\n      # Terraform ì›Œí‚¹ ë””ë ‰í„°ë¦¬ë¥¼ ì´ˆê¸°í™”í•˜ê³  ì´ˆê¸° íŒŒì¼ì„ ìƒì„±í•˜ê±°ë‚˜ ê¸°ì¡´ íŒŒì¼ì„ ë¡œë“œí•˜ê³  ëª¨ë“ˆ ë‹¤ìš´ë¡œë“œ ë“±ì„ ìˆ˜í–‰\n      - name: Terraform Init\n        run: terraform init\n\n      # ëª¨ë“  Terraform êµ¬ì„± íŒŒì¼ì´ ê·œë²”ì  í˜•ì‹ì„ ì¤€ìˆ˜í•˜ëŠ”ì§€ í™•ì¸\n      - name: Terraform Format\n        run: terraform fmt -check\n\n      # Terraform ì‹¤í–‰ ê³„íš ìƒì„±\n      - name: Terraform Plan\n        run: |\n          terraform plan -out=plan -input=false -var-file=\"variables.tfvars\" -var account_id=${{ secrets.AWS_ACCOUNT_ID }}\n\n      # \"main\"ìœ¼ë¡œ í‘¸ì‹œë˜ë©´ Terraform êµ¬ì„± íŒŒì¼ì— ë”°ë¼ ì¸í”„ë¼ë¥¼ êµ¬ì¶• ë˜ëŠ” ë³€ê²½í•¨\n      # ì°¸ê³ : \"Terraform Cloud\"ì— ëŒ€í•´ \"strict\" ìƒíƒœ ê²€ì‚¬ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤. ìì„¸í•œ ì •ë³´ëŠ” ì•„ë˜ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”: https://help.github.com/en/github/administering-a-repository/types-of-required-status-checks\n      - name: Terraform Apply\n        run: terraform apply -auto-approve -input=false plan\n```\n\n- AWS_ACCESS_KEY â€” ìì›ì„ ìƒì„±í•  ê¶Œí•œì´ ìˆëŠ” AWSì˜ ì•¡ì„¸ìŠ¤ í‚¤ì…ë‹ˆë‹¤\n- AWS_SECRET_ACCESS_KEY â€” ì•¡ì„¸ìŠ¤ í‚¤ì™€ ì—°ê²°ëœ AWS ì‹œí¬ë¦¿\n- AWS_ACCOUNT_ID â€” AWS ëŒ€ì‹œë³´ë“œ ì˜¤ë¥¸ìª½ ìƒë‹¨ì— ìˆëŠ” ê³„ì • IDì…ë‹ˆë‹¤\n- YOUR_REGION â€” ì¸í”„ë¼ë¥¼ ë°°í¬í•  ê¸°ë³¸ ì§€ì—­\n\nì´ì œ ì½”ë“œë¥¼ GitHubì— í‘¸ì‹œí•˜ê³  ì›Œí¬í”Œë¡œìš°ê°€ ì™„ë£Œë˜ë©´ ì¸í”„ë¼ê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•´ë³´ì„¸ìš”.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\ní…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ì´ë¯¸ì§€/ í´ë”ì— íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  CloudWatchì—ì„œ ëŒë‹¤ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nS3ëŠ” ë‘ ê°œì˜ í´ë”ë¡œ ìƒì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:\n\n![image](/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_2.png)\n\nSNSëŠ” êµ¬ë…ì´ ìˆëŠ” ìƒíƒœë¡œ ìƒì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\u003cimg src=\"/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_3.png\" /\u003e \n\nLambdaë¥¼ SNS íŠ¸ë¦¬ê±°ì™€ í•¨ê»˜ ìƒì„±í•´ì•¼í•©ë‹ˆë‹¤:\n\n\u003cimg src=\"/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_4.png\" /\u003e\n\n# Lambda êµ¬í˜„\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì¸í”„ë¼ê°€ ì„¤ì¹˜ë˜ì—ˆìœ¼ë¯€ë¡œ ì¸ë„¤ì¼ ìƒì„±ê¸° ì½”ë“œë¥¼ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.\n\në£¨íŠ¸ ë ˆë²¨ì— srcì´ë¼ëŠ” ìƒˆ í´ë”ë¥¼ ìƒì„±í•˜ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ Go ëª¨ë“ˆì„ ì´ˆê¸°í™”í•´ë³´ì„¸ìš”:\n\n```js\ngo mod init example.com/thumbnail-generator\ngo get github.com/aws/aws-lambda-go\ngo get github.com/aws/aws-sdk-go-v2\ngo get github.com/aws/aws-sdk-go-v2/service/s3\ngo get github.com/aws/aws-sdk-go-v2/config\ngo get github.com/disintegration/imaging\n```\n\nì›í•˜ëŠ” ê²½ìš° example.com/thumbnail-generatorë¥¼ ì„ í˜¸í•˜ëŠ” ëª¨ë“ˆ ì´ë¦„ìœ¼ë¡œ êµì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì´ì œ main.go íŒŒì¼ì„ ë§Œë“¤ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”:\n\n```go\npackage main\n\nimport (\n\t\"bytes\"\n\t\"context\"\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"image\"\n\t\"image/png\"\n\t\"io\"\n\t\"log\"\n\t\"strings\"\n\n\t\"github.com/aws/aws-lambda-go/events\"\n\t\"github.com/aws/aws-lambda-go/lambda\"\n\t\"github.com/aws/aws-sdk-go-v2/aws\"\n\t\"github.com/aws/aws-sdk-go-v2/config\"\n\t\"github.com/aws/aws-sdk-go-v2/service/s3\"\n\t\"github.com/disintegration/imaging\"\n)\n\ntype awsClient struct {\n\ts3  s3.Client\n\tctx *context.Context\n}\n\nfunc handleRequest(ctx context.Context, event events.SNSEvent) error {\n\tawsConfig, err := config.LoadDefaultConfig(ctx)\n\n\tif err != nil {\n\t\tlog.Fatalf(\"AWS ê¸°ë³¸ êµ¬ì„±ì„ ë¶ˆëŸ¬ ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\")\n\t\treturn err\n\t}\n\n\tawsClient := awsClient{s3: *s3.NewFromConfig(awsConfig), ctx: \u0026ctx}\n\n\tfor _, record := range event.Records {\n\t\tvar imageEvent events.S3Event\n\n\t\terr := json.Unmarshal([]byte(record.SNS.Message), \u0026imageEvent)\n\n\t\tif err != nil {\n\t\t\tlog.Fatalf(\"SNS ë©”ì‹œì§€ %sì„ S3 ì´ë²¤íŠ¸ ë ˆì½”ë“œë¡œ ì–¸ë§ˆìƒ¬í•˜ëŠ” ë™ì•ˆ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: %v\", record.SNS.Message, err)\n\t\t\treturn err\n\t\t}\n\n\t\tfor _, imageRecord := range imageEvent.Records {\n\t\t\tbucketName := imageRecord.S3.Bucket.Name\n\t\t\tobjectKey := imageRecord.S3.Object.Key\n\n\t\t\tfile, err := awsClient.downloadFile(bucketName, objectKey)\n\n\t\t\tlog.Printf(\"ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì„±ê³µ\")\n\n\t\t\tif err != nil {\n\t\t\t\tlog.Fatalf(\"ë²„í‚· %sì—ì„œ íŒŒì¼ %sì„ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤\", bucketName, objectKey)\n\t\t\t\treturn err\n\t\t\t}\n\n\t\t\tthumbnail, err := createThumbnail(file)\n\n\t\t\tif err != nil {\n\t\t\t\tlog.Fatalf(\"ë²„í‚· %sì˜ íŒŒì¼ %sì— ëŒ€í•œ ì„¬ë„¤ì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì˜¤ë¥˜: %v\", bucketName, objectKey, err)\n\t\t\t\treturn err\n\t\t\t}\n\n\t\t\tlog.Printf(\"ì„¬ë„¤ì¼ ìƒì„± ì„±ê³µ\")\n\n\t\t\terr = awsClient.uploadFile(bucketName, objectKey, thumbnail)\n\n\t\t\tlog.Printf(\"ì„¬ë„¤ì¼ ì—…ë¡œë“œ ì„±ê³µ\")\n\n\t\t\tif err != nil {\n\t\t\t\tlog.Fatalf(\"ë²„í‚· %sì— íŒŒì¼ %sì„ thumbnails/ì— ì—…ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤\", bucketName, objectKey)\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t}\n\n\treturn nil\n}\n\nfunc createThumbnail(reader io.Reader) (*bytes.Buffer, error) {\n\tsrcImage, _, err := image.Decode(reader)\n\n\tif err != nil {\n\t\tlog.Fatalf(\"ì˜¤ë¥˜ë¡œ ì¸í•´ íŒŒì¼ì„ ë””ì½”ë”©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: %v\", err)\n\t\treturn nil, err\n\t}\n\n\t// 80x80 í¬ê¸°ì˜ ì„¬ë„¤ì¼ ìƒì„±\n\tthumbnail := imaging.Thumbnail(srcImage, 80, 80, imaging.Lanczos)\n\n\tvar bufferBytes []byte\n\tbuffer := bytes.NewBuffer(bufferBytes)\n\n\terr = png.Encode(buffer, thumbnail)\n\n\treturn buffer, err\n}\n\nfunc (client *awsClient) downloadFile(bucketName string, objectKey string) (*bytes.Reader, error) {\n\tresult, err := client.s3.GetObject(*client.ctx, \u0026s3.GetObjectInput{\n\t\tBucket: aws.String(bucketName),\n\t\tKey:    aws.String(objectKey),\n\t})\n\n\tif err != nil {\n\t\tlog.Fatalf(\"ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ %v:%v. ì›ì¸: %v\", bucketName, objectKey, err)\n\t\treturn nil, err\n\t}\n\n\tdefer result.Body.Close()\n\n\tbody, err := io.ReadAll(result.Body)\n\n\tif err != nil {\n\t\tlog.Fatalf(\"íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ. ì˜¤ë¥˜: %s\", err)\n\t\treturn nil, err\n\t}\n\n\tfile := bytes.NewReader(body)\n\n\treturn file, err\n}\n\nfunc (client *awsClient) uploadFile(bucketName string, originalObjectKey string, thumbnail io.Reader) error {\n\tobjectKeyParts := strings.Split(originalObjectKey, \"/\")\n\tfileNameWithoutExtensions := strings.Split(objectKeyParts[len(objectKeyParts)-1], \".\")[0]\n\tobjectKey := fmt.Sprintf(\"thumbnails/%s_thumbnail.png\", fileNameWithoutExtensions)\n\n\t_, err := client.s3.PutObject(*client.ctx, \u0026s3.PutObjectInput{\n\t\tBucket: aws.String(bucketName),\n\t\tKey:    aws.String(objectKey),\n\t\tBody:   thumbnail,\n\t})\n\n\tif err != nil {\n\t\tlog.Fatalf(\"%vì„(ë¥¼) %vì˜ %vì— ì—…ë¡œë“œí•  ìˆ˜ ì—†ìŒ. ì›ì¸: %v\\n\",\n\t\t\toriginalObjectKey, bucketName, objectKey, err)\n\t}\n\n\treturn err\n}\n\nfunc main() {\n\tlambda.Start(handleRequest)\n}\n```\n\nì´ì œ GitHub workflowë¥¼ ì„¤ì •í•˜ì—¬ ëŒë‹¤ ì½”ë“œë¥¼ ë°°í¬í•´ì•¼ í•©ë‹ˆë‹¤.\n\n.github/workflows í´ë”ì— deploy-lambda.ymlì´ë¼ëŠ” ìƒˆ íŒŒì¼ì„ ì¶”ê°€í•˜ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”:```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```bash\nname: Deploy Thumbnail Generator Lambda\non:\n  push:\n    branches:\n      - main\n    paths:\n      - src/**/*\n      - .github/workflows/deploy-lambda.yml\n\ndefaults:\n  run:\n    working-directory: src/\n\njobs:\n  terraform:\n    name: 'Deploy Thumbnail Generator Lambda'\n    runs-on: ubuntu-latest\n    steps:\n      # Checkout the repository to the GitHub Actions runner\n      - name: Checkout\n        uses: actions/checkout@v3\n\n      - uses: actions/setup-go@v4.1.0\n        with:\n          go-version: '1.22.0'\n\n      - name: Configure AWS Credentials Action For GitHub Actions\n        uses: aws-actions/configure-aws-credentials@v1\n        with:\n          aws-access-key-id: ${ secrets.AWS_ACCESS_KEY }\n          aws-secret-access-key: ${ secrets.AWS_SECRET_ACCESS_KEY }\n          aws-region: eu-central-1\n\n      - name: Build Lambda\n        run: GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -o build/main .\n\n      - name: Zip build\n        run: zip -r -j main.zip ./build\n\n      - name: Update Lambda code\n        run: aws lambda update-function-code --function-name=thumbnail-generator --zip-file=fileb://main.zip\n```\n\nì½”ë“œë¥¼ ì»¤ë°‹í•˜ê³  ë ˆí¬ì§€í† ë¦¬ì— í‘¸ì‹œí•˜ë©´ ë¹Œë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.\n\nì™„ë£Œë˜ë©´ Lambda í˜ì´ì§€ì˜ \"ìµœì¢… ìˆ˜ì •\" ì†ì„±ì„ í™•ì¸í•˜ì—¬ ë°°í¬ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n\u003cimg src=\"/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_5.png\" /\u003e\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\ní…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ S3 ë²„í‚·ì˜ images/ í´ë”ì— ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤. ì—…ë¡œë“œê°€ ì„±ê³µí•˜ë©´ ì ì‹œ ê¸°ë‹¤ë¦° í›„ ìƒˆë¡œ ë§Œë“  ì„¬ë„¤ì¼ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n# ê²°ë¡ \n\nì´ ê¸€ì—ì„œëŠ” Terraform ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ë¥¼ ì‚¬ìš©í•˜ì—¬ S3 ë²„í‚·, ëŒë‹¤, SNS, SNS ì•Œë¦¼ ë“±ì„ ìƒì„±í•˜ê³  ì—°ê²°í•˜ëŠ” ë°©ë²•ì„ ë°°ì› ìŠµë‹ˆë‹¤.\n\në˜í•œ S3 ì´ë²¤íŠ¸ë¥¼ SNS í† í”½ì— ë³´ë‚´ì–´ ì´ë¥¼ ë‹¤ë¥¸ ì†ŒìŠ¤(ë‹¤ë¥¸ SNS í† í”½ í¬í•¨)ë¡œ í™•ì‚°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ë„ ë°°ì› ìŠµë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì €í¬ëŠ” Goë¡œ ì‘ì„±ëœ ëŒë‹¤ í•¨ìˆ˜ë„ ë§Œë“¤ì—ˆì–´ìš”. ì´ í•¨ìˆ˜ëŠ” SNS ë©”ì‹œì§€ë¥¼ í†µí•´ í˜¸ì¶œë˜ì–´ S3 ë²„í‚·ì—ì„œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê³  ì´ë¯¸ì§€ì—ì„œ ì¸ë„¤ì¼ì„ ìƒì„±í•œ ë‹¤ìŒ ì´ ì¸ë„¤ì¼ì„ S3ì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.\n\nì´ ê¸€ì˜ ì½”ë“œëŠ” ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.\n\nì¦ê±°ìš´ ì½”ë”©í•˜ì„¸ìš”! ğŸ’»","ogImage":{"url":"/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_0.png"},"coverImage":"/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_0.png","tag":["Tech"],"readingTime":18},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h2: \"h2\",\n    p: \"p\",\n    img: \"img\",\n    h1: \"h1\",\n    ul: \"ul\",\n    li: \"li\",\n    pre: \"pre\",\n    code: \"code\",\n    span: \"span\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h2, {\n      children: \"ì´ë²¤íŠ¸ ê¸°ë°˜ ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_0.png\",\n        alt: \"ì´ë¯¸ì§€\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì•ˆë…•í•˜ì„¸ìš”!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŒŒì¼ì„ í´ë¼ìš°ë“œì— ì €ì¥í•˜ëŠ” ê²ƒì€ íŒŒì¼ ì§€ì†ì„±ì˜ í•œ ë°©ë²•ìœ¼ë¡œ ë§¤ìš° ì¼ë°˜ì ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì–´ë””ì—ì„œ ì–´ë–»ê²Œ ì‚¬ìš©ë ì§€ì— ëŒ€í•œ ë§ì€ ìœ ì—°ì„±ì„ ì œê³µí•©ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"AWSëŠ” ê°ì²´ë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ìœ¼ë¡œ ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ S3 (Simple Storage Service)ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ëŠ” ë†’ì€ ê°€ìš©ì„±, í™•ì¥ì„± ë° ì„±ëŠ¥ì„ ê°–ì¶”ê³  ìˆìŠµë‹ˆë‹¤. ì£¼ë¡œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì €ì¥ ì„œë¹„ìŠ¤ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"S3ëŠ” ë²„í‚· ì•ˆì—ì„œ ê°ì²´ ì‘ì—…ì— ëŒ€í•œ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ë„ ì œê³µí•©ë‹ˆë‹¤. ì´ëŠ” ê°ì²´ ìƒì„±, ì—…ë°ì´íŠ¸, ì´ë™, ì‚­ì œ ë“±ì˜ ì‘ì—…ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ S3 ì´ë²¤íŠ¸ ì•Œë¦¼ì´ë¼ê³  í•©ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ ë¬¸ì„œì—ì„œëŠ” ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•  ë•Œë§ˆë‹¤ í•´ë‹¹ ì´ë¯¸ì§€ì— ëŒ€í•œ ì„¬ë„¤ì¼ì„ ìƒì„±í•˜ëŠ” ì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ìš°ë¦¬ëŠ” ì´ë²¤íŠ¸ ì•Œë¦¼ì„ ìˆ˜ì‹ í•˜ê³  ì„¬ë„¤ì¼ì„ ìƒì„±í•˜ëŠ” Goë¡œ ì‘ì„±ëœ ëŒë‹¤ í•¨ìˆ˜ë¥¼ ê°€ì§ˆ ê²ƒì…ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"í•´ë³´ìêµ¬ìš”!\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"ìš”êµ¬ ì‚¬í•­\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"AWS ê³„ì •\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"ì¢‹ì•„í•˜ëŠ” ì½”ë“œ í¸ì§‘ê¸° (ì €ëŠ” Visual Studio Codeë¥¼ ì‚¬ìš©í•  ì˜ˆì •ì…ë‹ˆë‹¤)\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"GitHub ê³„ì •\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"ì•„í‚¤í…ì²˜\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(\"img\", {\n      src: \"/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_1.png\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ë²„í‚·ì„ êµ¬ì„±í•˜ì—¬ ê°ì²´ ì´ë²¤íŠ¸ë¥¼ SNS í† í”½ìœ¼ë¡œ ë³´ë‚´ê³  í•´ë‹¹ ë©”ì‹œì§€ë¥¼ ìƒì„±í•œ ì¸ë„¤ì¼ì„ S3 ë²„í‚·ì— ì—…ë¡œë“œí•  ëŒë‹¤ë¡œ ì „ì†¡í•  ê²ƒì…ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"S3 ë²„í‚· ì´ë²¤íŠ¸ì— ëŒë‹¤ë¥¼ ì§ì ‘ ëŒ€ìƒìœ¼ë¡œ ì§€ì •í•˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤. ì´ìœ ëŠ” ê° ì´ë²¤íŠ¸ ì•Œë¦¼ì— ëŒ€í•´ í•˜ë‚˜ì˜ ëŒ€ìƒ ìœ í˜•ë§Œ ì§€ì •í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. SNS í† í”½ì„ ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ SQS ëŒ€ê¸°ì—´, ì´ë©”ì¼, ì „í™” ì•Œë¦¼ ë° SNSê°€ ì§€ì›í•˜ëŠ” ê¸°íƒ€ ì—¬ëŸ¬ ëŒ€ìƒìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ì „íŒŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"Terraformì„ ì‚¬ìš©í•˜ì—¬ ì¸í”„ë¼ êµ¬ì„±í•˜ê¸°\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"ì´ë¯¸ì§€ S3 ë²„í‚·\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì‹œì‘í•˜ë ¤ë©´ ìš°ë¦¬ì˜ í…Œë¼í¼ í´ë”ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ í”„ë¡œì íŠ¸ì˜ ë£¨íŠ¸ ë ˆë²¨ì— iacë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”. ê·¸ ì•ˆì— providers.tfë¼ëŠ” íŒŒì¼ì„ ìƒì„±í•´ AWS í”„ë¡œë°”ì´ë”ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆë„ë¡ ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"terraform {\\n  required_providers {\\n    aws = {\\n      source  = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"hashicorp/aws\\\"\"\n        }), \"\\n      version = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"~\u003e 5.0\\\"\"\n        }), \"\\n    }\\n  }\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"// Regionì€ AWS_REGION í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì„¤ì •ë©ë‹ˆë‹¤\"\n        }), \"\\nprovider \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws\\\"\"\n        }), \" {\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ë§Œì•½ í…Œë¼í¼ì´ ì¸í”„ë¼ ìƒíƒœë¥¼ ì¶”ì í•˜ë„ë¡ í•˜ë ¤ë©´, AWSì—ì„œ S3 ë²„í‚·ì„ ìƒì„±í•˜ê³  ìƒíƒœ ë°±ì—”ë“œë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì½”ë“œì—ì„œì²˜ëŸ¼ í•˜ì‹œë©´ ë©ë‹ˆë‹¤:\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"terraform {\\n  required_providers {\\n    aws = {\\n      source  = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"hashicorp/aws\\\"\"\n        }), \"\\n      version = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"~\u003e 5.0\\\"\"\n        }), \"\\n    }\\n  }\\n\\n  backend \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"s3\\\"\"\n        }), \" {\\n    bucket = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"terraform-medium-api-notification\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"// ì—¬ê¸°ê°€ ìƒíƒœ ë²„í‚·ì…ë‹ˆë‹¤\"\n        }), \"\\n    key    = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"thumbnail-generator/state\\\"\"\n        }), \"\\n  }\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"// AWS_REGION í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì§€ì—­ ì„¤ì •ë¨\"\n        }), \"\\nprovider \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws\\\"\"\n        }), \" {\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ì œ ì´ë¯¸ì§€ë¥¼ í˜¸ìŠ¤íŒ…í•˜ëŠ” S3 ë²„í‚·ì„ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"iac í´ë”ì— s3.tfë¼ëŠ” íŒŒì¼ì„ ë§Œë“¤ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"resource \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_s3_bucket\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"my-app-images\\\"\"\n        }), \" {\\n  bucket = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"my-super-app-images\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"// ë²„í‚·ì— ê³ ìœ í•œ ì´ë¦„ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”\"\n        }), \"\\n}\\n\\nresource \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_s3_object\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"images_folder\\\"\"\n        }), \" {\\n  bucket = aws_s3_bucket.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"my\"\n        }), \"-app-images.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"bucket\"\n        }), \"\\n  key    = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"images/\\\"\"\n        }), \"\\n}\\n\\nresource \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_s3_object\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"thumbnails_folder\\\"\"\n        }), \" {\\n  bucket = aws_s3_bucket.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"my\"\n        }), \"-app-images.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"bucket\"\n        }), \"\\n  key    = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"thumbnails/\\\"\"\n        }), \"\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ë²„í‚· ì†ì„±ì—ì„œëŠ” ë²„í‚·ì— ê³ ìœ í•œ ì´ë¦„ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ì™œëƒí•˜ë©´ S3 ë²„í‚· ì´ë¦„ì€ ëª¨ë“  AWS ì „ì—­ì—ì„œ ê³ ìœ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ë¦„ì„ ì œê³µí•˜ì§€ ì•Šìœ¼ë ¤ë©´ ë¹„ì›Œë‘ê³  AWSê°€ ê³ ìœ í•œ ë²„í‚· ì´ë¦„ì„ í• ë‹¹í•´ ì¤„ ê²ƒì…ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ ì½”ë“œëŠ” ì´ë¯¸ì§€/ ë° ì¸ë„¤ì¼/ ë‘ ê°œì˜ í´ë”ê°€ ìˆëŠ” S3 ë²„í‚·ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ í´ë”ë“¤ì€ íŒŒì¼ì„ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"SNSë¥¼ ì‚¬ìš©í•œ ë©”ì‹œì§•\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ì œ ì•Œë¦¼ ì£¼ì œì™€ ë©”ì‹œì§€ ëŒ€ê¸°ì—´ì„ ì„¤ì •í•´ ë´…ì‹œë‹¤.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-yaml\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# messaging.tf\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"resource\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_sns_topic\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"topic\\\"\"\n        }), \" {\\n  \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"name\"\n        }), \"   \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"image-events\\\"\"\n        }), \"\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-yaml\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# variables.tf\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"variable\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"region\\\"\"\n        }), \" {\\n  \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"description\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Default region of your resources\\\"\"\n        }), \"\\n  \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"type\"\n        }), \"        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"string\"\n        }), \"\\n  \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"default\"\n        }), \"     \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"eu-central-1\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Set as your default region here\"\n        }), \"\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"variable\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"account_id\\\"\"\n        }), \" {\\n  \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"description\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"The ID of the default AWS account\\\"\"\n        }), \"\\n  \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"type\"\n        }), \"        \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"string\"\n        }), \"\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ê·¸ë¦¬ê³  variables.tfvarsë¼ëŠ” ë˜ ë‹¤ë¥¸ íŒŒì¼ì„ ë§Œë“¤ì–´ ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"region = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"eu-central-1\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"// ì›í•˜ëŠ” ì§€ì—­ì„ ì„¤ì •í•˜ì„¸ìš”\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ë‚˜ì¤‘ì— í…Œë¼í¼ ëª…ë ¹ì–´ì— ì „ë‹¬í•  account_idëŠ” ë‚˜ì¤‘ì— ì¸ìˆ˜ë¡œ ì „ë‹¬í•  ê²ƒì…ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"S3 ì´ë²¤íŠ¸ ì•Œë¦¼\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ì œ S3ì— ëŒ€í•œ ì´ë²¤íŠ¸ ì•Œë¦¼ì„ ì„¤ì •í•´ ë´…ì‹œë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"s3.tf íŒŒì¼ì— ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì—¬ ë²„í‚· ì•Œë¦¼ì„ ì„¤ì •í•˜ì„¸ìš”:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"resource \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_s3_bucket_notification\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"images_put_notification\\\"\"\n        }), \" {\\n  bucket = aws_s3_bucket.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"my\"\n        }), \"-app-images.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"id\"\n        }), \"\\n  topic {\\n    topic_arn = aws_sns_topic.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"topic\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \"\\n    filter_prefix = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"images/\\\"\"\n        }), \"\\n    events = [\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"s3:ObjectCreated:*\\\"\"\n        }), \"]\\n  }\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ë¥¼ í™œì„±í™”í•˜ë ¤ë©´ S3 ë²„í‚·ì´ í•´ë‹¹ topicìœ¼ë¡œ ì•Œë¦¼ì„ ë°œí–‰í•  ìˆ˜ ìˆë„ë¡ SNS topicì— ì •ì±…ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. messaging.tf íŒŒì¼ë¡œ ì´ë™í•˜ì—¬ ë‹¤ìŒ ì •ì±…ì„ ì¶”ê°€í•˜ì„¸ìš”:\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"ë¦¬ì†ŒìŠ¤ \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_sns_topic\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"topic\\\"\"\n        }), \" {\\n  name   = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"image-events\\\"\"\n        }), \"\\n  policy = data.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"aws_iam_policy_document\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"sns\"\n        }), \"-topic-policy.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"json\"\n        }), \"\\n}\\n\\në°ì´í„° \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_iam_policy_document\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"sns-topic-policy\\\"\"\n        }), \" {\\n  policy_id = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"arn:aws:sns:${var.region}:${var.account_id}:image-events/SNSS3NotificationPolicy\\\"\"\n        }), \"\\n  statement {\\n    sid    = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"s3-allow-send-messages\\\"\"\n        }), \"\\n    effect = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Allow\\\"\"\n        }), \"\\n    principals {\\n      type        = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Service\\\"\"\n        }), \"\\n      identifiers = [\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"s3.amazonaws.com\\\"\"\n        }), \"]\\n    }\\n    actions = [\\n      \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"SNS:Publish\\\"\"\n        }), \",\\n    ]\\n    resources = [\\n      \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"arn:aws:sns:${var.region}:${var.account_id}:image-events\\\"\"\n        }), \",\\n    ]\\n    condition {\\n      test     = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"ArnEquals\\\"\"\n        }), \"\\n      variable = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws:SourceArn\\\"\"\n        }), \"\\n      values = [\\n        aws_s3_bucket.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"my\"\n        }), \"-app-images.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \"\\n      ]\\n    }\\n  }\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì—¬ê¸°ì„œëŠ” sns-topic-policy ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê³  í•´ë‹¹ ë¦¬ì†ŒìŠ¤ë¥¼ policy ì†ì„±ì— ì „ë‹¬í•˜ëŠ” topic ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"ê¸°ë³¸ ëŒë‹¤ ì¶”ê°€í•˜ê¸°\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ì œ ëŒë‹¤ì˜ ê¸°ë°˜ ì¸í”„ë¼ë¥¼ ì¶”ê°€í•˜ê¸°ë§Œ ë‚¨ì•˜ìŠµë‹ˆë‹¤. ì´í›„ì— ì½”ë“œë¥¼ ì¶”ê°€í•  ê¸°ë³¸ ëŒë‹¤ë¥¼ ì„¤ì •í•  ê²ƒì…ë‹ˆë‹¤. Go ì–¸ì–´ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•  ì˜ˆì •ì…ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ë¨¼ì €, ëŒë‹¤ í•¨ìˆ˜ë¥¼ ì´ˆê¸°í™”í•  ê¸°ë³¸ ì½”ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ iac í´ë”ì— lambda_init_codeë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”. ì—¬ê¸°ì„œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ê°€ì ¸ì™€ì„œ ë©”ì¸ ì»´íŒŒì¼ëœ íŒŒì¼ì„ ì§ì ‘ ì‚¬ìš©í•˜ê±°ë‚˜ README.md íŒŒì¼ì˜ ì§€ì‹œì— ë”°ë¼ ìƒˆë¡œìš´ ì‹¤í–‰ ê°€ëŠ¥ íŒŒì¼ì„ ì»´íŒŒì¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ì œ ìƒˆ íŒŒì¼ lambdas.tfë¥¼ ìƒì„±í•˜ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì—¬ ëŒë‹¤ ì¸í”„ë¼ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"resource \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_iam_role\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"iam_for_lambda\\\"\"\n        }), \" {\\n  name               = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"thumbnail-generator-lambda-role\\\"\"\n        }), \"\\n  assume_role_policy = data.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"aws_iam_policy_document\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"assume_role\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"json\"\n        }), \"\\n  inline_policy {\\n    name   = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"DefaultPolicy\\\"\"\n        }), \"\\n    policy = data.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"aws_iam_policy_document\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"lambda_role_policies\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"json\"\n        }), \"\\n  }\\n}\\nresource \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_lambda_function\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"lambda\\\"\"\n        }), \" {\\n  filename      = data.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"archive_file\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"lambda\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"output_path\"\n        }), \"\\n  function_name = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"thumbnail-generator\\\"\"\n        }), \"\\n  role          = aws_iam_role.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"iam_for_lambda\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \"\\n  handler       = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"main\\\"\"\n        }), \"\\n  runtime       = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"go1.x\\\"\"\n        }), \"\\n  timeout       = \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"15\"\n        }), \"\\n}\\n\\ndata \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"archive_file\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"lambda\\\"\"\n        }), \" {\\n  type        = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"zip\\\"\"\n        }), \"\\n  source_file = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"./lambda_init_code/main\\\"\"\n        }), \"\\n  output_path = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"thumbnail_generator_lambda_function_payload.zip\\\"\"\n        }), \"\\n}\\n\\ndata \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_iam_policy_document\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"assume_role\\\"\"\n        }), \" {\\n  statement {\\n    effect = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Allow\\\"\"\n        }), \"\\n    principals {\\n      type        = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Service\\\"\"\n        }), \"\\n      identifiers = [\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"lambda.amazonaws.com\\\"\"\n        }), \"]\\n    }\\n    actions = [\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"sts:AssumeRole\\\"\"\n        }), \"]\\n  }\\n}\\n\\ndata \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_iam_policy_document\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"lambda_role_policies\\\"\"\n        }), \" {\\n  statement {\\n    effect = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Allow\\\"\"\n        }), \"\\n    actions = [\\n      \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"logs:CreateLogGroup\\\"\"\n        }), \",\\n      \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"logs:CreateLogStream\\\"\"\n        }), \",\\n      \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"logs:PutLogEvents\\\"\"\n        }), \",\\n    ]\\n    resources = [\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"arn:aws:logs:*:*:*\\\"\"\n        }), \"]\\n  }\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ë ‡ê²Œ í•˜ë©´ ëŸ°íƒ€ì„ìœ¼ë¡œ Goë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒë‹¤ í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ê³  ì—­í• ì„ ë§Œë“¤ë©°, ëŒë‹¤ í•¨ìˆ˜ê°€ ì´ ì—­í• ì„ ê°€ì •í•˜ê³  í´ë¼ìš°ë“œì›Œì¹˜ì— ë¡œê¹…í•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ë‹¤ìŒìœ¼ë¡œ, ëŒë‹¤ê°€ íŠ¸ë¦¬ê±°ë  ìˆ˜ ìˆë„ë¡ SNS ì£¼ì œì— ëŒ€í•œ êµ¬ë…ì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. lambdas.tf íŒŒì¼ì— ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"resource \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_sns_topic_subscription\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"topic_subscription\\\"\"\n        }), \" {\\n  topic_arn = aws_sns_topic.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"topic\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \"\\n  protocol  = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"lambda\\\"\"\n        }), \"\\n  endpoint  = aws_lambda_function.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"lambda\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \"\\n}\\n\\nresource \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_lambda_permission\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"apigw_lambda\\\"\"\n        }), \" {\\n  statement_id  = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"AllowExecutionFromSNS\\\"\"\n        }), \"\\n  action        = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"lambda:InvokeFunction\\\"\"\n        }), \"\\n  function_name = aws_lambda_function.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"lambda\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \"\\n  principal     = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"sns.amazonaws.com\\\"\"\n        }), \"\\n  source_arn    = aws_sns_topic.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"topic\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \"\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ìµœì¢… lambdas.tf íŒŒì¼ì´ ë‹¤ìŒê³¼ ê°™ì´ ë˜ë„ë¡ ë§Œë“¤ì–´ë³´ì„¸ìš”:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"resource \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_iam_role\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"iam_for_lambda\\\"\"\n        }), \" {\\n  name               = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"thumbnail-generator-lambda-role\\\"\"\n        }), \"\\n  assume_role_policy = data.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"aws_iam_policy_document\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"assume_role\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"json\"\n        }), \"\\n  inline_policy {\\n    name   = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"DefaultPolicy\\\"\"\n        }), \"\\n    policy = data.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"aws_iam_policy_document\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"lambda_role_policies\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"json\"\n        }), \"\\n  }\\n}\\n\\nresource \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_lambda_function\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"lambda\\\"\"\n        }), \" {\\n  filename      = data.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"archive_file\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"lambda\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"output_path\"\n        }), \"\\n  function_name = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"thumbnail-generator\\\"\"\n        }), \"\\n  role          = aws_iam_role.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"iam_for_lambda\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \"\\n  handler       = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"main\\\"\"\n        }), \"\\n  runtime       = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"go1.x\\\"\"\n        }), \"\\n  timeout       = \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"15\"\n        }), \"\\n}\\n\\nresource \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_sns_topic_subscription\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"topic_subscription\\\"\"\n        }), \" {\\n  topic_arn = aws_sns_topic.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"topic\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \"\\n  protocol  = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"lambda\\\"\"\n        }), \"\\n  endpoint  = aws_lambda_function.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"lambda\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \"\\n}\\n\\nresource \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_lambda_permission\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"apigw_lambda\\\"\"\n        }), \" {\\n  statement_id  = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"AllowExecutionFromSNS\\\"\"\n        }), \"\\n  action        = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"lambda:InvokeFunction\\\"\"\n        }), \"\\n  function_name = aws_lambda_function.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"lambda\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \"\\n  principal     = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"sns.amazonaws.com\\\"\"\n        }), \"\\n  source_arn    = aws_sns_topic.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"topic\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \"\\n}\\n\\ndata \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"archive_file\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"lambda\\\"\"\n        }), \" {\\n  type        = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"zip\\\"\"\n        }), \"\\n  source_file = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"./lambda_init_code/main\\\"\"\n        }), \"\\n  output_path = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"thumbnail_generator_lambda_function_payload.zip\\\"\"\n        }), \"\\n}\\n\\ndata \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_iam_policy_document\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"assume_role\\\"\"\n        }), \" {\\n  statement {\\n    effect = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Allow\\\"\"\n        }), \"\\n    principals {\\n      type        = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Service\\\"\"\n        }), \"\\n      identifiers = [\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"lambda.amazonaws.com\\\"\"\n        }), \"]\\n    }\\n    actions = [\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"sts:AssumeRole\\\"\"\n        }), \"]\\n  }\\n}\\n\\ndata \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"aws_iam_policy_document\\\"\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"lambda_role_policies\\\"\"\n        }), \" {\\n  statement {\\n    effect = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Allow\\\"\"\n        }), \"\\n    actions = [\\n      \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"logs:CreateLogGroup\\\"\"\n        }), \",\\n      \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"logs:CreateLogStream\\\"\"\n        }), \",\\n      \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"logs:PutLogEvents\\\"\"\n        }), \"\\n    ]\\n    resources = [\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"arn:aws:logs:*:*:*\\\"\"\n        }), \"]\\n  }\\n\\n  statement {\\n    effect = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Allow\\\"\"\n        }), \"\\n    actions = [\\n      \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"s3:GetObject\\\"\"\n        }), \",\\n    ]\\n    resources = [\\n      \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"format\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"%s/%s*\\\"\"\n        }), \", aws_s3_bucket.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"my\"\n        }), \"-app-images.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \", aws_s3_object.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"images_folder\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"key\"\n        }), \")\\n    ]\\n  }\\n\\n  statement {\\n    effect = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Allow\\\"\"\n        }), \"\\n    actions = [\\n      \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"s3:PutObject\\\"\"\n        }), \",\\n    ]\\n    resources = [\\n      \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"format\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"%s/%s*\\\"\"\n        }), \", aws_s3_bucket.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"my\"\n        }), \"-app-images.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"arn\"\n        }), \", aws_s3_object.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"thumbnails_folder\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"key\"\n        }), \")\\n    ]\\n  }\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ìš°ë¦¬ì˜ SNS í† í”½ì´ ëŒë‹¤ë¥¼ ì´ë²¤íŠ¸ì™€ í•¨ê»˜ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œì„ ë¶€ì—¬í•  ê²ƒì…ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ëŒë‹¤ëŠ” 15ì´ˆì˜ ì œí•œ ì‹œê°„ì„ ê°–ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ê¸°ë³¸ ì œí•œ ì‹œê°„ì´ 3ì´ˆì´ê¸° ë•Œë¬¸ì— S3ë¡œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê³  ì—…ë¡œë“œí•˜ëŠ” ì‘ì—…ì€ ì´ë¯¸ì§€ í¬ê¸°ì— ë”°ë¼ 3ì´ˆë³´ë‹¤ ë” ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ëŠ” S3 ì‘ì—…ì´ ì¸í„°ë„·ì„ í†µê³¼í•˜ê¸° ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ê³  ì‹¶ë‹¤ë©´ VPCë¥¼ ìƒì„±í•˜ê³  ëŒë‹¤ì™€ VPC ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë§Œë“¤ì–´ S3 ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì—°ê²°ì´ ì¸í„°ë„·ì´ ì•„ë‹Œ AWS ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"ì¸í”„ë¼ ë°°í¬í•˜ê¸°\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ì œ ìš°ë¦¬ê°€ ì½”ë“œë¡œ ì •ì˜í•œ ì¸í”„ë¼ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•´ GitHub ì•¡ì…˜ì„ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì½”ë“œì— .github/workflows í´ë”ë¥¼ ë§Œë“¤ê³  deploy-infra.yml íŒŒì¼ì„ ì¶”ê°€í•˜ì—¬ GitHub ì•¡ì…˜ ì›Œí¬í”Œë¡œìš°ë¥¼ ì •ì˜í•˜ì„¸ìš”:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-yml\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"name:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Deploy\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Infrastructure\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"on:\"\n        }), \"\\n  \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"push:\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"branches:\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-bullet\",\n          children: \"-\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"main\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"paths:\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-bullet\",\n          children: \"-\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"iac/**/*\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-bullet\",\n          children: \"-\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \".github/workflows/deploy-infra.yml\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"defaults:\"\n        }), \"\\n  \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"run:\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"working-directory:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"iac/\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"jobs:\"\n        }), \"\\n  \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"terraform:\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"name:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'Terraform'\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"runs-on:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"ubuntu-latest\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"steps:\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# GitHub Actions ëŸ¬ë„ˆì— ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì²´í¬ì•„ì›ƒ\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-bullet\",\n          children: \"-\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"name:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Checkout\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"uses:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"actions/checkout@v3\"\n        }), \"\\n\\n      \", _jsx(_components.span, {\n          className: \"hljs-bullet\",\n          children: \"-\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"name:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Configure\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"AWS\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Credentials\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Action\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"For\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"GitHub\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Actions\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"uses:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"aws-actions/configure-aws-credentials@v1\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"with:\"\n        }), \"\\n          \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"aws-access-key-id:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"${{\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"secrets.AWS_ACCESS_KEY\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"}}\"\n        }), \"\\n          \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"aws-secret-access-key:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"${{\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"secrets.AWS_SECRET_ACCESS_KEY\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"}}\"\n        }), \"\\n          \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"aws-region:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"eu-central-1\"\n        }), \"\\n\\n      \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# ìµœì‹  ë²„ì „ì˜ Terraform CLI ì„¤ì¹˜ ë° Terraform Cloud ì‚¬ìš©ì API í† í°ì„ ì‚¬ìš©í•˜ì—¬ Terraform CLI êµ¬ì„± íŒŒì¼ ì„¤ì •\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-bullet\",\n          children: \"-\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"name:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Setup\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Terraform\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"uses:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"hashicorp/setup-terraform@v3\"\n        }), \"\\n\\n      \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Terraform ì›Œí‚¹ ë””ë ‰í„°ë¦¬ë¥¼ ì´ˆê¸°í™”í•˜ê³  ì´ˆê¸° íŒŒì¼ì„ ìƒì„±í•˜ê±°ë‚˜ ê¸°ì¡´ íŒŒì¼ì„ ë¡œë“œí•˜ê³  ëª¨ë“ˆ ë‹¤ìš´ë¡œë“œ ë“±ì„ ìˆ˜í–‰\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-bullet\",\n          children: \"-\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"name:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Terraform\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Init\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"run:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"terraform\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"init\"\n        }), \"\\n\\n      \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# ëª¨ë“  Terraform êµ¬ì„± íŒŒì¼ì´ ê·œë²”ì  í˜•ì‹ì„ ì¤€ìˆ˜í•˜ëŠ”ì§€ í™•ì¸\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-bullet\",\n          children: \"-\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"name:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Terraform\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Format\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"run:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"terraform\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"fmt\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"-check\"\n        }), \"\\n\\n      \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Terraform ì‹¤í–‰ ê³„íš ìƒì„±\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-bullet\",\n          children: \"-\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"name:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Terraform\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Plan\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"run:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"|\\n          terraform plan -out=plan -input=false -var-file=\\\"variables.tfvars\\\" -var account_id=${{ secrets.AWS_ACCOUNT_ID }}\\n\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# \\\"main\\\"ìœ¼ë¡œ í‘¸ì‹œë˜ë©´ Terraform êµ¬ì„± íŒŒì¼ì— ë”°ë¼ ì¸í”„ë¼ë¥¼ êµ¬ì¶• ë˜ëŠ” ë³€ê²½í•¨\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# ì°¸ê³ : \\\"Terraform Cloud\\\"ì— ëŒ€í•´ \\\"strict\\\" ìƒíƒœ ê²€ì‚¬ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤. ìì„¸í•œ ì •ë³´ëŠ” ì•„ë˜ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”: https://help.github.com/en/github/administering-a-repository/types-of-required-status-checks\"\n        }), \"\\n      \", _jsx(_components.span, {\n          className: \"hljs-bullet\",\n          children: \"-\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"name:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Terraform\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"Apply\"\n        }), \"\\n        \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"run:\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"terraform\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"apply\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"-auto-approve\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"-input=false\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"plan\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"AWS_ACCESS_KEY â€” ìì›ì„ ìƒì„±í•  ê¶Œí•œì´ ìˆëŠ” AWSì˜ ì•¡ì„¸ìŠ¤ í‚¤ì…ë‹ˆë‹¤\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"AWS_SECRET_ACCESS_KEY â€” ì•¡ì„¸ìŠ¤ í‚¤ì™€ ì—°ê²°ëœ AWS ì‹œí¬ë¦¿\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"AWS_ACCOUNT_ID â€” AWS ëŒ€ì‹œë³´ë“œ ì˜¤ë¥¸ìª½ ìƒë‹¨ì— ìˆëŠ” ê³„ì • IDì…ë‹ˆë‹¤\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"YOUR_REGION â€” ì¸í”„ë¼ë¥¼ ë°°í¬í•  ê¸°ë³¸ ì§€ì—­\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ì œ ì½”ë“œë¥¼ GitHubì— í‘¸ì‹œí•˜ê³  ì›Œí¬í”Œë¡œìš°ê°€ ì™„ë£Œë˜ë©´ ì¸í”„ë¼ê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•´ë³´ì„¸ìš”.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ì´ë¯¸ì§€/ í´ë”ì— íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  CloudWatchì—ì„œ ëŒë‹¤ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"S3ëŠ” ë‘ ê°œì˜ í´ë”ë¡œ ìƒì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_2.png\",\n        alt: \"image\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"SNSëŠ” êµ¬ë…ì´ ìˆëŠ” ìƒíƒœë¡œ ìƒì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(\"img\", {\n      src: \"/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_3.png\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Lambdaë¥¼ SNS íŠ¸ë¦¬ê±°ì™€ í•¨ê»˜ ìƒì„±í•´ì•¼í•©ë‹ˆë‹¤:\"\n    }), \"\\n\", _jsx(\"img\", {\n      src: \"/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_4.png\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"Lambda êµ¬í˜„\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì¸í”„ë¼ê°€ ì„¤ì¹˜ë˜ì—ˆìœ¼ë¯€ë¡œ ì¸ë„¤ì¼ ìƒì„±ê¸° ì½”ë“œë¥¼ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ë£¨íŠ¸ ë ˆë²¨ì— srcì´ë¼ëŠ” ìƒˆ í´ë”ë¥¼ ìƒì„±í•˜ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ Go ëª¨ë“ˆì„ ì´ˆê¸°í™”í•´ë³´ì„¸ìš”:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"go mod init example.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"com\"\n        }), \"/thumbnail-generator\\ngo get github.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"com\"\n        }), \"/aws/aws-lambda-go\\ngo get github.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"com\"\n        }), \"/aws/aws-sdk-go-v2\\ngo get github.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"com\"\n        }), \"/aws/aws-sdk-go-v2/service/s3\\ngo get github.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"com\"\n        }), \"/aws/aws-sdk-go-v2/config\\ngo get github.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"com\"\n        }), \"/disintegration/imaging\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì›í•˜ëŠ” ê²½ìš° example.com/thumbnail-generatorë¥¼ ì„ í˜¸í•˜ëŠ” ëª¨ë“ˆ ì´ë¦„ìœ¼ë¡œ êµì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ì œ main.go íŒŒì¼ì„ ë§Œë“¤ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-go\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"package\"\n        }), \" main\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" (\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"bytes\\\"\"\n        }), \"\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"context\\\"\"\n        }), \"\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"encoding/json\\\"\"\n        }), \"\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"fmt\\\"\"\n        }), \"\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"image\\\"\"\n        }), \"\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"image/png\\\"\"\n        }), \"\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"io\\\"\"\n        }), \"\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"log\\\"\"\n        }), \"\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"strings\\\"\"\n        }), \"\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"github.com/aws/aws-lambda-go/events\\\"\"\n        }), \"\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"github.com/aws/aws-lambda-go/lambda\\\"\"\n        }), \"\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"github.com/aws/aws-sdk-go-v2/aws\\\"\"\n        }), \"\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"github.com/aws/aws-sdk-go-v2/config\\\"\"\n        }), \"\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"github.com/aws/aws-sdk-go-v2/service/s3\\\"\"\n        }), \"\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"github.com/disintegration/imaging\\\"\"\n        }), \"\\n)\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"type\"\n        }), \" awsClient \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"struct\"\n        }), \" {\\n\\ts3  s3.Client\\n\\tctx *context.Context\\n}\\n\\n\", _jsxs(_components.span, {\n          className: \"hljs-function\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"func\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title\",\n            children: \"handleRequest\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(ctx context.Context, event events.SNSEvent)\"\n          })]\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"error\"\n        }), \" {\\n\\tawsConfig, err := config.LoadDefaultConfig(ctx)\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" err != \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \" {\\n\\t\\tlog.Fatalf(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"AWS ê¸°ë³¸ êµ¬ì„±ì„ ë¶ˆëŸ¬ ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\\\"\"\n        }), \")\\n\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" err\\n\\t}\\n\\n\\tawsClient := awsClient{s3: *s3.NewFromConfig(awsConfig), ctx: \u0026ctx}\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" _, record := \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"range\"\n        }), \" event.Records {\\n\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"var\"\n        }), \" imageEvent events.S3Event\\n\\n\\t\\terr := json.Unmarshal([]\", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"byte\"\n        }), \"(record.SNS.Message), \u0026imageEvent)\\n\\n\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" err != \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \" {\\n\\t\\t\\tlog.Fatalf(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"SNS ë©”ì‹œì§€ %sì„ S3 ì´ë²¤íŠ¸ ë ˆì½”ë“œë¡œ ì–¸ë§ˆìƒ¬í•˜ëŠ” ë™ì•ˆ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: %v\\\"\"\n        }), \", record.SNS.Message, err)\\n\\t\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" err\\n\\t\\t}\\n\\n\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" _, imageRecord := \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"range\"\n        }), \" imageEvent.Records {\\n\\t\\t\\tbucketName := imageRecord.S3.Bucket.Name\\n\\t\\t\\tobjectKey := imageRecord.S3.Object.Key\\n\\n\\t\\t\\tfile, err := awsClient.downloadFile(bucketName, objectKey)\\n\\n\\t\\t\\tlog.Printf(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì„±ê³µ\\\"\"\n        }), \")\\n\\n\\t\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" err != \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \" {\\n\\t\\t\\t\\tlog.Fatalf(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"ë²„í‚· %sì—ì„œ íŒŒì¼ %sì„ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤\\\"\"\n        }), \", bucketName, objectKey)\\n\\t\\t\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" err\\n\\t\\t\\t}\\n\\n\\t\\t\\tthumbnail, err := createThumbnail(file)\\n\\n\\t\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" err != \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \" {\\n\\t\\t\\t\\tlog.Fatalf(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"ë²„í‚· %sì˜ íŒŒì¼ %sì— ëŒ€í•œ ì„¬ë„¤ì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì˜¤ë¥˜: %v\\\"\"\n        }), \", bucketName, objectKey, err)\\n\\t\\t\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" err\\n\\t\\t\\t}\\n\\n\\t\\t\\tlog.Printf(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"ì„¬ë„¤ì¼ ìƒì„± ì„±ê³µ\\\"\"\n        }), \")\\n\\n\\t\\t\\terr = awsClient.uploadFile(bucketName, objectKey, thumbnail)\\n\\n\\t\\t\\tlog.Printf(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"ì„¬ë„¤ì¼ ì—…ë¡œë“œ ì„±ê³µ\\\"\"\n        }), \")\\n\\n\\t\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" err != \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \" {\\n\\t\\t\\t\\tlog.Fatalf(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"ë²„í‚· %sì— íŒŒì¼ %sì„ thumbnails/ì— ì—…ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤\\\"\"\n        }), \", bucketName, objectKey)\\n\\t\\t\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" err\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \"\\n}\\n\\n\", _jsxs(_components.span, {\n          className: \"hljs-function\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"func\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title\",\n            children: \"createThumbnail\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(reader io.Reader)\"\n          })]\n        }), \" (*bytes.Buffer, \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"error\"\n        }), \") {\\n\\tsrcImage, _, err := image.Decode(reader)\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" err != \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \" {\\n\\t\\tlog.Fatalf(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"ì˜¤ë¥˜ë¡œ ì¸í•´ íŒŒì¼ì„ ë””ì½”ë”©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: %v\\\"\"\n        }), \", err)\\n\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \", err\\n\\t}\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"// 80x80 í¬ê¸°ì˜ ì„¬ë„¤ì¼ ìƒì„±\"\n        }), \"\\n\\tthumbnail := imaging.Thumbnail(srcImage, \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"80\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"80\"\n        }), \", imaging.Lanczos)\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"var\"\n        }), \" bufferBytes []\", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"byte\"\n        }), \"\\n\\tbuffer := bytes.NewBuffer(bufferBytes)\\n\\n\\terr = png.Encode(buffer, thumbnail)\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" buffer, err\\n}\\n\\n\", _jsxs(_components.span, {\n          className: \"hljs-function\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"func\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(client *awsClient)\"\n          })]\n        }), \" downloadFile(bucketName \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"string\"\n        }), \", objectKey \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"string\"\n        }), \") (*bytes.Reader, \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"error\"\n        }), \") {\\n\\tresult, err := client.s3.GetObject(*client.ctx, \u0026s3.GetObjectInput{\\n\\t\\tBucket: aws.String(bucketName),\\n\\t\\tKey:    aws.String(objectKey),\\n\\t})\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" err != \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \" {\\n\\t\\tlog.Fatalf(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ %v:%v. ì›ì¸: %v\\\"\"\n        }), \", bucketName, objectKey, err)\\n\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \", err\\n\\t}\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"defer\"\n        }), \" result.Body.Close()\\n\\n\\tbody, err := io.ReadAll(result.Body)\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" err != \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \" {\\n\\t\\tlog.Fatalf(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ. ì˜¤ë¥˜: %s\\\"\"\n        }), \", err)\\n\\t\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \", err\\n\\t}\\n\\n\\tfile := bytes.NewReader(body)\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" file, err\\n}\\n\\n\", _jsxs(_components.span, {\n          className: \"hljs-function\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"func\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(client *awsClient)\"\n          })]\n        }), \" uploadFile(bucketName \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"string\"\n        }), \", originalObjectKey \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"string\"\n        }), \", thumbnail io.Reader) \", _jsx(_components.span, {\n          className: \"hljs-type\",\n          children: \"error\"\n        }), \" {\\n\\tobjectKeyParts := strings.Split(originalObjectKey, \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"/\\\"\"\n        }), \")\\n\\tfileNameWithoutExtensions := strings.Split(objectKeyParts[\", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"len\"\n        }), \"(objectKeyParts)\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"-1\"\n        }), \"], \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\".\\\"\"\n        }), \")[\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"]\\n\\tobjectKey := fmt.Sprintf(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"thumbnails/%s_thumbnail.png\\\"\"\n        }), \", fileNameWithoutExtensions)\\n\\n\\t_, err := client.s3.PutObject(*client.ctx, \u0026s3.PutObjectInput{\\n\\t\\tBucket: aws.String(bucketName),\\n\\t\\tKey:    aws.String(objectKey),\\n\\t\\tBody:   thumbnail,\\n\\t})\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" err != \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"nil\"\n        }), \" {\\n\\t\\tlog.Fatalf(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"%vì„(ë¥¼) %vì˜ %vì— ì—…ë¡œë“œí•  ìˆ˜ ì—†ìŒ. ì›ì¸: %v\\\\n\\\"\"\n        }), \",\\n\\t\\t\\toriginalObjectKey, bucketName, objectKey, err)\\n\\t}\\n\\n\\t\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" err\\n}\\n\\n\", _jsxs(_components.span, {\n          className: \"hljs-function\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"func\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title\",\n            children: \"main\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"()\"\n          })]\n        }), \" {\\n\\tlambda.Start(handleRequest)\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ì œ GitHub workflowë¥¼ ì„¤ì •í•˜ì—¬ ëŒë‹¤ ì½”ë“œë¥¼ ë°°í¬í•´ì•¼ í•©ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \".github/workflows í´ë”ì— deploy-lambda.ymlì´ë¼ëŠ” ìƒˆ íŒŒì¼ì„ ì¶”ê°€í•˜ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”:```\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-bash\",\n        children: [\"name: Deploy Thumbnail Generator Lambda\\non:\\n  push:\\n    branches:\\n      - main\\n    paths:\\n      - src/**/*\\n      - .github/workflows/deploy-lambda.yml\\n\\ndefaults:\\n  run:\\n    working-directory: src/\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"jobs\"\n        }), \":\\n  terraform:\\n    name: \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'Deploy Thumbnail Generator Lambda'\"\n        }), \"\\n    runs-on: ubuntu-latest\\n    steps:\\n      \", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# Checkout the repository to the GitHub Actions runner\"\n        }), \"\\n      - name: Checkout\\n        uses: actions/checkout@v3\\n\\n      - uses: actions/setup-go@v4.1.0\\n        with:\\n          go-version: \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'1.22.0'\"\n        }), \"\\n\\n      - name: Configure AWS Credentials Action For GitHub Actions\\n        uses: aws-actions/configure-aws-credentials@v1\\n        with:\\n          aws-access-key-id: \", _jsx(_components.span, {\n          className: \"hljs-variable\",\n          children: \"${ secrets.AWS_ACCESS_KEY }\"\n        }), \"\\n          aws-secret-access-key: \", _jsx(_components.span, {\n          className: \"hljs-variable\",\n          children: \"${ secrets.AWS_SECRET_ACCESS_KEY }\"\n        }), \"\\n          aws-region: eu-central-1\\n\\n      - name: Build Lambda\\n        run: GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -o build/main .\\n\\n      - name: Zip build\\n        run: zip -r -j main.zip ./build\\n\\n      - name: Update Lambda code\\n        run: aws lambda update-function-code --function-name=thumbnail-generator --zip-file=fileb://main.zip\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì½”ë“œë¥¼ ì»¤ë°‹í•˜ê³  ë ˆí¬ì§€í† ë¦¬ì— í‘¸ì‹œí•˜ë©´ ë¹Œë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì™„ë£Œë˜ë©´ Lambda í˜ì´ì§€ì˜ \\\"ìµœì¢… ìˆ˜ì •\\\" ì†ì„±ì„ í™•ì¸í•˜ì—¬ ë°°í¬ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\"\n    }), \"\\n\", _jsx(\"img\", {\n      src: \"/assets/img/2024-05-17-UseS3eventnotificationstogeneratethumbnails_5.png\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ S3 ë²„í‚·ì˜ images/ í´ë”ì— ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤. ì—…ë¡œë“œê°€ ì„±ê³µí•˜ë©´ ì ì‹œ ê¸°ë‹¤ë¦° í›„ ìƒˆë¡œ ë§Œë“  ì„¬ë„¤ì¼ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"ê²°ë¡ \"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ ê¸€ì—ì„œëŠ” Terraform ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ë¥¼ ì‚¬ìš©í•˜ì—¬ S3 ë²„í‚·, ëŒë‹¤, SNS, SNS ì•Œë¦¼ ë“±ì„ ìƒì„±í•˜ê³  ì—°ê²°í•˜ëŠ” ë°©ë²•ì„ ë°°ì› ìŠµë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ë˜í•œ S3 ì´ë²¤íŠ¸ë¥¼ SNS í† í”½ì— ë³´ë‚´ì–´ ì´ë¥¼ ë‹¤ë¥¸ ì†ŒìŠ¤(ë‹¤ë¥¸ SNS í† í”½ í¬í•¨)ë¡œ í™•ì‚°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ë„ ë°°ì› ìŠµë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì €í¬ëŠ” Goë¡œ ì‘ì„±ëœ ëŒë‹¤ í•¨ìˆ˜ë„ ë§Œë“¤ì—ˆì–´ìš”. ì´ í•¨ìˆ˜ëŠ” SNS ë©”ì‹œì§€ë¥¼ í†µí•´ í˜¸ì¶œë˜ì–´ S3 ë²„í‚·ì—ì„œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê³  ì´ë¯¸ì§€ì—ì„œ ì¸ë„¤ì¼ì„ ìƒì„±í•œ ë‹¤ìŒ ì´ ì¸ë„¤ì¼ì„ S3ì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì´ ê¸€ì˜ ì½”ë“œëŠ” ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ì¦ê±°ìš´ ì½”ë”©í•˜ì„¸ìš”! ğŸ’»\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-17-UseS3eventnotificationstogeneratethumbnails"},"buildId":"PgdIX9e0tvkvkdAmDT6qR","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>