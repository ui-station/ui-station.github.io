<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>SQL 설명 공통 테이블 표현식 | ui-station</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://ui-station.github.io///post/2024-05-23-SQLExplainedCommonTableExpressions" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="SQL 설명 공통 테이블 표현식 | ui-station" data-gatsby-head="true"/><meta property="og:title" content="SQL 설명 공통 테이블 표현식 | ui-station" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-23-SQLExplainedCommonTableExpressions_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://ui-station.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://ui-station.github.io///post/2024-05-23-SQLExplainedCommonTableExpressions" data-gatsby-head="true"/><meta name="twitter:title" content="SQL 설명 공통 테이블 표현식 | ui-station" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-23-SQLExplainedCommonTableExpressions_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | ui-station" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-23 15:55" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BHFR6GTH9P"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-BHFR6GTH9P');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/acd99c507555fdc6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/acd99c507555fdc6.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/_next/static/chunks/348-d11c34b645b13f5b.js" defer=""></script><script src="/_next/static/chunks/162-4172e84c8e2aa747.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-4f7b40c1114f0d09.js" defer=""></script><script src="/_next/static/RZIEBQ2aNAp_DXFVTV6eL/_buildManifest.js" defer=""></script><script src="/_next/static/RZIEBQ2aNAp_DXFVTV6eL/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UI STATION</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">SQL 설명 공통 테이블 표현식</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="SQL 설명 공통 테이블 표현식" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UI STATION</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 23, 2024</span><span class="posts_reading_time__f7YPP">8<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-23-SQLExplainedCommonTableExpressions&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>SQL에서 CTE(Common Table Expressions, CTE로 알려진)는 다른 SQL 쿼리에서 파생된 중간 데이터를 포함하는 일시적인 이름이 지정된 결과 세트입니다. CTE에 데이터가 있는 경우 동일한 쿼리 내에서 해당 데이터를 한 번 이상 참조할 수 있습니다.</p>
<p>위 설명을 보면 CTE가 SQL의 일반적인 일시적 테이블과 많이 닮았다고 생각할 수 있습니다. 어떤 면에서는 맞지만 왜 CTE를 사용해야 하는지 궁금할 수 있습니다. 이에 대답하기 위해 일시적 테이블의 주요 단점 두 가지를 살펴보겠습니다.</p>
<p>일시적 테이블은 특히 대규모 SQL 스크립트의 다양한 부분을 횡단해서 사용될 경우처럼 복잡한 코드 작성에 기여할 수 있습니다. 이들은 명시적으로 생성, 삭제되어야 하며 필요시 인덱스도 구축되어야 합니다. 이로 인해 SQL 및 세션 관리에 부하가 추가됩니다.</p>
<p>또한, 일시적 테이블은 물리적 저장 공간을 소비하며, 여유 공간이 부족하고 많은 양의 일시적 테이블이 있다면 이는 고려할 사항일 수 있습니다. 게다가 일시적 테이블을 사용하는 쿼리를 살펴볼 때, 일시적 테이블에 어떤 데이터가 포함되어 있는지, 데이터가 어디서 왔는지 명확하지 않을 수 있습니다.</p>
<p>CTE(공통 테이블 표현식)에는 위에서 언급한 문제가 없어요. 일단, CTE는 일시적이기 때문에 SQL 세션이 종료되면 CTE가 범위에서 벗어나고 사용한 모든 메모리가 해제됩니다.</p>
<p>그리고 CTE에 들어 있는 데이터를 정확히 확인할 수 있어요. 그 생성과 채움은 SQL 스크립트 안에 바로 있어요.</p>
<p>CTE의 이점뿐만 아니라, 특정 단점도 있어서 아래 경우에는 사용하지 않는 것이 좋을 수 있어요.</p>
<ul>
<li>쿼리에서 CTE에 포함될 데이터를 한 번 이상 참조해야 하는 경우. 이는 CTE가 참조될 때마다 다시 채워져야 하기 때문에 발생하는 문제예요. 그러나 CTE의 데이터 양이 작다면 이것이 사용 시 제약 사항이 되지 않을 수 있어요.</li>
<li>위와 관련하여, CTE는 인덱싱할 수 없기 때문에 데이터 양이 많으면 인덱싱된 임시 테이블보다 성능이 떨어질 수 있어요.</li>
</ul>
<p>그러니까, 다음 시나리오에서 CTE를 사용해 보세요.</p>
<ul>
<li>임시 테이블을 사용하지 않으려고 할 때</li>
<li>CTE의 데이터 양이 비교적 낮을 때</li>
<li>쿼리에서 CTE 데이터를 한 번만 참조하는 경우 (데이터 양에 따라 두 번일 수도 있음)</li>
</ul>
<p>아직 언급하지 않은 CTE의 마지막 이점은 많은 최신 SQL 방언에서 재귀 CTE를 지원한다는 것입니다. 즉, CTE가 자기 자신을 참조하는 경우입니다. 당연히 이는 재귀 및 계층 기반 SQL 쿼리를 코딩하기가 훨씬 쉬워진다는 뜻입니다. 나중에 이에 대한 몇 가지 예제를 살펴볼 것입니다.</p>
<p>이제 CTE의 정의와 기능을 보다 자세히 이해했으니, 사용 예제를 살펴보겠습니다.</p>
<h2>테스트 환경 설정하기.</h2>
<p>저는 Oracle의 라이브 SQL 웹사이트를 사용하여 테스트를 실행합니다. 이 서비스에 액세스하고 사용하는 방법에 대해 이전에 작성한 SQL에서 Grouping Sets, Rollup 및 Cube를 사용하는 기사에서 설명했습니다. 설정하고 사용하는 데 완전히 무료입니다. 해당 기사 링크는 아래에 제공되어 있습니다.</p>
<h2>샘플 테이블 생성 &#x26; 데이터 삽입</h2>
<p>재귀적이지 않은 CTE 예제를 위해 고객 거래 내역 테이블을 사용할 것입니다. 입력 테이블 및 데이터를 재생성하는 데 필요한 테이블 생성 및 데이터 삽입 문을 여기에 제공합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">CREATE</span> <span class="hljs-variable constant_">TABLE</span> transactions (
    <span class="hljs-title class_">TransactionID</span> <span class="hljs-variable constant_">INT</span> <span class="hljs-variable constant_">PRIMARY</span> <span class="hljs-variable constant_">KEY</span>,
    <span class="hljs-title class_">CustomerID</span> <span class="hljs-variable constant_">INT</span>,
    <span class="hljs-title class_">Amount</span> <span class="hljs-title function_">DECIMAL</span>(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>),
    <span class="hljs-title class_">TransactionDate</span> <span class="hljs-variable constant_">DATE</span>
);

<span class="hljs-variable constant_">INSERT</span> <span class="hljs-variable constant_">INTO</span> <span class="hljs-title class_">Transactions</span> (<span class="hljs-title class_">TransactionID</span>, <span class="hljs-title class_">CustomerID</span>, <span class="hljs-title class_">Amount</span>, <span class="hljs-title class_">TransactionDate</span>)
<span class="hljs-variable constant_">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-number">1001</span>, <span class="hljs-number">150</span>, <span class="hljs-title function_">TO_DATE</span>(<span class="hljs-string">'2021-01-01'</span>, <span class="hljs-string">'YYYY-MM-DD'</span>));

<span class="hljs-variable constant_">INSERT</span> <span class="hljs-variable constant_">INTO</span> <span class="hljs-title class_">Transactions</span> (<span class="hljs-title class_">TransactionID</span>, <span class="hljs-title class_">CustomerID</span>, <span class="hljs-title class_">Amount</span>, <span class="hljs-title class_">TransactionDate</span>)
<span class="hljs-variable constant_">VALUES</span> (<span class="hljs-number">2</span>, <span class="hljs-number">1002</span>, <span class="hljs-number">200</span>, <span class="hljs-title function_">TO_DATE</span>(<span class="hljs-string">'2021-01-04'</span>, <span class="hljs-string">'YYYY-MM-DD'</span>));

<span class="hljs-variable constant_">INSERT</span> <span class="hljs-variable constant_">INTO</span> <span class="hljs-title class_">Transactions</span> (<span class="hljs-title class_">TransactionID</span>, <span class="hljs-title class_">CustomerID</span>, <span class="hljs-title class_">Amount</span>, <span class="hljs-title class_">TransactionDate</span>)
<span class="hljs-variable constant_">VALUES</span> (<span class="hljs-number">3</span>, <span class="hljs-number">1001</span>, <span class="hljs-number">100</span>, <span class="hljs-title function_">TO_DATE</span>(<span class="hljs-string">'2021-01-04'</span>, <span class="hljs-string">'YYYY-MM-DD'</span>));

<span class="hljs-variable constant_">INSERT</span> <span class="hljs-variable constant_">INTO</span> <span class="hljs-title class_">Transactions</span> (<span class="hljs-title class_">TransactionID</span>, <span class="hljs-title class_">CustomerID</span>, <span class="hljs-title class_">Amount</span>, <span class="hljs-title class_">TransactionDate</span>)
<span class="hljs-variable constant_">VALUES</span> (<span class="hljs-number">4</span>, <span class="hljs-number">1003</span>, <span class="hljs-number">250</span>, <span class="hljs-title function_">TO_DATE</span>(<span class="hljs-string">'2021-01-05'</span>, <span class="hljs-string">'YYYY-MM-DD'</span>));

<span class="hljs-variable constant_">INSERT</span> <span class="hljs-variable constant_">INTO</span> <span class="hljs-title class_">Transactions</span> (<span class="hljs-title class_">TransactionID</span>, <span class="hljs-title class_">CustomerID</span>, <span class="hljs-title class_">Amount</span>, <span class="hljs-title class_">TransactionDate</span>)
<span class="hljs-variable constant_">VALUES</span> (<span class="hljs-number">5</span>, <span class="hljs-number">1002</span>, <span class="hljs-number">300</span>, <span class="hljs-title function_">TO_DATE</span>(<span class="hljs-string">'2021-01-05'</span>, <span class="hljs-string">'YYYY-MM-DD'</span>));

<span class="hljs-variable constant_">INSERT</span> <span class="hljs-variable constant_">INTO</span> <span class="hljs-title class_">Transactions</span> (<span class="hljs-title class_">TransactionID</span>, <span class="hljs-title class_">CustomerID</span>, <span class="hljs-title class_">Amount</span>, <span class="hljs-title class_">TransactionDate</span>)
<span class="hljs-variable constant_">VALUES</span> (<span class="hljs-number">6</span>, <span class="hljs-number">1003</span>, <span class="hljs-number">180</span>, <span class="hljs-title function_">TO_DATE</span>(<span class="hljs-string">'2021-01-08'</span>, <span class="hljs-string">'YYYY-MM-DD'</span>));

<span class="hljs-variable constant_">INSERT</span> <span class="hljs-variable constant_">INTO</span> <span class="hljs-title class_">Transactions</span> (<span class="hljs-title class_">TransactionID</span>, <span class="hljs-title class_">CustomerID</span>, <span class="hljs-title class_">Amount</span>, <span class="hljs-title class_">TransactionDate</span>)
<span class="hljs-variable constant_">VALUES</span> (<span class="hljs-number">7</span>, <span class="hljs-number">1001</span>, <span class="hljs-number">190</span>, <span class="hljs-title function_">TO_DATE</span>(<span class="hljs-string">'2021-01-08'</span>, <span class="hljs-string">'YYYY-MM-DD'</span>));
</code></pre>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">SELECT</span> * <span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">Transactions</span>


<span class="hljs-variable constant_">TRANSACTIONID</span> <span class="hljs-variable constant_">CUSTOMERID</span> <span class="hljs-variable constant_">AMOUNT</span> <span class="hljs-variable constant_">TRANSACTIONDATE</span>
============= ================= ===============
<span class="hljs-number">1</span>             <span class="hljs-number">1001</span>       <span class="hljs-number">150</span>    <span class="hljs-number">01</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>
<span class="hljs-number">2</span>             <span class="hljs-number">1002</span>       <span class="hljs-number">200</span>    <span class="hljs-number">04</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>
<span class="hljs-number">3</span>             <span class="hljs-number">1001</span>       <span class="hljs-number">100</span>    <span class="hljs-number">04</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>
<span class="hljs-number">4</span>             <span class="hljs-number">1003</span>       <span class="hljs-number">250</span>    <span class="hljs-number">05</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>
<span class="hljs-number">5</span>             <span class="hljs-number">1002</span>       <span class="hljs-number">300</span>    <span class="hljs-number">05</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>
<span class="hljs-number">6</span>             <span class="hljs-number">1003</span>       <span class="hljs-number">180</span>    <span class="hljs-number">08</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>
<span class="hljs-number">7</span>             <span class="hljs-number">1001</span>       <span class="hljs-number">190</span>    <span class="hljs-number">08</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>
</code></pre>
<p>표준 CTE 구문은 놀랍도록 간단합니다. 단순히,</p>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">WITH</span> cte_name [(column_list)] <span class="hljs-variable constant_">AS</span> (cte_query_definition) statement
</code></pre>
<p>다음과 같은 표가 있습니다:</p>
<ul>
<li>cte_name은 CTE에 지정된 이름입니다</li>
<li>column_list는 CTE의 열 이름 목록입니다(선택 사항)</li>
<li>cte_query_definition은 CTE의 결과 집합을 정의하는 쿼리입니다</li>
<li>statement은 CTE를 참조하는 단일 SELECT, INSERT, UPDATE, DELETE 또는 MERGE 문입니다</li>
</ul>
<h2>테스트 1 — 간단한 CTE</h2>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">WITH</span> <span class="hljs-title class_">CustomerTotals</span> <span class="hljs-variable constant_">AS</span> (
    <span class="hljs-variable constant_">SELECT</span> <span class="hljs-title class_">CustomerID</span>, <span class="hljs-title function_">SUM</span>(<span class="hljs-title class_">Amount</span>) <span class="hljs-variable constant_">AS</span> <span class="hljs-title class_">TotalSpent</span>
    <span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">Transactions</span>
    <span class="hljs-variable constant_">GROUP</span> <span class="hljs-variable constant_">BY</span> <span class="hljs-title class_">CustomerID</span>
)
<span class="hljs-variable constant_">SELECT</span> <span class="hljs-title class_">CustomerID</span>, <span class="hljs-title class_">TotalSpent</span>
<span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">CustomerTotals</span>
<span class="hljs-variable constant_">WHERE</span> <span class="hljs-title class_">TotalSpent</span> > <span class="hljs-number">250</span>;
</code></pre>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">CUSTOMERID</span> | <span class="hljs-variable constant_">TOTALSPENT</span>
---------- | ----------
<span class="hljs-number">1001</span>       | <span class="hljs-number">440</span>
<span class="hljs-number">1002</span>       | <span class="hljs-number">500</span>
<span class="hljs-number">1003</span>       | <span class="hljs-number">430</span>
</code></pre>
<p>이 경우, 이 쿼리의 non-CTE 버전도 간단합니다. 다음과 같습니다.</p>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">SELECT</span> <span class="hljs-title class_">CustomerID</span>, <span class="hljs-title function_">SUM</span>(<span class="hljs-title class_">Amount</span>) <span class="hljs-variable constant_">AS</span> <span class="hljs-title class_">TotalSpent</span>
<span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">Transactions</span>
<span class="hljs-variable constant_">GROUP</span> <span class="hljs-variable constant_">BY</span> <span class="hljs-title class_">CustomerID</span>
<span class="hljs-variable constant_">HAVING</span> <span class="hljs-title function_">SUM</span>(<span class="hljs-title class_">Amount</span>) > <span class="hljs-number">250</span>;
</code></pre>
<h2>테스트 2 — 더 복잡한 CTE</h2>
<p>CTE가 자신을 발휘하는 곳은 이와 유사한 쿼리를 갖고 있을 때입니다.</p>
<p>CTE를 사용하면 이와 같은 쿼리는 비교적 쉬워집니다. 필요한 두 집계값은 각각 두 개의 개별 CTE로 분리할 수 있고, 그 결과를 단순히 비교하여 얻을 수 있습니다.</p>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">WITH</span> <span class="hljs-title class_">CustomerAverages</span> <span class="hljs-variable constant_">AS</span> (
    <span class="hljs-variable constant_">SELECT</span> <span class="hljs-title class_">CustomerID</span>, <span class="hljs-title function_">AVG</span>(<span class="hljs-title class_">Amount</span>) <span class="hljs-variable constant_">AS</span> <span class="hljs-title class_">AvgAmount</span>
    <span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">Transactions</span>
    <span class="hljs-variable constant_">GROUP</span> <span class="hljs-variable constant_">BY</span> <span class="hljs-title class_">CustomerID</span>
),
<span class="hljs-title class_">OverallAverage</span> <span class="hljs-variable constant_">AS</span> (
    <span class="hljs-variable constant_">SELECT</span> <span class="hljs-title function_">AVG</span>(<span class="hljs-title class_">Amount</span>) <span class="hljs-variable constant_">AS</span> <span class="hljs-title class_">OverallAvg</span>
    <span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">Transactions</span>
)
<span class="hljs-variable constant_">SELECT</span> a.<span class="hljs-property">CustomerID</span>, a.<span class="hljs-property">AvgAmount</span>
<span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">CustomerAverages</span> a, <span class="hljs-title class_">OverallAverage</span> o
<span class="hljs-variable constant_">WHERE</span> a.<span class="hljs-property">AvgAmount</span> > o.<span class="hljs-property">OverallAvg</span>;
</code></pre>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">CUSTOMERID</span> <span class="hljs-variable constant_">AVGAMOUNT</span>
========== =========
<span class="hljs-number">1002</span>       <span class="hljs-number">250</span>
<span class="hljs-number">1003</span>       <span class="hljs-number">215</span>
</code></pre>
<p>저는 이것을 비-CTE 버전과 비교해 봤을 때,</p>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">SELECT</span> <span class="hljs-title class_">CustomerID</span>, <span class="hljs-title function_">AVG</span>(<span class="hljs-title class_">Amount</span>) <span class="hljs-variable constant_">AS</span> <span class="hljs-title class_">AvgAmount</span>
<span class="hljs-variable constant_">FROM</span> transactions
<span class="hljs-variable constant_">GROUP</span> <span class="hljs-variable constant_">BY</span> <span class="hljs-title class_">CustomerID</span>
<span class="hljs-variable constant_">HAVING</span> <span class="hljs-title function_">AVG</span>(<span class="hljs-title class_">Amount</span>) > (
    <span class="hljs-variable constant_">SELECT</span> <span class="hljs-title function_">AVG</span>(sub.<span class="hljs-property">AvgAmount</span>)
    <span class="hljs-variable constant_">FROM</span> (
        <span class="hljs-variable constant_">SELECT</span> <span class="hljs-title function_">AVG</span>(<span class="hljs-title class_">Amount</span>) <span class="hljs-variable constant_">AS</span> <span class="hljs-title class_">AvgAmount</span>
        <span class="hljs-variable constant_">FROM</span> transactions
        <span class="hljs-variable constant_">GROUP</span> <span class="hljs-variable constant_">BY</span> <span class="hljs-title class_">CustomerID</span>
    ) sub
);
</code></pre>
<p>내가 생각하기에, CTE를 사용하면 SQL 작성자의 의도가 더 명확해지고 무엇이 일어나고 있는지 더 명확해집니다.</p>
<h2>테스트 3 — 재귀 CTEs</h2>
<p>재귀 CTE(Commmon Table Expressions)는 쿼리 중 하나의 CTE가 자신을 참조하는 쿼리입니다. 예제에서 별명 정보를 사용하여 위의 CTE 예제를 재귀 CTE를 사용하여 작성할 수 있다는 것을 기믈했을지도 모릅니다.</p>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">WITH</span> <span class="hljs-title class_">CustomerAverages</span> <span class="hljs-variable constant_">AS</span> (
    <span class="hljs-variable constant_">SELECT</span> <span class="hljs-title class_">CustomerID</span>, <span class="hljs-title function_">AVG</span>(<span class="hljs-title class_">Amount</span>) <span class="hljs-variable constant_">AS</span> <span class="hljs-title class_">AvgAmount</span>
    <span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">Transactions</span>
    <span class="hljs-variable constant_">GROUP</span> <span class="hljs-variable constant_">BY</span> <span class="hljs-title class_">CustomerID</span>
),
<span class="hljs-title class_">OverallAverage</span> <span class="hljs-variable constant_">AS</span> (
    <span class="hljs-variable constant_">SELECT</span> <span class="hljs-title function_">AVG</span>(<span class="hljs-title class_">AvgAmount</span>) <span class="hljs-variable constant_">AS</span> <span class="hljs-title class_">OverallAvg</span>
    <span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">CustomerAverages</span>
)
<span class="hljs-variable constant_">SELECT</span> a.<span class="hljs-property">CustomerID</span>, a.<span class="hljs-property">AvgAmount</span>
<span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">CustomerAverages</span> a, <span class="hljs-title class_">OverallAverage</span> o
<span class="hljs-variable constant_">WHERE</span> a.<span class="hljs-property">AvgAmount</span> > o.<span class="hljs-property">OverallAvg</span>;
</code></pre>
<p>두 번째 CTE인 OverallAverage에 필요한 정보는 이미 첫 번째 CTE인 CustomerAverages에 포함되어 있었기 때문에 첫 번째 CTE의 데이터를 두 번째 CTE의 계산에 사용할 수 있었습니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">with</span> recursive <span class="hljs-title function_">cte</span>(col1, col2 etc…) <span class="hljs-keyword">as</span> my_cte
...
...
</code></pre>
<p>오라클은 CTE가 쿼리 내에서 자기 자신을 참조한다면 재귀적이라고 가정하기 때문에 특별한 재귀 키워드가 필요하지 않습니다.</p>
<p>최종 예제로, 우리는 원본 시계열 데이터의 간격을 채우기 위해 재귀적인 CTE를 사용할 것입니다.</p>
<p>원본 테이블 데이터로 돌아가면, 1월 2일 및 3일, 그리고 1월 6일 및 7일의 고객 데이터 항목이 누락되어 있다는 것을 알 수 있습니다.</p>
<p>우리의 작업은 매일의 고객 지출 총액을 보여주는 보고서를 생성하는 것입니다. 날짜에 대한 항목이 없는 경우, 해당 날짜의 고객 지출 값의 합계를 위해 제로를 반환합니다.</p>
<p>이 재귀 CTE에 대한 좋은 사용 사례입니다.</p>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">WITH</span> <span class="hljs-title class_">DateRange</span> (dt) <span class="hljs-variable constant_">AS</span> (
    <span class="hljs-variable constant_">SELECT</span> <span class="hljs-title function_">MIN</span>(<span class="hljs-variable constant_">TRANSACTIONDATE</span>) 
    <span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">Transactions</span>
    <span class="hljs-variable constant_">UNION</span> <span class="hljs-variable constant_">ALL</span>
    <span class="hljs-variable constant_">SELECT</span> dt + <span class="hljs-variable constant_">INTERVAL</span> <span class="hljs-string">'1'</span> <span class="hljs-variable constant_">DAY</span> 
    <span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">DateRange</span> <span class="hljs-variable constant_">WHERE</span> dt &#x3C; (<span class="hljs-variable constant_">SELECT</span> <span class="hljs-title function_">MAX</span>(<span class="hljs-variable constant_">TRANSACTIONDATE</span>) <span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">Transactions</span>)
),
<span class="hljs-title class_">AggregatedData</span> <span class="hljs-variable constant_">AS</span> (
    <span class="hljs-variable constant_">SELECT</span> <span class="hljs-variable constant_">TRANSACTIONDATE</span>, <span class="hljs-title function_">SUM</span>(<span class="hljs-variable constant_">AMOUNT</span>) <span class="hljs-variable constant_">AS</span> <span class="hljs-variable constant_">TOTAL_SPEND</span>
    <span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">Transactions</span>
    <span class="hljs-variable constant_">GROUP</span> <span class="hljs-variable constant_">BY</span> <span class="hljs-variable constant_">TRANSACTIONDATE</span>
)
<span class="hljs-variable constant_">SELECT</span> dr.<span class="hljs-property">dt</span> <span class="hljs-variable constant_">AS</span> <span class="hljs-variable constant_">TRANSACTIONDATE</span>,
       <span class="hljs-title function_">NVL</span>(ad.<span class="hljs-property">TOTAL_AMOUNT</span>, <span class="hljs-number">0</span>) <span class="hljs-variable constant_">AS</span> <span class="hljs-variable constant_">TOTAL_SPEND</span>
<span class="hljs-variable constant_">FROM</span> <span class="hljs-title class_">DateRange</span> dr
<span class="hljs-variable constant_">LEFT</span> <span class="hljs-variable constant_">JOIN</span> <span class="hljs-title class_">AggregatedData</span> ad <span class="hljs-variable constant_">ON</span> dr.<span class="hljs-property">dt</span> = ad.<span class="hljs-property">TRANSACTIONDATE</span>
<span class="hljs-variable constant_">ORDER</span> <span class="hljs-variable constant_">BY</span> dr.<span class="hljs-property">dt</span>;

<span class="hljs-variable constant_">TRANSACTIONDATE</span>  <span class="hljs-variable constant_">TOTAL_SPEND</span>
===============  ===========
<span class="hljs-number">01</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>        <span class="hljs-number">150</span>
<span class="hljs-number">02</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>        <span class="hljs-number">0</span>
<span class="hljs-number">03</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>        <span class="hljs-number">0</span>
<span class="hljs-number">04</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>        <span class="hljs-number">300</span>
<span class="hljs-number">05</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>        <span class="hljs-number">550</span>
<span class="hljs-number">06</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>        <span class="hljs-number">0</span>
<span class="hljs-number">07</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>        <span class="hljs-number">0</span>
<span class="hljs-number">08</span>-<span class="hljs-variable constant_">JAN</span>-<span class="hljs-number">21</span>        <span class="hljs-number">370</span>
</code></pre>
<ul>
<li>DateRange CTE: 이 부분은 가장 이른 날짜부터 가장 늦은 거래일까지 연속된 날짜 범위를 생성하여 날짜 간격이 없음을 보장합니다.</li>
<li>AggregatedData CTE: 각 날짜의 거래를 합산합니다.</li>
<li>최종 SELECT: 날짜 범위를 집계된 거래 데이터와 조인하며, NVL 함수를 사용하여 NULL 값을 0으로 대체하여 거래가 없는 날은 총액이 0으로 나타나도록 합니다.</li>
</ul>
<h2>요약</h2>
<p>결론적으로, Common Table Expressions(CTEs)는 SQL에서 가독성, 유지 관리 및 복잡한 쿼리의 실행을 개선할 수 있는 다재다능하고 강력한 기능입니다. 이 글을 통해 CTE의 기본 구조와 기능을 탐색하며, 비재귀 및 재귀 유형을 살펴 다양한 시나리오에서 그 유틸리티를 보여주었습니다.</p>
<p>포함된 세 가지 테스트 케이스는 CTE가 복잡한 SQL 작업의 관리를 단순화하고 이를 더 쉽게 다룰 수 있는 부분으로 나누어주며, 재귀 데이터를 처리하는 능력을 보여주었습니다.</p>
<p>또한, CTE 사용은 더 깨끗하고 조직적인 SQL 스크립트로 이어지며, 개발자와 분석가가 데이터베이스 쿼리를 작성, 디버깅 및 최적화하는 작업이 쉬워집니다.</p>
<p>아직도 CTE에 대해 확신이 없다면, 제 3번 테스트 예제에서 CTE를 사용하지 않고 어떻게 문제를 해결할지 생각해보세요. 이런 문제에 대한 전통적인 SQL 접근 방식은 더 불편하고 효율적이지 않다는 것을 알게 될 것입니다.</p>
<p>이 컨텐츠가 마음에 드셨다면, 이 아티클도 흥미롭게 보실 것 같아요.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"SQL 설명 공통 테이블 표현식","description":"","date":"2024-05-23 15:55","slug":"2024-05-23-SQLExplainedCommonTableExpressions","content":"\n\nSQL에서 CTE(Common Table Expressions, CTE로 알려진)는 다른 SQL 쿼리에서 파생된 중간 데이터를 포함하는 일시적인 이름이 지정된 결과 세트입니다. CTE에 데이터가 있는 경우 동일한 쿼리 내에서 해당 데이터를 한 번 이상 참조할 수 있습니다.\n\n위 설명을 보면 CTE가 SQL의 일반적인 일시적 테이블과 많이 닮았다고 생각할 수 있습니다. 어떤 면에서는 맞지만 왜 CTE를 사용해야 하는지 궁금할 수 있습니다. 이에 대답하기 위해 일시적 테이블의 주요 단점 두 가지를 살펴보겠습니다.\n\n일시적 테이블은 특히 대규모 SQL 스크립트의 다양한 부분을 횡단해서 사용될 경우처럼 복잡한 코드 작성에 기여할 수 있습니다. 이들은 명시적으로 생성, 삭제되어야 하며 필요시 인덱스도 구축되어야 합니다. 이로 인해 SQL 및 세션 관리에 부하가 추가됩니다.\n\n또한, 일시적 테이블은 물리적 저장 공간을 소비하며, 여유 공간이 부족하고 많은 양의 일시적 테이블이 있다면 이는 고려할 사항일 수 있습니다. 게다가 일시적 테이블을 사용하는 쿼리를 살펴볼 때, 일시적 테이블에 어떤 데이터가 포함되어 있는지, 데이터가 어디서 왔는지 명확하지 않을 수 있습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nCTE(공통 테이블 표현식)에는 위에서 언급한 문제가 없어요. 일단, CTE는 일시적이기 때문에 SQL 세션이 종료되면 CTE가 범위에서 벗어나고 사용한 모든 메모리가 해제됩니다.\n\n그리고 CTE에 들어 있는 데이터를 정확히 확인할 수 있어요. 그 생성과 채움은 SQL 스크립트 안에 바로 있어요.\n\nCTE의 이점뿐만 아니라, 특정 단점도 있어서 아래 경우에는 사용하지 않는 것이 좋을 수 있어요.\n\n- 쿼리에서 CTE에 포함될 데이터를 한 번 이상 참조해야 하는 경우. 이는 CTE가 참조될 때마다 다시 채워져야 하기 때문에 발생하는 문제예요. 그러나 CTE의 데이터 양이 작다면 이것이 사용 시 제약 사항이 되지 않을 수 있어요.\n- 위와 관련하여, CTE는 인덱싱할 수 없기 때문에 데이터 양이 많으면 인덱싱된 임시 테이블보다 성능이 떨어질 수 있어요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n그러니까, 다음 시나리오에서 CTE를 사용해 보세요.\n\n- 임시 테이블을 사용하지 않으려고 할 때\n- CTE의 데이터 양이 비교적 낮을 때\n- 쿼리에서 CTE 데이터를 한 번만 참조하는 경우 (데이터 양에 따라 두 번일 수도 있음)\n\n아직 언급하지 않은 CTE의 마지막 이점은 많은 최신 SQL 방언에서 재귀 CTE를 지원한다는 것입니다. 즉, CTE가 자기 자신을 참조하는 경우입니다. 당연히 이는 재귀 및 계층 기반 SQL 쿼리를 코딩하기가 훨씬 쉬워진다는 뜻입니다. 나중에 이에 대한 몇 가지 예제를 살펴볼 것입니다.\n\n이제 CTE의 정의와 기능을 보다 자세히 이해했으니, 사용 예제를 살펴보겠습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 테스트 환경 설정하기.\n\n저는 Oracle의 라이브 SQL 웹사이트를 사용하여 테스트를 실행합니다. 이 서비스에 액세스하고 사용하는 방법에 대해 이전에 작성한 SQL에서 Grouping Sets, Rollup 및 Cube를 사용하는 기사에서 설명했습니다. 설정하고 사용하는 데 완전히 무료입니다. 해당 기사 링크는 아래에 제공되어 있습니다.\n\n## 샘플 테이블 생성 \u0026 데이터 삽입\n\n재귀적이지 않은 CTE 예제를 위해 고객 거래 내역 테이블을 사용할 것입니다. 입력 테이블 및 데이터를 재생성하는 데 필요한 테이블 생성 및 데이터 삽입 문을 여기에 제공합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\r\nCREATE TABLE transactions (\n    TransactionID INT PRIMARY KEY,\n    CustomerID INT,\n    Amount DECIMAL(10, 2),\n    TransactionDate DATE\n);\n\nINSERT INTO Transactions (TransactionID, CustomerID, Amount, TransactionDate)\nVALUES (1, 1001, 150, TO_DATE('2021-01-01', 'YYYY-MM-DD'));\n\nINSERT INTO Transactions (TransactionID, CustomerID, Amount, TransactionDate)\nVALUES (2, 1002, 200, TO_DATE('2021-01-04', 'YYYY-MM-DD'));\n\nINSERT INTO Transactions (TransactionID, CustomerID, Amount, TransactionDate)\nVALUES (3, 1001, 100, TO_DATE('2021-01-04', 'YYYY-MM-DD'));\n\nINSERT INTO Transactions (TransactionID, CustomerID, Amount, TransactionDate)\nVALUES (4, 1003, 250, TO_DATE('2021-01-05', 'YYYY-MM-DD'));\n\nINSERT INTO Transactions (TransactionID, CustomerID, Amount, TransactionDate)\nVALUES (5, 1002, 300, TO_DATE('2021-01-05', 'YYYY-MM-DD'));\n\nINSERT INTO Transactions (TransactionID, CustomerID, Amount, TransactionDate)\nVALUES (6, 1003, 180, TO_DATE('2021-01-08', 'YYYY-MM-DD'));\n\nINSERT INTO Transactions (TransactionID, CustomerID, Amount, TransactionDate)\nVALUES (7, 1001, 190, TO_DATE('2021-01-08', 'YYYY-MM-DD'));\r\n```\n\n```js\r\nSELECT * FROM Transactions\n\n\nTRANSACTIONID CUSTOMERID AMOUNT TRANSACTIONDATE\n============= ================= ===============\n1             1001       150    01-JAN-21\n2             1002       200    04-JAN-21\n3             1001       100    04-JAN-21\n4             1003       250    05-JAN-21\n5             1002       300    05-JAN-21\n6             1003       180    08-JAN-21\n7             1001       190    08-JAN-21\r\n```\n\n표준 CTE 구문은 놀랍도록 간단합니다. 단순히,\n\n```js\r\nWITH cte_name [(column_list)] AS (cte_query_definition) statement\r\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n다음과 같은 표가 있습니다:\n\n- cte_name은 CTE에 지정된 이름입니다\n- column_list는 CTE의 열 이름 목록입니다(선택 사항)\n- cte_query_definition은 CTE의 결과 집합을 정의하는 쿼리입니다\n- statement은 CTE를 참조하는 단일 SELECT, INSERT, UPDATE, DELETE 또는 MERGE 문입니다\n\n## 테스트 1 — 간단한 CTE\n\n```js\nWITH CustomerTotals AS (\n    SELECT CustomerID, SUM(Amount) AS TotalSpent\n    FROM Transactions\n    GROUP BY CustomerID\n)\nSELECT CustomerID, TotalSpent\nFROM CustomerTotals\nWHERE TotalSpent \u003e 250;\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nCUSTOMERID | TOTALSPENT\n---------- | ----------\n1001       | 440\n1002       | 500\n1003       | 430\n```\n\n이 경우, 이 쿼리의 non-CTE 버전도 간단합니다. 다음과 같습니다.\n\n```js\nSELECT CustomerID, SUM(Amount) AS TotalSpent\nFROM Transactions\nGROUP BY CustomerID\nHAVING SUM(Amount) \u003e 250;\n```\n\n## 테스트 2 — 더 복잡한 CTE\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nCTE가 자신을 발휘하는 곳은 이와 유사한 쿼리를 갖고 있을 때입니다.\n\nCTE를 사용하면 이와 같은 쿼리는 비교적 쉬워집니다. 필요한 두 집계값은 각각 두 개의 개별 CTE로 분리할 수 있고, 그 결과를 단순히 비교하여 얻을 수 있습니다.\n\n```js\nWITH CustomerAverages AS (\n    SELECT CustomerID, AVG(Amount) AS AvgAmount\n    FROM Transactions\n    GROUP BY CustomerID\n),\nOverallAverage AS (\n    SELECT AVG(Amount) AS OverallAvg\n    FROM Transactions\n)\nSELECT a.CustomerID, a.AvgAmount\nFROM CustomerAverages a, OverallAverage o\nWHERE a.AvgAmount \u003e o.OverallAvg;\n```\n\n```js\nCUSTOMERID AVGAMOUNT\n========== =========\n1002       250\n1003       215\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n저는 이것을 비-CTE 버전과 비교해 봤을 때,\n\n```js\nSELECT CustomerID, AVG(Amount) AS AvgAmount\nFROM transactions\nGROUP BY CustomerID\nHAVING AVG(Amount) \u003e (\n    SELECT AVG(sub.AvgAmount)\n    FROM (\n        SELECT AVG(Amount) AS AvgAmount\n        FROM transactions\n        GROUP BY CustomerID\n    ) sub\n);\n```\n\n내가 생각하기에, CTE를 사용하면 SQL 작성자의 의도가 더 명확해지고 무엇이 일어나고 있는지 더 명확해집니다.\n\n## 테스트 3 — 재귀 CTEs\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n재귀 CTE(Commmon Table Expressions)는 쿼리 중 하나의 CTE가 자신을 참조하는 쿼리입니다. 예제에서 별명 정보를 사용하여 위의 CTE 예제를 재귀 CTE를 사용하여 작성할 수 있다는 것을 기믈했을지도 모릅니다.\n\n```js\nWITH CustomerAverages AS (\n    SELECT CustomerID, AVG(Amount) AS AvgAmount\n    FROM Transactions\n    GROUP BY CustomerID\n),\nOverallAverage AS (\n    SELECT AVG(AvgAmount) AS OverallAvg\n    FROM CustomerAverages\n)\nSELECT a.CustomerID, a.AvgAmount\nFROM CustomerAverages a, OverallAverage o\nWHERE a.AvgAmount \u003e o.OverallAvg;\n```\n\n두 번째 CTE인 OverallAverage에 필요한 정보는 이미 첫 번째 CTE인 CustomerAverages에 포함되어 있었기 때문에 첫 번째 CTE의 데이터를 두 번째 CTE의 계산에 사용할 수 있었습니다. \n\n```js\nwith recursive cte(col1, col2 etc…) as my_cte\n...\n...\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n오라클은 CTE가 쿼리 내에서 자기 자신을 참조한다면 재귀적이라고 가정하기 때문에 특별한 재귀 키워드가 필요하지 않습니다.\n\n최종 예제로, 우리는 원본 시계열 데이터의 간격을 채우기 위해 재귀적인 CTE를 사용할 것입니다.\n\n원본 테이블 데이터로 돌아가면, 1월 2일 및 3일, 그리고 1월 6일 및 7일의 고객 데이터 항목이 누락되어 있다는 것을 알 수 있습니다.\n\n우리의 작업은 매일의 고객 지출 총액을 보여주는 보고서를 생성하는 것입니다. 날짜에 대한 항목이 없는 경우, 해당 날짜의 고객 지출 값의 합계를 위해 제로를 반환합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n이 재귀 CTE에 대한 좋은 사용 사례입니다.\n\n```js\nWITH DateRange (dt) AS (\n    SELECT MIN(TRANSACTIONDATE) \n    FROM Transactions\n    UNION ALL\n    SELECT dt + INTERVAL '1' DAY \n    FROM DateRange WHERE dt \u003c (SELECT MAX(TRANSACTIONDATE) FROM Transactions)\n),\nAggregatedData AS (\n    SELECT TRANSACTIONDATE, SUM(AMOUNT) AS TOTAL_SPEND\n    FROM Transactions\n    GROUP BY TRANSACTIONDATE\n)\nSELECT dr.dt AS TRANSACTIONDATE,\n       NVL(ad.TOTAL_AMOUNT, 0) AS TOTAL_SPEND\nFROM DateRange dr\nLEFT JOIN AggregatedData ad ON dr.dt = ad.TRANSACTIONDATE\nORDER BY dr.dt;\n\nTRANSACTIONDATE  TOTAL_SPEND\n===============  ===========\n01-JAN-21        150\n02-JAN-21        0\n03-JAN-21        0\n04-JAN-21        300\n05-JAN-21        550\n06-JAN-21        0\n07-JAN-21        0\n08-JAN-21        370\n```\n\n- DateRange CTE: 이 부분은 가장 이른 날짜부터 가장 늦은 거래일까지 연속된 날짜 범위를 생성하여 날짜 간격이 없음을 보장합니다.\n- AggregatedData CTE: 각 날짜의 거래를 합산합니다.\n- 최종 SELECT: 날짜 범위를 집계된 거래 데이터와 조인하며, NVL 함수를 사용하여 NULL 값을 0으로 대체하여 거래가 없는 날은 총액이 0으로 나타나도록 합니다.\n\n## 요약\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n결론적으로, Common Table Expressions(CTEs)는 SQL에서 가독성, 유지 관리 및 복잡한 쿼리의 실행을 개선할 수 있는 다재다능하고 강력한 기능입니다. 이 글을 통해 CTE의 기본 구조와 기능을 탐색하며, 비재귀 및 재귀 유형을 살펴 다양한 시나리오에서 그 유틸리티를 보여주었습니다.\n\n포함된 세 가지 테스트 케이스는 CTE가 복잡한 SQL 작업의 관리를 단순화하고 이를 더 쉽게 다룰 수 있는 부분으로 나누어주며, 재귀 데이터를 처리하는 능력을 보여주었습니다.\n\n또한, CTE 사용은 더 깨끗하고 조직적인 SQL 스크립트로 이어지며, 개발자와 분석가가 데이터베이스 쿼리를 작성, 디버깅 및 최적화하는 작업이 쉬워집니다.\n\n아직도 CTE에 대해 확신이 없다면, 제 3번 테스트 예제에서 CTE를 사용하지 않고 어떻게 문제를 해결할지 생각해보세요. 이런 문제에 대한 전통적인 SQL 접근 방식은 더 불편하고 효율적이지 않다는 것을 알게 될 것입니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n이 컨텐츠가 마음에 드셨다면, 이 아티클도 흥미롭게 보실 것 같아요.","ogImage":{"url":"/assets/img/2024-05-23-SQLExplainedCommonTableExpressions_0.png"},"coverImage":"/assets/img/2024-05-23-SQLExplainedCommonTableExpressions_0.png","tag":["Tech"],"readingTime":8},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003eSQL에서 CTE(Common Table Expressions, CTE로 알려진)는 다른 SQL 쿼리에서 파생된 중간 데이터를 포함하는 일시적인 이름이 지정된 결과 세트입니다. CTE에 데이터가 있는 경우 동일한 쿼리 내에서 해당 데이터를 한 번 이상 참조할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e위 설명을 보면 CTE가 SQL의 일반적인 일시적 테이블과 많이 닮았다고 생각할 수 있습니다. 어떤 면에서는 맞지만 왜 CTE를 사용해야 하는지 궁금할 수 있습니다. 이에 대답하기 위해 일시적 테이블의 주요 단점 두 가지를 살펴보겠습니다.\u003c/p\u003e\n\u003cp\u003e일시적 테이블은 특히 대규모 SQL 스크립트의 다양한 부분을 횡단해서 사용될 경우처럼 복잡한 코드 작성에 기여할 수 있습니다. 이들은 명시적으로 생성, 삭제되어야 하며 필요시 인덱스도 구축되어야 합니다. 이로 인해 SQL 및 세션 관리에 부하가 추가됩니다.\u003c/p\u003e\n\u003cp\u003e또한, 일시적 테이블은 물리적 저장 공간을 소비하며, 여유 공간이 부족하고 많은 양의 일시적 테이블이 있다면 이는 고려할 사항일 수 있습니다. 게다가 일시적 테이블을 사용하는 쿼리를 살펴볼 때, 일시적 테이블에 어떤 데이터가 포함되어 있는지, 데이터가 어디서 왔는지 명확하지 않을 수 있습니다.\u003c/p\u003e\n\u003cp\u003eCTE(공통 테이블 표현식)에는 위에서 언급한 문제가 없어요. 일단, CTE는 일시적이기 때문에 SQL 세션이 종료되면 CTE가 범위에서 벗어나고 사용한 모든 메모리가 해제됩니다.\u003c/p\u003e\n\u003cp\u003e그리고 CTE에 들어 있는 데이터를 정확히 확인할 수 있어요. 그 생성과 채움은 SQL 스크립트 안에 바로 있어요.\u003c/p\u003e\n\u003cp\u003eCTE의 이점뿐만 아니라, 특정 단점도 있어서 아래 경우에는 사용하지 않는 것이 좋을 수 있어요.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e쿼리에서 CTE에 포함될 데이터를 한 번 이상 참조해야 하는 경우. 이는 CTE가 참조될 때마다 다시 채워져야 하기 때문에 발생하는 문제예요. 그러나 CTE의 데이터 양이 작다면 이것이 사용 시 제약 사항이 되지 않을 수 있어요.\u003c/li\u003e\n\u003cli\u003e위와 관련하여, CTE는 인덱싱할 수 없기 때문에 데이터 양이 많으면 인덱싱된 임시 테이블보다 성능이 떨어질 수 있어요.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e그러니까, 다음 시나리오에서 CTE를 사용해 보세요.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e임시 테이블을 사용하지 않으려고 할 때\u003c/li\u003e\n\u003cli\u003eCTE의 데이터 양이 비교적 낮을 때\u003c/li\u003e\n\u003cli\u003e쿼리에서 CTE 데이터를 한 번만 참조하는 경우 (데이터 양에 따라 두 번일 수도 있음)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e아직 언급하지 않은 CTE의 마지막 이점은 많은 최신 SQL 방언에서 재귀 CTE를 지원한다는 것입니다. 즉, CTE가 자기 자신을 참조하는 경우입니다. 당연히 이는 재귀 및 계층 기반 SQL 쿼리를 코딩하기가 훨씬 쉬워진다는 뜻입니다. 나중에 이에 대한 몇 가지 예제를 살펴볼 것입니다.\u003c/p\u003e\n\u003cp\u003e이제 CTE의 정의와 기능을 보다 자세히 이해했으니, 사용 예제를 살펴보겠습니다.\u003c/p\u003e\n\u003ch2\u003e테스트 환경 설정하기.\u003c/h2\u003e\n\u003cp\u003e저는 Oracle의 라이브 SQL 웹사이트를 사용하여 테스트를 실행합니다. 이 서비스에 액세스하고 사용하는 방법에 대해 이전에 작성한 SQL에서 Grouping Sets, Rollup 및 Cube를 사용하는 기사에서 설명했습니다. 설정하고 사용하는 데 완전히 무료입니다. 해당 기사 링크는 아래에 제공되어 있습니다.\u003c/p\u003e\n\u003ch2\u003e샘플 테이블 생성 \u0026#x26; 데이터 삽입\u003c/h2\u003e\n\u003cp\u003e재귀적이지 않은 CTE 예제를 위해 고객 거래 내역 테이블을 사용할 것입니다. 입력 테이블 및 데이터를 재생성하는 데 필요한 테이블 생성 및 데이터 삽입 문을 여기에 제공합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eCREATE\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eTABLE\u003c/span\u003e transactions (\n    \u003cspan class=\"hljs-title class_\"\u003eTransactionID\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eINT\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003ePRIMARY\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eKEY\u003c/span\u003e,\n    \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eINT\u003c/span\u003e,\n    \u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eDECIMAL\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e),\n    \u003cspan class=\"hljs-title class_\"\u003eTransactionDate\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eDATE\u003c/span\u003e\n);\n\n\u003cspan class=\"hljs-variable constant_\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eINTO\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e (\u003cspan class=\"hljs-title class_\"\u003eTransactionID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eTransactionDate\u003c/span\u003e)\n\u003cspan class=\"hljs-variable constant_\"\u003eVALUES\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1001\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e150\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eTO_DATE\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'2021-01-01'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'YYYY-MM-DD'\u003c/span\u003e));\n\n\u003cspan class=\"hljs-variable constant_\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eINTO\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e (\u003cspan class=\"hljs-title class_\"\u003eTransactionID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eTransactionDate\u003c/span\u003e)\n\u003cspan class=\"hljs-variable constant_\"\u003eVALUES\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1002\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eTO_DATE\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'2021-01-04'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'YYYY-MM-DD'\u003c/span\u003e));\n\n\u003cspan class=\"hljs-variable constant_\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eINTO\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e (\u003cspan class=\"hljs-title class_\"\u003eTransactionID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eTransactionDate\u003c/span\u003e)\n\u003cspan class=\"hljs-variable constant_\"\u003eVALUES\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1001\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eTO_DATE\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'2021-01-04'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'YYYY-MM-DD'\u003c/span\u003e));\n\n\u003cspan class=\"hljs-variable constant_\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eINTO\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e (\u003cspan class=\"hljs-title class_\"\u003eTransactionID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eTransactionDate\u003c/span\u003e)\n\u003cspan class=\"hljs-variable constant_\"\u003eVALUES\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1003\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e250\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eTO_DATE\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'2021-01-05'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'YYYY-MM-DD'\u003c/span\u003e));\n\n\u003cspan class=\"hljs-variable constant_\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eINTO\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e (\u003cspan class=\"hljs-title class_\"\u003eTransactionID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eTransactionDate\u003c/span\u003e)\n\u003cspan class=\"hljs-variable constant_\"\u003eVALUES\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1002\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e300\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eTO_DATE\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'2021-01-05'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'YYYY-MM-DD'\u003c/span\u003e));\n\n\u003cspan class=\"hljs-variable constant_\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eINTO\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e (\u003cspan class=\"hljs-title class_\"\u003eTransactionID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eTransactionDate\u003c/span\u003e)\n\u003cspan class=\"hljs-variable constant_\"\u003eVALUES\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1003\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e180\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eTO_DATE\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'2021-01-08'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'YYYY-MM-DD'\u003c/span\u003e));\n\n\u003cspan class=\"hljs-variable constant_\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eINTO\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e (\u003cspan class=\"hljs-title class_\"\u003eTransactionID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eTransactionDate\u003c/span\u003e)\n\u003cspan class=\"hljs-variable constant_\"\u003eVALUES\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1001\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e190\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eTO_DATE\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'2021-01-08'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'YYYY-MM-DD'\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e * \u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e\n\n\n\u003cspan class=\"hljs-variable constant_\"\u003eTRANSACTIONID\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eCUSTOMERID\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eAMOUNT\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eTRANSACTIONDATE\u003c/span\u003e\n============= ================= ===============\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e             \u003cspan class=\"hljs-number\"\u003e1001\u003c/span\u003e       \u003cspan class=\"hljs-number\"\u003e150\u003c/span\u003e    \u003cspan class=\"hljs-number\"\u003e01\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e             \u003cspan class=\"hljs-number\"\u003e1002\u003c/span\u003e       \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e    \u003cspan class=\"hljs-number\"\u003e04\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e             \u003cspan class=\"hljs-number\"\u003e1001\u003c/span\u003e       \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e    \u003cspan class=\"hljs-number\"\u003e04\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e             \u003cspan class=\"hljs-number\"\u003e1003\u003c/span\u003e       \u003cspan class=\"hljs-number\"\u003e250\u003c/span\u003e    \u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e             \u003cspan class=\"hljs-number\"\u003e1002\u003c/span\u003e       \u003cspan class=\"hljs-number\"\u003e300\u003c/span\u003e    \u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e             \u003cspan class=\"hljs-number\"\u003e1003\u003c/span\u003e       \u003cspan class=\"hljs-number\"\u003e180\u003c/span\u003e    \u003cspan class=\"hljs-number\"\u003e08\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e             \u003cspan class=\"hljs-number\"\u003e1001\u003c/span\u003e       \u003cspan class=\"hljs-number\"\u003e190\u003c/span\u003e    \u003cspan class=\"hljs-number\"\u003e08\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e표준 CTE 구문은 놀랍도록 간단합니다. 단순히,\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eWITH\u003c/span\u003e cte_name [(column_list)] \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e (cte_query_definition) statement\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e다음과 같은 표가 있습니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecte_name은 CTE에 지정된 이름입니다\u003c/li\u003e\n\u003cli\u003ecolumn_list는 CTE의 열 이름 목록입니다(선택 사항)\u003c/li\u003e\n\u003cli\u003ecte_query_definition은 CTE의 결과 집합을 정의하는 쿼리입니다\u003c/li\u003e\n\u003cli\u003estatement은 CTE를 참조하는 단일 SELECT, INSERT, UPDATE, DELETE 또는 MERGE 문입니다\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e테스트 1 — 간단한 CTE\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eWITH\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerTotals\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e (\n    \u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eSUM\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e) \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTotalSpent\u003c/span\u003e\n    \u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e\n    \u003cspan class=\"hljs-variable constant_\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eBY\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e\n)\n\u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eTotalSpent\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerTotals\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTotalSpent\u003c/span\u003e \u003e \u003cspan class=\"hljs-number\"\u003e250\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eCUSTOMERID\u003c/span\u003e | \u003cspan class=\"hljs-variable constant_\"\u003eTOTALSPENT\u003c/span\u003e\n---------- | ----------\n\u003cspan class=\"hljs-number\"\u003e1001\u003c/span\u003e       | \u003cspan class=\"hljs-number\"\u003e440\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e1002\u003c/span\u003e       | \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e1003\u003c/span\u003e       | \u003cspan class=\"hljs-number\"\u003e430\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 경우, 이 쿼리의 non-CTE 버전도 간단합니다. 다음과 같습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eSUM\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e) \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTotalSpent\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eBY\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eHAVING\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eSUM\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e) \u003e \u003cspan class=\"hljs-number\"\u003e250\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e테스트 2 — 더 복잡한 CTE\u003c/h2\u003e\n\u003cp\u003eCTE가 자신을 발휘하는 곳은 이와 유사한 쿼리를 갖고 있을 때입니다.\u003c/p\u003e\n\u003cp\u003eCTE를 사용하면 이와 같은 쿼리는 비교적 쉬워집니다. 필요한 두 집계값은 각각 두 개의 개별 CTE로 분리할 수 있고, 그 결과를 단순히 비교하여 얻을 수 있습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eWITH\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerAverages\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e (\n    \u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eAVG\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e) \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAvgAmount\u003c/span\u003e\n    \u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e\n    \u003cspan class=\"hljs-variable constant_\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eBY\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e\n),\n\u003cspan class=\"hljs-title class_\"\u003eOverallAverage\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e (\n    \u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eAVG\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e) \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eOverallAvg\u003c/span\u003e\n    \u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e\n)\n\u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e a.\u003cspan class=\"hljs-property\"\u003eCustomerID\u003c/span\u003e, a.\u003cspan class=\"hljs-property\"\u003eAvgAmount\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerAverages\u003c/span\u003e a, \u003cspan class=\"hljs-title class_\"\u003eOverallAverage\u003c/span\u003e o\n\u003cspan class=\"hljs-variable constant_\"\u003eWHERE\u003c/span\u003e a.\u003cspan class=\"hljs-property\"\u003eAvgAmount\u003c/span\u003e \u003e o.\u003cspan class=\"hljs-property\"\u003eOverallAvg\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eCUSTOMERID\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eAVGAMOUNT\u003c/span\u003e\n========== =========\n\u003cspan class=\"hljs-number\"\u003e1002\u003c/span\u003e       \u003cspan class=\"hljs-number\"\u003e250\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e1003\u003c/span\u003e       \u003cspan class=\"hljs-number\"\u003e215\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e저는 이것을 비-CTE 버전과 비교해 봤을 때,\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eAVG\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e) \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAvgAmount\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e transactions\n\u003cspan class=\"hljs-variable constant_\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eBY\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eHAVING\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eAVG\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e) \u003e (\n    \u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eAVG\u003c/span\u003e(sub.\u003cspan class=\"hljs-property\"\u003eAvgAmount\u003c/span\u003e)\n    \u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e (\n        \u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eAVG\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e) \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAvgAmount\u003c/span\u003e\n        \u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e transactions\n        \u003cspan class=\"hljs-variable constant_\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eBY\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e\n    ) sub\n);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e내가 생각하기에, CTE를 사용하면 SQL 작성자의 의도가 더 명확해지고 무엇이 일어나고 있는지 더 명확해집니다.\u003c/p\u003e\n\u003ch2\u003e테스트 3 — 재귀 CTEs\u003c/h2\u003e\n\u003cp\u003e재귀 CTE(Commmon Table Expressions)는 쿼리 중 하나의 CTE가 자신을 참조하는 쿼리입니다. 예제에서 별명 정보를 사용하여 위의 CTE 예제를 재귀 CTE를 사용하여 작성할 수 있다는 것을 기믈했을지도 모릅니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eWITH\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerAverages\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e (\n    \u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eAVG\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAmount\u003c/span\u003e) \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAvgAmount\u003c/span\u003e\n    \u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e\n    \u003cspan class=\"hljs-variable constant_\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eBY\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerID\u003c/span\u003e\n),\n\u003cspan class=\"hljs-title class_\"\u003eOverallAverage\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e (\n    \u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eAVG\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAvgAmount\u003c/span\u003e) \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eOverallAvg\u003c/span\u003e\n    \u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerAverages\u003c/span\u003e\n)\n\u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e a.\u003cspan class=\"hljs-property\"\u003eCustomerID\u003c/span\u003e, a.\u003cspan class=\"hljs-property\"\u003eAvgAmount\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomerAverages\u003c/span\u003e a, \u003cspan class=\"hljs-title class_\"\u003eOverallAverage\u003c/span\u003e o\n\u003cspan class=\"hljs-variable constant_\"\u003eWHERE\u003c/span\u003e a.\u003cspan class=\"hljs-property\"\u003eAvgAmount\u003c/span\u003e \u003e o.\u003cspan class=\"hljs-property\"\u003eOverallAvg\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e두 번째 CTE인 OverallAverage에 필요한 정보는 이미 첫 번째 CTE인 CustomerAverages에 포함되어 있었기 때문에 첫 번째 CTE의 데이터를 두 번째 CTE의 계산에 사용할 수 있었습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e recursive \u003cspan class=\"hljs-title function_\"\u003ecte\u003c/span\u003e(col1, col2 etc…) \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e my_cte\n...\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e오라클은 CTE가 쿼리 내에서 자기 자신을 참조한다면 재귀적이라고 가정하기 때문에 특별한 재귀 키워드가 필요하지 않습니다.\u003c/p\u003e\n\u003cp\u003e최종 예제로, 우리는 원본 시계열 데이터의 간격을 채우기 위해 재귀적인 CTE를 사용할 것입니다.\u003c/p\u003e\n\u003cp\u003e원본 테이블 데이터로 돌아가면, 1월 2일 및 3일, 그리고 1월 6일 및 7일의 고객 데이터 항목이 누락되어 있다는 것을 알 수 있습니다.\u003c/p\u003e\n\u003cp\u003e우리의 작업은 매일의 고객 지출 총액을 보여주는 보고서를 생성하는 것입니다. 날짜에 대한 항목이 없는 경우, 해당 날짜의 고객 지출 값의 합계를 위해 제로를 반환합니다.\u003c/p\u003e\n\u003cp\u003e이 재귀 CTE에 대한 좋은 사용 사례입니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eWITH\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDateRange\u003c/span\u003e (dt) \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e (\n    \u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eMIN\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003eTRANSACTIONDATE\u003c/span\u003e) \n    \u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e\n    \u003cspan class=\"hljs-variable constant_\"\u003eUNION\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eALL\u003c/span\u003e\n    \u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e dt + \u003cspan class=\"hljs-variable constant_\"\u003eINTERVAL\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eDAY\u003c/span\u003e \n    \u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDateRange\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eWHERE\u003c/span\u003e dt \u0026#x3C; (\u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eMAX\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003eTRANSACTIONDATE\u003c/span\u003e) \u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e)\n),\n\u003cspan class=\"hljs-title class_\"\u003eAggregatedData\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e (\n    \u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eTRANSACTIONDATE\u003c/span\u003e, \u003cspan class=\"hljs-title function_\"\u003eSUM\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003eAMOUNT\u003c/span\u003e) \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eTOTAL_SPEND\u003c/span\u003e\n    \u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTransactions\u003c/span\u003e\n    \u003cspan class=\"hljs-variable constant_\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eBY\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eTRANSACTIONDATE\u003c/span\u003e\n)\n\u003cspan class=\"hljs-variable constant_\"\u003eSELECT\u003c/span\u003e dr.\u003cspan class=\"hljs-property\"\u003edt\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eTRANSACTIONDATE\u003c/span\u003e,\n       \u003cspan class=\"hljs-title function_\"\u003eNVL\u003c/span\u003e(ad.\u003cspan class=\"hljs-property\"\u003eTOTAL_AMOUNT\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) \u003cspan class=\"hljs-variable constant_\"\u003eAS\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eTOTAL_SPEND\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eFROM\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDateRange\u003c/span\u003e dr\n\u003cspan class=\"hljs-variable constant_\"\u003eLEFT\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eJOIN\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAggregatedData\u003c/span\u003e ad \u003cspan class=\"hljs-variable constant_\"\u003eON\u003c/span\u003e dr.\u003cspan class=\"hljs-property\"\u003edt\u003c/span\u003e = ad.\u003cspan class=\"hljs-property\"\u003eTRANSACTIONDATE\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eORDER\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eBY\u003c/span\u003e dr.\u003cspan class=\"hljs-property\"\u003edt\u003c/span\u003e;\n\n\u003cspan class=\"hljs-variable constant_\"\u003eTRANSACTIONDATE\u003c/span\u003e  \u003cspan class=\"hljs-variable constant_\"\u003eTOTAL_SPEND\u003c/span\u003e\n===============  ===========\n\u003cspan class=\"hljs-number\"\u003e01\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e        \u003cspan class=\"hljs-number\"\u003e150\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e02\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e        \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e03\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e        \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e04\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e        \u003cspan class=\"hljs-number\"\u003e300\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e        \u003cspan class=\"hljs-number\"\u003e550\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e06\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e        \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e07\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e        \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e08\u003c/span\u003e-\u003cspan class=\"hljs-variable constant_\"\u003eJAN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e        \u003cspan class=\"hljs-number\"\u003e370\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eDateRange CTE: 이 부분은 가장 이른 날짜부터 가장 늦은 거래일까지 연속된 날짜 범위를 생성하여 날짜 간격이 없음을 보장합니다.\u003c/li\u003e\n\u003cli\u003eAggregatedData CTE: 각 날짜의 거래를 합산합니다.\u003c/li\u003e\n\u003cli\u003e최종 SELECT: 날짜 범위를 집계된 거래 데이터와 조인하며, NVL 함수를 사용하여 NULL 값을 0으로 대체하여 거래가 없는 날은 총액이 0으로 나타나도록 합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e요약\u003c/h2\u003e\n\u003cp\u003e결론적으로, Common Table Expressions(CTEs)는 SQL에서 가독성, 유지 관리 및 복잡한 쿼리의 실행을 개선할 수 있는 다재다능하고 강력한 기능입니다. 이 글을 통해 CTE의 기본 구조와 기능을 탐색하며, 비재귀 및 재귀 유형을 살펴 다양한 시나리오에서 그 유틸리티를 보여주었습니다.\u003c/p\u003e\n\u003cp\u003e포함된 세 가지 테스트 케이스는 CTE가 복잡한 SQL 작업의 관리를 단순화하고 이를 더 쉽게 다룰 수 있는 부분으로 나누어주며, 재귀 데이터를 처리하는 능력을 보여주었습니다.\u003c/p\u003e\n\u003cp\u003e또한, CTE 사용은 더 깨끗하고 조직적인 SQL 스크립트로 이어지며, 개발자와 분석가가 데이터베이스 쿼리를 작성, 디버깅 및 최적화하는 작업이 쉬워집니다.\u003c/p\u003e\n\u003cp\u003e아직도 CTE에 대해 확신이 없다면, 제 3번 테스트 예제에서 CTE를 사용하지 않고 어떻게 문제를 해결할지 생각해보세요. 이런 문제에 대한 전통적인 SQL 접근 방식은 더 불편하고 효율적이지 않다는 것을 알게 될 것입니다.\u003c/p\u003e\n\u003cp\u003e이 컨텐츠가 마음에 드셨다면, 이 아티클도 흥미롭게 보실 것 같아요.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-23-SQLExplainedCommonTableExpressions"},"buildId":"RZIEBQ2aNAp_DXFVTV6eL","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>