<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>YouTube 데이터 파이프라인 구축하기 Docker 컨테이너에서 Airflow 사용하기 | ui-station</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://ui-station.github.io///post/2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="YouTube 데이터 파이프라인 구축하기 Docker 컨테이너에서 Airflow 사용하기 | ui-station" data-gatsby-head="true"/><meta property="og:title" content="YouTube 데이터 파이프라인 구축하기 Docker 컨테이너에서 Airflow 사용하기 | ui-station" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://ui-station.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://ui-station.github.io///post/2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer" data-gatsby-head="true"/><meta name="twitter:title" content="YouTube 데이터 파이프라인 구축하기 Docker 컨테이너에서 Airflow 사용하기 | ui-station" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | ui-station" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-18 18:03" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-V5DKFTZ6BX"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-V5DKFTZ6BX');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cd012fc8787133d0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cd012fc8787133d0.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/_next/static/chunks/348-d11c34b645b13f5b.js" defer=""></script><script src="/_next/static/chunks/551-3069cf29fe274aab.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-561ae49ab5aab7f5.js" defer=""></script><script src="/_next/static/R1x9p1CQYDDJESXyLXKOK/_buildManifest.js" defer=""></script><script src="/_next/static/R1x9p1CQYDDJESXyLXKOK/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UI STATION</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">YouTube 데이터 파이프라인 구축하기 Docker 컨테이너에서 Airflow 사용하기</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="YouTube 데이터 파이프라인 구축하기 Docker 컨테이너에서 Airflow 사용하기" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UI STATION</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 18, 2024</span><span class="posts_reading_time__f7YPP">6<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><p>그게 많은 양이겠죠! 조금씩 나눠서 살펴봐요.</p>
<p><img src="/assets/img/2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer_0.png" alt="YoutubeDataPipeline"/></p>
<h2>사용 사례: —</h2>
<p>상상해봐요! 성장하는 YouTube 채널을 운영하는 콘텐츠 크리에이터라고 상상해봐요. 시청자들의 댓글과 답글을 통해 시청자를 이해하는 것은 귀중한 통찰력을 제공할 수 있어요. 그러나 수많은 동영상의 댓글을 수동으로 분류하는 것은 지칠 수 있죠. 이 프로세스를 자동화할 수 있는 방법이 있다면 어떨까요?</p>
<div class="content-ad"></div>
<h2>제안된 해결책: —</h2>
<p>위의 그림을 보시면, YouTube 비디오에서 댓글과 답글을 추출하기 위한 자동화된 솔루션을 안내해 드리겠습니다. 이 과정에는 여러 가지 주요 구성 요소가 포함됩니다:</p>
<p>— YouTube 데이터 API용 Python 라이브러리: YouTube 데이터 API와 상호 작용하기 위해 Python 라이브러리를 사용하여 댓글과 답글을 프로그래밍 방식으로 가져올 수 있습니다.</p>
<p>— 작업 관리를 위한 Airflow: 데이터 추출 및 처리 작업을 체계적으로 관리하기 위해 Apache Airflow를 Docker 컨테이너 내에서 사용할 것입니다.</p>
<div class="content-ad"></div>
<ul>
<li>데이터 저장을 위한 AWS S3: 마지막으로, boto3 라이브러리를 사용하여 처리된 데이터를 AWS S3에 저장하게 됩니다. 나중에 쉽게 액세스하고 분석할 수 있습니다.</li>
</ul>
<p>이 솔루션은 추출 프로세스를 자동화하는 데 그치지 않고 데이터가 구성되어 안전하게 저장되어 나중에 깊이 있는 분석을 위해 준비되어 있음을 보장합니다. 이제 이 워크플로우를 설정하고 실행하는 자세한 내용을 살펴보겠습니다.</p>
<h2>구현</h2>
<p>구현은 주로 두 가지 작업으로 구성되어 있습니다. 첫 번째는 인프라 구축, 두 번째는 코드 작업입니다. 그래서 이제 인프라 설정을 먼저 살펴보겠습니다.</p>
<div class="content-ad"></div>
<p>도커 데스크톱을 설치해보세요 — https://www.docker.com/get-started/</p>
<p>머신에 도커를 설치한 후에는 다음 명령어를 확인하여 설치가 성공적으로 이루어졌는지 확인하세요.</p>
<pre><code class="hljs language-js">docker --version
<span class="hljs-title class_">Docker</span> version <span class="hljs-number">20.10</span><span class="hljs-number">.23</span>, build <span class="hljs-number">7155243</span>
</code></pre>
<p>최신 apache/airflow 이미지를 받아보세요</p>
<div class="content-ad"></div>
<pre><code class="hljs language-sh">도커 pull apache/airflow
</code></pre>
<p>다음 명령어를 사용하여 아파치 에어플로우 컨테이너를 시작하세요.</p>
<pre><code class="hljs language-sh">도커 run -p 8080:8080 -v /Users/local_user/airflow/dags:/opt/airflow/dags -v /Users/local_user/airflow/creds:/home/airflow/.aws -d apache/airflow standalone
</code></pre>
<p>AWS 자격 증명을 생성하여 원격 s3 버킷과 통신하여 날짜를 쓸 수 있습니다. 다음 링크를 통해 생성하세요 — 루트 사용자를 위한 액세스 키 생성하기</p>
<div class="content-ad"></div>
<p>config</p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">[</span>default<span class="hljs-punctuation">]</span>
region = ap-south<span class="hljs-number">-1</span>
</code></pre>
<p>credentials</p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">[</span>default<span class="hljs-punctuation">]</span>
aws_access_key_id = AKIB******AXPCMO
aws_secret_access_key = <span class="hljs-number">4</span>D7HkaIBsqu***********+<span class="hljs-number">0</span>AT2a8j
</code></pre>
<div class="content-ad"></div>
<p>지역 사용자의 경우 두 파일을 로컬 머신의 /Users/local_user/airflow/creds/ 폴더로 복사해주세요. 이렇게 함으로써 이 파일들이 컨테이너에서 /home/airflow/.aws/ 경로에 마운트되도록 할 수 있습니다.</p>
<p>도커 데스크톱 애플리케이션을 열고 Airflow 컨테이너를 선택해주세요. 컨테이너 내에서 standalone_admin_password.txt 파일을 찾아주세요. 이 파일을 열고 Airflow 포털에 로그인하기 위한 비밀번호를 복사해주세요.</p>
<p><img src="/assets/img/2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer_1.png" alt="이미지"/></p>
<p>웹 브라우저를 열고 <code>http://localhost:8080</code> 주소로 이동해주세요. username에 admin을 입력하고 이전 단계에서 복사한 비밀번호로 로그인해주세요.</p>
<div class="content-ad"></div>
<p><code>aws_write_utility.py</code> 파일을 만들 때 평소처럼 진행하시면 됩니다.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> boto3
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> uuid

def <span class="hljs-title function_">write_json_to_s3</span>(json_data, bucket_name, key_name):

    # <span class="hljs-variable constant_">S3</span> 클라이언트 초기화
    s3 = boto3.<span class="hljs-title function_">client</span>(<span class="hljs-string">&#x27;s3&#x27;</span>)
    
    # <span class="hljs-title class_">JSON</span> 데이터를 바이트로 변환
    json_bytes = json.<span class="hljs-title function_">dumps</span>(json_data).<span class="hljs-title function_">encode</span>(<span class="hljs-string">&#x27;utf-8&#x27;</span>)
    
    # <span class="hljs-title class_">JSON</span> 데이터를 <span class="hljs-variable constant_">S3</span>에 쓰기
    s3.<span class="hljs-title function_">put_object</span>(<span class="hljs-title class_">Bucket</span>=bucket_name, <span class="hljs-title class_">Key</span>=key_name, <span class="hljs-title class_">Body</span>=json_bytes)


def <span class="hljs-title function_">generate_uuid</span>():
    <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;UUID와 유사한 문자열 생성.&quot;</span><span class="hljs-string">&quot;&quot;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">str</span>(uuid.<span class="hljs-title function_">uuid4</span>())
</code></pre>
<p>youtube_comments.py</p>
<pre><code class="hljs language-js"># -*- <span class="hljs-attr">coding</span>: utf-<span class="hljs-number">8</span> -*-

# youtube.<span class="hljs-property">commentThreads</span>.<span class="hljs-property">list</span>를 위한 샘플 <span class="hljs-title class_">Python</span> 코드
# 이 코드 샘플을 로컬에서 실행하는 방법은 다음 링크를 참고하세요:
# <span class="hljs-attr">https</span>:<span class="hljs-comment">//developers.google.com/explorer-help/code-samples#python</span>

<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">import</span> googleapiclient.<span class="hljs-property">discovery</span>
<span class="hljs-keyword">import</span> aws_write_utility
<span class="hljs-keyword">from</span> aws_write_utility <span class="hljs-keyword">import</span> write_json_to_s3

def <span class="hljs-title function_">start_process</span>():
    # 로컬에서 실행 시 <span class="hljs-title class_">OAuthlib</span>의 <span class="hljs-variable constant_">HTTPS</span> 확인 비활성화
    # 제품 환경에서는 이 옵션을 활성화하지 마세요.
    os.<span class="hljs-property">environ</span>[<span class="hljs-string">&quot;OAUTHLIB_INSECURE_TRANSPORT&quot;</span>] = <span class="hljs-string">&quot;1&quot;</span>

    api_service_name = <span class="hljs-string">&quot;youtube&quot;</span>
    api_version = <span class="hljs-string">&quot;v3&quot;</span>
    <span class="hljs-variable constant_">DEVELOPER_KEY</span> = <span class="hljs-string">&quot;AIzaS*****************PiwBdaP_IE&quot;</span>

    youtube = googleapiclient.<span class="hljs-property">discovery</span>.<span class="hljs-title function_">build</span>(
        api_service_name, api_version, developerKey=<span class="hljs-variable constant_">DEVELOPER_KEY</span>)

    request = youtube.<span class="hljs-title function_">commentThreads</span>().<span class="hljs-title function_">list</span>(
        part=<span class="hljs-string">&quot;snippet,replies&quot;</span>,
        videoId=<span class="hljs-string">&quot;r_K*****PKU&quot;</span>
    )
    response = request.<span class="hljs-title function_">execute</span>()

    <span class="hljs-title function_">process_comments</span>(response)


def <span class="hljs-title function_">process_comments</span>(response_items):

    # 예시 <span class="hljs-variable constant_">S3</span> 버킷 및 키 이름
    bucket_name = <span class="hljs-string">&#x27;youtube-comments-analysis&#x27;</span>
    key_name = <span class="hljs-string">&#x27;data/{}.json&#x27;</span>.<span class="hljs-title function_">format</span>(aws_write_utility.<span class="hljs-title function_">generate_uuid</span>())

    comments = []
    <span class="hljs-keyword">for</span> comment <span class="hljs-keyword">in</span> response_items[<span class="hljs-string">&#x27;items&#x27;</span>]:
        author = comment[<span class="hljs-string">&#x27;snippet&#x27;</span>][<span class="hljs-string">&#x27;topLevelComment&#x27;</span>][<span class="hljs-string">&#x27;snippet&#x27;</span>][<span class="hljs-string">&#x27;authorDisplayName&#x27;</span>]
        comment_text = comment[<span class="hljs-string">&#x27;snippet&#x27;</span>][<span class="hljs-string">&#x27;topLevelComment&#x27;</span>][<span class="hljs-string">&#x27;snippet&#x27;</span>][<span class="hljs-string">&#x27;textOriginal&#x27;</span>]
        publish_time = comment[<span class="hljs-string">&#x27;snippet&#x27;</span>][<span class="hljs-string">&#x27;topLevelComment&#x27;</span>][<span class="hljs-string">&#x27;snippet&#x27;</span>][<span class="hljs-string">&#x27;publishedAt&#x27;</span>]
        comment_info = {<span class="hljs-string">&#x27;author&#x27;</span>: author, <span class="hljs-string">&#x27;comment&#x27;</span>: comment_text, <span class="hljs-string">&#x27;published_at&#x27;</span>: publish_time}
        comments.<span class="hljs-title function_">append</span>(comment_info)
    <span class="hljs-title function_">print</span>(f<span class="hljs-string">&#x27;총 {len(comments)}개의 댓글 처리 완료.&#x27;</span>)
    <span class="hljs-title function_">write_json_to_s3</span>(comments, bucket_name, key_name)
</code></pre>
<p>youtube_dag.py</p>
<div class="content-ad"></div>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta
<span class="hljs-keyword">from</span> airflow <span class="hljs-keyword">import</span> DAG
<span class="hljs-keyword">from</span> airflow.operators.python_operator <span class="hljs-keyword">import</span> PythonOperator
<span class="hljs-keyword">from</span> youtube_comments <span class="hljs-keyword">import</span> start_process

<span class="hljs-comment"># 기본 인수 정의</span>
default_args = {
    <span class="hljs-string">&#x27;owner&#x27;</span>: <span class="hljs-string">&#x27;airflow&#x27;</span>,
    <span class="hljs-string">&#x27;depends_on_past&#x27;</span>: <span class="hljs-literal">False</span>,
    <span class="hljs-string">&#x27;start_date&#x27;</span>: datetime(<span class="hljs-number">2024</span>, <span class="hljs-number">5</span>, <span class="hljs-number">16</span>),
    <span class="hljs-string">&#x27;email_on_failure&#x27;</span>: <span class="hljs-literal">False</span>,
    <span class="hljs-string">&#x27;email_on_retry&#x27;</span>: <span class="hljs-literal">False</span>,
    <span class="hljs-string">&#x27;retries&#x27;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&#x27;retry_delay&#x27;</span>: timedelta(minutes=<span class="hljs-number">5</span>),
}

<span class="hljs-comment"># DAG 객체 생성</span>
dag = DAG(
    <span class="hljs-string">&#x27;youtube_python_operator_dag&#x27;</span>,
    default_args=default_args,
    description=<span class="hljs-string">&#x27;Python 함수를 호출하는 간단한 DAG&#x27;</span>,
    schedule_interval=timedelta(days=<span class="hljs-number">1</span>),
)

<span class="hljs-comment"># PythonOperator 작업 생성</span>
python_task = PythonOperator(
    task_id=<span class="hljs-string">&#x27;my_python_task&#x27;</span>,
    python_callable=start_process,
    dag=dag,
)

<span class="hljs-comment"># 작업 간 의존성 정의</span>
python_task

<span class="hljs-comment"># DAG 등록</span>
dag
</code></pre>
<p>위의 .py 파일을 로컬 머신의 /Users/local_user/airflow/dags로 복사하세요. 이렇게 함으로써 컨테이너 내의 경로 /opt/airflow/dags로 마운트됩니다.</p>
<p>좋아요!!</p>
<p>이제 Airflow에서 DAG 페이지를 새로고침하세요. 위의 DAG가 표시될 것입니다. 실행해보고 문제가 있는지 로그를 확인해보세요. 녹색으로 변하면 작업이 완료된 것입니다.</p>
<div class="content-ad"></div>
<p>이 구현은 AWS EC2 인스턴스에 Airflow를 설정하여 수행할 수도 있습니다.</p></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"YouTube 데이터 파이프라인 구축하기 Docker 컨테이너에서 Airflow 사용하기","description":"","date":"2024-05-18 18:03","slug":"2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer","content":"\n\n그게 많은 양이겠죠! 조금씩 나눠서 살펴봐요.\n\n![YoutubeDataPipeline](/assets/img/2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer_0.png)\n\n## 사용 사례: —\n\n상상해봐요! 성장하는 YouTube 채널을 운영하는 콘텐츠 크리에이터라고 상상해봐요. 시청자들의 댓글과 답글을 통해 시청자를 이해하는 것은 귀중한 통찰력을 제공할 수 있어요. 그러나 수많은 동영상의 댓글을 수동으로 분류하는 것은 지칠 수 있죠. 이 프로세스를 자동화할 수 있는 방법이 있다면 어떨까요?\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 제안된 해결책: —\n\n위의 그림을 보시면, YouTube 비디오에서 댓글과 답글을 추출하기 위한 자동화된 솔루션을 안내해 드리겠습니다. 이 과정에는 여러 가지 주요 구성 요소가 포함됩니다:\n\n— YouTube 데이터 API용 Python 라이브러리: YouTube 데이터 API와 상호 작용하기 위해 Python 라이브러리를 사용하여 댓글과 답글을 프로그래밍 방식으로 가져올 수 있습니다.\n\n— 작업 관리를 위한 Airflow: 데이터 추출 및 처리 작업을 체계적으로 관리하기 위해 Apache Airflow를 Docker 컨테이너 내에서 사용할 것입니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 데이터 저장을 위한 AWS S3: 마지막으로, boto3 라이브러리를 사용하여 처리된 데이터를 AWS S3에 저장하게 됩니다. 나중에 쉽게 액세스하고 분석할 수 있습니다.\n\n이 솔루션은 추출 프로세스를 자동화하는 데 그치지 않고 데이터가 구성되어 안전하게 저장되어 나중에 깊이 있는 분석을 위해 준비되어 있음을 보장합니다. 이제 이 워크플로우를 설정하고 실행하는 자세한 내용을 살펴보겠습니다.\n\n## 구현\n\n구현은 주로 두 가지 작업으로 구성되어 있습니다. 첫 번째는 인프라 구축, 두 번째는 코드 작업입니다. 그래서 이제 인프라 설정을 먼저 살펴보겠습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n도커 데스크톱을 설치해보세요 — https://www.docker.com/get-started/\n\n머신에 도커를 설치한 후에는 다음 명령어를 확인하여 설치가 성공적으로 이루어졌는지 확인하세요.\n\n```js\ndocker --version\nDocker version 20.10.23, build 7155243\n```\n\n최신 apache/airflow 이미지를 받아보세요\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```sh\n도커 pull apache/airflow\n```\n\n다음 명령어를 사용하여 아파치 에어플로우 컨테이너를 시작하세요.\n\n```sh\n도커 run -p 8080:8080 -v /Users/local_user/airflow/dags:/opt/airflow/dags -v /Users/local_user/airflow/creds:/home/airflow/.aws -d apache/airflow standalone\n```\n\nAWS 자격 증명을 생성하여 원격 s3 버킷과 통신하여 날짜를 쓸 수 있습니다. 다음 링크를 통해 생성하세요 — 루트 사용자를 위한 액세스 키 생성하기\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nconfig\n\n```json\n[default]\nregion = ap-south-1\n```\n\ncredentials\n\n```json\n[default]\naws_access_key_id = AKIB******AXPCMO\naws_secret_access_key = 4D7HkaIBsqu***********+0AT2a8j\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n지역 사용자의 경우 두 파일을 로컬 머신의 /Users/local_user/airflow/creds/ 폴더로 복사해주세요. 이렇게 함으로써 이 파일들이 컨테이너에서 /home/airflow/.aws/ 경로에 마운트되도록 할 수 있습니다.\n\n도커 데스크톱 애플리케이션을 열고 Airflow 컨테이너를 선택해주세요. 컨테이너 내에서 standalone_admin_password.txt 파일을 찾아주세요. 이 파일을 열고 Airflow 포털에 로그인하기 위한 비밀번호를 복사해주세요.\n\n![이미지](/assets/img/2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer_1.png)\n\n웹 브라우저를 열고 `http://localhost:8080` 주소로 이동해주세요. username에 admin을 입력하고 이전 단계에서 복사한 비밀번호로 로그인해주세요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n`aws_write_utility.py` 파일을 만들 때 평소처럼 진행하시면 됩니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n```js\nimport boto3\nimport json\nimport uuid\n\ndef write_json_to_s3(json_data, bucket_name, key_name):\n\n    # S3 클라이언트 초기화\n    s3 = boto3.client('s3')\n    \n    # JSON 데이터를 바이트로 변환\n    json_bytes = json.dumps(json_data).encode('utf-8')\n    \n    # JSON 데이터를 S3에 쓰기\n    s3.put_object(Bucket=bucket_name, Key=key_name, Body=json_bytes)\n\n\ndef generate_uuid():\n    \"\"\"UUID와 유사한 문자열 생성.\"\"\"\n    return str(uuid.uuid4())\n```\n\nyoutube_comments.py\n\n```js\n# -*- coding: utf-8 -*-\n\n# youtube.commentThreads.list를 위한 샘플 Python 코드\n# 이 코드 샘플을 로컬에서 실행하는 방법은 다음 링크를 참고하세요:\n# https://developers.google.com/explorer-help/code-samples#python\n\nimport os\n\nimport googleapiclient.discovery\nimport aws_write_utility\nfrom aws_write_utility import write_json_to_s3\n\ndef start_process():\n    # 로컬에서 실행 시 OAuthlib의 HTTPS 확인 비활성화\n    # 제품 환경에서는 이 옵션을 활성화하지 마세요.\n    os.environ[\"OAUTHLIB_INSECURE_TRANSPORT\"] = \"1\"\n\n    api_service_name = \"youtube\"\n    api_version = \"v3\"\n    DEVELOPER_KEY = \"AIzaS*****************PiwBdaP_IE\"\n\n    youtube = googleapiclient.discovery.build(\n        api_service_name, api_version, developerKey=DEVELOPER_KEY)\n\n    request = youtube.commentThreads().list(\n        part=\"snippet,replies\",\n        videoId=\"r_K*****PKU\"\n    )\n    response = request.execute()\n\n    process_comments(response)\n\n\ndef process_comments(response_items):\n\n    # 예시 S3 버킷 및 키 이름\n    bucket_name = 'youtube-comments-analysis'\n    key_name = 'data/{}.json'.format(aws_write_utility.generate_uuid())\n\n    comments = []\n    for comment in response_items['items']:\n        author = comment['snippet']['topLevelComment']['snippet']['authorDisplayName']\n        comment_text = comment['snippet']['topLevelComment']['snippet']['textOriginal']\n        publish_time = comment['snippet']['topLevelComment']['snippet']['publishedAt']\n        comment_info = {'author': author, 'comment': comment_text, 'published_at': publish_time}\n        comments.append(comment_info)\n    print(f'총 {len(comments)}개의 댓글 처리 완료.')\n    write_json_to_s3(comments, bucket_name, key_name)\n```\n\nyoutube_dag.py\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```python\nfrom datetime import datetime, timedelta\nfrom airflow import DAG\nfrom airflow.operators.python_operator import PythonOperator\nfrom youtube_comments import start_process\n\n# 기본 인수 정의\ndefault_args = {\n    'owner': 'airflow',\n    'depends_on_past': False,\n    'start_date': datetime(2024, 5, 16),\n    'email_on_failure': False,\n    'email_on_retry': False,\n    'retries': 1,\n    'retry_delay': timedelta(minutes=5),\n}\n\n# DAG 객체 생성\ndag = DAG(\n    'youtube_python_operator_dag',\n    default_args=default_args,\n    description='Python 함수를 호출하는 간단한 DAG',\n    schedule_interval=timedelta(days=1),\n)\n\n# PythonOperator 작업 생성\npython_task = PythonOperator(\n    task_id='my_python_task',\n    python_callable=start_process,\n    dag=dag,\n)\n\n# 작업 간 의존성 정의\npython_task\n\n# DAG 등록\ndag\n```\n\n위의 .py 파일을 로컬 머신의 /Users/local_user/airflow/dags로 복사하세요. 이렇게 함으로써 컨테이너 내의 경로 /opt/airflow/dags로 마운트됩니다.\n\n좋아요!!\n\n이제 Airflow에서 DAG 페이지를 새로고침하세요. 위의 DAG가 표시될 것입니다. 실행해보고 문제가 있는지 로그를 확인해보세요. 녹색으로 변하면 작업이 완료된 것입니다.\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n이 구현은 AWS EC2 인스턴스에 Airflow를 설정하여 수행할 수도 있습니다.","ogImage":{"url":"/assets/img/2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer_0.png"},"coverImage":"/assets/img/2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer_0.png","tag":["Tech"],"readingTime":6},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    img: \"img\",\n    h2: \"h2\",\n    ul: \"ul\",\n    li: \"li\",\n    pre: \"pre\",\n    code: \"code\",\n    span: \"span\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"그게 많은 양이겠죠! 조금씩 나눠서 살펴봐요.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/img/2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer_0.png\",\n        alt: \"YoutubeDataPipeline\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"사용 사례: —\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"상상해봐요! 성장하는 YouTube 채널을 운영하는 콘텐츠 크리에이터라고 상상해봐요. 시청자들의 댓글과 답글을 통해 시청자를 이해하는 것은 귀중한 통찰력을 제공할 수 있어요. 그러나 수많은 동영상의 댓글을 수동으로 분류하는 것은 지칠 수 있죠. 이 프로세스를 자동화할 수 있는 방법이 있다면 어떨까요?\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"제안된 해결책: —\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"위의 그림을 보시면, YouTube 비디오에서 댓글과 답글을 추출하기 위한 자동화된 솔루션을 안내해 드리겠습니다. 이 과정에는 여러 가지 주요 구성 요소가 포함됩니다:\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"— YouTube 데이터 API용 Python 라이브러리: YouTube 데이터 API와 상호 작용하기 위해 Python 라이브러리를 사용하여 댓글과 답글을 프로그래밍 방식으로 가져올 수 있습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"— 작업 관리를 위한 Airflow: 데이터 추출 및 처리 작업을 체계적으로 관리하기 위해 Apache Airflow를 Docker 컨테이너 내에서 사용할 것입니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"데이터 저장을 위한 AWS S3: 마지막으로, boto3 라이브러리를 사용하여 처리된 데이터를 AWS S3에 저장하게 됩니다. 나중에 쉽게 액세스하고 분석할 수 있습니다.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이 솔루션은 추출 프로세스를 자동화하는 데 그치지 않고 데이터가 구성되어 안전하게 저장되어 나중에 깊이 있는 분석을 위해 준비되어 있음을 보장합니다. 이제 이 워크플로우를 설정하고 실행하는 자세한 내용을 살펴보겠습니다.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"구현\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"구현은 주로 두 가지 작업으로 구성되어 있습니다. 첫 번째는 인프라 구축, 두 번째는 코드 작업입니다. 그래서 이제 인프라 설정을 먼저 살펴보겠습니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"도커 데스크톱을 설치해보세요 — https://www.docker.com/get-started/\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"머신에 도커를 설치한 후에는 다음 명령어를 확인하여 설치가 성공적으로 이루어졌는지 확인하세요.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"docker --version\\n\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Docker\"\n        }), \" version \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"20.10\"\n        }), _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \".23\"\n        }), \", build \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"7155243\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"최신 apache/airflow 이미지를 받아보세요\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-sh\",\n        children: \"도커 pull apache/airflow\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"다음 명령어를 사용하여 아파치 에어플로우 컨테이너를 시작하세요.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-sh\",\n        children: \"도커 run -p 8080:8080 -v /Users/local_user/airflow/dags:/opt/airflow/dags -v /Users/local_user/airflow/creds:/home/airflow/.aws -d apache/airflow standalone\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"AWS 자격 증명을 생성하여 원격 s3 버킷과 통신하여 날짜를 쓸 수 있습니다. 다음 링크를 통해 생성하세요 — 루트 사용자를 위한 액세스 키 생성하기\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"config\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-json\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"[\"\n        }), \"default\", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"]\"\n        }), \"\\nregion = ap-south\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"-1\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"credentials\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-json\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"[\"\n        }), \"default\", _jsx(_components.span, {\n          className: \"hljs-punctuation\",\n          children: \"]\"\n        }), \"\\naws_access_key_id = AKIB******AXPCMO\\naws_secret_access_key = \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"4\"\n        }), \"D7HkaIBsqu***********+\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"AT2a8j\\n\"]\n      })\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"지역 사용자의 경우 두 파일을 로컬 머신의 /Users/local_user/airflow/creds/ 폴더로 복사해주세요. 이렇게 함으로써 이 파일들이 컨테이너에서 /home/airflow/.aws/ 경로에 마운트되도록 할 수 있습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"도커 데스크톱 애플리케이션을 열고 Airflow 컨테이너를 선택해주세요. 컨테이너 내에서 standalone_admin_password.txt 파일을 찾아주세요. 이 파일을 열고 Airflow 포털에 로그인하기 위한 비밀번호를 복사해주세요.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/img/2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer_1.png\",\n        alt: \"이미지\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"웹 브라우저를 열고 \", _jsx(_components.code, {\n        children: \"http://localhost:8080\"\n      }), \" 주소로 이동해주세요. username에 admin을 입력하고 이전 단계에서 복사한 비밀번호로 로그인해주세요.\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.code, {\n        children: \"aws_write_utility.py\"\n      }), \" 파일을 만들 때 평소처럼 진행하시면 됩니다.\"]\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" boto3\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" json\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" uuid\\n\\ndef \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"write_json_to_s3\"\n        }), \"(json_data, bucket_name, key_name):\\n\\n    # \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"S3\"\n        }), \" 클라이언트 초기화\\n    s3 = boto3.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"client\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'s3'\"\n        }), \")\\n    \\n    # \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"JSON\"\n        }), \" 데이터를 바이트로 변환\\n    json_bytes = json.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"dumps\"\n        }), \"(json_data).\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"encode\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'utf-8'\"\n        }), \")\\n    \\n    # \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"JSON\"\n        }), \" 데이터를 \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"S3\"\n        }), \"에 쓰기\\n    s3.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"put_object\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Bucket\"\n        }), \"=bucket_name, \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Key\"\n        }), \"=key_name, \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Body\"\n        }), \"=json_bytes)\\n\\n\\ndef \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"generate_uuid\"\n        }), \"():\\n    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"UUID와 유사한 문자열 생성.\\\"\"\n        }), _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"str\"\n        }), \"(uuid.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"uuid4\"\n        }), \"())\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"youtube_comments.py\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"# -*- \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"coding\"\n        }), \": utf-\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"8\"\n        }), \" -*-\\n\\n# youtube.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"commentThreads\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"list\"\n        }), \"를 위한 샘플 \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Python\"\n        }), \" 코드\\n# 이 코드 샘플을 로컬에서 실행하는 방법은 다음 링크를 참고하세요:\\n# \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"https\"\n        }), \":\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"//developers.google.com/explorer-help/code-samples#python\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" os\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" googleapiclient.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"discovery\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" aws_write_utility\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" aws_write_utility \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" write_json_to_s3\\n\\ndef \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"start_process\"\n        }), \"():\\n    # 로컬에서 실행 시 \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"OAuthlib\"\n        }), \"의 \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"HTTPS\"\n        }), \" 확인 비활성화\\n    # 제품 환경에서는 이 옵션을 활성화하지 마세요.\\n    os.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"environ\"\n        }), \"[\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"OAUTHLIB_INSECURE_TRANSPORT\\\"\"\n        }), \"] = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"1\\\"\"\n        }), \"\\n\\n    api_service_name = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"youtube\\\"\"\n        }), \"\\n    api_version = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"v3\\\"\"\n        }), \"\\n    \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"DEVELOPER_KEY\"\n        }), \" = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"AIzaS*****************PiwBdaP_IE\\\"\"\n        }), \"\\n\\n    youtube = googleapiclient.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"discovery\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"build\"\n        }), \"(\\n        api_service_name, api_version, developerKey=\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"DEVELOPER_KEY\"\n        }), \")\\n\\n    request = youtube.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"commentThreads\"\n        }), \"().\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"list\"\n        }), \"(\\n        part=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"snippet,replies\\\"\"\n        }), \",\\n        videoId=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"r_K*****PKU\\\"\"\n        }), \"\\n    )\\n    response = request.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"execute\"\n        }), \"()\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"process_comments\"\n        }), \"(response)\\n\\n\\ndef \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"process_comments\"\n        }), \"(response_items):\\n\\n    # 예시 \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"S3\"\n        }), \" 버킷 및 키 이름\\n    bucket_name = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'youtube-comments-analysis'\"\n        }), \"\\n    key_name = \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'data/{}.json'\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"format\"\n        }), \"(aws_write_utility.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"generate_uuid\"\n        }), \"())\\n\\n    comments = []\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \" comment \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"in\"\n        }), \" response_items[\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'items'\"\n        }), \"]:\\n        author = comment[\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'snippet'\"\n        }), \"][\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'topLevelComment'\"\n        }), \"][\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'snippet'\"\n        }), \"][\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'authorDisplayName'\"\n        }), \"]\\n        comment_text = comment[\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'snippet'\"\n        }), \"][\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'topLevelComment'\"\n        }), \"][\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'snippet'\"\n        }), \"][\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'textOriginal'\"\n        }), \"]\\n        publish_time = comment[\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'snippet'\"\n        }), \"][\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'topLevelComment'\"\n        }), \"][\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'snippet'\"\n        }), \"][\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'publishedAt'\"\n        }), \"]\\n        comment_info = {\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'author'\"\n        }), \": author, \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'comment'\"\n        }), \": comment_text, \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'published_at'\"\n        }), \": publish_time}\\n        comments.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"append\"\n        }), \"(comment_info)\\n    \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"print\"\n        }), \"(f\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'총 {len(comments)}개의 댓글 처리 완료.'\"\n        }), \")\\n    \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"write_json_to_s3\"\n        }), \"(comments, bucket_name, key_name)\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"youtube_dag.py\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-python\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" datetime \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" datetime, timedelta\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" airflow \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" DAG\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" airflow.operators.python_operator \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" PythonOperator\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" youtube_comments \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" start_process\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 기본 인수 정의\"\n        }), \"\\ndefault_args = {\\n    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'owner'\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'airflow'\"\n        }), \",\\n    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'depends_on_past'\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"False\"\n        }), \",\\n    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'start_date'\"\n        }), \": datetime(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"2024\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"5\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"16\"\n        }), \"),\\n    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'email_on_failure'\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"False\"\n        }), \",\\n    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'email_on_retry'\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"False\"\n        }), \",\\n    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'retries'\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \",\\n    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'retry_delay'\"\n        }), \": timedelta(minutes=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"5\"\n        }), \"),\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# DAG 객체 생성\"\n        }), \"\\ndag = DAG(\\n    \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'youtube_python_operator_dag'\"\n        }), \",\\n    default_args=default_args,\\n    description=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'Python 함수를 호출하는 간단한 DAG'\"\n        }), \",\\n    schedule_interval=timedelta(days=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"),\\n)\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# PythonOperator 작업 생성\"\n        }), \"\\npython_task = PythonOperator(\\n    task_id=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'my_python_task'\"\n        }), \",\\n    python_callable=start_process,\\n    dag=dag,\\n)\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# 작업 간 의존성 정의\"\n        }), \"\\npython_task\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"# DAG 등록\"\n        }), \"\\ndag\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"위의 .py 파일을 로컬 머신의 /Users/local_user/airflow/dags로 복사하세요. 이렇게 함으로써 컨테이너 내의 경로 /opt/airflow/dags로 마운트됩니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"좋아요!!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이제 Airflow에서 DAG 페이지를 새로고침하세요. 위의 DAG가 표시될 것입니다. 실행해보고 문제가 있는지 로그를 확인해보세요. 녹색으로 변하면 작업이 완료된 것입니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이 구현은 AWS EC2 인스턴스에 Airflow를 설정하여 수행할 수도 있습니다.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-18-YoutubeDataPipelineusingAirflowinDockerContainer"},"buildId":"R1x9p1CQYDDJESXyLXKOK","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>