<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>KMM에서 Proto DataStore 마법을 해제하는 방법 | ui-station</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://ui-station.github.io///post/2024-06-23-UnlockingProtoDataStoreMagicinKMM" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="KMM에서 Proto DataStore 마법을 해제하는 방법 | ui-station" data-gatsby-head="true"/><meta property="og:title" content="KMM에서 Proto DataStore 마법을 해제하는 방법 | ui-station" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-23-UnlockingProtoDataStoreMagicinKMM_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://ui-station.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://ui-station.github.io///post/2024-06-23-UnlockingProtoDataStoreMagicinKMM" data-gatsby-head="true"/><meta name="twitter:title" content="KMM에서 Proto DataStore 마법을 해제하는 방법 | ui-station" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-23-UnlockingProtoDataStoreMagicinKMM_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | ui-station" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-23 01:17" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BHFR6GTH9P"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-BHFR6GTH9P');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-70e5ce89f3d962ac.js" defer=""></script><script src="/_next/static/T_Nz0g9U1yttYMSEma95P/_buildManifest.js" defer=""></script><script src="/_next/static/T_Nz0g9U1yttYMSEma95P/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UI STATION</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">KMM에서 Proto DataStore 마법을 해제하는 방법</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="KMM에서 Proto DataStore 마법을 해제하는 방법" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UI STATION</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 23, 2024</span><span class="posts_reading_time__f7YPP">8<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-23-UnlockingProtoDataStoreMagicinKMM&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<img src="/assets/img/2024-06-23-UnlockingProtoDataStoreMagicinKMM_0.png">
<p>모바일 개발의 빠르게 진화하는 세계에서 Kotlin Multiplatform Mobile (KMM)은 안드로이드 및 iOS 애플리케이션을 위한 공유 코드를 작성할 수 있게 해줍니다. 중요한 도전 중 하나는 안드로이드의 SharedPreference나 iOS의 NSUserDefaults와 같은 효율적이고 신뢰할 수 있는 키-값 데이터 저장 솔루션을 찾는 것입니다. 이 글에서는 강력하고 타입 안전한 솔루션 Proto DataStore를 KMM 프로젝트에 통합하는 방법을 탐구합니다.</p>
<h1>DataStore</h1>
<p>Jetpack DataStore는 프로토콜 버퍼를 사용하여 키-값 쌍 또는 형식화된 객체를 저장할 수 있는 데이터 저장 솔루션입니다. DataStore는 Kotlin 코루틴과 Flow를 사용하여 데이터를 비동기적으로, 일관되게 및 트랜잭션 처리할 수 있습니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>DataStore은 두 가지 다른 구현을 제공합니다:</p>
<ul>
<li>Preferences DataStore는 키를 사용하여 데이터를 저장하고 액세스합니다. 이 구현은 미리 정의된 스키마가 필요하지 않으며 형식 안전성을 제공하지 않습니다.</li>
<li>Proto DataStore는 사용자 정의 데이터 유형의 인스턴스로 데이터를 저장합니다. 이 구현은 프로토콜 버퍼를 사용하여 스키마를 정의해야 하지만 형식 안전성을 제공합니다.</li>
</ul>
<p>Google이 이제 DataStore Multiplatform을 출시했습니다!</p>
<p>이 문서에서는 KMM에 Proto DataStore를 구현하여 Protocol Buffer를 활용할 것입니다. KMM에서 Protocol Buffer를 사용하기 위해 Wire를 사용했습니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h1>전체 코드</h1>
<h1>단계별 구현</h1>
<ul>
<li>app/build.gradle.kts 파일에 DataStore 종속성 추가</li>
</ul>
<pre><code class="hljs language-js">commonMain.<span class="hljs-property">dependencies</span> {
  <span class="hljs-comment">// 다른 종속성들</span>
  <span class="hljs-title function_">implementation</span>(<span class="hljs-string">"androidx.datastore:datastore-core-okio:1.1.1"</span>)
}
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>app/build.gradle.kts 파일에 Wire Gradle 플러그인을 추가해주세요.</li>
</ul>
<pre><code class="hljs language-js">plugins {
  <span class="hljs-comment">// 다른 플러그인들</span>
  <span class="hljs-title function_">id</span>(<span class="hljs-string">"com.squareup.wire"</span>) version <span class="hljs-string">"5.0.0-alpha03"</span>
}
</code></pre>
<ul>
<li>app/build.gradle.kts 파일에 Wire Gradle 설정을 추가해주세요.</li>
</ul>
<pre><code class="hljs language-js">wire {
    kotlin {}
    sourcePath {
        <span class="hljs-title function_">srcDir</span>(<span class="hljs-string">"src/commonMain/proto"</span>)
    }
}
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>src/commonMain/proto 디렉토리 아래 preference_data.proto 파일을 생성해주세요</li>
</ul>
<p><img src="/assets/img/2024-06-23-UnlockingProtoDataStoreMagicinKMM_1.png" alt="아이미지"></p>
<pre><code class="hljs language-js"><span class="hljs-comment">// preference_data.proto 파일</span>

syntax = <span class="hljs-string">"proto3"</span>;

package com.<span class="hljs-property">areeb</span>.<span class="hljs-property">proto_datastore_kmm</span>;

message <span class="hljs-title class_">PreferenceData</span> {
  int32 counter = <span class="hljs-number">1</span>;
}
</code></pre>
<ul>
<li>PreferenceData에 대한 Protocol Buffer 직렬화기를 생성해주세요</li>
</ul>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-kt"><span class="hljs-comment">// commonMain 안에 있습니다</span>
<span class="hljs-comment">// PreferenceSerializer.kt</span>

<span class="hljs-keyword">object</span> PreferenceSerializer : OkioSerializer&#x3C;PreferenceData> {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> defaultValue: PreferenceData
        <span class="hljs-keyword">get</span>() = PreferenceData()

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">readFrom</span><span class="hljs-params">(source: <span class="hljs-type">BufferedSource</span>)</span></span>: PreferenceData {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> PreferenceData.ADAPTER.decode(source)
        } <span class="hljs-keyword">catch</span> (exception: IOException) {
            <span class="hljs-keyword">throw</span> Exception(exception.message ?: <span class="hljs-string">"Serialization Exception"</span>)
        }
    }

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">writeTo</span><span class="hljs-params">(t: <span class="hljs-type">PreferenceData</span>, sink: <span class="hljs-type">BufferedSink</span>)</span></span> {
        sink.write(t.encode())
    }
}
</code></pre>
<ul>
<li>각 플랫폼(여기서 안드로이드 및 iOS)을 위한 Proto DataStore 인스턴스를 생성합니다</li>
</ul>
<pre><code class="hljs language-kt"><span class="hljs-comment">// commonMain 안에 있습니다</span>
<span class="hljs-comment">// DataStore.kt</span>

<span class="hljs-keyword">internal</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> DATA_STORE_FILE_NAME = <span class="hljs-string">"proto_datastore.preferences_pb"</span>

<span class="hljs-keyword">expect</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getDataStore</span><span class="hljs-params">()</span></span>: DataStore&#x3C;PreferenceData>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createDataStore</span><span class="hljs-params">(
    fileSystem: <span class="hljs-type">FileSystem</span>,
    producePath: () -> <span class="hljs-type">Path</span>
)</span></span>: DataStore&#x3C;PreferenceData> =
    DataStoreFactory.create(
        storage = OkioStorage(
            fileSystem = fileSystem,
            producePath = producePath,
            serializer = PreferenceSerializer,
        ),
    )
</code></pre>
<pre><code class="hljs language-kt"><span class="hljs-comment">// androidMain 안에 있습니다</span>
<span class="hljs-comment">// ProtoDataStore.kt</span>

<span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getDataStore</span><span class="hljs-params">()</span></span>: DataStore&#x3C;PreferenceData> {
    <span class="hljs-keyword">val</span> content = requireNotNull(AndroidPlatformContextProvider.context)
    <span class="hljs-keyword">val</span> producePath = { content.filesDir.resolve(DATA_STORE_FILE_NAME).absolutePath.toPath() }

    <span class="hljs-keyword">return</span> createDataStore(fileSystem = FileSystem.SYSTEM, producePath = producePath)
}
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-kotlin"><span class="hljs-comment">// iosMain 내부</span>
<span class="hljs-comment">// ProtoDataStore.kt</span>

실제 getDataStore() 함수:

<span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getDataStore</span><span class="hljs-params">()</span></span>: DataStore&#x3C;PreferenceData> {
    <span class="hljs-meta">@OptIn(ExperimentalForeignApi::class)</span>
    <span class="hljs-keyword">val</span> producePath = {
        <span class="hljs-keyword">val</span> documentDirectory: NSURL? = NSFileManager.defaultManager.URLForDirectory(
            directory = NSDocumentDirectory,
            inDomain = NSUserDomainMask,
            appropriateForURL = <span class="hljs-literal">null</span>,
            create = <span class="hljs-literal">false</span>,
            error = <span class="hljs-literal">null</span>,
        )
        requireNotNull(documentDirectory).path + <span class="hljs-string">"/<span class="hljs-variable">$DATA_STORE_FILE_NAME</span>"</span>
    }

    <span class="hljs-keyword">return</span> createDataStore(fileSystem = FileSystem.SYSTEM, producePath = { producePath().toPath() })
}
</code></pre>
<ul>
<li>DataStore를 사용하여 키-값 쌍을 가져오고 저장합니다.</li>
</ul>
<pre><code class="hljs language-kotlin"><span class="hljs-comment">// commonMain 내부</span>
<span class="hljs-comment">// Preference.kt</span>

Preference 인터페이스:

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Preference</span> {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateCounter</span><span class="hljs-params">()</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCounter</span><span class="hljs-params">()</span></span>: Flow&#x3C;<span class="hljs-built_in">Int</span>>
}

PreferenceImpl 클래스:

PreferenceImpl(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> dataStore: DataStore&#x3C;PreferenceData> = getDataStore()) :
    Preference {

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateCounter</span><span class="hljs-params">()</span></span> {
        dataStore.updateData { <span class="hljs-keyword">data</span> ->
            <span class="hljs-keyword">data</span>.copy(counter = <span class="hljs-keyword">data</span>.counter + <span class="hljs-number">1</span>)
        }
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCounter</span><span class="hljs-params">()</span></span>: Flow&#x3C;<span class="hljs-built_in">Int</span>> {
        <span class="hljs-keyword">return</span> dataStore.<span class="hljs-keyword">data</span>.map { <span class="hljs-keyword">data</span> ->
            <span class="hljs-keyword">data</span>.counter
        }
    }
}
</code></pre>
<ul>
<li>Compose Multiplatform에서 DataStore 사용법</li>
</ul>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-meta">@Preview</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">App</span><span class="hljs-params">()</span></span> {
    MaterialTheme {
        <span class="hljs-keyword">val</span> composableScope = rememberCoroutineScope()
        <span class="hljs-keyword">val</span> preference: Preference = remember { PreferenceImpl() }
        <span class="hljs-keyword">val</span> counter <span class="hljs-keyword">by</span> preference.getCounter().collectAsState(initial = <span class="hljs-number">0</span>)

        Column(
            Modifier.fillMaxSize(),
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.Center,
        ) {
            Button(
                onClick = {
                    composableScope.launch {
                        preference.updateCounter()
                    }
                },
            ) {
                Text(<span class="hljs-string">"Click me! Counter: <span class="hljs-variable">$counter</span>"</span>)
            }
        }
    }
}
</code></pre>
<p>결과</p>
<img src="https://miro.medium.com/v2/resize:fit:648/1*LLMohc4VOkcL1wdhGDjp_Q.gif">
<img src="https://miro.medium.com/v2/resize:fit:600/1*myxIzIctkEZvgk81vKV0-w.gif">
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>아래 코멘트에 여러분의 제안과 개선 사항을 남겨주세요. 편안한 마음으로 연락해주세요!</p>
<p>LinkedIn에서 저와 연결해보세요.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"KMM에서 Proto DataStore 마법을 해제하는 방법","description":"","date":"2024-06-23 01:17","slug":"2024-06-23-UnlockingProtoDataStoreMagicinKMM","content":"\n\u003cimg src=\"/assets/img/2024-06-23-UnlockingProtoDataStoreMagicinKMM_0.png\" /\u003e\n\n모바일 개발의 빠르게 진화하는 세계에서 Kotlin Multiplatform Mobile (KMM)은 안드로이드 및 iOS 애플리케이션을 위한 공유 코드를 작성할 수 있게 해줍니다. 중요한 도전 중 하나는 안드로이드의 SharedPreference나 iOS의 NSUserDefaults와 같은 효율적이고 신뢰할 수 있는 키-값 데이터 저장 솔루션을 찾는 것입니다. 이 글에서는 강력하고 타입 안전한 솔루션 Proto DataStore를 KMM 프로젝트에 통합하는 방법을 탐구합니다.\n\n# DataStore\n\nJetpack DataStore는 프로토콜 버퍼를 사용하여 키-값 쌍 또는 형식화된 객체를 저장할 수 있는 데이터 저장 솔루션입니다. DataStore는 Kotlin 코루틴과 Flow를 사용하여 데이터를 비동기적으로, 일관되게 및 트랜잭션 처리할 수 있습니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nDataStore은 두 가지 다른 구현을 제공합니다:\n\n- Preferences DataStore는 키를 사용하여 데이터를 저장하고 액세스합니다. 이 구현은 미리 정의된 스키마가 필요하지 않으며 형식 안전성을 제공하지 않습니다.\n- Proto DataStore는 사용자 정의 데이터 유형의 인스턴스로 데이터를 저장합니다. 이 구현은 프로토콜 버퍼를 사용하여 스키마를 정의해야 하지만 형식 안전성을 제공합니다.\n\nGoogle이 이제 DataStore Multiplatform을 출시했습니다!\n\n이 문서에서는 KMM에 Proto DataStore를 구현하여 Protocol Buffer를 활용할 것입니다. KMM에서 Protocol Buffer를 사용하기 위해 Wire를 사용했습니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n# 전체 코드\n\n# 단계별 구현\n\n- app/build.gradle.kts 파일에 DataStore 종속성 추가\n\n```js\ncommonMain.dependencies {\n  // 다른 종속성들\n  implementation(\"androidx.datastore:datastore-core-okio:1.1.1\")\n}\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- app/build.gradle.kts 파일에 Wire Gradle 플러그인을 추가해주세요.\n\n```js\nplugins {\n  // 다른 플러그인들\n  id(\"com.squareup.wire\") version \"5.0.0-alpha03\"\n}\n```\n\n- app/build.gradle.kts 파일에 Wire Gradle 설정을 추가해주세요.\n\n```js\nwire {\n    kotlin {}\n    sourcePath {\n        srcDir(\"src/commonMain/proto\")\n    }\n}\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- src/commonMain/proto 디렉토리 아래 preference_data.proto 파일을 생성해주세요\n\n![아이미지](/assets/img/2024-06-23-UnlockingProtoDataStoreMagicinKMM_1.png)\n\n```js\n// preference_data.proto 파일\n\nsyntax = \"proto3\";\n\npackage com.areeb.proto_datastore_kmm;\n\nmessage PreferenceData {\n  int32 counter = 1;\n}\n```\n\n- PreferenceData에 대한 Protocol Buffer 직렬화기를 생성해주세요\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```kt\n// commonMain 안에 있습니다\n// PreferenceSerializer.kt\n\nobject PreferenceSerializer : OkioSerializer\u003cPreferenceData\u003e {\n    override val defaultValue: PreferenceData\n        get() = PreferenceData()\n\n    override suspend fun readFrom(source: BufferedSource): PreferenceData {\n        try {\n            return PreferenceData.ADAPTER.decode(source)\n        } catch (exception: IOException) {\n            throw Exception(exception.message ?: \"Serialization Exception\")\n        }\n    }\n\n    override suspend fun writeTo(t: PreferenceData, sink: BufferedSink) {\n        sink.write(t.encode())\n    }\n}\n```\n\n- 각 플랫폼(여기서 안드로이드 및 iOS)을 위한 Proto DataStore 인스턴스를 생성합니다\n\n```kt\n// commonMain 안에 있습니다\n// DataStore.kt\n\ninternal const val DATA_STORE_FILE_NAME = \"proto_datastore.preferences_pb\"\n\nexpect fun getDataStore(): DataStore\u003cPreferenceData\u003e\n\nfun createDataStore(\n    fileSystem: FileSystem,\n    producePath: () -\u003e Path\n): DataStore\u003cPreferenceData\u003e =\n    DataStoreFactory.create(\n        storage = OkioStorage(\n            fileSystem = fileSystem,\n            producePath = producePath,\n            serializer = PreferenceSerializer,\n        ),\n    )\n```\n\n```kt\n// androidMain 안에 있습니다\n// ProtoDataStore.kt\n\nactual fun getDataStore(): DataStore\u003cPreferenceData\u003e {\n    val content = requireNotNull(AndroidPlatformContextProvider.context)\n    val producePath = { content.filesDir.resolve(DATA_STORE_FILE_NAME).absolutePath.toPath() }\n\n    return createDataStore(fileSystem = FileSystem.SYSTEM, producePath = producePath)\n}\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```kotlin\n// iosMain 내부\n// ProtoDataStore.kt\n\n실제 getDataStore() 함수:\n\nactual fun getDataStore(): DataStore\u003cPreferenceData\u003e {\n    @OptIn(ExperimentalForeignApi::class)\n    val producePath = {\n        val documentDirectory: NSURL? = NSFileManager.defaultManager.URLForDirectory(\n            directory = NSDocumentDirectory,\n            inDomain = NSUserDomainMask,\n            appropriateForURL = null,\n            create = false,\n            error = null,\n        )\n        requireNotNull(documentDirectory).path + \"/$DATA_STORE_FILE_NAME\"\n    }\n\n    return createDataStore(fileSystem = FileSystem.SYSTEM, producePath = { producePath().toPath() })\n}\n```\n\n- DataStore를 사용하여 키-값 쌍을 가져오고 저장합니다.\n\n```kotlin\n// commonMain 내부\n// Preference.kt\n\nPreference 인터페이스:\n\ninterface Preference {\n    suspend fun updateCounter()\n    fun getCounter(): Flow\u003cInt\u003e\n}\n\nPreferenceImpl 클래스:\n\nPreferenceImpl(private val dataStore: DataStore\u003cPreferenceData\u003e = getDataStore()) :\n    Preference {\n\n    override suspend fun updateCounter() {\n        dataStore.updateData { data -\u003e\n            data.copy(counter = data.counter + 1)\n        }\n    }\n\n    override fun getCounter(): Flow\u003cInt\u003e {\n        return dataStore.data.map { data -\u003e\n            data.counter\n        }\n    }\n}\n```\n\n- Compose Multiplatform에서 DataStore 사용법\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```kotlin\n@Composable\n@Preview\nfun App() {\n    MaterialTheme {\n        val composableScope = rememberCoroutineScope()\n        val preference: Preference = remember { PreferenceImpl() }\n        val counter by preference.getCounter().collectAsState(initial = 0)\n\n        Column(\n            Modifier.fillMaxSize(),\n            horizontalAlignment = Alignment.CenterHorizontally,\n            verticalArrangement = Arrangement.Center,\n        ) {\n            Button(\n                onClick = {\n                    composableScope.launch {\n                        preference.updateCounter()\n                    }\n                },\n            ) {\n                Text(\"Click me! Counter: $counter\")\n            }\n        }\n    }\n}\n```\n\n결과\n\n\u003cimg src=\"https://miro.medium.com/v2/resize:fit:648/1*LLMohc4VOkcL1wdhGDjp_Q.gif\" /\u003e\n\n\u003cimg src=\"https://miro.medium.com/v2/resize:fit:600/1*myxIzIctkEZvgk81vKV0-w.gif\" /\u003e\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n아래 코멘트에 여러분의 제안과 개선 사항을 남겨주세요. 편안한 마음으로 연락해주세요!\n\nLinkedIn에서 저와 연결해보세요.\n","ogImage":{"url":"/assets/img/2024-06-23-UnlockingProtoDataStoreMagicinKMM_0.png"},"coverImage":"/assets/img/2024-06-23-UnlockingProtoDataStoreMagicinKMM_0.png","tag":["Tech"],"readingTime":8},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cimg src=\"/assets/img/2024-06-23-UnlockingProtoDataStoreMagicinKMM_0.png\"\u003e\n\u003cp\u003e모바일 개발의 빠르게 진화하는 세계에서 Kotlin Multiplatform Mobile (KMM)은 안드로이드 및 iOS 애플리케이션을 위한 공유 코드를 작성할 수 있게 해줍니다. 중요한 도전 중 하나는 안드로이드의 SharedPreference나 iOS의 NSUserDefaults와 같은 효율적이고 신뢰할 수 있는 키-값 데이터 저장 솔루션을 찾는 것입니다. 이 글에서는 강력하고 타입 안전한 솔루션 Proto DataStore를 KMM 프로젝트에 통합하는 방법을 탐구합니다.\u003c/p\u003e\n\u003ch1\u003eDataStore\u003c/h1\u003e\n\u003cp\u003eJetpack DataStore는 프로토콜 버퍼를 사용하여 키-값 쌍 또는 형식화된 객체를 저장할 수 있는 데이터 저장 솔루션입니다. DataStore는 Kotlin 코루틴과 Flow를 사용하여 데이터를 비동기적으로, 일관되게 및 트랜잭션 처리할 수 있습니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eDataStore은 두 가지 다른 구현을 제공합니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePreferences DataStore는 키를 사용하여 데이터를 저장하고 액세스합니다. 이 구현은 미리 정의된 스키마가 필요하지 않으며 형식 안전성을 제공하지 않습니다.\u003c/li\u003e\n\u003cli\u003eProto DataStore는 사용자 정의 데이터 유형의 인스턴스로 데이터를 저장합니다. 이 구현은 프로토콜 버퍼를 사용하여 스키마를 정의해야 하지만 형식 안전성을 제공합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eGoogle이 이제 DataStore Multiplatform을 출시했습니다!\u003c/p\u003e\n\u003cp\u003e이 문서에서는 KMM에 Proto DataStore를 구현하여 Protocol Buffer를 활용할 것입니다. KMM에서 Protocol Buffer를 사용하기 위해 Wire를 사용했습니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch1\u003e전체 코드\u003c/h1\u003e\n\u003ch1\u003e단계별 구현\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eapp/build.gradle.kts 파일에 DataStore 종속성 추가\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003ecommonMain.\u003cspan class=\"hljs-property\"\u003edependencies\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// 다른 종속성들\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_\"\u003eimplementation\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"androidx.datastore:datastore-core-okio:1.1.1\"\u003c/span\u003e)\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003eapp/build.gradle.kts 파일에 Wire Gradle 플러그인을 추가해주세요.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eplugins {\n  \u003cspan class=\"hljs-comment\"\u003e// 다른 플러그인들\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_\"\u003eid\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"com.squareup.wire\"\u003c/span\u003e) version \u003cspan class=\"hljs-string\"\u003e\"5.0.0-alpha03\"\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eapp/build.gradle.kts 파일에 Wire Gradle 설정을 추가해주세요.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003ewire {\n    kotlin {}\n    sourcePath {\n        \u003cspan class=\"hljs-title function_\"\u003esrcDir\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"src/commonMain/proto\"\u003c/span\u003e)\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003esrc/commonMain/proto 디렉토리 아래 preference_data.proto 파일을 생성해주세요\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-UnlockingProtoDataStoreMagicinKMM_1.png\" alt=\"아이미지\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// preference_data.proto 파일\u003c/span\u003e\n\nsyntax = \u003cspan class=\"hljs-string\"\u003e\"proto3\"\u003c/span\u003e;\n\npackage com.\u003cspan class=\"hljs-property\"\u003eareeb\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eproto_datastore_kmm\u003c/span\u003e;\n\nmessage \u003cspan class=\"hljs-title class_\"\u003ePreferenceData\u003c/span\u003e {\n  int32 counter = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003ePreferenceData에 대한 Protocol Buffer 직렬화기를 생성해주세요\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-kt\"\u003e\u003cspan class=\"hljs-comment\"\u003e// commonMain 안에 있습니다\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// PreferenceSerializer.kt\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eobject\u003c/span\u003e PreferenceSerializer : OkioSerializer\u0026#x3C;PreferenceData\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eval\u003c/span\u003e defaultValue: PreferenceData\n        \u003cspan class=\"hljs-keyword\"\u003eget\u003c/span\u003e() = PreferenceData()\n\n    \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003esuspend\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ereadFrom\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(source: \u003cspan class=\"hljs-type\"\u003eBufferedSource\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e: PreferenceData {\n        \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e PreferenceData.ADAPTER.decode(source)\n        } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (exception: IOException) {\n            \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e Exception(exception.message ?: \u003cspan class=\"hljs-string\"\u003e\"Serialization Exception\"\u003c/span\u003e)\n        }\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003esuspend\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ewriteTo\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(t: \u003cspan class=\"hljs-type\"\u003ePreferenceData\u003c/span\u003e, sink: \u003cspan class=\"hljs-type\"\u003eBufferedSink\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e {\n        sink.write(t.encode())\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e각 플랫폼(여기서 안드로이드 및 iOS)을 위한 Proto DataStore 인스턴스를 생성합니다\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-kt\"\u003e\u003cspan class=\"hljs-comment\"\u003e// commonMain 안에 있습니다\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// DataStore.kt\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003einternal\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eval\u003c/span\u003e DATA_STORE_FILE_NAME = \u003cspan class=\"hljs-string\"\u003e\"proto_datastore.preferences_pb\"\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eexpect\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetDataStore\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e: DataStore\u0026#x3C;PreferenceData\u003e\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecreateDataStore\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\n    fileSystem: \u003cspan class=\"hljs-type\"\u003eFileSystem\u003c/span\u003e,\n    producePath: () -\u003e \u003cspan class=\"hljs-type\"\u003ePath\u003c/span\u003e\n)\u003c/span\u003e\u003c/span\u003e: DataStore\u0026#x3C;PreferenceData\u003e =\n    DataStoreFactory.create(\n        storage = OkioStorage(\n            fileSystem = fileSystem,\n            producePath = producePath,\n            serializer = PreferenceSerializer,\n        ),\n    )\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-kt\"\u003e\u003cspan class=\"hljs-comment\"\u003e// androidMain 안에 있습니다\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// ProtoDataStore.kt\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eactual\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetDataStore\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e: DataStore\u0026#x3C;PreferenceData\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eval\u003c/span\u003e content = requireNotNull(AndroidPlatformContextProvider.context)\n    \u003cspan class=\"hljs-keyword\"\u003eval\u003c/span\u003e producePath = { content.filesDir.resolve(DATA_STORE_FILE_NAME).absolutePath.toPath() }\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e createDataStore(fileSystem = FileSystem.SYSTEM, producePath = producePath)\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-kotlin\"\u003e\u003cspan class=\"hljs-comment\"\u003e// iosMain 내부\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// ProtoDataStore.kt\u003c/span\u003e\n\n실제 getDataStore() 함수:\n\n\u003cspan class=\"hljs-keyword\"\u003eactual\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetDataStore\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e: DataStore\u0026#x3C;PreferenceData\u003e {\n    \u003cspan class=\"hljs-meta\"\u003e@OptIn(ExperimentalForeignApi::class)\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eval\u003c/span\u003e producePath = {\n        \u003cspan class=\"hljs-keyword\"\u003eval\u003c/span\u003e documentDirectory: NSURL? = NSFileManager.defaultManager.URLForDirectory(\n            directory = NSDocumentDirectory,\n            inDomain = NSUserDomainMask,\n            appropriateForURL = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e,\n            create = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n            error = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e,\n        )\n        requireNotNull(documentDirectory).path + \u003cspan class=\"hljs-string\"\u003e\"/\u003cspan class=\"hljs-variable\"\u003e$DATA_STORE_FILE_NAME\u003c/span\u003e\"\u003c/span\u003e\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e createDataStore(fileSystem = FileSystem.SYSTEM, producePath = { producePath().toPath() })\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eDataStore를 사용하여 키-값 쌍을 가져오고 저장합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-kotlin\"\u003e\u003cspan class=\"hljs-comment\"\u003e// commonMain 내부\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// Preference.kt\u003c/span\u003e\n\nPreference 인터페이스:\n\n\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePreference\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003esuspend\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eupdateCounter\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetCounter\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e: Flow\u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003eInt\u003c/span\u003e\u003e\n}\n\nPreferenceImpl 클래스:\n\nPreferenceImpl(\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eval\u003c/span\u003e dataStore: DataStore\u0026#x3C;PreferenceData\u003e = getDataStore()) :\n    Preference {\n\n    \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003esuspend\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eupdateCounter\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e {\n        dataStore.updateData { \u003cspan class=\"hljs-keyword\"\u003edata\u003c/span\u003e -\u003e\n            \u003cspan class=\"hljs-keyword\"\u003edata\u003c/span\u003e.copy(counter = \u003cspan class=\"hljs-keyword\"\u003edata\u003c/span\u003e.counter + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n        }\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetCounter\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e: Flow\u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003eInt\u003c/span\u003e\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e dataStore.\u003cspan class=\"hljs-keyword\"\u003edata\u003c/span\u003e.map { \u003cspan class=\"hljs-keyword\"\u003edata\u003c/span\u003e -\u003e\n            \u003cspan class=\"hljs-keyword\"\u003edata\u003c/span\u003e.counter\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eCompose Multiplatform에서 DataStore 사용법\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-kotlin\"\u003e\u003cspan class=\"hljs-meta\"\u003e@Composable\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e@Preview\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eApp\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e {\n    MaterialTheme {\n        \u003cspan class=\"hljs-keyword\"\u003eval\u003c/span\u003e composableScope = rememberCoroutineScope()\n        \u003cspan class=\"hljs-keyword\"\u003eval\u003c/span\u003e preference: Preference = remember { PreferenceImpl() }\n        \u003cspan class=\"hljs-keyword\"\u003eval\u003c/span\u003e counter \u003cspan class=\"hljs-keyword\"\u003eby\u003c/span\u003e preference.getCounter().collectAsState(initial = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n\n        Column(\n            Modifier.fillMaxSize(),\n            horizontalAlignment = Alignment.CenterHorizontally,\n            verticalArrangement = Arrangement.Center,\n        ) {\n            Button(\n                onClick = {\n                    composableScope.launch {\n                        preference.updateCounter()\n                    }\n                },\n            ) {\n                Text(\u003cspan class=\"hljs-string\"\u003e\"Click me! Counter: \u003cspan class=\"hljs-variable\"\u003e$counter\u003c/span\u003e\"\u003c/span\u003e)\n            }\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e결과\u003c/p\u003e\n\u003cimg src=\"https://miro.medium.com/v2/resize:fit:648/1*LLMohc4VOkcL1wdhGDjp_Q.gif\"\u003e\n\u003cimg src=\"https://miro.medium.com/v2/resize:fit:600/1*myxIzIctkEZvgk81vKV0-w.gif\"\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e아래 코멘트에 여러분의 제안과 개선 사항을 남겨주세요. 편안한 마음으로 연락해주세요!\u003c/p\u003e\n\u003cp\u003eLinkedIn에서 저와 연결해보세요.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-23-UnlockingProtoDataStoreMagicinKMM"},"buildId":"T_Nz0g9U1yttYMSEma95P","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>