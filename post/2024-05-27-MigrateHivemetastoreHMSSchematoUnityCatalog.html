<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>하이브 메타스토어 HMS 스키마를 유니티 카탈로그로 이관하기 | ui-station</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://ui-station.github.io///post/2024-05-27-MigrateHivemetastoreHMSSchematoUnityCatalog" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="하이브 메타스토어 HMS 스키마를 유니티 카탈로그로 이관하기 | ui-station" data-gatsby-head="true"/><meta property="og:title" content="하이브 메타스토어 HMS 스키마를 유니티 카탈로그로 이관하기 | ui-station" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-27-MigrateHivemetastoreHMSSchematoUnityCatalog_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://ui-station.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://ui-station.github.io///post/2024-05-27-MigrateHivemetastoreHMSSchematoUnityCatalog" data-gatsby-head="true"/><meta name="twitter:title" content="하이브 메타스토어 HMS 스키마를 유니티 카탈로그로 이관하기 | ui-station" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-27-MigrateHivemetastoreHMSSchematoUnityCatalog_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | ui-station" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-27 17:16" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BHFR6GTH9P"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-BHFR6GTH9P');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-70e5ce89f3d962ac.js" defer=""></script><script src="/_next/static/JlBEgQDLGRx6DYlBnT8eD/_buildManifest.js" defer=""></script><script src="/_next/static/JlBEgQDLGRx6DYlBnT8eD/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UI STATION</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">하이브 메타스토어 HMS 스키마를 유니티 카탈로그로 이관하기</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="하이브 메타스토어 HMS 스키마를 유니티 카탈로그로 이관하기" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UI STATION</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 27, 2024</span><span class="posts_reading_time__f7YPP">8<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-27-MigrateHivemetastoreHMSSchematoUnityCatalog&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<img src="/assets/img/2024-05-27-MigrateHivemetastoreHMSSchematoUnityCatalog_0.png">
<p>HMS에서 Unity Catalog로의 이주 이야기에 오신 것을 환영합니다.</p>
<p>본 글에서는 HMS에서 Unity Catalog로의 이주 과정을 공유하고자 합니다. HMS를 Unity Catalog로 마이그레이션하기 위한 여러 도구들이 있음을 알고 있습니다. 특히 현재 시장에서 인기를 끌고 있는 UCX가 있습니다. 아직 UCX를 탐험해보지는 않았지만, 앞으로 UCX를 살펴볼 예정입니다.
UCX를 사용해보고 싶다면, <a href="https://github.com/databrickslabs/ucx" rel="nofollow" target="_blank">https://github.com/databrickslabs/ucx</a> 에서 확인하고 그 경험을 공유해주세요.</p>
<p>본 글의 범위</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>외부 테이블을 Unity 카탈로그로 이주합니다.</li>
</ul>
<p>이 글에서 다루겠습니다.</p>
<ul>
<li>관리형 테이블을 Unity 카탈로그로 이주합니다.
<a href="https://medium.com/@data_engineering_0216/migrate-managed-table-to-unity-catalog-ab4dbba9d6aa" rel="nofollow" target="_blank">https://medium.com/@data_engineering_0216/migrate-managed-table-to-unity-catalog-ab4dbba9d6aa</a></li>
<li>뷰를 Unity 카탈로그로 이주합니다.
<a href="https://medium.com/@data_engineering_0216/migrate-views-from-hive-metastore-to-unity-catalog-7aac5ec1da50" rel="nofollow" target="_blank">https://medium.com/@data_engineering_0216/migrate-views-from-hive-metastore-to-unity-catalog-7aac5ec1da50</a></li>
<li>메타데이터 기반 권한 관리
<a href="https://medium.com/@data_engineering_0216/unity-catalog-permissions-f1e6221cbc68" rel="nofollow" target="_blank">https://medium.com/@data_engineering_0216/unity-catalog-permissions-f1e6221cbc68</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/databricks/data-governance/unity-catalog/migrate" rel="nofollow" target="_blank">https://learn.microsoft.com/en-us/azure/databricks/data-governance/unity-catalog/migrate</a></li>
</ul>
<p>외부 테이블을 Unity 카탈로그로 이주합니다.</p>
<p>준비물</p>
<ul>
<li>메타스토어 또는 카탈로그 관리자 권한</li>
<li>Unity 카탈로그가 활성화된 Databricks 워크스페이스</li>
<li>Unity 카탈로그가 활성화된 클러스터</li>
<li>Databricks 접근 커넥터</li>
<li>마운트 지점과 동등한 스토리지 자격 증명 및 외부 위치(읽기 및 쓰기 권한 필요)</li>
<li>워크스페이스 또는 클러스터 수준에서 기본 카탈로그 설정: 선택 사항
클러스터 구성: spark.databricks.sql.initial.catalog.name gold_dv</li>
</ul>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>솔루션을 깊이 살펴보겠습니다. 사용자 정의 Python 함수인 migrate_tables_to_unity_catalog을 살펴봅시다. 이 코드는 외부 테이블을 하나의 (hive_metastore) 카탈로그에서 다른 카탈로그(Unity Catalog)로 동기화하는 함수를 정의합니다.</p>
<p>이 함수는 다음과 같은 매개변수를 사용합니다:</p>
<ul>
<li>src_ct_name: 원본 카탈로그의 이름.</li>
<li>src_databases: 원본 카탈로그에서 가져온 데이터베이스 사전의 목록.</li>
<li>dst_ct_name: 대상 카탈로그의 이름.</li>
<li>exclude_databases: 마이그레이션에서 제외할 데이터베이스 이름의 목록.</li>
<li>full_reset: 전체 리셋을 수행해야 하는지 여부를 나타내는 부울 플래그.</li>
</ul>
<p>이 함수는 먼저 src_databases 매개변수에서 데이터베이스 이름 목록을 작성합니다. 제외할 데이터베이스가 있는 경우 해당 데이터베이스를 목록에서 필터링합니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>그럼, 각 데이터베이스를 처리하는 process_database 내부 함수를 정의합니다. full_reset이 True 인 경우, 대상 카탈로그의 데이터베이스를 삭제하고 새 데이터베이스를 생성한 후 소스 카탈로그에서 대상 카탈로그로 스키마를 동기화합니다. full_reset이 False 인 경우, 새 데이터베이스를 생성하고 스키마를 동기화합니다. full_reset이 제공되지 않은 경우, 재설정 모드를 요청하는 메시지를 출력합니다.</p>
<p>concurrent.futures.ThreadPoolExecutor를 사용하여 함수는 각 데이터베이스를 병렬로 처리하도록 제출합니다. 모든 futures가 완료되기를 기다리고 처리 중 발생한 예외를 처리합니다.</p>
<p>이 함수를 사용하려면 필요한 매개변수를 제공하고 함수를 호출해야 합니다.</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">import</span> concurrent.futures


<span class="hljs-keyword">def</span> <span class="hljs-title function_">migrate_tables_to_unity_catalog</span>(<span class="hljs-params">src_ct_name, src_databases, dst_ct_name, exclude_databases, full_reset</span>):
    <span class="hljs-string">"""
    한 카탈로그에서 다른 카탈로그로 관리되는 모든 테이블을 복사합니다.

    매개변수:
        src_ct_name (str): 원본 카탈로그의 이름.
        src_databases (list): 원본 카탈로그에서의 데이터베이스 딕셔너리 목록.
        dst_ct_name (str): 대상 카탈로그의 이름.
        exclude_databases (list): 마이그레이션에서 제외할 데이터베이스 이름 목록.

    반환:
        None

    예외:
        None

    예시:
        src_ct_name       = "hive_metastore"
        src_databases     = spark.sql(f"SHOW DATABASES IN {src_ct_name}").collect()
        dst_ct_name       = "uc_dv"
        exclude_databases = ["poc", "temp_tbd", "default"]
        migrate_managed_tables_to_unity_catalog(src_ct_name, src_databases, dst_ct_name, exclude_databases)

    """</span>

    list_of_db = []
    <span class="hljs-keyword">for</span> db <span class="hljs-keyword">in</span> src_databases:
        dbName = db[<span class="hljs-string">'databaseName'</span>]
        list_of_db.append(dbName)
    <span class="hljs-keyword">if</span> exclude_databases:
        databases = [x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> list_of_db <span class="hljs-keyword">if</span> x <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> exclude_databases]
    <span class="hljs-keyword">else</span>:
        databases = list_of_db

    <span class="hljs-built_in">print</span>(databases)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_database</span>(<span class="hljs-params">db, full_reset</span>):

        <span class="hljs-keyword">if</span> full_reset == <span class="hljs-literal">True</span>:
            drop_db = <span class="hljs-string">f"DROP DATABASE IF EXISTS <span class="hljs-subst">{dst_ct_name}</span>.<span class="hljs-subst">{db}</span> CASCADE"</span>
            display(spark.sql(drop_db))
            create_db = <span class="hljs-string">f"CREATE DATABASE IF NOT EXISTS <span class="hljs-subst">{dst_ct_name}</span>.<span class="hljs-subst">{db}</span>"</span>
            display(spark.sql(create_db))
            query = <span class="hljs-string">f"SYNC SCHEMA <span class="hljs-subst">{dst_ct_name}</span>.<span class="hljs-subst">{db}</span> from <span class="hljs-subst">{src_ct_name}</span>.<span class="hljs-subst">{db}</span>"</span> <span class="hljs-comment"># SYNC SCHEMA uc_dv.gold from hive_metastore.clean</span>

            <span class="hljs-built_in">print</span>(query)
            display(spark.sql(query))
        <span class="hljs-keyword">elif</span> full_reset == <span class="hljs-literal">False</span>:
            create_db = <span class="hljs-string">f"CREATE DATABASE IF NOT EXISTS <span class="hljs-subst">{dst_ct_name}</span>.<span class="hljs-subst">{db}</span>"</span>
            display(spark.sql(create_db))
            query = <span class="hljs-string">f"SYNC SCHEMA <span class="hljs-subst">{dst_ct_name}</span>.<span class="hljs-subst">{db}</span> from <span class="hljs-subst">{src_ct_name}</span>.<span class="hljs-subst">{db}</span>"</span> <span class="hljs-comment"># SYNC SCHEMA uc_dv.gold from hive_metastore.clean</span>

            <span class="hljs-built_in">print</span>(query)
            display(spark.sql(query))
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"재설정 모드를 제공해주세요"</span>)

    <span class="hljs-keyword">with</span> concurrent.futures.ThreadPoolExecutor() <span class="hljs-keyword">as</span> executor:
        futures = [executor.submit(process_database, db, full_reset) <span class="hljs-keyword">for</span> db <span class="hljs-keyword">in</span> databases]
        <span class="hljs-comment"># 모든 futures가 완료되기를 기다림</span>
        <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> concurrent.futures.as_completed(futures):
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 각 future의 결과를 가져옴</span>
                result = future.result()
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                <span class="hljs-comment"># 발생한 예외 처리</span>
                <span class="hljs-keyword">pass</span>
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>아래 코드는 다음 작업을 수행합니다:</p>
<pre><code class="hljs language-js">src_ct_name       = <span class="hljs-string">"hive_metastore"</span>
src_databases     = spark.<span class="hljs-title function_">sql</span>(f<span class="hljs-string">"SHOW DATABASES IN {src_ct_name}"</span>).<span class="hljs-title function_">collect</span>()
dst_ct_name       = <span class="hljs-string">"uc_dv"</span> #spark.<span class="hljs-title function_">sql</span>(<span class="hljs-string">"SELECT current_catalog()"</span>).<span class="hljs-title function_">collect</span>()[<span class="hljs-number">0</span>][<span class="hljs-string">'current_catalog()'</span>]
exclude_databases = [<span class="hljs-string">"poc"</span>, <span class="hljs-string">"temp_tbd"</span>, <span class="hljs-string">"default"</span>]
full_reset         = <span class="hljs-title class_">False</span>

<span class="hljs-title function_">migrate_tables_to_unity_catalog</span>(src_ct_name,src_databases,dst_ct_name,exclude_databases,full_reset)
</code></pre>
<ul>
<li>"src_ct_name" 변수를 정의하여 값 "hive_metastore"를 할당합니다.</li>
<li>Spark를 사용하여 src_ct_name 카탈로그 내의 데이터베이스 목록을 검색하는 SQL 쿼리를 실행하고 결과를 src_databases 변수에 할당합니다.</li>
<li>Spark를 사용하여 현재 카탈로그를 검색하는 SQL 쿼리를 실행하고 결과를 dst_ct_name 변수에 할당합니다.</li>
<li>마이그레이션 프로세스에서 제외될 데이터베이스 이름을 포함하는 "exclude_databases" 목록을 정의합니다.</li>
<li>값이 False인 부울 변수 "full_reset"을 정의합니다.</li>
<li>migrate_tables_to_unity_catalog 함수를 src_ct_name, src_databases, dst_ct_name, exclude_databases 및 full_reset 매개변수로 호출합니다. 이 함수는 소스 카탈로그에서 대상 카탈로그로 테이블을 마이그레이션하는 역할을 합니다.</li>
</ul>
<p>위의 Python 함수는 hive_metastore의 외부 테이블을 unity Catalog로 몇 분 안에 마이그레이션하는 데 유용합니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>위 코드를 Databricks 노트북에 복사하여 Adf나 Databricks 일정으로 매일 실행하면 Unity Catalog로 완전히 마이그레이션할 때까지 도움을 줄 수 있습니다. 예를 들어, hive_metastore에 새 테이블을 추가하면 일정이 자동으로 새로운 테이블을 Unity Catalog에 동기화합니다.</p>
<p>Unity Catalog로의 마이그레이션 여정에 도움이 되기를 바라며, 궁금한 점이 있으시면 언제든지 물어보세요.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"하이브 메타스토어 HMS 스키마를 유니티 카탈로그로 이관하기","description":"","date":"2024-05-27 17:16","slug":"2024-05-27-MigrateHivemetastoreHMSSchematoUnityCatalog","content":"\n\u003cimg src=\"/assets/img/2024-05-27-MigrateHivemetastoreHMSSchematoUnityCatalog_0.png\" /\u003e\n\nHMS에서 Unity Catalog로의 이주 이야기에 오신 것을 환영합니다.\n\n본 글에서는 HMS에서 Unity Catalog로의 이주 과정을 공유하고자 합니다. HMS를 Unity Catalog로 마이그레이션하기 위한 여러 도구들이 있음을 알고 있습니다. 특히 현재 시장에서 인기를 끌고 있는 UCX가 있습니다. 아직 UCX를 탐험해보지는 않았지만, 앞으로 UCX를 살펴볼 예정입니다.\nUCX를 사용해보고 싶다면, https://github.com/databrickslabs/ucx 에서 확인하고 그 경험을 공유해주세요.\n\n본 글의 범위\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 외부 테이블을 Unity 카탈로그로 이주합니다.\n\n이 글에서 다루겠습니다.\n\n- 관리형 테이블을 Unity 카탈로그로 이주합니다.\n  https://medium.com/@data_engineering_0216/migrate-managed-table-to-unity-catalog-ab4dbba9d6aa\n- 뷰를 Unity 카탈로그로 이주합니다.\n  https://medium.com/@data_engineering_0216/migrate-views-from-hive-metastore-to-unity-catalog-7aac5ec1da50\n- 메타데이터 기반 권한 관리\n  https://medium.com/@data_engineering_0216/unity-catalog-permissions-f1e6221cbc68\n- https://learn.microsoft.com/en-us/azure/databricks/data-governance/unity-catalog/migrate\n\n외부 테이블을 Unity 카탈로그로 이주합니다.\n\n준비물\n\n- 메타스토어 또는 카탈로그 관리자 권한\n- Unity 카탈로그가 활성화된 Databricks 워크스페이스\n- Unity 카탈로그가 활성화된 클러스터\n- Databricks 접근 커넥터\n- 마운트 지점과 동등한 스토리지 자격 증명 및 외부 위치(읽기 및 쓰기 권한 필요)\n- 워크스페이스 또는 클러스터 수준에서 기본 카탈로그 설정: 선택 사항\n  클러스터 구성: spark.databricks.sql.initial.catalog.name gold_dv\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n솔루션을 깊이 살펴보겠습니다. 사용자 정의 Python 함수인 migrate_tables_to_unity_catalog을 살펴봅시다. 이 코드는 외부 테이블을 하나의 (hive_metastore) 카탈로그에서 다른 카탈로그(Unity Catalog)로 동기화하는 함수를 정의합니다.\n\n이 함수는 다음과 같은 매개변수를 사용합니다:\n\n- src_ct_name: 원본 카탈로그의 이름.\n- src_databases: 원본 카탈로그에서 가져온 데이터베이스 사전의 목록.\n- dst_ct_name: 대상 카탈로그의 이름.\n- exclude_databases: 마이그레이션에서 제외할 데이터베이스 이름의 목록.\n- full_reset: 전체 리셋을 수행해야 하는지 여부를 나타내는 부울 플래그.\n\n이 함수는 먼저 src_databases 매개변수에서 데이터베이스 이름 목록을 작성합니다. 제외할 데이터베이스가 있는 경우 해당 데이터베이스를 목록에서 필터링합니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n그럼, 각 데이터베이스를 처리하는 process_database 내부 함수를 정의합니다. full_reset이 True 인 경우, 대상 카탈로그의 데이터베이스를 삭제하고 새 데이터베이스를 생성한 후 소스 카탈로그에서 대상 카탈로그로 스키마를 동기화합니다. full_reset이 False 인 경우, 새 데이터베이스를 생성하고 스키마를 동기화합니다. full_reset이 제공되지 않은 경우, 재설정 모드를 요청하는 메시지를 출력합니다.\n\nconcurrent.futures.ThreadPoolExecutor를 사용하여 함수는 각 데이터베이스를 병렬로 처리하도록 제출합니다. 모든 futures가 완료되기를 기다리고 처리 중 발생한 예외를 처리합니다.\n\n이 함수를 사용하려면 필요한 매개변수를 제공하고 함수를 호출해야 합니다.\n\n```python\nimport concurrent.futures\n\n\ndef migrate_tables_to_unity_catalog(src_ct_name, src_databases, dst_ct_name, exclude_databases, full_reset):\n    \"\"\"\n    한 카탈로그에서 다른 카탈로그로 관리되는 모든 테이블을 복사합니다.\n\n    매개변수:\n        src_ct_name (str): 원본 카탈로그의 이름.\n        src_databases (list): 원본 카탈로그에서의 데이터베이스 딕셔너리 목록.\n        dst_ct_name (str): 대상 카탈로그의 이름.\n        exclude_databases (list): 마이그레이션에서 제외할 데이터베이스 이름 목록.\n\n    반환:\n        None\n\n    예외:\n        None\n\n    예시:\n        src_ct_name       = \"hive_metastore\"\n        src_databases     = spark.sql(f\"SHOW DATABASES IN {src_ct_name}\").collect()\n        dst_ct_name       = \"uc_dv\"\n        exclude_databases = [\"poc\", \"temp_tbd\", \"default\"]\n        migrate_managed_tables_to_unity_catalog(src_ct_name, src_databases, dst_ct_name, exclude_databases)\n\n    \"\"\"\n\n    list_of_db = []\n    for db in src_databases:\n        dbName = db['databaseName']\n        list_of_db.append(dbName)\n    if exclude_databases:\n        databases = [x for x in list_of_db if x not in exclude_databases]\n    else:\n        databases = list_of_db\n\n    print(databases)\n\n    def process_database(db, full_reset):\n\n        if full_reset == True:\n            drop_db = f\"DROP DATABASE IF EXISTS {dst_ct_name}.{db} CASCADE\"\n            display(spark.sql(drop_db))\n            create_db = f\"CREATE DATABASE IF NOT EXISTS {dst_ct_name}.{db}\"\n            display(spark.sql(create_db))\n            query = f\"SYNC SCHEMA {dst_ct_name}.{db} from {src_ct_name}.{db}\" # SYNC SCHEMA uc_dv.gold from hive_metastore.clean\n\n            print(query)\n            display(spark.sql(query))\n        elif full_reset == False:\n            create_db = f\"CREATE DATABASE IF NOT EXISTS {dst_ct_name}.{db}\"\n            display(spark.sql(create_db))\n            query = f\"SYNC SCHEMA {dst_ct_name}.{db} from {src_ct_name}.{db}\" # SYNC SCHEMA uc_dv.gold from hive_metastore.clean\n\n            print(query)\n            display(spark.sql(query))\n        else:\n            print(\"재설정 모드를 제공해주세요\")\n\n    with concurrent.futures.ThreadPoolExecutor() as executor:\n        futures = [executor.submit(process_database, db, full_reset) for db in databases]\n        # 모든 futures가 완료되기를 기다림\n        for future in concurrent.futures.as_completed(futures):\n            try:\n                # 각 future의 결과를 가져옴\n                result = future.result()\n            except Exception as e:\n                # 발생한 예외 처리\n                pass\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n아래 코드는 다음 작업을 수행합니다:\n\n```js\nsrc_ct_name       = \"hive_metastore\"\nsrc_databases     = spark.sql(f\"SHOW DATABASES IN {src_ct_name}\").collect()\ndst_ct_name       = \"uc_dv\" #spark.sql(\"SELECT current_catalog()\").collect()[0]['current_catalog()']\nexclude_databases = [\"poc\", \"temp_tbd\", \"default\"]\nfull_reset         = False\n\nmigrate_tables_to_unity_catalog(src_ct_name,src_databases,dst_ct_name,exclude_databases,full_reset)\n```\n\n- \"src_ct_name\" 변수를 정의하여 값 \"hive_metastore\"를 할당합니다.\n- Spark를 사용하여 src_ct_name 카탈로그 내의 데이터베이스 목록을 검색하는 SQL 쿼리를 실행하고 결과를 src_databases 변수에 할당합니다.\n- Spark를 사용하여 현재 카탈로그를 검색하는 SQL 쿼리를 실행하고 결과를 dst_ct_name 변수에 할당합니다.\n- 마이그레이션 프로세스에서 제외될 데이터베이스 이름을 포함하는 \"exclude_databases\" 목록을 정의합니다.\n- 값이 False인 부울 변수 \"full_reset\"을 정의합니다.\n- migrate_tables_to_unity_catalog 함수를 src_ct_name, src_databases, dst_ct_name, exclude_databases 및 full_reset 매개변수로 호출합니다. 이 함수는 소스 카탈로그에서 대상 카탈로그로 테이블을 마이그레이션하는 역할을 합니다.\n\n위의 Python 함수는 hive_metastore의 외부 테이블을 unity Catalog로 몇 분 안에 마이그레이션하는 데 유용합니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n위 코드를 Databricks 노트북에 복사하여 Adf나 Databricks 일정으로 매일 실행하면 Unity Catalog로 완전히 마이그레이션할 때까지 도움을 줄 수 있습니다. 예를 들어, hive_metastore에 새 테이블을 추가하면 일정이 자동으로 새로운 테이블을 Unity Catalog에 동기화합니다.\n\nUnity Catalog로의 마이그레이션 여정에 도움이 되기를 바라며, 궁금한 점이 있으시면 언제든지 물어보세요.\n","ogImage":{"url":"/assets/img/2024-05-27-MigrateHivemetastoreHMSSchematoUnityCatalog_0.png"},"coverImage":"/assets/img/2024-05-27-MigrateHivemetastoreHMSSchematoUnityCatalog_0.png","tag":["Tech"],"readingTime":8},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cimg src=\"/assets/img/2024-05-27-MigrateHivemetastoreHMSSchematoUnityCatalog_0.png\"\u003e\n\u003cp\u003eHMS에서 Unity Catalog로의 이주 이야기에 오신 것을 환영합니다.\u003c/p\u003e\n\u003cp\u003e본 글에서는 HMS에서 Unity Catalog로의 이주 과정을 공유하고자 합니다. HMS를 Unity Catalog로 마이그레이션하기 위한 여러 도구들이 있음을 알고 있습니다. 특히 현재 시장에서 인기를 끌고 있는 UCX가 있습니다. 아직 UCX를 탐험해보지는 않았지만, 앞으로 UCX를 살펴볼 예정입니다.\nUCX를 사용해보고 싶다면, \u003ca href=\"https://github.com/databrickslabs/ucx\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://github.com/databrickslabs/ucx\u003c/a\u003e 에서 확인하고 그 경험을 공유해주세요.\u003c/p\u003e\n\u003cp\u003e본 글의 범위\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e외부 테이블을 Unity 카탈로그로 이주합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e이 글에서 다루겠습니다.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e관리형 테이블을 Unity 카탈로그로 이주합니다.\n\u003ca href=\"https://medium.com/@data_engineering_0216/migrate-managed-table-to-unity-catalog-ab4dbba9d6aa\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://medium.com/@data_engineering_0216/migrate-managed-table-to-unity-catalog-ab4dbba9d6aa\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e뷰를 Unity 카탈로그로 이주합니다.\n\u003ca href=\"https://medium.com/@data_engineering_0216/migrate-views-from-hive-metastore-to-unity-catalog-7aac5ec1da50\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://medium.com/@data_engineering_0216/migrate-views-from-hive-metastore-to-unity-catalog-7aac5ec1da50\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e메타데이터 기반 권한 관리\n\u003ca href=\"https://medium.com/@data_engineering_0216/unity-catalog-permissions-f1e6221cbc68\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://medium.com/@data_engineering_0216/unity-catalog-permissions-f1e6221cbc68\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://learn.microsoft.com/en-us/azure/databricks/data-governance/unity-catalog/migrate\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://learn.microsoft.com/en-us/azure/databricks/data-governance/unity-catalog/migrate\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e외부 테이블을 Unity 카탈로그로 이주합니다.\u003c/p\u003e\n\u003cp\u003e준비물\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e메타스토어 또는 카탈로그 관리자 권한\u003c/li\u003e\n\u003cli\u003eUnity 카탈로그가 활성화된 Databricks 워크스페이스\u003c/li\u003e\n\u003cli\u003eUnity 카탈로그가 활성화된 클러스터\u003c/li\u003e\n\u003cli\u003eDatabricks 접근 커넥터\u003c/li\u003e\n\u003cli\u003e마운트 지점과 동등한 스토리지 자격 증명 및 외부 위치(읽기 및 쓰기 권한 필요)\u003c/li\u003e\n\u003cli\u003e워크스페이스 또는 클러스터 수준에서 기본 카탈로그 설정: 선택 사항\n클러스터 구성: spark.databricks.sql.initial.catalog.name gold_dv\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e솔루션을 깊이 살펴보겠습니다. 사용자 정의 Python 함수인 migrate_tables_to_unity_catalog을 살펴봅시다. 이 코드는 외부 테이블을 하나의 (hive_metastore) 카탈로그에서 다른 카탈로그(Unity Catalog)로 동기화하는 함수를 정의합니다.\u003c/p\u003e\n\u003cp\u003e이 함수는 다음과 같은 매개변수를 사용합니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003esrc_ct_name: 원본 카탈로그의 이름.\u003c/li\u003e\n\u003cli\u003esrc_databases: 원본 카탈로그에서 가져온 데이터베이스 사전의 목록.\u003c/li\u003e\n\u003cli\u003edst_ct_name: 대상 카탈로그의 이름.\u003c/li\u003e\n\u003cli\u003eexclude_databases: 마이그레이션에서 제외할 데이터베이스 이름의 목록.\u003c/li\u003e\n\u003cli\u003efull_reset: 전체 리셋을 수행해야 하는지 여부를 나타내는 부울 플래그.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e이 함수는 먼저 src_databases 매개변수에서 데이터베이스 이름 목록을 작성합니다. 제외할 데이터베이스가 있는 경우 해당 데이터베이스를 목록에서 필터링합니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e그럼, 각 데이터베이스를 처리하는 process_database 내부 함수를 정의합니다. full_reset이 True 인 경우, 대상 카탈로그의 데이터베이스를 삭제하고 새 데이터베이스를 생성한 후 소스 카탈로그에서 대상 카탈로그로 스키마를 동기화합니다. full_reset이 False 인 경우, 새 데이터베이스를 생성하고 스키마를 동기화합니다. full_reset이 제공되지 않은 경우, 재설정 모드를 요청하는 메시지를 출력합니다.\u003c/p\u003e\n\u003cp\u003econcurrent.futures.ThreadPoolExecutor를 사용하여 함수는 각 데이터베이스를 병렬로 처리하도록 제출합니다. 모든 futures가 완료되기를 기다리고 처리 중 발생한 예외를 처리합니다.\u003c/p\u003e\n\u003cp\u003e이 함수를 사용하려면 필요한 매개변수를 제공하고 함수를 호출해야 합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e concurrent.futures\n\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003emigrate_tables_to_unity_catalog\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esrc_ct_name, src_databases, dst_ct_name, exclude_databases, full_reset\u003c/span\u003e):\n    \u003cspan class=\"hljs-string\"\u003e\"\"\"\n    한 카탈로그에서 다른 카탈로그로 관리되는 모든 테이블을 복사합니다.\n\n    매개변수:\n        src_ct_name (str): 원본 카탈로그의 이름.\n        src_databases (list): 원본 카탈로그에서의 데이터베이스 딕셔너리 목록.\n        dst_ct_name (str): 대상 카탈로그의 이름.\n        exclude_databases (list): 마이그레이션에서 제외할 데이터베이스 이름 목록.\n\n    반환:\n        None\n\n    예외:\n        None\n\n    예시:\n        src_ct_name       = \"hive_metastore\"\n        src_databases     = spark.sql(f\"SHOW DATABASES IN {src_ct_name}\").collect()\n        dst_ct_name       = \"uc_dv\"\n        exclude_databases = [\"poc\", \"temp_tbd\", \"default\"]\n        migrate_managed_tables_to_unity_catalog(src_ct_name, src_databases, dst_ct_name, exclude_databases)\n\n    \"\"\"\u003c/span\u003e\n\n    list_of_db = []\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e db \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e src_databases:\n        dbName = db[\u003cspan class=\"hljs-string\"\u003e'databaseName'\u003c/span\u003e]\n        list_of_db.append(dbName)\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e exclude_databases:\n        databases = [x \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e x \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e list_of_db \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e x \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e exclude_databases]\n    \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n        databases = list_of_db\n\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(databases)\n\n    \u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eprocess_database\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003edb, full_reset\u003c/span\u003e):\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e full_reset == \u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e:\n            drop_db = \u003cspan class=\"hljs-string\"\u003ef\"DROP DATABASE IF EXISTS \u003cspan class=\"hljs-subst\"\u003e{dst_ct_name}\u003c/span\u003e.\u003cspan class=\"hljs-subst\"\u003e{db}\u003c/span\u003e CASCADE\"\u003c/span\u003e\n            display(spark.sql(drop_db))\n            create_db = \u003cspan class=\"hljs-string\"\u003ef\"CREATE DATABASE IF NOT EXISTS \u003cspan class=\"hljs-subst\"\u003e{dst_ct_name}\u003c/span\u003e.\u003cspan class=\"hljs-subst\"\u003e{db}\u003c/span\u003e\"\u003c/span\u003e\n            display(spark.sql(create_db))\n            query = \u003cspan class=\"hljs-string\"\u003ef\"SYNC SCHEMA \u003cspan class=\"hljs-subst\"\u003e{dst_ct_name}\u003c/span\u003e.\u003cspan class=\"hljs-subst\"\u003e{db}\u003c/span\u003e from \u003cspan class=\"hljs-subst\"\u003e{src_ct_name}\u003c/span\u003e.\u003cspan class=\"hljs-subst\"\u003e{db}\u003c/span\u003e\"\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e# SYNC SCHEMA uc_dv.gold from hive_metastore.clean\u003c/span\u003e\n\n            \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(query)\n            display(spark.sql(query))\n        \u003cspan class=\"hljs-keyword\"\u003eelif\u003c/span\u003e full_reset == \u003cspan class=\"hljs-literal\"\u003eFalse\u003c/span\u003e:\n            create_db = \u003cspan class=\"hljs-string\"\u003ef\"CREATE DATABASE IF NOT EXISTS \u003cspan class=\"hljs-subst\"\u003e{dst_ct_name}\u003c/span\u003e.\u003cspan class=\"hljs-subst\"\u003e{db}\u003c/span\u003e\"\u003c/span\u003e\n            display(spark.sql(create_db))\n            query = \u003cspan class=\"hljs-string\"\u003ef\"SYNC SCHEMA \u003cspan class=\"hljs-subst\"\u003e{dst_ct_name}\u003c/span\u003e.\u003cspan class=\"hljs-subst\"\u003e{db}\u003c/span\u003e from \u003cspan class=\"hljs-subst\"\u003e{src_ct_name}\u003c/span\u003e.\u003cspan class=\"hljs-subst\"\u003e{db}\u003c/span\u003e\"\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e# SYNC SCHEMA uc_dv.gold from hive_metastore.clean\u003c/span\u003e\n\n            \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(query)\n            display(spark.sql(query))\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n            \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"재설정 모드를 제공해주세요\"\u003c/span\u003e)\n\n    \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e concurrent.futures.ThreadPoolExecutor() \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e executor:\n        futures = [executor.submit(process_database, db, full_reset) \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e db \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e databases]\n        \u003cspan class=\"hljs-comment\"\u003e# 모든 futures가 완료되기를 기다림\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e future \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e concurrent.futures.as_completed(futures):\n            \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e:\n                \u003cspan class=\"hljs-comment\"\u003e# 각 future의 결과를 가져옴\u003c/span\u003e\n                result = future.result()\n            \u003cspan class=\"hljs-keyword\"\u003eexcept\u003c/span\u003e Exception \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e e:\n                \u003cspan class=\"hljs-comment\"\u003e# 발생한 예외 처리\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003epass\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e아래 코드는 다음 작업을 수행합니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003esrc_ct_name       = \u003cspan class=\"hljs-string\"\u003e\"hive_metastore\"\u003c/span\u003e\nsrc_databases     = spark.\u003cspan class=\"hljs-title function_\"\u003esql\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"SHOW DATABASES IN {src_ct_name}\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ecollect\u003c/span\u003e()\ndst_ct_name       = \u003cspan class=\"hljs-string\"\u003e\"uc_dv\"\u003c/span\u003e #spark.\u003cspan class=\"hljs-title function_\"\u003esql\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"SELECT current_catalog()\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ecollect\u003c/span\u003e()[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e'current_catalog()'\u003c/span\u003e]\nexclude_databases = [\u003cspan class=\"hljs-string\"\u003e\"poc\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"temp_tbd\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"default\"\u003c/span\u003e]\nfull_reset         = \u003cspan class=\"hljs-title class_\"\u003eFalse\u003c/span\u003e\n\n\u003cspan class=\"hljs-title function_\"\u003emigrate_tables_to_unity_catalog\u003c/span\u003e(src_ct_name,src_databases,dst_ct_name,exclude_databases,full_reset)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\"src_ct_name\" 변수를 정의하여 값 \"hive_metastore\"를 할당합니다.\u003c/li\u003e\n\u003cli\u003eSpark를 사용하여 src_ct_name 카탈로그 내의 데이터베이스 목록을 검색하는 SQL 쿼리를 실행하고 결과를 src_databases 변수에 할당합니다.\u003c/li\u003e\n\u003cli\u003eSpark를 사용하여 현재 카탈로그를 검색하는 SQL 쿼리를 실행하고 결과를 dst_ct_name 변수에 할당합니다.\u003c/li\u003e\n\u003cli\u003e마이그레이션 프로세스에서 제외될 데이터베이스 이름을 포함하는 \"exclude_databases\" 목록을 정의합니다.\u003c/li\u003e\n\u003cli\u003e값이 False인 부울 변수 \"full_reset\"을 정의합니다.\u003c/li\u003e\n\u003cli\u003emigrate_tables_to_unity_catalog 함수를 src_ct_name, src_databases, dst_ct_name, exclude_databases 및 full_reset 매개변수로 호출합니다. 이 함수는 소스 카탈로그에서 대상 카탈로그로 테이블을 마이그레이션하는 역할을 합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e위의 Python 함수는 hive_metastore의 외부 테이블을 unity Catalog로 몇 분 안에 마이그레이션하는 데 유용합니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e위 코드를 Databricks 노트북에 복사하여 Adf나 Databricks 일정으로 매일 실행하면 Unity Catalog로 완전히 마이그레이션할 때까지 도움을 줄 수 있습니다. 예를 들어, hive_metastore에 새 테이블을 추가하면 일정이 자동으로 새로운 테이블을 Unity Catalog에 동기화합니다.\u003c/p\u003e\n\u003cp\u003eUnity Catalog로의 마이그레이션 여정에 도움이 되기를 바라며, 궁금한 점이 있으시면 언제든지 물어보세요.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-27-MigrateHivemetastoreHMSSchematoUnityCatalog"},"buildId":"JlBEgQDLGRx6DYlBnT8eD","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>