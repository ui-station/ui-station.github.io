<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>아마존 S3 프리사인드 URL 활용 방법 | ui-station</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://ui-station.github.io///post/2024-05-20-HowtoutilizeAmazonS3presignedURLs" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="아마존 S3 프리사인드 URL 활용 방법 | ui-station" data-gatsby-head="true"/><meta property="og:title" content="아마존 S3 프리사인드 URL 활용 방법 | ui-station" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://ui-station.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://ui-station.github.io///post/2024-05-20-HowtoutilizeAmazonS3presignedURLs" data-gatsby-head="true"/><meta name="twitter:title" content="아마존 S3 프리사인드 URL 활용 방법 | ui-station" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | ui-station" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-20 16:44" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BHFR6GTH9P"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-BHFR6GTH9P');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/_next/static/chunks/348-d11c34b645b13f5b.js" defer=""></script><script src="/_next/static/chunks/162-4172e84c8e2aa747.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-4f7b40c1114f0d09.js" defer=""></script><script src="/_next/static/-dPCbnM2yhdKNgXe92VJV/_buildManifest.js" defer=""></script><script src="/_next/static/-dPCbnM2yhdKNgXe92VJV/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UI STATION</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">아마존 S3 프리사인드 URL 활용 방법</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="아마존 S3 프리사인드 URL 활용 방법" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UI STATION</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 20, 2024</span><span class="posts_reading_time__f7YPP">13<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-20-HowtoutilizeAmazonS3presignedURLs&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>블롭 객체를 안전하게 저장하는 것은 중요합니다. AWS S3는 이를 위한 우수한 해결책을 제공합니다. 여러 언어로 제공되는 사용자 친화적인 SDK를 통해 파일을 업로드하고 다운로드하는 과정이 간단해집니다. 그러나 민감한 계정 자격 증명에 접속해야 하는 경우가 발생할 수 있습니다. 이런 상황에서 사전 서명된 URL은 귀중한 해결책으로 나타납니다. 이 URL은 AWS S3 버킷 리소스에 일시적으로 접속할 수 있는 수단을 제공하여 비밀 키를 직접 삽입할 필요가 없어집니다. 이 URL은 데이터 무결성을 보호하면서 보안을 보장하는 안전하고 일시적인 접근을 가능케 합니다.</p>
<p>본 글에서는 파일을 업로드하고 다운로드하는 용도로 사전 서명된 URL을 사용하는 방법을 설명하여 AWS S3를 효과적으로 활용하면서 데이터 보안의 실천을 유지할 수 있도록 돕고 있습니다.</p>
<h1>사용 사례</h1>
<p>다음은 사전 서명된 URL을 활용할 수 있는 여러 사용 사례입니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ul>
<li>일시적 액세스를 통한 다운로드 링크: 사전 서명된 GET URL을 생성하여 S3 버킷에서 특정 파일을 다운로드하는 데 일시적인 액세스를 제공할 수 있습니다. 이를 통해 AWS 자격 증명을 노출시키지 않고 다른 사람들과 파일을 안전하게 공유할 수 있습니다.</li>
<li>일시적 슬롯을 통한 업로드 링크: 비슷하게, 사전 서명된 PUT URL은 S3 버킷으로 파일을 업로드하는 데 일시적인 액세스를 제공하는 데 사용할 수 있습니다. 이를 통해 사용자들이 직접 AWS 자격 증명에 접근할 필요없이 파일을 안전하게 업로드할 수 있습니다.</li>
<li>가상 머신 보안: 부팅할 때 가상 머신에 사전 서명된 POST 정책을 삽입하여 지정된 조건하에 여러 파일을 S3 버킷에 안전하게 업로드할 수 있습니다. 이 접근 방식은 민감한 AWS 자격 증명이 가상 머신에 저장되지 않도록 보안을 강화합니다.</li>
<li>HTML 폼으로 직접 파일 업로드: HTML 폼에 사전 서명된 POST 정책을 삽입하여 백엔드 서버를 프록시로 사용하지 않고 S3 버킷으로의 직접 파일 업로드를 허용할 수 있습니다. 이를 통해 업로드 프로세스를 간소화하고 서버 측 처리를 줄일 수 있습니다.</li>
</ul>
<p>AWS S3 사전 서명된 URL을 사용하면 PUT 또는 POST 정책을 사용하여 단일 또는 여러 파일을 업로드할 수 있습니다. 다수의 파일을 다운로드할 수 있는 정책을 생성하는 것은 불가능합니다. 이 경우에는 여러 개의 사전 서명된 GET URL을 생성해야 합니다.</p>
<p><a href="/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_0.png">2024-05-20-HowtoutilizeAmazonS3presignedURLs_0.png</a></p>
<p>단일 파일을 다운로드하거나 업로드하기 위해, 파일 업로드가 필요한 구성 요소가 필요할 때 외부 서비스로부터 사전 서명된 URL을 동적으로 요청할 수 있는 풀 기반 아키텍처가 탁월합니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p><img src="/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_1.png" alt="image1"></p>
<p>Conversely, for scenarios such as uploading using HTML form or running specific jobs within a virtual machine, a push-based approach presents a straightforward solution. Here, the initiation of the presigned POST policy aligns with the document creation or VM startup process. By injecting a policy during these events, we empower the source to autonomously upload files and minimize external dependencies.</p>
<p><img src="/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_2.png" alt="image2"></p>
<h1>How-to guide</h1>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>파이썬 boto 패키지를 사용하여 미리 서명된 URL을 생성하고 사용하는 방법을 보여드립니다. 간단한 인터페이스를 제공하는 AWS S3 클라이언트입니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> os

<span class="hljs-keyword">import</span> boto3
<span class="hljs-keyword">from</span> botocore.<span class="hljs-property">client</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">Config</span>

<span class="hljs-variable constant_">ACCESS_KEY</span> = os.<span class="hljs-title function_">getenv</span>(<span class="hljs-string">"ACCESS_KEY"</span>)
<span class="hljs-variable constant_">SECRET_KEY</span> = os.<span class="hljs-title function_">getenv</span>(<span class="hljs-string">"SECRET_KEY"</span>)
region = <span class="hljs-string">"eu-central-1"</span>

s3_client = boto3.<span class="hljs-title function_">client</span>(
    <span class="hljs-string">'s3'</span>,
    aws_access_key_id=<span class="hljs-variable constant_">ACCESS_KEY</span>,
    aws_secret_access_key=<span class="hljs-variable constant_">SECRET_KEY</span>,
    config=<span class="hljs-title class_">Config</span>(signature_version=<span class="hljs-string">'s3v4'</span>),
    region_name=region,
)
</code></pre>
<p>물론 AWS S3 클라우드에도 액세스해야합니다. 이전 포스트 중 하나에서 IAM 계정 및 S3 버킷을 생성하는 방법을 설명했습니다. 이 포스트는 AWS S3 업로드에 대한 자동화 테스트에 관한 것입니다.</p>
<h1>Presigned POST policy</h1>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>미리 서명된 POST URL에서는 여러 파일을 업로드할 수 있는 정책을 구성합니다. 다음을 정의할 수 있습니다:</p>
<ul>
<li>S3 버킷 파일이 저장될 위치 — bucket_name</li>
<li>정책의 유효 기간 — ExpiresIn</li>
<li>추가로 허용할 폼 필드 — Fields</li>
<li>추가 조건 세트 — Conditions (예: 파일의 허용 확장자, 파일 이름의 허용 접두사)</li>
</ul>
<p>우리의 예시에서는 정책이 생성 시간으로부터 1분(60초) 후에 만료될 것이라고 지정합니다. 또한 mytest/ 문자열로 시작하는 키를 가진 파일만 허용합니다. Amazon S3에서 키(객체 이름이라고도 함)는 버킷 내 객체의 고유 식별자로 사용됩니다. 이것은 본질적으로 버킷의 네임스페이스 내 객체의 전체 경로를 나타냅니다. 이 구성은 testjorzel 버킷 내 mytest 폴더로 파일을 업로드할 수 있도록 허용합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> requests

bucket_name = <span class="hljs-string">"testjorzel"</span>
prefix = <span class="hljs-string">"mytest/"</span>
object_name = prefix + <span class="hljs-string">"${filename}"</span>
presigned_post = s3_client.<span class="hljs-title function_">generate_presigned_post</span>(
    bucket_name,
    object_name,
    <span class="hljs-title class_">Fields</span>=<span class="hljs-title class_">None</span>,
    <span class="hljs-title class_">Conditions</span>=[[<span class="hljs-string">"starts-with"</span>, <span class="hljs-string">"$key"</span>, prefix]],
    <span class="hljs-title class_">ExpiresIn</span>=expiration,
)
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>저희 사전 서명된 POST 정책은 다음과 같이 보입니다:</p>
<pre><code class="hljs language-js">{
    <span class="hljs-string">'url'</span>: <span class="hljs-string">'https://testjorzel.s3.amazonaws.com/'</span>,
    <span class="hljs-string">'fields'</span>: {
        <span class="hljs-string">'key'</span>: <span class="hljs-string">'mytest/${filename}'</span>,
        <span class="hljs-string">'x-amz-algorithm'</span>: <span class="hljs-string">'AWS4-HMAC-SHA256'</span>,
        <span class="hljs-string">'x-amz-credential'</span>: <span class="hljs-string">'AKIAU5USI2VZ3RIF3L5V/20240403/eu-central-1/s3/aws4_request'</span>,
        <span class="hljs-string">'x-amz-date'</span>: <span class="hljs-string">'20240403T201346Z'</span>,
        <span class="hljs-string">'policy'</span>: <span class="hljs-string">'eyJleHBpcmF0aW9uIjogIjIwMjQtMDQtMDNUMjE6MTM6NDZaIiwgImNvbmRpdGlvbnMiOiBbWyJzdGFydHMtd2l0aCIsICIka2V5IiwgIm15dGVzdC8iXSwgeyJidWNrZXQiOiAidGVzdGpvcnplbCJ9LCBbInN0YXJ0cy13aXRoIiwgIiRrZXkiLCAibXl0ZXN0LyJdLCB7IngtYW16LWFsZ29yaXRobSI6ICJBV1M0LUhNQUMtU0hBMjU2In0sIHsieC1hbXotY3JlZGVudGlhbCI6ICJBS0lBVTVVU0kyVlozUklGM0w1Vi8yMDI0MDQwMy9ldS1jZW50cmFsLTEvczMvYXdzNF9yZXF1ZXN0In0sIHsieC1hbXotZGF0ZSI6ICIyMDI0MDQwM1QyMDEzNDZaIn1dfQ=='</span>,
        <span class="hljs-string">'x-amz-signature'</span>: <span class="hljs-string">'672ca05236f727190841b102a73e4d3298b5821b5afbc62cbfba2dad6128c74c'</span>
    }
}
</code></pre>
<p>이는 일반적인 URL과 POST 요청과 함께 전달해야 하는 인증 필드 세트로 구성되어 있습니다(requests.post 함수).</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> requests

def <span class="hljs-title function_">upload_file</span>(filepath, object_name, policy):
    <span class="hljs-keyword">with</span> <span class="hljs-title function_">open</span>(filepath, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> <span class="hljs-attr">f</span>:
        files = {<span class="hljs-string">'file'</span>: (filepath, f)}
        fields = policy[<span class="hljs-string">'fields'</span>]
        fields[<span class="hljs-string">'key'</span>] = object_name
        http_response = requests.<span class="hljs-title function_">post</span>(policy[<span class="hljs-string">'url'</span>], data=fields, files=files)
    <span class="hljs-title function_">print</span>(f<span class="hljs-string">'File: {object_name} uploaded, HTTP status code: {http_response.status_code}, text: {http_response.text}'</span>)

filepath = <span class="hljs-string">"test.txt"</span>
<span class="hljs-title function_">upload_file</span>(filepath, <span class="hljs-string">'mytest/post_test1.txt'</span>, presigned_post)
<span class="hljs-title function_">upload_file</span>(filepath, <span class="hljs-string">'mytest/post_test2.txt'</span>, presigned_post)
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>test.txt 파일은 하나의 줄로 구성된 간단한 텍스트 파일입니다: My test put/get/post. POST 요청이 성공하면 결과는 내용이없는 204 응답 코드여야 합니다. 이는 파일이 성공적으로 업로드되었음을 의미합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-title class_">File</span>: mytest/post_test1.<span class="hljs-property">txt</span> uploaded, <span class="hljs-variable constant_">HTTP</span> status <span class="hljs-attr">code</span>: <span class="hljs-number">204</span>,
<span class="hljs-attr">text</span>:

<span class="hljs-title class_">File</span>: mytest/post_test2.<span class="hljs-property">txt</span> uploaded, <span class="hljs-variable constant_">HTTP</span> status <span class="hljs-attr">code</span>: <span class="hljs-number">204</span>,
<span class="hljs-attr">text</span>:
</code></pre>
<p>우리는 S3 클라우드의 testjorzel 버킷 내용을 확인할 수 있습니다.</p>
<p><img src="/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_3.png" alt="이미지"></p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p><code>Markdown</code> 형식으로 변경된 테이블:</p>

































<table><thead><tr><th>파일 이름</th><th>결과 코드</th><th>메시지</th><th>요청 ID</th><th>호스트 ID</th></tr></thead><tbody><tr><td>post_test1.txt</td><td>200</td><td>-</td><td>-</td><td>-</td></tr><tr><td>post_test2.txt</td><td>200</td><td>-</td><td>-</td><td>-</td></tr><tr><td>post_test3.txt</td><td>403</td><td>AccessDenied</td><td>3GZ7Q2XYK4R9190H</td><td>CAL0rRroo8PjDPvXEKhAa5XB/FKwf0k+dm00Kwr95ri2yaN+Hr/qZgzmnH4Fs/Jmnt45rMBidY8=</td></tr></tbody></table>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">파일 test/post_test4.<span class="hljs-property">txt</span>가 업로드되었습니다. <span class="hljs-variable constant_">HTTP</span> 상태 코드: <span class="hljs-number">403</span>,
텍스트: &#x3C;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?>
<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">Error</span>></span><span class="hljs-tag">&#x3C;<span class="hljs-name">Code</span>></span>AccessDenied<span class="hljs-tag">&#x3C;/<span class="hljs-name">Code</span>></span><span class="hljs-tag">&#x3C;<span class="hljs-name">Message</span>></span>정책에 따라 무효함: 정책 조건 실패: ["starts-with", "$key", "mytest/"]<span class="hljs-tag">&#x3C;/<span class="hljs-name">Message</span>></span><span class="hljs-tag">&#x3C;<span class="hljs-name">RequestId</span>></span>4AKJZREYX4YD17VF<span class="hljs-tag">&#x3C;/<span class="hljs-name">RequestId</span>></span><span class="hljs-tag">&#x3C;<span class="hljs-name">HostId</span>></span>WLz45xZYd7dSgSIi/6SWtWuzPPYF2aCI1oeX8P+RxTdFskeAM6c7g0VH0OwJRVDIEBSmUS8qDnw=<span class="hljs-tag">&#x3C;/<span class="hljs-name">HostId</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">Error</span>></span></span>
</code></pre>
<h1>GET을 위한 사전 서명 된 URL</h1>
<p>S3 버킷에 파일이 있다고 가정하고(예: post_test1.txt), 사전 서명된 GET URL을 생성할 수 있습니다.</p>
<pre><code class="hljs language-js">bucket_name = <span class="hljs-string">"testjorzel"</span>;
prefix = <span class="hljs-string">"mytest/"</span>;
presigned_get = s3_client.<span class="hljs-title function_">generate_presigned_url</span>(
  <span class="hljs-string">"get_object"</span>,
  (<span class="hljs-title class_">Params</span> = {
    <span class="hljs-title class_">Bucket</span>: bucket_name,
    <span class="hljs-title class_">Key</span>: <span class="hljs-string">"mytest/post_test1.txt"</span>,
  }),
  (<span class="hljs-title class_">ExpiresIn</span> = <span class="hljs-number">60</span>)
);
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>아래 URL은 쿼리 문자열에 추가 필드를 포함한 문자열이어야 합니다:</p>
<pre><code class="hljs language-js"><span class="hljs-attr">https</span>:<span class="hljs-comment">//testjorzel.s3.amazonaws.com/mytest/post_test1.txt?X-Amz-Algorithm=AWS4-HMAC-SHA256&#x26;X-Amz-Credential=AKIAU5USI2VZ3RIF3L5V%2F20240403%2Feu-central-1%2Fs3%2Faws4_request&#x26;X-Amz-Date=20240403T203856Z&#x26;X-Amz-Expires=60&#x26;X-Amz-SignedHeaders=host&#x26;X-Amz-Signature=25b531d9eb1ed01afcaaa1ce61fddf36720833e04a239d0ab0c6fa78ce308fa1</span>
</code></pre>
<p>이를 사용하여 파일을 다운로드할 수 있습니다 (request.get을 실행함).</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> requests

def <span class="hljs-title function_">download_file</span>(url):
    response_get = requests.<span class="hljs-title function_">get</span>(url)
    <span class="hljs-title function_">print</span>(f<span class="hljs-string">"다운로드, HTTP 코드: {response_get.status_code}, 내용: '{response_get.text}'"</span>)
    <span class="hljs-keyword">with</span> <span class="hljs-title function_">open</span>(<span class="hljs-string">"presigned_get.txt"</span>, mode=<span class="hljs-string">"wb"</span>) <span class="hljs-keyword">as</span> <span class="hljs-attr">file</span>:
        file.<span class="hljs-title function_">write</span>(response_get.<span class="hljs-property">content</span>)

<span class="hljs-title function_">download_file</span>(presigned_get)
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>파일은 저희 디스크에 presigned_get.txt 이름으로 저장되어야 하며, 응답은 다음과 같아야 합니다:</p>
<pre><code class="hljs language-js">다운로드, <span class="hljs-variable constant_">HTTP</span> 코드: <span class="hljs-number">200</span>, 내용: <span class="hljs-string">'My test put/get/post'</span>
</code></pre>
<h1>PUT을 위한 Presigned URL</h1>
<p>마지막 케이스는 단일 파일을 업로드하기 위한 presigned PUT URL을 생성하는 것입니다 (키: mytest/presigned_put.txt 아래). GET과 비슷하게 동작할 것입니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">bucket_name = <span class="hljs-string">"testjorzel"</span>;
prefix = <span class="hljs-string">"mytest/"</span>;
presigned_put = s3_client.<span class="hljs-title function_">generate_presigned_url</span>(
  <span class="hljs-string">"put_object"</span>,
  (<span class="hljs-title class_">Params</span> = {
    <span class="hljs-title class_">Bucket</span>: bucket_name,
    <span class="hljs-title class_">Key</span>: prefix + <span class="hljs-string">"presigned_put.txt"</span>,
  }),
  (<span class="hljs-title class_">ExpiresIn</span> = <span class="hljs-number">60</span>)
);
</code></pre>
<p>The <code>presigned_put</code> will also be a string:</p>
<p><a href="https://testjorzel.s3.amazonaws.com/mytest/presigned_put.txt?X-Amz-Algorithm=AWS4-HMAC-SHA256&#x26;X-Amz-Credential=AKIAU5USI2VZ3RIF3L5V%2F20240403%2Feu-central-1%2Fs3%2Faws4_request&#x26;X-Amz-Date=20240403T204459Z&#x26;X-Amz-Expires=60&#x26;X-Amz-SignedHeaders=host&#x26;X-Amz-Signature=ed117f655fc007d1572618474b9fc96f1a1820ec705317a6954c6a78730fd769" rel="nofollow" target="_blank">https://testjorzel.s3.amazonaws.com/mytest/presigned_put.txt?X-Amz-Algorithm=AWS4-HMAC-SHA256&#x26;X-Amz-Credential=AKIAU5USI2VZ3RIF3L5V%2F20240403%2Feu-central-1%2Fs3%2Faws4_request&#x26;X-Amz-Date=20240403T204459Z&#x26;X-Amz-Expires=60&#x26;X-Amz-SignedHeaders=host&#x26;X-Amz-Signature=ed117f655fc007d1572618474b9fc96f1a1820ec705317a6954c6a78730fd769</a></p>
<p>Now we can upload a file using <code>requests.put</code> function.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> requests

filepath = <span class="hljs-string">"test.txt"</span>

def <span class="hljs-title function_">upload_file</span>(filepath, presigned_put):
    <span class="hljs-keyword">with</span> <span class="hljs-title function_">open</span>(filepath, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> <span class="hljs-attr">f</span>:
        response_put = requests.<span class="hljs-title function_">put</span>(presigned_put, data=f)
        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"파일 업로드, HTTP 상태 코드: {response_put.status_code}, 내용: '{response_put.text}'"</span>)

<span class="hljs-title function_">upload_file</span>(filepath, presigned_put)
</code></pre>
<p>위 코드의 실행 결과는:</p>
<pre><code class="hljs language-js">파일 업로드, <span class="hljs-variable constant_">HTTP</span> 상태 코드: <span class="hljs-number">200</span>, 내용: <span class="hljs-string">''</span>
</code></pre>
<p>이 파일은 'testjorzel' 버킷에서 찾을 수 있습니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<img src="/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_4.png">
<h1>결론</h1>
<p>이 짧은 가이드에서 우리는 Amazon S3의 사전 서명된 URL의 다양성을 탐구하고, 해당 사용법을 파이썬으로 실제 예제를 통해 보여주었습니다. 단일 파일 및 여러 파일에 대해 둘 다 수행할 수 있는 방법을 보여주었으며, 이는 AWS 자격 증명을 응용 프로그램에 포함시키지 않거나 사용자에게 민감한 AWS 자격 증명을 공유하지 않고 S3에서 파일 업로드 또는 다운로드를 활성화하고자 하는 시나리오에서 특히 유용합니다.</p>
<p>이 주제를 다룬 코드베이스는 여기에서 찾을 수 있습니다.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"아마존 S3 프리사인드 URL 활용 방법","description":"","date":"2024-05-20 16:44","slug":"2024-05-20-HowtoutilizeAmazonS3presignedURLs","content":"\n블롭 객체를 안전하게 저장하는 것은 중요합니다. AWS S3는 이를 위한 우수한 해결책을 제공합니다. 여러 언어로 제공되는 사용자 친화적인 SDK를 통해 파일을 업로드하고 다운로드하는 과정이 간단해집니다. 그러나 민감한 계정 자격 증명에 접속해야 하는 경우가 발생할 수 있습니다. 이런 상황에서 사전 서명된 URL은 귀중한 해결책으로 나타납니다. 이 URL은 AWS S3 버킷 리소스에 일시적으로 접속할 수 있는 수단을 제공하여 비밀 키를 직접 삽입할 필요가 없어집니다. 이 URL은 데이터 무결성을 보호하면서 보안을 보장하는 안전하고 일시적인 접근을 가능케 합니다.\n\n본 글에서는 파일을 업로드하고 다운로드하는 용도로 사전 서명된 URL을 사용하는 방법을 설명하여 AWS S3를 효과적으로 활용하면서 데이터 보안의 실천을 유지할 수 있도록 돕고 있습니다.\n\n# 사용 사례\n\n다음은 사전 서명된 URL을 활용할 수 있는 여러 사용 사례입니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- 일시적 액세스를 통한 다운로드 링크: 사전 서명된 GET URL을 생성하여 S3 버킷에서 특정 파일을 다운로드하는 데 일시적인 액세스를 제공할 수 있습니다. 이를 통해 AWS 자격 증명을 노출시키지 않고 다른 사람들과 파일을 안전하게 공유할 수 있습니다.\n- 일시적 슬롯을 통한 업로드 링크: 비슷하게, 사전 서명된 PUT URL은 S3 버킷으로 파일을 업로드하는 데 일시적인 액세스를 제공하는 데 사용할 수 있습니다. 이를 통해 사용자들이 직접 AWS 자격 증명에 접근할 필요없이 파일을 안전하게 업로드할 수 있습니다.\n- 가상 머신 보안: 부팅할 때 가상 머신에 사전 서명된 POST 정책을 삽입하여 지정된 조건하에 여러 파일을 S3 버킷에 안전하게 업로드할 수 있습니다. 이 접근 방식은 민감한 AWS 자격 증명이 가상 머신에 저장되지 않도록 보안을 강화합니다.\n- HTML 폼으로 직접 파일 업로드: HTML 폼에 사전 서명된 POST 정책을 삽입하여 백엔드 서버를 프록시로 사용하지 않고 S3 버킷으로의 직접 파일 업로드를 허용할 수 있습니다. 이를 통해 업로드 프로세스를 간소화하고 서버 측 처리를 줄일 수 있습니다.\n\nAWS S3 사전 서명된 URL을 사용하면 PUT 또는 POST 정책을 사용하여 단일 또는 여러 파일을 업로드할 수 있습니다. 다수의 파일을 다운로드할 수 있는 정책을 생성하는 것은 불가능합니다. 이 경우에는 여러 개의 사전 서명된 GET URL을 생성해야 합니다.\n\n[2024-05-20-HowtoutilizeAmazonS3presignedURLs_0.png](/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_0.png)\n\n단일 파일을 다운로드하거나 업로드하기 위해, 파일 업로드가 필요한 구성 요소가 필요할 때 외부 서비스로부터 사전 서명된 URL을 동적으로 요청할 수 있는 풀 기반 아키텍처가 탁월합니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n![image1](/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_1.png)\n\nConversely, for scenarios such as uploading using HTML form or running specific jobs within a virtual machine, a push-based approach presents a straightforward solution. Here, the initiation of the presigned POST policy aligns with the document creation or VM startup process. By injecting a policy during these events, we empower the source to autonomously upload files and minimize external dependencies.\n\n![image2](/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_2.png)\n\n# How-to guide\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n파이썬 boto 패키지를 사용하여 미리 서명된 URL을 생성하고 사용하는 방법을 보여드립니다. 간단한 인터페이스를 제공하는 AWS S3 클라이언트입니다.\n\n```js\nimport os\n\nimport boto3\nfrom botocore.client import Config\n\nACCESS_KEY = os.getenv(\"ACCESS_KEY\")\nSECRET_KEY = os.getenv(\"SECRET_KEY\")\nregion = \"eu-central-1\"\n\ns3_client = boto3.client(\n    's3',\n    aws_access_key_id=ACCESS_KEY,\n    aws_secret_access_key=SECRET_KEY,\n    config=Config(signature_version='s3v4'),\n    region_name=region,\n)\n```\n\n물론 AWS S3 클라우드에도 액세스해야합니다. 이전 포스트 중 하나에서 IAM 계정 및 S3 버킷을 생성하는 방법을 설명했습니다. 이 포스트는 AWS S3 업로드에 대한 자동화 테스트에 관한 것입니다.\n\n# Presigned POST policy\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n미리 서명된 POST URL에서는 여러 파일을 업로드할 수 있는 정책을 구성합니다. 다음을 정의할 수 있습니다:\n\n- S3 버킷 파일이 저장될 위치 — bucket_name\n- 정책의 유효 기간 — ExpiresIn\n- 추가로 허용할 폼 필드 — Fields\n- 추가 조건 세트 — Conditions (예: 파일의 허용 확장자, 파일 이름의 허용 접두사)\n\n우리의 예시에서는 정책이 생성 시간으로부터 1분(60초) 후에 만료될 것이라고 지정합니다. 또한 mytest/ 문자열로 시작하는 키를 가진 파일만 허용합니다. Amazon S3에서 키(객체 이름이라고도 함)는 버킷 내 객체의 고유 식별자로 사용됩니다. 이것은 본질적으로 버킷의 네임스페이스 내 객체의 전체 경로를 나타냅니다. 이 구성은 testjorzel 버킷 내 mytest 폴더로 파일을 업로드할 수 있도록 허용합니다.\n\n```js\nimport requests\n\nbucket_name = \"testjorzel\"\nprefix = \"mytest/\"\nobject_name = prefix + \"${filename}\"\npresigned_post = s3_client.generate_presigned_post(\n    bucket_name,\n    object_name,\n    Fields=None,\n    Conditions=[[\"starts-with\", \"$key\", prefix]],\n    ExpiresIn=expiration,\n)\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n저희 사전 서명된 POST 정책은 다음과 같이 보입니다:\n\n```js\n{\n    'url': 'https://testjorzel.s3.amazonaws.com/',\n    'fields': {\n        'key': 'mytest/${filename}',\n        'x-amz-algorithm': 'AWS4-HMAC-SHA256',\n        'x-amz-credential': 'AKIAU5USI2VZ3RIF3L5V/20240403/eu-central-1/s3/aws4_request',\n        'x-amz-date': '20240403T201346Z',\n        'policy': 'eyJleHBpcmF0aW9uIjogIjIwMjQtMDQtMDNUMjE6MTM6NDZaIiwgImNvbmRpdGlvbnMiOiBbWyJzdGFydHMtd2l0aCIsICIka2V5IiwgIm15dGVzdC8iXSwgeyJidWNrZXQiOiAidGVzdGpvcnplbCJ9LCBbInN0YXJ0cy13aXRoIiwgIiRrZXkiLCAibXl0ZXN0LyJdLCB7IngtYW16LWFsZ29yaXRobSI6ICJBV1M0LUhNQUMtU0hBMjU2In0sIHsieC1hbXotY3JlZGVudGlhbCI6ICJBS0lBVTVVU0kyVlozUklGM0w1Vi8yMDI0MDQwMy9ldS1jZW50cmFsLTEvczMvYXdzNF9yZXF1ZXN0In0sIHsieC1hbXotZGF0ZSI6ICIyMDI0MDQwM1QyMDEzNDZaIn1dfQ==',\n        'x-amz-signature': '672ca05236f727190841b102a73e4d3298b5821b5afbc62cbfba2dad6128c74c'\n    }\n}\n```\n\n이는 일반적인 URL과 POST 요청과 함께 전달해야 하는 인증 필드 세트로 구성되어 있습니다(requests.post 함수).\n\n```js\nimport requests\n\ndef upload_file(filepath, object_name, policy):\n    with open(filepath, 'rb') as f:\n        files = {'file': (filepath, f)}\n        fields = policy['fields']\n        fields['key'] = object_name\n        http_response = requests.post(policy['url'], data=fields, files=files)\n    print(f'File: {object_name} uploaded, HTTP status code: {http_response.status_code}, text: {http_response.text}')\n\nfilepath = \"test.txt\"\nupload_file(filepath, 'mytest/post_test1.txt', presigned_post)\nupload_file(filepath, 'mytest/post_test2.txt', presigned_post)\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\ntest.txt 파일은 하나의 줄로 구성된 간단한 텍스트 파일입니다: My test put/get/post. POST 요청이 성공하면 결과는 내용이없는 204 응답 코드여야 합니다. 이는 파일이 성공적으로 업로드되었음을 의미합니다.\n\n```js\nFile: mytest/post_test1.txt uploaded, HTTP status code: 204,\ntext:\n\nFile: mytest/post_test2.txt uploaded, HTTP status code: 204,\ntext:\n```\n\n우리는 S3 클라우드의 testjorzel 버킷 내용을 확인할 수 있습니다.\n\n![이미지](/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_3.png)\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n`Markdown` 형식으로 변경된 테이블:\n\n| 파일 이름      | 결과 코드 | 메시지       | 요청 ID          | 호스트 ID                                                                    |\n| -------------- | --------- | ------------ | ---------------- | ---------------------------------------------------------------------------- |\n| post_test1.txt | 200       | -            | -                | -                                                                            |\n| post_test2.txt | 200       | -            | -                | -                                                                            |\n| post_test3.txt | 403       | AccessDenied | 3GZ7Q2XYK4R9190H | CAL0rRroo8PjDPvXEKhAa5XB/FKwf0k+dm00Kwr95ri2yaN+Hr/qZgzmnH4Fs/Jmnt45rMBidY8= |\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n파일 test/post_test4.txt가 업로드되었습니다. HTTP 상태 코드: 403,\n텍스트: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cError\u003e\u003cCode\u003eAccessDenied\u003c/Code\u003e\u003cMessage\u003e정책에 따라 무효함: 정책 조건 실패: [\"starts-with\", \"$key\", \"mytest/\"]\u003c/Message\u003e\u003cRequestId\u003e4AKJZREYX4YD17VF\u003c/RequestId\u003e\u003cHostId\u003eWLz45xZYd7dSgSIi/6SWtWuzPPYF2aCI1oeX8P+RxTdFskeAM6c7g0VH0OwJRVDIEBSmUS8qDnw=\u003c/HostId\u003e\u003c/Error\u003e\n```\n\n# GET을 위한 사전 서명 된 URL\n\nS3 버킷에 파일이 있다고 가정하고(예: post_test1.txt), 사전 서명된 GET URL을 생성할 수 있습니다.\n\n```js\nbucket_name = \"testjorzel\";\nprefix = \"mytest/\";\npresigned_get = s3_client.generate_presigned_url(\n  \"get_object\",\n  (Params = {\n    Bucket: bucket_name,\n    Key: \"mytest/post_test1.txt\",\n  }),\n  (ExpiresIn = 60)\n);\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n아래 URL은 쿼리 문자열에 추가 필드를 포함한 문자열이어야 합니다:\n\n```js\nhttps://testjorzel.s3.amazonaws.com/mytest/post_test1.txt?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAU5USI2VZ3RIF3L5V%2F20240403%2Feu-central-1%2Fs3%2Faws4_request\u0026X-Amz-Date=20240403T203856Z\u0026X-Amz-Expires=60\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=25b531d9eb1ed01afcaaa1ce61fddf36720833e04a239d0ab0c6fa78ce308fa1\n```\n\n이를 사용하여 파일을 다운로드할 수 있습니다 (request.get을 실행함).\n\n```js\nimport requests\n\ndef download_file(url):\n    response_get = requests.get(url)\n    print(f\"다운로드, HTTP 코드: {response_get.status_code}, 내용: '{response_get.text}'\")\n    with open(\"presigned_get.txt\", mode=\"wb\") as file:\n        file.write(response_get.content)\n\ndownload_file(presigned_get)\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n파일은 저희 디스크에 presigned_get.txt 이름으로 저장되어야 하며, 응답은 다음과 같아야 합니다:\n\n```js\n다운로드, HTTP 코드: 200, 내용: 'My test put/get/post'\n```\n\n# PUT을 위한 Presigned URL\n\n마지막 케이스는 단일 파일을 업로드하기 위한 presigned PUT URL을 생성하는 것입니다 (키: mytest/presigned_put.txt 아래). GET과 비슷하게 동작할 것입니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nbucket_name = \"testjorzel\";\nprefix = \"mytest/\";\npresigned_put = s3_client.generate_presigned_url(\n  \"put_object\",\n  (Params = {\n    Bucket: bucket_name,\n    Key: prefix + \"presigned_put.txt\",\n  }),\n  (ExpiresIn = 60)\n);\n```\n\nThe `presigned_put` will also be a string:\n\n[https://testjorzel.s3.amazonaws.com/mytest/presigned_put.txt?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAU5USI2VZ3RIF3L5V%2F20240403%2Feu-central-1%2Fs3%2Faws4_request\u0026X-Amz-Date=20240403T204459Z\u0026X-Amz-Expires=60\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ed117f655fc007d1572618474b9fc96f1a1820ec705317a6954c6a78730fd769](https://testjorzel.s3.amazonaws.com/mytest/presigned_put.txt?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAU5USI2VZ3RIF3L5V%2F20240403%2Feu-central-1%2Fs3%2Faws4_request\u0026X-Amz-Date=20240403T204459Z\u0026X-Amz-Expires=60\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ed117f655fc007d1572618474b9fc96f1a1820ec705317a6954c6a78730fd769)\n\nNow we can upload a file using `requests.put` function.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nimport requests\n\nfilepath = \"test.txt\"\n\ndef upload_file(filepath, presigned_put):\n    with open(filepath, 'rb') as f:\n        response_put = requests.put(presigned_put, data=f)\n        print(f\"파일 업로드, HTTP 상태 코드: {response_put.status_code}, 내용: '{response_put.text}'\")\n\nupload_file(filepath, presigned_put)\n```\n\n위 코드의 실행 결과는:\n\n```js\n파일 업로드, HTTP 상태 코드: 200, 내용: ''\n```\n\n이 파일은 'testjorzel' 버킷에서 찾을 수 있습니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n\u003cimg src=\"/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_4.png\" /\u003e\n\n# 결론\n\n이 짧은 가이드에서 우리는 Amazon S3의 사전 서명된 URL의 다양성을 탐구하고, 해당 사용법을 파이썬으로 실제 예제를 통해 보여주었습니다. 단일 파일 및 여러 파일에 대해 둘 다 수행할 수 있는 방법을 보여주었으며, 이는 AWS 자격 증명을 응용 프로그램에 포함시키지 않거나 사용자에게 민감한 AWS 자격 증명을 공유하지 않고 S3에서 파일 업로드 또는 다운로드를 활성화하고자 하는 시나리오에서 특히 유용합니다.\n\n이 주제를 다룬 코드베이스는 여기에서 찾을 수 있습니다.\n","ogImage":{"url":"/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_0.png"},"coverImage":"/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_0.png","tag":["Tech"],"readingTime":13},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e블롭 객체를 안전하게 저장하는 것은 중요합니다. AWS S3는 이를 위한 우수한 해결책을 제공합니다. 여러 언어로 제공되는 사용자 친화적인 SDK를 통해 파일을 업로드하고 다운로드하는 과정이 간단해집니다. 그러나 민감한 계정 자격 증명에 접속해야 하는 경우가 발생할 수 있습니다. 이런 상황에서 사전 서명된 URL은 귀중한 해결책으로 나타납니다. 이 URL은 AWS S3 버킷 리소스에 일시적으로 접속할 수 있는 수단을 제공하여 비밀 키를 직접 삽입할 필요가 없어집니다. 이 URL은 데이터 무결성을 보호하면서 보안을 보장하는 안전하고 일시적인 접근을 가능케 합니다.\u003c/p\u003e\n\u003cp\u003e본 글에서는 파일을 업로드하고 다운로드하는 용도로 사전 서명된 URL을 사용하는 방법을 설명하여 AWS S3를 효과적으로 활용하면서 데이터 보안의 실천을 유지할 수 있도록 돕고 있습니다.\u003c/p\u003e\n\u003ch1\u003e사용 사례\u003c/h1\u003e\n\u003cp\u003e다음은 사전 서명된 URL을 활용할 수 있는 여러 사용 사례입니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cul\u003e\n\u003cli\u003e일시적 액세스를 통한 다운로드 링크: 사전 서명된 GET URL을 생성하여 S3 버킷에서 특정 파일을 다운로드하는 데 일시적인 액세스를 제공할 수 있습니다. 이를 통해 AWS 자격 증명을 노출시키지 않고 다른 사람들과 파일을 안전하게 공유할 수 있습니다.\u003c/li\u003e\n\u003cli\u003e일시적 슬롯을 통한 업로드 링크: 비슷하게, 사전 서명된 PUT URL은 S3 버킷으로 파일을 업로드하는 데 일시적인 액세스를 제공하는 데 사용할 수 있습니다. 이를 통해 사용자들이 직접 AWS 자격 증명에 접근할 필요없이 파일을 안전하게 업로드할 수 있습니다.\u003c/li\u003e\n\u003cli\u003e가상 머신 보안: 부팅할 때 가상 머신에 사전 서명된 POST 정책을 삽입하여 지정된 조건하에 여러 파일을 S3 버킷에 안전하게 업로드할 수 있습니다. 이 접근 방식은 민감한 AWS 자격 증명이 가상 머신에 저장되지 않도록 보안을 강화합니다.\u003c/li\u003e\n\u003cli\u003eHTML 폼으로 직접 파일 업로드: HTML 폼에 사전 서명된 POST 정책을 삽입하여 백엔드 서버를 프록시로 사용하지 않고 S3 버킷으로의 직접 파일 업로드를 허용할 수 있습니다. 이를 통해 업로드 프로세스를 간소화하고 서버 측 처리를 줄일 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAWS S3 사전 서명된 URL을 사용하면 PUT 또는 POST 정책을 사용하여 단일 또는 여러 파일을 업로드할 수 있습니다. 다수의 파일을 다운로드할 수 있는 정책을 생성하는 것은 불가능합니다. 이 경우에는 여러 개의 사전 서명된 GET URL을 생성해야 합니다.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_0.png\"\u003e2024-05-20-HowtoutilizeAmazonS3presignedURLs_0.png\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e단일 파일을 다운로드하거나 업로드하기 위해, 파일 업로드가 필요한 구성 요소가 필요할 때 외부 서비스로부터 사전 서명된 URL을 동적으로 요청할 수 있는 풀 기반 아키텍처가 탁월합니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_1.png\" alt=\"image1\"\u003e\u003c/p\u003e\n\u003cp\u003eConversely, for scenarios such as uploading using HTML form or running specific jobs within a virtual machine, a push-based approach presents a straightforward solution. Here, the initiation of the presigned POST policy aligns with the document creation or VM startup process. By injecting a policy during these events, we empower the source to autonomously upload files and minimize external dependencies.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_2.png\" alt=\"image2\"\u003e\u003c/p\u003e\n\u003ch1\u003eHow-to guide\u003c/h1\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e파이썬 boto 패키지를 사용하여 미리 서명된 URL을 생성하고 사용하는 방법을 보여드립니다. 간단한 인터페이스를 제공하는 AWS S3 클라이언트입니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e os\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e boto3\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e botocore.\u003cspan class=\"hljs-property\"\u003eclient\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eConfig\u003c/span\u003e\n\n\u003cspan class=\"hljs-variable constant_\"\u003eACCESS_KEY\u003c/span\u003e = os.\u003cspan class=\"hljs-title function_\"\u003egetenv\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"ACCESS_KEY\"\u003c/span\u003e)\n\u003cspan class=\"hljs-variable constant_\"\u003eSECRET_KEY\u003c/span\u003e = os.\u003cspan class=\"hljs-title function_\"\u003egetenv\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"SECRET_KEY\"\u003c/span\u003e)\nregion = \u003cspan class=\"hljs-string\"\u003e\"eu-central-1\"\u003c/span\u003e\n\ns3_client = boto3.\u003cspan class=\"hljs-title function_\"\u003eclient\u003c/span\u003e(\n    \u003cspan class=\"hljs-string\"\u003e's3'\u003c/span\u003e,\n    aws_access_key_id=\u003cspan class=\"hljs-variable constant_\"\u003eACCESS_KEY\u003c/span\u003e,\n    aws_secret_access_key=\u003cspan class=\"hljs-variable constant_\"\u003eSECRET_KEY\u003c/span\u003e,\n    config=\u003cspan class=\"hljs-title class_\"\u003eConfig\u003c/span\u003e(signature_version=\u003cspan class=\"hljs-string\"\u003e's3v4'\u003c/span\u003e),\n    region_name=region,\n)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e물론 AWS S3 클라우드에도 액세스해야합니다. 이전 포스트 중 하나에서 IAM 계정 및 S3 버킷을 생성하는 방법을 설명했습니다. 이 포스트는 AWS S3 업로드에 대한 자동화 테스트에 관한 것입니다.\u003c/p\u003e\n\u003ch1\u003ePresigned POST policy\u003c/h1\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e미리 서명된 POST URL에서는 여러 파일을 업로드할 수 있는 정책을 구성합니다. 다음을 정의할 수 있습니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eS3 버킷 파일이 저장될 위치 — bucket_name\u003c/li\u003e\n\u003cli\u003e정책의 유효 기간 — ExpiresIn\u003c/li\u003e\n\u003cli\u003e추가로 허용할 폼 필드 — Fields\u003c/li\u003e\n\u003cli\u003e추가 조건 세트 — Conditions (예: 파일의 허용 확장자, 파일 이름의 허용 접두사)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e우리의 예시에서는 정책이 생성 시간으로부터 1분(60초) 후에 만료될 것이라고 지정합니다. 또한 mytest/ 문자열로 시작하는 키를 가진 파일만 허용합니다. Amazon S3에서 키(객체 이름이라고도 함)는 버킷 내 객체의 고유 식별자로 사용됩니다. 이것은 본질적으로 버킷의 네임스페이스 내 객체의 전체 경로를 나타냅니다. 이 구성은 testjorzel 버킷 내 mytest 폴더로 파일을 업로드할 수 있도록 허용합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e requests\n\nbucket_name = \u003cspan class=\"hljs-string\"\u003e\"testjorzel\"\u003c/span\u003e\nprefix = \u003cspan class=\"hljs-string\"\u003e\"mytest/\"\u003c/span\u003e\nobject_name = prefix + \u003cspan class=\"hljs-string\"\u003e\"${filename}\"\u003c/span\u003e\npresigned_post = s3_client.\u003cspan class=\"hljs-title function_\"\u003egenerate_presigned_post\u003c/span\u003e(\n    bucket_name,\n    object_name,\n    \u003cspan class=\"hljs-title class_\"\u003eFields\u003c/span\u003e=\u003cspan class=\"hljs-title class_\"\u003eNone\u003c/span\u003e,\n    \u003cspan class=\"hljs-title class_\"\u003eConditions\u003c/span\u003e=[[\u003cspan class=\"hljs-string\"\u003e\"starts-with\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"$key\"\u003c/span\u003e, prefix]],\n    \u003cspan class=\"hljs-title class_\"\u003eExpiresIn\u003c/span\u003e=expiration,\n)\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e저희 사전 서명된 POST 정책은 다음과 같이 보입니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e{\n    \u003cspan class=\"hljs-string\"\u003e'url'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'https://testjorzel.s3.amazonaws.com/'\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'fields'\u003c/span\u003e: {\n        \u003cspan class=\"hljs-string\"\u003e'key'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'mytest/${filename}'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'x-amz-algorithm'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'AWS4-HMAC-SHA256'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'x-amz-credential'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'AKIAU5USI2VZ3RIF3L5V/20240403/eu-central-1/s3/aws4_request'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'x-amz-date'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'20240403T201346Z'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'policy'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'eyJleHBpcmF0aW9uIjogIjIwMjQtMDQtMDNUMjE6MTM6NDZaIiwgImNvbmRpdGlvbnMiOiBbWyJzdGFydHMtd2l0aCIsICIka2V5IiwgIm15dGVzdC8iXSwgeyJidWNrZXQiOiAidGVzdGpvcnplbCJ9LCBbInN0YXJ0cy13aXRoIiwgIiRrZXkiLCAibXl0ZXN0LyJdLCB7IngtYW16LWFsZ29yaXRobSI6ICJBV1M0LUhNQUMtU0hBMjU2In0sIHsieC1hbXotY3JlZGVudGlhbCI6ICJBS0lBVTVVU0kyVlozUklGM0w1Vi8yMDI0MDQwMy9ldS1jZW50cmFsLTEvczMvYXdzNF9yZXF1ZXN0In0sIHsieC1hbXotZGF0ZSI6ICIyMDI0MDQwM1QyMDEzNDZaIn1dfQ=='\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'x-amz-signature'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'672ca05236f727190841b102a73e4d3298b5821b5afbc62cbfba2dad6128c74c'\u003c/span\u003e\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이는 일반적인 URL과 POST 요청과 함께 전달해야 하는 인증 필드 세트로 구성되어 있습니다(requests.post 함수).\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e requests\n\ndef \u003cspan class=\"hljs-title function_\"\u003eupload_file\u003c/span\u003e(filepath, object_name, policy):\n    \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eopen\u003c/span\u003e(filepath, \u003cspan class=\"hljs-string\"\u003e'rb'\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ef\u003c/span\u003e:\n        files = {\u003cspan class=\"hljs-string\"\u003e'file'\u003c/span\u003e: (filepath, f)}\n        fields = policy[\u003cspan class=\"hljs-string\"\u003e'fields'\u003c/span\u003e]\n        fields[\u003cspan class=\"hljs-string\"\u003e'key'\u003c/span\u003e] = object_name\n        http_response = requests.\u003cspan class=\"hljs-title function_\"\u003epost\u003c/span\u003e(policy[\u003cspan class=\"hljs-string\"\u003e'url'\u003c/span\u003e], data=fields, files=files)\n    \u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e'File: {object_name} uploaded, HTTP status code: {http_response.status_code}, text: {http_response.text}'\u003c/span\u003e)\n\nfilepath = \u003cspan class=\"hljs-string\"\u003e\"test.txt\"\u003c/span\u003e\n\u003cspan class=\"hljs-title function_\"\u003eupload_file\u003c/span\u003e(filepath, \u003cspan class=\"hljs-string\"\u003e'mytest/post_test1.txt'\u003c/span\u003e, presigned_post)\n\u003cspan class=\"hljs-title function_\"\u003eupload_file\u003c/span\u003e(filepath, \u003cspan class=\"hljs-string\"\u003e'mytest/post_test2.txt'\u003c/span\u003e, presigned_post)\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003etest.txt 파일은 하나의 줄로 구성된 간단한 텍스트 파일입니다: My test put/get/post. POST 요청이 성공하면 결과는 내용이없는 204 응답 코드여야 합니다. 이는 파일이 성공적으로 업로드되었음을 의미합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-title class_\"\u003eFile\u003c/span\u003e: mytest/post_test1.\u003cspan class=\"hljs-property\"\u003etxt\u003c/span\u003e uploaded, \u003cspan class=\"hljs-variable constant_\"\u003eHTTP\u003c/span\u003e status \u003cspan class=\"hljs-attr\"\u003ecode\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e204\u003c/span\u003e,\n\u003cspan class=\"hljs-attr\"\u003etext\u003c/span\u003e:\n\n\u003cspan class=\"hljs-title class_\"\u003eFile\u003c/span\u003e: mytest/post_test2.\u003cspan class=\"hljs-property\"\u003etxt\u003c/span\u003e uploaded, \u003cspan class=\"hljs-variable constant_\"\u003eHTTP\u003c/span\u003e status \u003cspan class=\"hljs-attr\"\u003ecode\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e204\u003c/span\u003e,\n\u003cspan class=\"hljs-attr\"\u003etext\u003c/span\u003e:\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e우리는 S3 클라우드의 testjorzel 버킷 내용을 확인할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_3.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e\u003ccode\u003eMarkdown\u003c/code\u003e 형식으로 변경된 테이블:\u003c/p\u003e\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003ctable\u003e\u003cthead\u003e\u003ctr\u003e\u003cth\u003e파일 이름\u003c/th\u003e\u003cth\u003e결과 코드\u003c/th\u003e\u003cth\u003e메시지\u003c/th\u003e\u003cth\u003e요청 ID\u003c/th\u003e\u003cth\u003e호스트 ID\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003epost_test1.txt\u003c/td\u003e\u003ctd\u003e200\u003c/td\u003e\u003ctd\u003e-\u003c/td\u003e\u003ctd\u003e-\u003c/td\u003e\u003ctd\u003e-\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003epost_test2.txt\u003c/td\u003e\u003ctd\u003e200\u003c/td\u003e\u003ctd\u003e-\u003c/td\u003e\u003ctd\u003e-\u003c/td\u003e\u003ctd\u003e-\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003epost_test3.txt\u003c/td\u003e\u003ctd\u003e403\u003c/td\u003e\u003ctd\u003eAccessDenied\u003c/td\u003e\u003ctd\u003e3GZ7Q2XYK4R9190H\u003c/td\u003e\u003ctd\u003eCAL0rRroo8PjDPvXEKhAa5XB/FKwf0k+dm00Kwr95ri2yaN+Hr/qZgzmnH4Fs/Jmnt45rMBidY8=\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e파일 test/post_test4.\u003cspan class=\"hljs-property\"\u003etxt\u003c/span\u003e가 업로드되었습니다. \u003cspan class=\"hljs-variable constant_\"\u003eHTTP\u003c/span\u003e 상태 코드: \u003cspan class=\"hljs-number\"\u003e403\u003c/span\u003e,\n텍스트: \u0026#x3C;?xml version=\u003cspan class=\"hljs-string\"\u003e\"1.0\"\u003c/span\u003e encoding=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e?\u003e\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eError\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eCode\u003c/span\u003e\u003e\u003c/span\u003eAccessDenied\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003eCode\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eMessage\u003c/span\u003e\u003e\u003c/span\u003e정책에 따라 무효함: 정책 조건 실패: [\"starts-with\", \"$key\", \"mytest/\"]\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003eMessage\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eRequestId\u003c/span\u003e\u003e\u003c/span\u003e4AKJZREYX4YD17VF\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003eRequestId\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eHostId\u003c/span\u003e\u003e\u003c/span\u003eWLz45xZYd7dSgSIi/6SWtWuzPPYF2aCI1oeX8P+RxTdFskeAM6c7g0VH0OwJRVDIEBSmUS8qDnw=\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003eHostId\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003eError\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eGET을 위한 사전 서명 된 URL\u003c/h1\u003e\n\u003cp\u003eS3 버킷에 파일이 있다고 가정하고(예: post_test1.txt), 사전 서명된 GET URL을 생성할 수 있습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003ebucket_name = \u003cspan class=\"hljs-string\"\u003e\"testjorzel\"\u003c/span\u003e;\nprefix = \u003cspan class=\"hljs-string\"\u003e\"mytest/\"\u003c/span\u003e;\npresigned_get = s3_client.\u003cspan class=\"hljs-title function_\"\u003egenerate_presigned_url\u003c/span\u003e(\n  \u003cspan class=\"hljs-string\"\u003e\"get_object\"\u003c/span\u003e,\n  (\u003cspan class=\"hljs-title class_\"\u003eParams\u003c/span\u003e = {\n    \u003cspan class=\"hljs-title class_\"\u003eBucket\u003c/span\u003e: bucket_name,\n    \u003cspan class=\"hljs-title class_\"\u003eKey\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"mytest/post_test1.txt\"\u003c/span\u003e,\n  }),\n  (\u003cspan class=\"hljs-title class_\"\u003eExpiresIn\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e)\n);\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e아래 URL은 쿼리 문자열에 추가 필드를 포함한 문자열이어야 합니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-attr\"\u003ehttps\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//testjorzel.s3.amazonaws.com/mytest/post_test1.txt?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026#x26;X-Amz-Credential=AKIAU5USI2VZ3RIF3L5V%2F20240403%2Feu-central-1%2Fs3%2Faws4_request\u0026#x26;X-Amz-Date=20240403T203856Z\u0026#x26;X-Amz-Expires=60\u0026#x26;X-Amz-SignedHeaders=host\u0026#x26;X-Amz-Signature=25b531d9eb1ed01afcaaa1ce61fddf36720833e04a239d0ab0c6fa78ce308fa1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이를 사용하여 파일을 다운로드할 수 있습니다 (request.get을 실행함).\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e requests\n\ndef \u003cspan class=\"hljs-title function_\"\u003edownload_file\u003c/span\u003e(url):\n    response_get = requests.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(url)\n    \u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"다운로드, HTTP 코드: {response_get.status_code}, 내용: '{response_get.text}'\"\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eopen\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"presigned_get.txt\"\u003c/span\u003e, mode=\u003cspan class=\"hljs-string\"\u003e\"wb\"\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003efile\u003c/span\u003e:\n        file.\u003cspan class=\"hljs-title function_\"\u003ewrite\u003c/span\u003e(response_get.\u003cspan class=\"hljs-property\"\u003econtent\u003c/span\u003e)\n\n\u003cspan class=\"hljs-title function_\"\u003edownload_file\u003c/span\u003e(presigned_get)\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e파일은 저희 디스크에 presigned_get.txt 이름으로 저장되어야 하며, 응답은 다음과 같아야 합니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e다운로드, \u003cspan class=\"hljs-variable constant_\"\u003eHTTP\u003c/span\u003e 코드: \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, 내용: \u003cspan class=\"hljs-string\"\u003e'My test put/get/post'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003ePUT을 위한 Presigned URL\u003c/h1\u003e\n\u003cp\u003e마지막 케이스는 단일 파일을 업로드하기 위한 presigned PUT URL을 생성하는 것입니다 (키: mytest/presigned_put.txt 아래). GET과 비슷하게 동작할 것입니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003ebucket_name = \u003cspan class=\"hljs-string\"\u003e\"testjorzel\"\u003c/span\u003e;\nprefix = \u003cspan class=\"hljs-string\"\u003e\"mytest/\"\u003c/span\u003e;\npresigned_put = s3_client.\u003cspan class=\"hljs-title function_\"\u003egenerate_presigned_url\u003c/span\u003e(\n  \u003cspan class=\"hljs-string\"\u003e\"put_object\"\u003c/span\u003e,\n  (\u003cspan class=\"hljs-title class_\"\u003eParams\u003c/span\u003e = {\n    \u003cspan class=\"hljs-title class_\"\u003eBucket\u003c/span\u003e: bucket_name,\n    \u003cspan class=\"hljs-title class_\"\u003eKey\u003c/span\u003e: prefix + \u003cspan class=\"hljs-string\"\u003e\"presigned_put.txt\"\u003c/span\u003e,\n  }),\n  (\u003cspan class=\"hljs-title class_\"\u003eExpiresIn\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e)\n);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ccode\u003epresigned_put\u003c/code\u003e will also be a string:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://testjorzel.s3.amazonaws.com/mytest/presigned_put.txt?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026#x26;X-Amz-Credential=AKIAU5USI2VZ3RIF3L5V%2F20240403%2Feu-central-1%2Fs3%2Faws4_request\u0026#x26;X-Amz-Date=20240403T204459Z\u0026#x26;X-Amz-Expires=60\u0026#x26;X-Amz-SignedHeaders=host\u0026#x26;X-Amz-Signature=ed117f655fc007d1572618474b9fc96f1a1820ec705317a6954c6a78730fd769\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://testjorzel.s3.amazonaws.com/mytest/presigned_put.txt?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026#x26;X-Amz-Credential=AKIAU5USI2VZ3RIF3L5V%2F20240403%2Feu-central-1%2Fs3%2Faws4_request\u0026#x26;X-Amz-Date=20240403T204459Z\u0026#x26;X-Amz-Expires=60\u0026#x26;X-Amz-SignedHeaders=host\u0026#x26;X-Amz-Signature=ed117f655fc007d1572618474b9fc96f1a1820ec705317a6954c6a78730fd769\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eNow we can upload a file using \u003ccode\u003erequests.put\u003c/code\u003e function.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e requests\n\nfilepath = \u003cspan class=\"hljs-string\"\u003e\"test.txt\"\u003c/span\u003e\n\ndef \u003cspan class=\"hljs-title function_\"\u003eupload_file\u003c/span\u003e(filepath, presigned_put):\n    \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eopen\u003c/span\u003e(filepath, \u003cspan class=\"hljs-string\"\u003e'rb'\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ef\u003c/span\u003e:\n        response_put = requests.\u003cspan class=\"hljs-title function_\"\u003eput\u003c/span\u003e(presigned_put, data=f)\n        \u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"파일 업로드, HTTP 상태 코드: {response_put.status_code}, 내용: '{response_put.text}'\"\u003c/span\u003e)\n\n\u003cspan class=\"hljs-title function_\"\u003eupload_file\u003c/span\u003e(filepath, presigned_put)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e위 코드의 실행 결과는:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e파일 업로드, \u003cspan class=\"hljs-variable constant_\"\u003eHTTP\u003c/span\u003e 상태 코드: \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, 내용: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 파일은 'testjorzel' 버킷에서 찾을 수 있습니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cimg src=\"/assets/img/2024-05-20-HowtoutilizeAmazonS3presignedURLs_4.png\"\u003e\n\u003ch1\u003e결론\u003c/h1\u003e\n\u003cp\u003e이 짧은 가이드에서 우리는 Amazon S3의 사전 서명된 URL의 다양성을 탐구하고, 해당 사용법을 파이썬으로 실제 예제를 통해 보여주었습니다. 단일 파일 및 여러 파일에 대해 둘 다 수행할 수 있는 방법을 보여주었으며, 이는 AWS 자격 증명을 응용 프로그램에 포함시키지 않거나 사용자에게 민감한 AWS 자격 증명을 공유하지 않고 S3에서 파일 업로드 또는 다운로드를 활성화하고자 하는 시나리오에서 특히 유용합니다.\u003c/p\u003e\n\u003cp\u003e이 주제를 다룬 코드베이스는 여기에서 찾을 수 있습니다.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-20-HowtoutilizeAmazonS3presignedURLs"},"buildId":"-dPCbnM2yhdKNgXe92VJV","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>