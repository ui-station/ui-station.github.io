<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>Kubernetes K8s ConfigMap ë˜ëŠ” Secretê°€ ì—…ë°ì´íŠ¸ë  ë•Œ ë°°í¬ ìë™ ì¬ì‹œì‘í•˜ê¸° | ui-station</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://ui-station.github.io///post/2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="Kubernetes K8s ConfigMap ë˜ëŠ” Secretê°€ ì—…ë°ì´íŠ¸ë  ë•Œ ë°°í¬ ìë™ ì¬ì‹œì‘í•˜ê¸° | ui-station" data-gatsby-head="true"/><meta property="og:title" content="Kubernetes K8s ConfigMap ë˜ëŠ” Secretê°€ ì—…ë°ì´íŠ¸ë  ë•Œ ë°°í¬ ìë™ ì¬ì‹œì‘í•˜ê¸° | ui-station" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://ui-station.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://ui-station.github.io///post/2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated" data-gatsby-head="true"/><meta name="twitter:title" content="Kubernetes K8s ConfigMap ë˜ëŠ” Secretê°€ ì—…ë°ì´íŠ¸ë  ë•Œ ë°°í¬ ìë™ ì¬ì‹œì‘í•˜ê¸° | ui-station" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | ui-station" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-19 13:11" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BHFR6GTH9P"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-BHFR6GTH9P');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/_next/static/chunks/348-d11c34b645b13f5b.js" defer=""></script><script src="/_next/static/chunks/162-4172e84c8e2aa747.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-4f7b40c1114f0d09.js" defer=""></script><script src="/_next/static/bb_yO9GbCvdfc_n71SfUf/_buildManifest.js" defer=""></script><script src="/_next/static/bb_yO9GbCvdfc_n71SfUf/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UI STATION</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">Kubernetes K8s ConfigMap ë˜ëŠ” Secretê°€ ì—…ë°ì´íŠ¸ë  ë•Œ ë°°í¬ ìë™ ì¬ì‹œì‘í•˜ê¸°</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="Kubernetes K8s ConfigMap ë˜ëŠ” Secretê°€ ì—…ë°ì´íŠ¸ë  ë•Œ ë°°í¬ ìë™ ì¬ì‹œì‘í•˜ê¸°" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UI STATION</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 19, 2024</span><span class="posts_reading_time__f7YPP">19<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<h2>ìë™ ë¡¤ì•„ì›ƒ ì¬ì‹œì‘: K8s ConfigMap ë˜ëŠ” Secretê°€ ì—…ë°ì´íŠ¸ë  ë•Œ ë°°í¬ ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</h2>
<p>ì¿ ë²„ë„¤í‹°ìŠ¤ ë°°í¬ëŠ” ëª¨ë“  ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ì„œ ê°€ì¥ ì¼ë°˜ì ì¸ ë¦¬ì†ŒìŠ¤ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ëª¨ë‘ podë¥¼ K8s ë°°í¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰í•˜ì—¬ ë†’ì€ ê°€ìš©ì„±ì„ ë³´ì¥í•˜ê³ , podê°€ ì‚­ì œë˜ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ë„ë¡í•©ë‹ˆë‹¤.</p>
<p>ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•­ìƒ ì—¬ëŸ¬ í™˜ê²½ì—ì„œ ì›í™œí•˜ê²Œ ì‹¤í–‰ë˜ë„ë¡í•˜ê¸° ìœ„í•´ êµ¬ì„±ì´ í•„ìš”í•œ ê²ƒì€ ë§¤ìš° í”í•©ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ì ì´ë¦„, ë¹„ë°€ë²ˆí˜¸ ë“±ê³¼ ê°™ì€ ì¤‘ìš”í•œ ì •ë³´ê°€ í•„ìš”í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œëŠ” êµ¬ì„± ë§µê³¼ ì‹œí¬ë¦¿ì„ ì‚¬ìš©í•˜ì—¬ ì‘ìš© í”„ë¡œê·¸ë¨ë³„ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  podë¡œ ì£¼ì…í•˜ì—¬ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ê·¸ë ‡ë‹¤ë©´ êµ¬ì„± ë§µì´ë‚˜ ì‹œí¬ë¦¿ì˜ ê°’ì„ ì—…ë°ì´íŠ¸í–ˆì„ ë•ŒëŠ” ì–´ë–¨ê¹Œìš”? ìµœì‹  ê°’ì„ ë°˜ì˜í•˜ë ¤ë©´ podë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ì•¼í•©ë‹ˆë‹¤, ë§ì£ ? ë˜ëŠ” ë¡¤ì•„ì›ƒì„ ë‹¤ì‹œ ì‹œì‘í•˜ì—¬ ìƒˆë¡œìš´ podë¥¼ ìƒì„±í•˜ê²Œ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ì œ ìƒìƒí•´ë³´ì„¸ìš”. ê³µí†µ configmap ë˜ëŠ” secretì„ ì‚¬ìš©í•˜ëŠ” ìˆ˜ë°± ê°œì˜ ë°°í¬ê°€ ìˆê³  ê·¸ ê°’ì„ ì—…ë°ì´íŠ¸í•˜ê³  ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ìµœì‹  ê°’ì´ë¼ëŠ” ê²ƒì„ í™•ì‹¤í•˜ê²Œ í•´ì•¼í•œë‹¤ê³  ê°€ì •í•´ë³´ì„¸ìš”.</p>
<p></p>
<p>ì €í¬ëŠ” AWS Secrets Managerì— ë¹„ë°€ì„ ì €ì¥í•˜ê³ , Kubernetes Secrets Store CSI Driverë¥¼ ìœ„í•´ AWS Secrets ë° êµ¬ì„± ì œê³µì(ASCP)ë¡œë¶€í„° Kubernetes Secretsë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
<p>ì´ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ì—ì„œëŠ” Secret ë˜ëŠ” ConfigMapì´ ì—…ë°ì´íŠ¸ë  ë•Œ Kubernetes ë°°í¬ë¥¼ ìë™ìœ¼ë¡œ ë¡¤ì•„ì›ƒ ë° ë‹¤ì‹œ ì‹œì‘í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.</p>
<h1>ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨:</h1>
<p><img src="/assets/img/2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated_0.png" alt="Architecture Diagram"></p>
<p></p>
<h2>ì‹œì‘í•´ ë´…ì‹œë‹¤!</h2>
<h3>ì¤€ë¹„ë¬¼:</h3>
<ul>
<li>EKS í´ëŸ¬ìŠ¤í„°</li>
<li>EKSë¥¼ ìœ„í•œ OIDC ì œê³µì êµ¬ì„± í•„ìš”</li>
<li>Kubectl</li>
<li>AWS CLI</li>
</ul>
<h3>ë‹¨ê³„ 1: ASCPë¥¼ ìœ„í•œ IAM ì—­í•  ë° ì •ì±… ìƒì„±</h3>
<p></p>
<p>ASCP(Amazon EKS Security Token Service)ëŠ” Amazon EKS íŒŒë“œ IDë¥¼ ê²€ìƒ‰í•˜ì—¬ IAM ì—­í• ë¡œ êµí™˜í•©ë‹ˆë‹¤. í•´ë‹¹ IAM ì—­í• ì— ëŒ€í•œ IAM ì •ì±…ì—ì„œ ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤. ASCPê°€ IAM ì—­í• ì„ ê°€ì •í•˜ë©´ ê¶Œí•œì„ ë¶€ì—¬ë°›ì€ ì‹œí¬ë¦¿ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆëŠ” IAM ì—­í• ê³¼ ì—°ê²°ë˜ì§€ ì•ŠëŠ” í•œ ì‹œí¬ë¦¿ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
<ul>
<li>IAM ì •ì±… ë¬¸ì„œ ì‘ì„±
"secrets_policy"ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ ë§Œë“¤ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•˜ì‹­ì‹œì˜¤.</li>
</ul>
<pre><code class="hljs language-js">{
    <span class="hljs-string">"Version"</span>: <span class="hljs-string">"2012-10-17"</span>,
    <span class="hljs-string">"Statement"</span>: [
        {
            <span class="hljs-string">"Action"</span>: [
                <span class="hljs-string">"secretsmanager:DescribeSecret"</span>,
                <span class="hljs-string">"secretsmanager:GetSecretValue"</span>
            ],
            <span class="hljs-string">"Effect"</span>: <span class="hljs-string">"Allow"</span>,
            <span class="hljs-string">"Resource"</span>: <span class="hljs-string">"*"</span>
        }
}
</code></pre>
<ol start="2">
<li>ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ IAM ì •ì±…ì„ ë§Œë“­ë‹ˆë‹¤.
IAM ì •ì±…ì„ IAM ì—­í• ì— ì—°ê²°í•  ë•Œ policy ARNì„ ë©”ëª¨í•˜ì‹­ì‹œì˜¤.</li>
</ol>
<p></p>
<pre><code class="hljs language-js">aws iam create-policy \
    --policy-name my-secret-manager-policy \
    --policy-<span class="hljs-variable language_">document</span> <span class="hljs-attr">file</span>:<span class="hljs-comment">//secrets_policy</span>
</code></pre>
<ol start="3">
<li>IAM ì—­í• ì— ì‹ ë¢° ì •ì±… ìƒì„±í•˜ê¸°
"trust_policy"ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•˜ì„¸ìš”. ì˜¬ë°”ë¥¸ ê°’ìœ¼ë¡œ ëŒ€ì²´í•´ì•¼ í•©ë‹ˆë‹¤. <code>SERVICE_ACCOUNT_NAME</code>ì€ ì„ì˜ë¡œ ì§€ì •í•  ìˆ˜ ìˆì§€ë§Œ Kubernetesì—ì„œ ì‹¤ì œ ì„œë¹„ìŠ¤ ê³„ì •ì„ ìƒì„±í•  ë•Œ ë™ì¼í•œ ì´ë¦„ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.</li>
</ol>
<pre><code class="hljs language-js">{
  <span class="hljs-string">"Version"</span>: <span class="hljs-string">"2012-10-17"</span>,
  <span class="hljs-string">"Statement"</span>: [
    {
      <span class="hljs-string">"Effect"</span>: <span class="hljs-string">"Allow"</span>,
      <span class="hljs-string">"Action"</span>: <span class="hljs-string">"sts:AssumeRoleWithWebIdentity"</span>,
      <span class="hljs-string">"Principal"</span>: {
        <span class="hljs-string">"Federated"</span>: <span class="hljs-string">"arn:aws:iam::&#x3C;AWS_ACCOUNT_ID>:oidc-provider/oidc.eks.&#x3C;AWS_REGION>.amazonaws.com/id/&#x3C;OIDC_ID>"</span>
      },
      <span class="hljs-string">"Condition"</span>: {
        <span class="hljs-string">"StringEquals"</span>: {
          <span class="hljs-string">"oidc.eks.&#x3C;AWS_REGION>.amazonaws.com/id/&#x3C;OIDC_ID>:aud"</span>: <span class="hljs-string">"sts.amazonaws.com"</span>,
          <span class="hljs-string">"oidc.eks.&#x3C;AWS_REGION>.amazonaws.com/id/&#x3C;OIDC_ID>:sub"</span>: <span class="hljs-string">"system:serviceaccount:&#x3C;K8S_NAMESPACE>:&#x3C;SERVICE_ACCOUNT_NAME>"</span>
        }
      }
    }
  ]
}
</code></pre>
<ol start="4">
<li>ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ IAM ì—­í• ì„ ë§Œë“œì„¸ìš”.</li>
</ol>
<p></p>
<pre><code class="hljs language-js">aws iam create-role --role-name my-secret-manager-role --assume-role-policy-<span class="hljs-variable language_">document</span> <span class="hljs-attr">file</span>:<span class="hljs-comment">//trust_policy</span>
</code></pre>
<ol start="5">
<li>Attach IAM policy to IAM Role</li>
</ol>
<pre><code class="hljs language-js">aws iam attach-role-policy --policy-arn &#x3C;your_policy_arn> --role-name my-secret-manager-role
</code></pre>
<p>ìš°ë¦¬ëŠ” í•„ìš”í•œ ëª¨ë“  IAM ì—­í• ê³¼ ì •ì±…ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.</p>
<p></p>
<h1>ë‹¨ê³„ 2: ASCP ì„¤ì¹˜ ë° êµ¬ì„±</h1>
<p>ì´ì œ 2ê°œì˜ Helm ì°¨íŠ¸ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<ul>
<li>AWS Secrets and Configuration Provider (ASCP) ì°¨íŠ¸ ì„¤ì¹˜</li>
</ul>
<pre><code class="hljs language-js"># <span class="hljs-variable constant_">ASCP</span> <span class="hljs-title class_">Helm</span> ì°¨íŠ¸ ë¦¬í¬ì§€í† ë¦¬ ì¶”ê°€
helm repo add aws-secrets-manager <span class="hljs-attr">https</span>:<span class="hljs-comment">//aws.github.io/secrets-store-csi-driver-provider-aws</span>

# <span class="hljs-variable constant_">ASCP</span> <span class="hljs-title class_">Helm</span> ì°¨íŠ¸ ì„¤ì¹˜
helm install -n kube-system secrets-provider-aws aws-secrets-manager/secrets-store-csi-driver-provider-aws
</code></pre>
<p></p>
<ol start="2">
<li>Secrets Store CSI Driver ì°¨íŠ¸ ì„¤ì¹˜</li>
</ol>
<ul>
<li>Secrets Store CSI Driver ì°¨íŠ¸ë¥¼ ìœ„í•œ helm ë ˆí¬ì§€í† ë¦¬ ì¶”ê°€</li>
</ul>
<pre><code class="hljs language-js"># <span class="hljs-title class_">Secrets</span> <span class="hljs-title class_">Store</span> <span class="hljs-variable constant_">CSI</span> <span class="hljs-title class_">Driver</span> ì°¨íŠ¸ ë ˆí¬ì§€í† ë¦¬ ì¶”ê°€
helm repo add secrets-store-csi-driver <span class="hljs-attr">https</span>:<span class="hljs-comment">//kubernetes-sigs.github.io/secrets-store-csi-driver/charts</span>
</code></pre>
<ul>
<li>ê¸°ë³¸ê°’ í™•ì¸</li>
</ul>
<p></p>
<h1>ê¸°ë³¸ ê°’ ê°€ì ¸ì˜¤ê¸°</h1>
<p>helm show values secrets-store-csi-driver/secrets-store-csi-driver > secrets-store-csi-driver.yaml</p>
<ul>
<li>secrets-store-csi-driver.yaml íŒŒì¼ì—ì„œ ë‹¤ìŒ ê°’ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.</li>
</ul>
<h2>K8S Secrets ë™ê¸°í™”ì— í•„ìš”í•œ RBAC ì—­í•  ë° ë°”ì¸ë”© ì„¤ì¹˜ ì—¬ë¶€</h2>
<p>syncSecret:
enabled: true</p>
<h2>ì‹œí¬ë¦¿ ë¡œí…Œì´ì…˜ ê¸°ëŠ¥ í™œì„±í™” [ì•ŒíŒŒ]</h2>
<p>enableSecretRotation: true</p>
<p>ìœ„ì˜ êµ¬ì„±ì€ "secrets-store-csi-driver"ê°€ AWS Secret Managerì—ì„œ ìµœì‹  ê°’ì„ ê°€ì ¸ì™€ í•´ë‹¹ ê°’ì„ Kubernetes Secrets ê°ì²´ì— ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.</p>
<p></p>
<p>íšŒì „-íˆ¬í‘œ-ê°„ê²©ì€ ê¸°ë³¸ì ìœ¼ë¡œ 2ë¶„ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì§€ë§Œ, ì†ì„± rotationPollIntervalì„ ì„¤ì •í•¨ìœ¼ë¡œì¨ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<ul>
<li>Helm ì°¨íŠ¸ ì„¤ì¹˜</li>
</ul>
<pre><code class="hljs language-js"># <span class="hljs-title class_">Helm</span> ì°¨íŠ¸ ì„¤ì¹˜
helm install -n kube-system csi-secrets-store secrets-store-csi-driver/secrets-store-csi-driver -f secrets-store-csi-driver.<span class="hljs-property">yaml</span>
</code></pre>
<h1>ë‹¨ê³„ 3: AWS Secret Managerì— í…ŒìŠ¤íŠ¸ ì‹œí¬ë¦¿ ìƒì„±</h1>
<p></p>
<p>AWS Secret Managerì—ì„œ í…ŒìŠ¤íŠ¸ ì‹œí¬ë¦¿ì„ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤.</p>
<pre><code class="hljs language-js">aws secretsmanager create-secret \
    --name my-test-secret \
    --description <span class="hljs-string">"CLIë¡œ ìƒì„±í•œ ë‚´ í…ŒìŠ¤íŠ¸ ì‹œí¬ë¦¿."</span> \
    --secret-string <span class="hljs-string">"{\"user\":\"my-user\",\"password\":\"ì˜ˆì‹œ-ë¹„ë°€ë²ˆí˜¸\"}"</span>
</code></pre>
<h1>ë‹¨ê³„ 4: Kubernetes ServiceAccount ìƒì„±</h1>
<p>ì´ì œ IAM ì—­í• ì„ ê°€ì •í•  ìˆ˜ ìˆë„ë¡ íŒŒë“œì— í—ˆìš©í•˜ëŠ” ServiceAccountë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ServiceAccountëŠ” K8s ë°°í¬ì—ì„œ ì‚¬ìš©ë  ê²ƒì…ë‹ˆë‹¤.</p>
<p></p>
<p>serviceaccount.yamlì´ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ ìƒì„±í•´ì£¼ì„¸ìš”.</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">&#x3C;your_service_account_name></span> <span class="hljs-comment"># ì´ ì´ë¦„ì€ IAM ì‹ ë¢° ì •ì±…ì„ ë§Œë“¤ ë•Œ ì§€ì •í•œ ì´ë¦„ê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.</span>
  <span class="hljs-attr">annotations:</span>
    <span class="hljs-attr">eks.amazonaws.com/role-arn:</span> <span class="hljs-string">&#x3C;IAM_ROLE_ARN></span>
</code></pre>
<p>ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ K8sì—ì„œ ì„œë¹„ìŠ¤ ê³„ì •ì„ ìƒì„±í•©ë‹ˆë‹¤.</p>
<pre><code class="hljs language-bash">kubectl apply -f serviceaccount.yaml
</code></pre>
<p></p>
<h1>ë‹¨ê³„ 5: í…ŒìŠ¤íŠ¸ ê°ì²´ ìƒì„±í•˜ê¸°</h1>
<p>ì´ì œ í•„ìš”í•œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ë°°í¬í–ˆìŠµë‹ˆë‹¤. ì´ì œ í…ŒìŠ¤íŠ¸ ê°ì²´ë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.</p>
<ul>
<li>ì´ë¦„ì´ â€œmy-test-secret-manifest.yamlâ€ì¸ íŒŒì¼ ìƒì„±</li>
</ul>
<pre><code class="hljs language-js">---
<span class="hljs-attr">apiVersion</span>: secrets-store.<span class="hljs-property">csi</span>.<span class="hljs-property">x</span>-k8s.<span class="hljs-property">io</span>/v1
<span class="hljs-attr">kind</span>: <span class="hljs-title class_">SecretProviderClass</span>
<span class="hljs-attr">metadata</span>:
  <span class="hljs-attr">name</span>: aws-secrets-provider<span class="hljs-keyword">class</span>
<span class="hljs-title class_">spec</span>:
  <span class="hljs-attr">provider</span>: aws
  <span class="hljs-attr">secretObjects</span>:
    - <span class="hljs-attr">secretName</span>: my-test-k8s-secret
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">Opaque</span>
      <span class="hljs-attr">data</span>:
        - <span class="hljs-attr">objectName</span>: user
          <span class="hljs-attr">key</span>: user
        - <span class="hljs-attr">objectName</span>: password
          <span class="hljs-attr">key</span>: password
  <span class="hljs-attr">parameters</span>:
    <span class="hljs-attr">objects</span>: |
      - <span class="hljs-attr">objectName</span>: <span class="hljs-attr">arn</span>:<span class="hljs-attr">aws</span>:<span class="hljs-attr">secretsmanager</span>:&#x3C;<span class="hljs-variable constant_">AWS_REGION</span>>:&#x3C;<span class="hljs-variable constant_">AWS_ACCOUNT_ID</span>>:<span class="hljs-attr">secret</span>:my-test-secret
        <span class="hljs-attr">jmesPath</span>:
          - <span class="hljs-attr">path</span>: user
            <span class="hljs-attr">objectAlias</span>: user
          - <span class="hljs-attr">path</span>: password
            <span class="hljs-attr">objectAlias</span>: password
---
<span class="hljs-attr">apiVersion</span>: apps/v1
<span class="hljs-attr">kind</span>: <span class="hljs-title class_">Deployment</span>
<span class="hljs-attr">metadata</span>:
  <span class="hljs-attr">name</span>: secret-rotation-test-ubuntu-deployment
  <span class="hljs-attr">labels</span>:
    <span class="hljs-attr">app</span>: ubuntu
<span class="hljs-attr">spec</span>:
  <span class="hljs-attr">replicas</span>: <span class="hljs-number">1</span>
  <span class="hljs-attr">selector</span>:
    <span class="hljs-attr">matchLabels</span>:
      <span class="hljs-attr">app</span>: ubuntu
  <span class="hljs-attr">template</span>:
    <span class="hljs-attr">metadata</span>:
      <span class="hljs-attr">labels</span>:
        <span class="hljs-attr">app</span>: ubuntu
    <span class="hljs-attr">spec</span>:
      <span class="hljs-attr">serviceAccountName</span>: &#x3C;your_service_account_name> # ì´ ì´ë¦„ì€ ë‹¨ê³„ <span class="hljs-number">4</span>ì—ì„œ ë§Œë“  ì„œë¹„ìŠ¤ ê³„ì • ì´ë¦„ê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤
      <span class="hljs-attr">volumes</span>:
      - <span class="hljs-attr">name</span>: mount-secrets-access
        <span class="hljs-attr">csi</span>:
          <span class="hljs-attr">driver</span>: secrets-store.<span class="hljs-property">csi</span>.<span class="hljs-property">k8s</span>.<span class="hljs-property">io</span>
          <span class="hljs-attr">readOnly</span>: <span class="hljs-literal">true</span>
          <span class="hljs-attr">volumeAttributes</span>:
            <span class="hljs-attr">secretProviderClass</span>: <span class="hljs-string">"aws-secrets-providerclass"</span>
      <span class="hljs-attr">containers</span>:
      - <span class="hljs-attr">name</span>: ubuntu
        <span class="hljs-attr">image</span>: ubuntu
        <span class="hljs-attr">command</span>: [<span class="hljs-string">"sleep"</span>, <span class="hljs-string">"123456"</span>]
        <span class="hljs-attr">env</span>:
        - <span class="hljs-attr">name</span>: <span class="hljs-variable constant_">USER</span>
          <span class="hljs-attr">valueFrom</span>:
            <span class="hljs-attr">secretKeyRef</span>:
              <span class="hljs-attr">name</span>: my-test-k8s-secret
              <span class="hljs-attr">key</span>: user
        - <span class="hljs-attr">name</span>: <span class="hljs-variable constant_">PASSWORD</span>
          <span class="hljs-attr">valueFrom</span>:
            <span class="hljs-attr">secretKeyRef</span>:
              <span class="hljs-attr">name</span>: my-test-k8s-secret
              <span class="hljs-attr">key</span>: password
        <span class="hljs-attr">volumeMounts</span>:
        - <span class="hljs-attr">name</span>: mount-secrets-access
          <span class="hljs-attr">mountPath</span>: <span class="hljs-string">"/mnt/aws-secrets"</span>
          <span class="hljs-attr">readOnly</span>: <span class="hljs-literal">true</span>
</code></pre>
<p></p>
<ol start="2">
<li>manifestë¥¼ ì ìš©í•˜ì‹­ì‹œì˜¤</li>
</ol>
<pre><code class="hljs language-js">kubectl apply -f my-test-secret-manifest.<span class="hljs-property">yaml</span>
</code></pre>
<ol start="3">
<li>ë‹¤ìŒ ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë©ë‹ˆë‹¤.</li>
</ol>
<ul>
<li>SecretProviderClass ë¦¬ì†ŒìŠ¤ - AWS Secret Managerì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ K8s Secretë¥¼ ìƒì„±í•©ë‹ˆë‹¤</li>
<li>ë³¼ë¥¨ ë§ˆìš´íŠ¸ê°€ ìˆëŠ” ë°°í¬ - SecretProviderClassë¥¼ ë³¼ë¥¨ìœ¼ë¡œ ë§ˆìš´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤</li>
<li>Kubernetes Secret - íŒŒë“œ ë‚´ì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¡œ ì£¼ì…ë©ë‹ˆë‹¤</li>
</ul>
<p></p>
<p>ì•„ë˜ ë‹¤ì´ì–´ê·¸ë¨ì€ YAMLì„ ì ìš©í•  ë•Œ ë’·ë‹¨ì—ì„œ ë¬´ìŠ¨ ì¼ì´ ë²Œì–´ì§€ëŠ”ì§€ ì˜ ì‹œê°í™”í•œ ê²ƒì…ë‹ˆë‹¤.</p>
<p><img src="/assets/img/2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated_1.png" alt="ë‹¤ì´ì–´ê·¸ë¨"></p>
<ol start="4">
<li>ëª¨ë“  ê²ƒì´ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.</li>
</ol>
<pre><code class="hljs language-js"># <span class="hljs-title class_">SecretProviderClass</span> í™•ì¸
kubectl get <span class="hljs-title class_">SecretProviderClass</span> aws-secrets-providerclass -o yaml

# ë°°í¬ í™•ì¸
kubectl get deploy secret-rotation-test-ubuntu-deployment -o yaml

# <span class="hljs-title class_">Pod</span> í™•ì¸
kubectl get po &#x3C;pod_name> -o yaml

# <span class="hljs-title class_">Secret</span> ê°€ì ¸ì˜¤ê¸°
kubectl get secret my-test-k8s-secret -o yaml
</code></pre>
<p></p>
<h1>ë‹¨ê³„ 6: Reloader ì„¤ì¹˜í•˜ê¸°</h1>
<p>ReloaderëŠ” ConfigMapê³¼ Secretì˜ ë³€ê²½ ì‚¬í•­ì„ ê°ì§€í•˜ê³  ê´€ë ¨ëœ DeploymentConfig, Deployment, DaemonSet, StatefulSet ë° Rolloutê³¼ í•¨ê»˜ Podì˜ ë¡¤ë§ ì—…ê·¸ë ˆì´ë“œë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<ul>
<li>Reloader Helm Repo ì¶”ê°€</li>
</ul>
<pre><code class="hljs language-js"># <span class="hljs-title class_">Helm</span> <span class="hljs-title class_">Repo</span> ì¶”ê°€
helm repo add stakater <span class="hljs-attr">https</span>:<span class="hljs-comment">//stakater.github.io/stakater-charts</span>
</code></pre>
<p></p>
<ol start="2">
<li>ê¸°ë³¸ê°’ ê°€ì ¸ì˜¤ê¸°</li>
</ol>
<pre><code class="hljs language-js"># ê¸°ë³¸ê°’ ê°€ì ¸ì˜¤ê¸°
helm show values stakater/reloader > reloader.<span class="hljs-property">yaml</span>
</code></pre>
<ol start="3">
<li>reloader.yaml íŒŒì¼ ì—…ë°ì´íŠ¸í•˜ê¸°</li>
</ol>
<pre><code class="hljs language-js"><span class="hljs-attr">reloader</span>:
  # ë¦¬ë”ì‹­ ì„ ì¶œì„ í™œì„±í™”í•˜ë ¤ë©´ <span class="hljs-literal">true</span>ë¡œ ì„¤ì •í•˜ì—¬ ì—¬ëŸ¬ ë ˆí”Œë¦¬ì¹´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  <span class="hljs-attr">enableHA</span>: <span class="hljs-literal">true</span>
  <span class="hljs-attr">deployment</span>:
    # ì—¬ëŸ¬ ë ˆí”Œë¦¬ì¹´ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ reloader.<span class="hljs-property">enableHA</span> = <span class="hljs-literal">true</span>ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
    <span class="hljs-attr">replicas</span>: <span class="hljs-number">2</span>
</code></pre>
<p></p>
<ol start="4">
<li>Helm ì°¨íŠ¸ ì„¤ì¹˜</li>
</ol>
<pre><code class="hljs language-js"># <span class="hljs-title class_">Helm</span> ì°¨íŠ¸ ì„¤ì¹˜
helm install reloader -f reloader.<span class="hljs-property">yaml</span> stakater/reloader -n kube-system
</code></pre>
<h1>ë‹¨ê³„ 7: Secret ì—…ë°ì´íŠ¸ë¡œ í…ŒìŠ¤íŠ¸í•˜ê¸°</h1>
<ul>
<li>ReloaderëŠ” ì£¼ì„ì— ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤.
ê¸°ë³¸ ì£¼ì„ reloader.stakater.com/autoëŠ” ì£¼ìš” ë©”íƒ€ë°ì´í„°ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì•„ë˜ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ë°°í¬ì— ì£¼ì„ì„ ì¶”ê°€í•˜ì„¸ìš”.</li>
</ul>
<p></p>
<pre><code class="hljs language-js"># ë°°í¬ ì£¼ì„ ì¶”ê°€
kubectl annotate deployment secret-rotation-test-ubuntu-deployment <span class="hljs-string">"reloader.stakater.com/auto=true"</span>
</code></pre>
<p>ë˜ëŠ” ë‹¤ìŒ ë¸”ë¡ìœ¼ë¡œ ë°°í¬ íŒŒì¼ì„ í¸ì§‘í•˜ê³  ì ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>
<pre><code class="hljs language-js"><span class="hljs-attr">metadata</span>:
  <span class="hljs-attr">annotations</span>:
    reloader.<span class="hljs-property">stakater</span>.<span class="hljs-property">com</span>/<span class="hljs-attr">auto</span>: <span class="hljs-string">"true"</span>
</code></pre>
<ol start="2">
<li>AWS Secret Managerì—ì„œ ì‹œí¬ë¦¿ ì—…ë°ì´íŠ¸í•˜ê¸°</li>
</ol>
<p></p>
<pre><code class="hljs language-js">aws secretsmanager put-secret-value \
      --secret-id my-test-secret \
      --secret-string <span class="hljs-string">"{\"user\":\"diegor\",\"password\":\"SAMPLE-PASSWORD\"}"</span>
</code></pre>
<ol start="3">
<li>í•œ ë²ˆ ì‹œí¬ë¦¿ì´ AWS ì‹œí¬ë¦¿ ìŠ¤í† ì–´ csi ë“œë¼ì´ë²„ì— ì—…ë°ì´íŠ¸ë˜ë©´ K8s ì‹œí¬ë¦¿ì´ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤. K8s ì‹œí¬ë¦¿ì´ ì—…ë°ì´íŠ¸ë˜ë©´ Reloaderê°€ ë¡¤ì•„ì›ƒì„ ë‹¤ì‹œ ì‹œì‘í•˜ë„ë¡ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.</li>
</ol>
<pre><code class="hljs language-js"># K8s ì‹œí¬ë¦¿ì„ í™•ì¸í•˜ì„¸ìš”. ìƒˆë¡œìš´ ê°’ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
kubectl get secret my-test-k8s-secret -o yaml

# <span class="hljs-title class_">Pod</span>ë¥¼ í™•ì¸í•˜ì„¸ìš”. ëª‡ ì´ˆ ì „ì— ì‹œì‘ë˜ì—ˆì–´ì•¼ í•©ë‹ˆë‹¤.
kubectl get po

# <span class="hljs-title class_">Reloader</span> íŒŸì˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.
kubectl logs &#x3C;reloader-pod-name> -n kube-system

# <span class="hljs-title class_">Pod</span>ë¡œ ì‹¤í–‰ í›„ ìƒˆë¡œìš´ ê°’ì„ í™•ì¸í•˜ì„¸ìš”.
kubectl exec -it &#x3C;pod_name> -- bash

# <span class="hljs-title class_">Pod</span>ì— ë“¤ì–´ê°„ í›„ <span class="hljs-string">`env`</span> ëª…ë ¹ì„ ì‹¤í–‰í•˜ì„¸ìš”. <span class="hljs-title class_">Pod</span>ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.
</code></pre>
<h1>ë‹¨ê³„ 8: ConfigMap ì—…ë°ì´íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.</h1>
<p></p>
<ul>
<li>"my-test-cm-manifest.yaml" íŒŒì¼ì„ ìƒì„±í•´ì£¼ì„¸ìš”.</li>
</ul>
<pre><code class="hljs language-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">my-test-k8s-cm</span>
<span class="hljs-attr">data:</span>
  <span class="hljs-attr">myvalue:</span> <span class="hljs-string">"Hello World"</span>
  <span class="hljs-attr">drink:</span> <span class="hljs-string">coffee</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">reloader-poc-ubuntu-deployment</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">ubuntu</span>
  <span class="hljs-attr">annotations:</span>
    <span class="hljs-attr">reloader.stakater.com/auto:</span> <span class="hljs-string">"true"</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">ubuntu</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">ubuntu</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ubuntu</span>
          <span class="hljs-attr">image:</span> <span class="hljs-string">ubuntu</span>
          <span class="hljs-attr">command:</span> [<span class="hljs-string">"sleep"</span>, <span class="hljs-string">"123456"</span>]
          <span class="hljs-attr">env:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">DRINK</span>
              <span class="hljs-attr">valueFrom:</span>
                <span class="hljs-attr">configMapKeyRef:</span>
                  <span class="hljs-attr">name:</span> <span class="hljs-string">my-test-k8s-cm</span>
                  <span class="hljs-attr">key:</span> <span class="hljs-string">drink</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYVALUE</span>
              <span class="hljs-attr">valueFrom:</span>
                <span class="hljs-attr">configMapKeyRef:</span>
                  <span class="hljs-attr">name:</span> <span class="hljs-string">my-test-k8s-cm</span>
                  <span class="hljs-attr">key:</span> <span class="hljs-string">myvalue</span>
</code></pre>
<ol start="2">
<li>ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì ìš©</li>
</ol>
<pre><code class="hljs language-bash">kubectl apply -f my-test-cm-manifest.yaml
</code></pre>
<p></p>
<ol start="3">
<li>my-test-cm-manifest.yaml íŒŒì¼ì—ì„œ configmapì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.</li>
</ol>
<pre><code class="hljs language-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">my-test-k8s-cm</span>
<span class="hljs-attr">data:</span>
  <span class="hljs-attr">myvalue:</span> <span class="hljs-string">"ì•ˆë…•í•˜ì„¸ìš”"</span>
  <span class="hljs-attr">drink:</span> <span class="hljs-string">ì°¨</span>
</code></pre>
<ol start="4">
<li>íŒŒì¼ì„ ë‹¤ì‹œ ì ìš©í•˜ì„¸ìš”.</li>
</ol>
<pre><code class="hljs language-yaml"><span class="hljs-string">kubectl</span> <span class="hljs-string">apply</span> <span class="hljs-string">-f</span> <span class="hljs-string">my-test-cm-manifest.yaml</span>
</code></pre>
<p></p>
<ol start="5">
<li>í™•ì¸</li>
</ol>
<pre><code class="hljs language-js"># <span class="hljs-title class_">ConfigMap</span> í™•ì¸
kubectl get cm my-test-k8s-cm -o yaml

# <span class="hljs-title class_">Pod</span> í™•ì¸
kubectl get po

# <span class="hljs-title class_">Pod</span>ì— ì ‘ì†í•˜ì—¬ ìƒˆ ê°’ í™•ì¸
kubectl exec -it &#x3C;pod_name> -- bash

# <span class="hljs-title class_">Pod</span>ì— ë“¤ì–´ê°„ í›„ <span class="hljs-string">`env`</span> ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ <span class="hljs-title class_">Pod</span> ë‚´ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ê°€ ì¶œë ¥ë©ë‹ˆë‹¤
</code></pre>
<p>ì¶•í•˜í•©ë‹ˆë‹¤!!! secret-store-csi-driverì™€ reloaderë¥¼ ì„±ê³µì ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.</p>
<p>ê°ì‚¬í•©ë‹ˆë‹¤!!!</p>
<p></p>
<h2>ì°¸ê³  ìë£Œ:</h2>
<ul>
<li><a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html" rel="nofollow" target="_blank">AWS ê³µì‹ ë¬¸ì„œ - CSI ë“œë¼ì´ë²„ í†µí•©</a></li>
<li><a href="https://blog.bootlabstech.com/aws-secrets-manager-in-kubernetes-secret-rotation-and-reloader" rel="nofollow" target="_blank">Bootlabs ê¸°ìˆ  ë¸”ë¡œê·¸ - AWS Secrets Manager in Kubernetes ì‹œí¬ë¦¿ íšŒì „ê³¼ ë¦¬ë¡œë”</a></li>
<li><a href="https://secrets-store-csi-driver.sigs.k8s.io/topics/secret-auto-rotation" rel="nofollow" target="_blank">Secrets Store CSI ë“œë¼ì´ë²„ ê³µì‹ í™ˆí˜ì´ì§€ - ì‹œí¬ë¦¿ ìë™ íšŒì „</a></li>
<li><a href="https://github.com/kubernetes-sigs/secrets-store-csi-driver/blob/main/charts/secrets-store-csi-driver/values.yaml" rel="nofollow" target="_blank">Secrets Store CSI ë“œë¼ì´ë²„ ì°¨íŠ¸ ê°’ ì„¤ì • íŒŒì¼</a></li>
<li><a href="https://github.com/stakater/Reloader/tree/master" rel="nofollow" target="_blank">Reloader GitHub ì €ì¥ì†Œ</a></li>
<li><a href="https://github.com/stakater/Reloader/blob/master/docs/Verify-Reloader-Working.md" rel="nofollow" target="_blank">Reloader ì‘ë™ í™•ì¸ ë¬¸ì„œ</a></li>
<li><a href="https://github.com/stakater/Reloader/blob/master/docs/How-it-works.md" rel="nofollow" target="_blank">Reloader ì‘ë™ ë°©ì‹ ë¬¸ì„œ</a></li>
</ul>
<h1>ê°„ë‹¨íˆ ë§í•˜ìë©´ ğŸš€</h1>
<p>In Plain English ì»¤ë®¤ë‹ˆí‹°ì˜ ì¼ì›ì´ ë˜ì–´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ê³„ì† ì°¸ì—¬í•´ ì£¼ì„¸ìš”:</p>
<p></p>
<ul>
<li>ì‘ê°€ì—ê²Œ ë°•ìˆ˜ë¥¼ ë³´ë‚´ê³  íŒ”ë¡œìš°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš” ï¸ğŸ‘ï¸ï¸</li>
<li>íŒ”ë¡œìš°í•˜ê¸°: X | LinkedIn | YouTube | Discord | Newsletter</li>
<li>ë‹¤ë¥¸ í”Œë«í¼ì—ì„œ ì €í¬ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”: Stackademic | CoFeed | Venture | Cubed</li>
<li>ì•Œê³ ë¦¬ì¦˜ ì½˜í…ì¸ ë¥¼ ë‹¤ë¤„ì•¼ í•˜ëŠ” ë¸”ë¡œê·¸ í”Œë«í¼ì— ì§€ì³¤ë‚˜ìš”? Differë¥¼ ì‹œë„í•´ë³´ì„¸ìš”</li>
<li>PlainEnglish.ioì—ì„œ ë” ë§ì€ ì½˜í…ì¸ ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”</li>
</ul>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Kubernetes K8s ConfigMap ë˜ëŠ” Secretê°€ ì—…ë°ì´íŠ¸ë  ë•Œ ë°°í¬ ìë™ ì¬ì‹œì‘í•˜ê¸°","description":"","date":"2024-06-19 13:11","slug":"2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated","content":"\n## ìë™ ë¡¤ì•„ì›ƒ ì¬ì‹œì‘: K8s ConfigMap ë˜ëŠ” Secretê°€ ì—…ë°ì´íŠ¸ë  ë•Œ ë°°í¬ ë‹¤ì‹œ ì‹œì‘í•˜ê¸°\n\nì¿ ë²„ë„¤í‹°ìŠ¤ ë°°í¬ëŠ” ëª¨ë“  ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ì„œ ê°€ì¥ ì¼ë°˜ì ì¸ ë¦¬ì†ŒìŠ¤ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ëª¨ë‘ podë¥¼ K8s ë°°í¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰í•˜ì—¬ ë†’ì€ ê°€ìš©ì„±ì„ ë³´ì¥í•˜ê³ , podê°€ ì‚­ì œë˜ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ë„ë¡í•©ë‹ˆë‹¤.\n\nì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•­ìƒ ì—¬ëŸ¬ í™˜ê²½ì—ì„œ ì›í™œí•˜ê²Œ ì‹¤í–‰ë˜ë„ë¡í•˜ê¸° ìœ„í•´ êµ¬ì„±ì´ í•„ìš”í•œ ê²ƒì€ ë§¤ìš° í”í•©ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ì ì´ë¦„, ë¹„ë°€ë²ˆí˜¸ ë“±ê³¼ ê°™ì€ ì¤‘ìš”í•œ ì •ë³´ê°€ í•„ìš”í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œëŠ” êµ¬ì„± ë§µê³¼ ì‹œí¬ë¦¿ì„ ì‚¬ìš©í•˜ì—¬ ì‘ìš© í”„ë¡œê·¸ë¨ë³„ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  podë¡œ ì£¼ì…í•˜ì—¬ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nê·¸ë ‡ë‹¤ë©´ êµ¬ì„± ë§µì´ë‚˜ ì‹œí¬ë¦¿ì˜ ê°’ì„ ì—…ë°ì´íŠ¸í–ˆì„ ë•ŒëŠ” ì–´ë–¨ê¹Œìš”? ìµœì‹  ê°’ì„ ë°˜ì˜í•˜ë ¤ë©´ podë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ì•¼í•©ë‹ˆë‹¤, ë§ì£ ? ë˜ëŠ” ë¡¤ì•„ì›ƒì„ ë‹¤ì‹œ ì‹œì‘í•˜ì—¬ ìƒˆë¡œìš´ podë¥¼ ìƒì„±í•˜ê²Œ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ì œ ìƒìƒí•´ë³´ì„¸ìš”. ê³µí†µ configmap ë˜ëŠ” secretì„ ì‚¬ìš©í•˜ëŠ” ìˆ˜ë°± ê°œì˜ ë°°í¬ê°€ ìˆê³  ê·¸ ê°’ì„ ì—…ë°ì´íŠ¸í•˜ê³  ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ìµœì‹  ê°’ì´ë¼ëŠ” ê²ƒì„ í™•ì‹¤í•˜ê²Œ í•´ì•¼í•œë‹¤ê³  ê°€ì •í•´ë³´ì„¸ìš”.\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nì €í¬ëŠ” AWS Secrets Managerì— ë¹„ë°€ì„ ì €ì¥í•˜ê³ , Kubernetes Secrets Store CSI Driverë¥¼ ìœ„í•´ AWS Secrets ë° êµ¬ì„± ì œê³µì(ASCP)ë¡œë¶€í„° Kubernetes Secretsë¥¼ ìƒì„±í•©ë‹ˆë‹¤.\n\nì´ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ì—ì„œëŠ” Secret ë˜ëŠ” ConfigMapì´ ì—…ë°ì´íŠ¸ë  ë•Œ Kubernetes ë°°í¬ë¥¼ ìë™ìœ¼ë¡œ ë¡¤ì•„ì›ƒ ë° ë‹¤ì‹œ ì‹œì‘í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\n# ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨:\n\n![Architecture Diagram](/assets/img/2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated_0.png)\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## ì‹œì‘í•´ ë´…ì‹œë‹¤!\n\n### ì¤€ë¹„ë¬¼:\n\n- EKS í´ëŸ¬ìŠ¤í„°\n- EKSë¥¼ ìœ„í•œ OIDC ì œê³µì êµ¬ì„± í•„ìš”\n- Kubectl\n- AWS CLI\n\n### ë‹¨ê³„ 1: ASCPë¥¼ ìœ„í•œ IAM ì—­í•  ë° ì •ì±… ìƒì„±\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nASCP(Amazon EKS Security Token Service)ëŠ” Amazon EKS íŒŒë“œ IDë¥¼ ê²€ìƒ‰í•˜ì—¬ IAM ì—­í• ë¡œ êµí™˜í•©ë‹ˆë‹¤. í•´ë‹¹ IAM ì—­í• ì— ëŒ€í•œ IAM ì •ì±…ì—ì„œ ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤. ASCPê°€ IAM ì—­í• ì„ ê°€ì •í•˜ë©´ ê¶Œí•œì„ ë¶€ì—¬ë°›ì€ ì‹œí¬ë¦¿ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆëŠ” IAM ì—­í• ê³¼ ì—°ê²°ë˜ì§€ ì•ŠëŠ” í•œ ì‹œí¬ë¦¿ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n- IAM ì •ì±… ë¬¸ì„œ ì‘ì„±\n  \"secrets_policy\"ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ ë§Œë“¤ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•˜ì‹­ì‹œì˜¤.\n\n```js\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Action\": [\n                \"secretsmanager:DescribeSecret\",\n                \"secretsmanager:GetSecretValue\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n        }\n}\n```\n\n2. ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ IAM ì •ì±…ì„ ë§Œë“­ë‹ˆë‹¤.\n   IAM ì •ì±…ì„ IAM ì—­í• ì— ì—°ê²°í•  ë•Œ policy ARNì„ ë©”ëª¨í•˜ì‹­ì‹œì˜¤.\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\naws iam create-policy \\\n    --policy-name my-secret-manager-policy \\\n    --policy-document file://secrets_policy\n```\n\n3. IAM ì—­í• ì— ì‹ ë¢° ì •ì±… ìƒì„±í•˜ê¸°\n   \"trust_policy\"ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•˜ì„¸ìš”. ì˜¬ë°”ë¥¸ ê°’ìœ¼ë¡œ ëŒ€ì²´í•´ì•¼ í•©ë‹ˆë‹¤. `SERVICE_ACCOUNT_NAME`ì€ ì„ì˜ë¡œ ì§€ì •í•  ìˆ˜ ìˆì§€ë§Œ Kubernetesì—ì„œ ì‹¤ì œ ì„œë¹„ìŠ¤ ê³„ì •ì„ ìƒì„±í•  ë•Œ ë™ì¼í•œ ì´ë¦„ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.\n\n```js\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRoleWithWebIdentity\",\n      \"Principal\": {\n        \"Federated\": \"arn:aws:iam::\u003cAWS_ACCOUNT_ID\u003e:oidc-provider/oidc.eks.\u003cAWS_REGION\u003e.amazonaws.com/id/\u003cOIDC_ID\u003e\"\n      },\n      \"Condition\": {\n        \"StringEquals\": {\n          \"oidc.eks.\u003cAWS_REGION\u003e.amazonaws.com/id/\u003cOIDC_ID\u003e:aud\": \"sts.amazonaws.com\",\n          \"oidc.eks.\u003cAWS_REGION\u003e.amazonaws.com/id/\u003cOIDC_ID\u003e:sub\": \"system:serviceaccount:\u003cK8S_NAMESPACE\u003e:\u003cSERVICE_ACCOUNT_NAME\u003e\"\n        }\n      }\n    }\n  ]\n}\n```\n\n4. ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ IAM ì—­í• ì„ ë§Œë“œì„¸ìš”.\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\naws iam create-role --role-name my-secret-manager-role --assume-role-policy-document file://trust_policy\n```\n\n5. Attach IAM policy to IAM Role\n\n```js\naws iam attach-role-policy --policy-arn \u003cyour_policy_arn\u003e --role-name my-secret-manager-role\n```\n\nìš°ë¦¬ëŠ” í•„ìš”í•œ ëª¨ë“  IAM ì—­í• ê³¼ ì •ì±…ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n# ë‹¨ê³„ 2: ASCP ì„¤ì¹˜ ë° êµ¬ì„±\n\nì´ì œ 2ê°œì˜ Helm ì°¨íŠ¸ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.\n\n- AWS Secrets and Configuration Provider (ASCP) ì°¨íŠ¸ ì„¤ì¹˜\n\n```js\n# ASCP Helm ì°¨íŠ¸ ë¦¬í¬ì§€í† ë¦¬ ì¶”ê°€\nhelm repo add aws-secrets-manager https://aws.github.io/secrets-store-csi-driver-provider-aws\n\n# ASCP Helm ì°¨íŠ¸ ì„¤ì¹˜\nhelm install -n kube-system secrets-provider-aws aws-secrets-manager/secrets-store-csi-driver-provider-aws\n```\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n2. Secrets Store CSI Driver ì°¨íŠ¸ ì„¤ì¹˜\n\n- Secrets Store CSI Driver ì°¨íŠ¸ë¥¼ ìœ„í•œ helm ë ˆí¬ì§€í† ë¦¬ ì¶”ê°€\n\n```js\n# Secrets Store CSI Driver ì°¨íŠ¸ ë ˆí¬ì§€í† ë¦¬ ì¶”ê°€\nhelm repo add secrets-store-csi-driver https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts\n```\n\n- ê¸°ë³¸ê°’ í™•ì¸\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n# ê¸°ë³¸ ê°’ ê°€ì ¸ì˜¤ê¸°\n\nhelm show values secrets-store-csi-driver/secrets-store-csi-driver \u003e secrets-store-csi-driver.yaml\n\n- secrets-store-csi-driver.yaml íŒŒì¼ì—ì„œ ë‹¤ìŒ ê°’ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.\n\n## K8S Secrets ë™ê¸°í™”ì— í•„ìš”í•œ RBAC ì—­í•  ë° ë°”ì¸ë”© ì„¤ì¹˜ ì—¬ë¶€\n\nsyncSecret:\nenabled: true\n\n## ì‹œí¬ë¦¿ ë¡œí…Œì´ì…˜ ê¸°ëŠ¥ í™œì„±í™” [ì•ŒíŒŒ]\n\nenableSecretRotation: true\n\nìœ„ì˜ êµ¬ì„±ì€ \"secrets-store-csi-driver\"ê°€ AWS Secret Managerì—ì„œ ìµœì‹  ê°’ì„ ê°€ì ¸ì™€ í•´ë‹¹ ê°’ì„ Kubernetes Secrets ê°ì²´ì— ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\níšŒì „-íˆ¬í‘œ-ê°„ê²©ì€ ê¸°ë³¸ì ìœ¼ë¡œ 2ë¶„ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì§€ë§Œ, ì†ì„± rotationPollIntervalì„ ì„¤ì •í•¨ìœ¼ë¡œì¨ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n- Helm ì°¨íŠ¸ ì„¤ì¹˜\n\n```js\n# Helm ì°¨íŠ¸ ì„¤ì¹˜\nhelm install -n kube-system csi-secrets-store secrets-store-csi-driver/secrets-store-csi-driver -f secrets-store-csi-driver.yaml\n```\n\n# ë‹¨ê³„ 3: AWS Secret Managerì— í…ŒìŠ¤íŠ¸ ì‹œí¬ë¦¿ ìƒì„±\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nAWS Secret Managerì—ì„œ í…ŒìŠ¤íŠ¸ ì‹œí¬ë¦¿ì„ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤.\n\n```js\naws secretsmanager create-secret \\\n    --name my-test-secret \\\n    --description \"CLIë¡œ ìƒì„±í•œ ë‚´ í…ŒìŠ¤íŠ¸ ì‹œí¬ë¦¿.\" \\\n    --secret-string \"{\\\"user\\\":\\\"my-user\\\",\\\"password\\\":\\\"ì˜ˆì‹œ-ë¹„ë°€ë²ˆí˜¸\\\"}\"\n```\n\n# ë‹¨ê³„ 4: Kubernetes ServiceAccount ìƒì„±\n\nì´ì œ IAM ì—­í• ì„ ê°€ì •í•  ìˆ˜ ìˆë„ë¡ íŒŒë“œì— í—ˆìš©í•˜ëŠ” ServiceAccountë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ServiceAccountëŠ” K8s ë°°í¬ì—ì„œ ì‚¬ìš©ë  ê²ƒì…ë‹ˆë‹¤.\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nserviceaccount.yamlì´ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ ìƒì„±í•´ì£¼ì„¸ìš”.\n\n```yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: \u003cyour_service_account_name\u003e # ì´ ì´ë¦„ì€ IAM ì‹ ë¢° ì •ì±…ì„ ë§Œë“¤ ë•Œ ì§€ì •í•œ ì´ë¦„ê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.\n  annotations:\n    eks.amazonaws.com/role-arn: \u003cIAM_ROLE_ARN\u003e\n```\n\në‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ K8sì—ì„œ ì„œë¹„ìŠ¤ ê³„ì •ì„ ìƒì„±í•©ë‹ˆë‹¤.\n\n```bash\nkubectl apply -f serviceaccount.yaml\n```\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n# ë‹¨ê³„ 5: í…ŒìŠ¤íŠ¸ ê°ì²´ ìƒì„±í•˜ê¸°\n\nì´ì œ í•„ìš”í•œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ë°°í¬í–ˆìŠµë‹ˆë‹¤. ì´ì œ í…ŒìŠ¤íŠ¸ ê°ì²´ë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.\n\n- ì´ë¦„ì´ â€œmy-test-secret-manifest.yamlâ€ì¸ íŒŒì¼ ìƒì„±\n\n```js\n---\napiVersion: secrets-store.csi.x-k8s.io/v1\nkind: SecretProviderClass\nmetadata:\n  name: aws-secrets-providerclass\nspec:\n  provider: aws\n  secretObjects:\n    - secretName: my-test-k8s-secret\n      type: Opaque\n      data:\n        - objectName: user\n          key: user\n        - objectName: password\n          key: password\n  parameters:\n    objects: |\n      - objectName: arn:aws:secretsmanager:\u003cAWS_REGION\u003e:\u003cAWS_ACCOUNT_ID\u003e:secret:my-test-secret\n        jmesPath:\n          - path: user\n            objectAlias: user\n          - path: password\n            objectAlias: password\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: secret-rotation-test-ubuntu-deployment\n  labels:\n    app: ubuntu\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: ubuntu\n  template:\n    metadata:\n      labels:\n        app: ubuntu\n    spec:\n      serviceAccountName: \u003cyour_service_account_name\u003e # ì´ ì´ë¦„ì€ ë‹¨ê³„ 4ì—ì„œ ë§Œë“  ì„œë¹„ìŠ¤ ê³„ì • ì´ë¦„ê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤\n      volumes:\n      - name: mount-secrets-access\n        csi:\n          driver: secrets-store.csi.k8s.io\n          readOnly: true\n          volumeAttributes:\n            secretProviderClass: \"aws-secrets-providerclass\"\n      containers:\n      - name: ubuntu\n        image: ubuntu\n        command: [\"sleep\", \"123456\"]\n        env:\n        - name: USER\n          valueFrom:\n            secretKeyRef:\n              name: my-test-k8s-secret\n              key: user\n        - name: PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: my-test-k8s-secret\n              key: password\n        volumeMounts:\n        - name: mount-secrets-access\n          mountPath: \"/mnt/aws-secrets\"\n          readOnly: true\n```\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n2. manifestë¥¼ ì ìš©í•˜ì‹­ì‹œì˜¤\n\n```js\nkubectl apply -f my-test-secret-manifest.yaml\n```\n\n3. ë‹¤ìŒ ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë©ë‹ˆë‹¤.\n\n- SecretProviderClass ë¦¬ì†ŒìŠ¤ - AWS Secret Managerì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ K8s Secretë¥¼ ìƒì„±í•©ë‹ˆë‹¤\n- ë³¼ë¥¨ ë§ˆìš´íŠ¸ê°€ ìˆëŠ” ë°°í¬ - SecretProviderClassë¥¼ ë³¼ë¥¨ìœ¼ë¡œ ë§ˆìš´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤\n- Kubernetes Secret - íŒŒë“œ ë‚´ì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¡œ ì£¼ì…ë©ë‹ˆë‹¤\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nì•„ë˜ ë‹¤ì´ì–´ê·¸ë¨ì€ YAMLì„ ì ìš©í•  ë•Œ ë’·ë‹¨ì—ì„œ ë¬´ìŠ¨ ì¼ì´ ë²Œì–´ì§€ëŠ”ì§€ ì˜ ì‹œê°í™”í•œ ê²ƒì…ë‹ˆë‹¤.\n\n![ë‹¤ì´ì–´ê·¸ë¨](/assets/img/2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated_1.png)\n\n4. ëª¨ë“  ê²ƒì´ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.\n\n```js\n# SecretProviderClass í™•ì¸\nkubectl get SecretProviderClass aws-secrets-providerclass -o yaml\n\n# ë°°í¬ í™•ì¸\nkubectl get deploy secret-rotation-test-ubuntu-deployment -o yaml\n\n# Pod í™•ì¸\nkubectl get po \u003cpod_name\u003e -o yaml\n\n# Secret ê°€ì ¸ì˜¤ê¸°\nkubectl get secret my-test-k8s-secret -o yaml\n```\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n# ë‹¨ê³„ 6: Reloader ì„¤ì¹˜í•˜ê¸°\n\nReloaderëŠ” ConfigMapê³¼ Secretì˜ ë³€ê²½ ì‚¬í•­ì„ ê°ì§€í•˜ê³  ê´€ë ¨ëœ DeploymentConfig, Deployment, DaemonSet, StatefulSet ë° Rolloutê³¼ í•¨ê»˜ Podì˜ ë¡¤ë§ ì—…ê·¸ë ˆì´ë“œë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n- Reloader Helm Repo ì¶”ê°€\n\n```js\n# Helm Repo ì¶”ê°€\nhelm repo add stakater https://stakater.github.io/stakater-charts\n```\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n2. ê¸°ë³¸ê°’ ê°€ì ¸ì˜¤ê¸°\n\n```js\n# ê¸°ë³¸ê°’ ê°€ì ¸ì˜¤ê¸°\nhelm show values stakater/reloader \u003e reloader.yaml\n```\n\n3. reloader.yaml íŒŒì¼ ì—…ë°ì´íŠ¸í•˜ê¸°\n\n```js\nreloader:\n  # ë¦¬ë”ì‹­ ì„ ì¶œì„ í™œì„±í™”í•˜ë ¤ë©´ trueë¡œ ì„¤ì •í•˜ì—¬ ì—¬ëŸ¬ ë ˆí”Œë¦¬ì¹´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n  enableHA: true\n  deployment:\n    # ì—¬ëŸ¬ ë ˆí”Œë¦¬ì¹´ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ reloader.enableHA = trueë¡œ ì„¤ì •í•©ë‹ˆë‹¤.\n    replicas: 2\n```\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n4. Helm ì°¨íŠ¸ ì„¤ì¹˜\n\n```js\n# Helm ì°¨íŠ¸ ì„¤ì¹˜\nhelm install reloader -f reloader.yaml stakater/reloader -n kube-system\n```\n\n# ë‹¨ê³„ 7: Secret ì—…ë°ì´íŠ¸ë¡œ í…ŒìŠ¤íŠ¸í•˜ê¸°\n\n- ReloaderëŠ” ì£¼ì„ì— ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤.\n  ê¸°ë³¸ ì£¼ì„ reloader.stakater.com/autoëŠ” ì£¼ìš” ë©”íƒ€ë°ì´í„°ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì•„ë˜ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ë°°í¬ì— ì£¼ì„ì„ ì¶”ê°€í•˜ì„¸ìš”.\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n# ë°°í¬ ì£¼ì„ ì¶”ê°€\nkubectl annotate deployment secret-rotation-test-ubuntu-deployment \"reloader.stakater.com/auto=true\"\n```\n\në˜ëŠ” ë‹¤ìŒ ë¸”ë¡ìœ¼ë¡œ ë°°í¬ íŒŒì¼ì„ í¸ì§‘í•˜ê³  ì ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\n\n```js\nmetadata:\n  annotations:\n    reloader.stakater.com/auto: \"true\"\n```\n\n2. AWS Secret Managerì—ì„œ ì‹œí¬ë¦¿ ì—…ë°ì´íŠ¸í•˜ê¸°\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\naws secretsmanager put-secret-value \\\n      --secret-id my-test-secret \\\n      --secret-string \"{\\\"user\\\":\\\"diegor\\\",\\\"password\\\":\\\"SAMPLE-PASSWORD\\\"}\"\n```\n\n3. í•œ ë²ˆ ì‹œí¬ë¦¿ì´ AWS ì‹œí¬ë¦¿ ìŠ¤í† ì–´ csi ë“œë¼ì´ë²„ì— ì—…ë°ì´íŠ¸ë˜ë©´ K8s ì‹œí¬ë¦¿ì´ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤. K8s ì‹œí¬ë¦¿ì´ ì—…ë°ì´íŠ¸ë˜ë©´ Reloaderê°€ ë¡¤ì•„ì›ƒì„ ë‹¤ì‹œ ì‹œì‘í•˜ë„ë¡ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.\n\n```js\n# K8s ì‹œí¬ë¦¿ì„ í™•ì¸í•˜ì„¸ìš”. ìƒˆë¡œìš´ ê°’ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.\nkubectl get secret my-test-k8s-secret -o yaml\n\n# Podë¥¼ í™•ì¸í•˜ì„¸ìš”. ëª‡ ì´ˆ ì „ì— ì‹œì‘ë˜ì—ˆì–´ì•¼ í•©ë‹ˆë‹¤.\nkubectl get po\n\n# Reloader íŒŸì˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.\nkubectl logs \u003creloader-pod-name\u003e -n kube-system\n\n# Podë¡œ ì‹¤í–‰ í›„ ìƒˆë¡œìš´ ê°’ì„ í™•ì¸í•˜ì„¸ìš”.\nkubectl exec -it \u003cpod_name\u003e -- bash\n\n# Podì— ë“¤ì–´ê°„ í›„ `env` ëª…ë ¹ì„ ì‹¤í–‰í•˜ì„¸ìš”. Podì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.\n```\n\n# ë‹¨ê³„ 8: ConfigMap ì—…ë°ì´íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- \"my-test-cm-manifest.yaml\" íŒŒì¼ì„ ìƒì„±í•´ì£¼ì„¸ìš”.\n\n```yaml\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: my-test-k8s-cm\ndata:\n  myvalue: \"Hello World\"\n  drink: coffee\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: reloader-poc-ubuntu-deployment\n  labels:\n    app: ubuntu\n  annotations:\n    reloader.stakater.com/auto: \"true\"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: ubuntu\n  template:\n    metadata:\n      labels:\n        app: ubuntu\n    spec:\n      containers:\n        - name: ubuntu\n          image: ubuntu\n          command: [\"sleep\", \"123456\"]\n          env:\n            - name: DRINK\n              valueFrom:\n                configMapKeyRef:\n                  name: my-test-k8s-cm\n                  key: drink\n            - name: MYVALUE\n              valueFrom:\n                configMapKeyRef:\n                  name: my-test-k8s-cm\n                  key: myvalue\n```\n\n2. ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì ìš©\n\n```bash\nkubectl apply -f my-test-cm-manifest.yaml\n```\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n3. my-test-cm-manifest.yaml íŒŒì¼ì—ì„œ configmapì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.\n\n```yaml\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: my-test-k8s-cm\ndata:\n  myvalue: \"ì•ˆë…•í•˜ì„¸ìš”\"\n  drink: ì°¨\n```\n\n4. íŒŒì¼ì„ ë‹¤ì‹œ ì ìš©í•˜ì„¸ìš”.\n\n```yaml\nkubectl apply -f my-test-cm-manifest.yaml\n```\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n5. í™•ì¸\n\n```js\n# ConfigMap í™•ì¸\nkubectl get cm my-test-k8s-cm -o yaml\n\n# Pod í™•ì¸\nkubectl get po\n\n# Podì— ì ‘ì†í•˜ì—¬ ìƒˆ ê°’ í™•ì¸\nkubectl exec -it \u003cpod_name\u003e -- bash\n\n# Podì— ë“¤ì–´ê°„ í›„ `env` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ Pod ë‚´ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ê°€ ì¶œë ¥ë©ë‹ˆë‹¤\n```\n\nì¶•í•˜í•©ë‹ˆë‹¤!!! secret-store-csi-driverì™€ reloaderë¥¼ ì„±ê³µì ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.\n\nê°ì‚¬í•©ë‹ˆë‹¤!!!\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n## ì°¸ê³  ìë£Œ:\n\n- [AWS ê³µì‹ ë¬¸ì„œ - CSI ë“œë¼ì´ë²„ í†µí•©](https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html)\n- [Bootlabs ê¸°ìˆ  ë¸”ë¡œê·¸ - AWS Secrets Manager in Kubernetes ì‹œí¬ë¦¿ íšŒì „ê³¼ ë¦¬ë¡œë”](https://blog.bootlabstech.com/aws-secrets-manager-in-kubernetes-secret-rotation-and-reloader)\n- [Secrets Store CSI ë“œë¼ì´ë²„ ê³µì‹ í™ˆí˜ì´ì§€ - ì‹œí¬ë¦¿ ìë™ íšŒì „](https://secrets-store-csi-driver.sigs.k8s.io/topics/secret-auto-rotation)\n- [Secrets Store CSI ë“œë¼ì´ë²„ ì°¨íŠ¸ ê°’ ì„¤ì • íŒŒì¼](https://github.com/kubernetes-sigs/secrets-store-csi-driver/blob/main/charts/secrets-store-csi-driver/values.yaml)\n- [Reloader GitHub ì €ì¥ì†Œ](https://github.com/stakater/Reloader/tree/master)\n- [Reloader ì‘ë™ í™•ì¸ ë¬¸ì„œ](https://github.com/stakater/Reloader/blob/master/docs/Verify-Reloader-Working.md)\n- [Reloader ì‘ë™ ë°©ì‹ ë¬¸ì„œ](https://github.com/stakater/Reloader/blob/master/docs/How-it-works.md)\n\n# ê°„ë‹¨íˆ ë§í•˜ìë©´ ğŸš€\n\nIn Plain English ì»¤ë®¤ë‹ˆí‹°ì˜ ì¼ì›ì´ ë˜ì–´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ê³„ì† ì°¸ì—¬í•´ ì£¼ì„¸ìš”:\n\n\u003c!-- ui-station ì‚¬ê°í˜• --\u003e\n\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n- ì‘ê°€ì—ê²Œ ë°•ìˆ˜ë¥¼ ë³´ë‚´ê³  íŒ”ë¡œìš°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš” ï¸ğŸ‘ï¸ï¸\n- íŒ”ë¡œìš°í•˜ê¸°: X | LinkedIn | YouTube | Discord | Newsletter\n- ë‹¤ë¥¸ í”Œë«í¼ì—ì„œ ì €í¬ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”: Stackademic | CoFeed | Venture | Cubed\n- ì•Œê³ ë¦¬ì¦˜ ì½˜í…ì¸ ë¥¼ ë‹¤ë¤„ì•¼ í•˜ëŠ” ë¸”ë¡œê·¸ í”Œë«í¼ì— ì§€ì³¤ë‚˜ìš”? Differë¥¼ ì‹œë„í•´ë³´ì„¸ìš”\n- PlainEnglish.ioì—ì„œ ë” ë§ì€ ì½˜í…ì¸ ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”\n","ogImage":{"url":"/assets/img/2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated_0.png"},"coverImage":"/assets/img/2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated_0.png","tag":["Tech"],"readingTime":19},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003ch2\u003eìë™ ë¡¤ì•„ì›ƒ ì¬ì‹œì‘: K8s ConfigMap ë˜ëŠ” Secretê°€ ì—…ë°ì´íŠ¸ë  ë•Œ ë°°í¬ ë‹¤ì‹œ ì‹œì‘í•˜ê¸°\u003c/h2\u003e\n\u003cp\u003eì¿ ë²„ë„¤í‹°ìŠ¤ ë°°í¬ëŠ” ëª¨ë“  ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ì„œ ê°€ì¥ ì¼ë°˜ì ì¸ ë¦¬ì†ŒìŠ¤ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ëª¨ë‘ podë¥¼ K8s ë°°í¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰í•˜ì—¬ ë†’ì€ ê°€ìš©ì„±ì„ ë³´ì¥í•˜ê³ , podê°€ ì‚­ì œë˜ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ë„ë¡í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•­ìƒ ì—¬ëŸ¬ í™˜ê²½ì—ì„œ ì›í™œí•˜ê²Œ ì‹¤í–‰ë˜ë„ë¡í•˜ê¸° ìœ„í•´ êµ¬ì„±ì´ í•„ìš”í•œ ê²ƒì€ ë§¤ìš° í”í•©ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ì ì´ë¦„, ë¹„ë°€ë²ˆí˜¸ ë“±ê³¼ ê°™ì€ ì¤‘ìš”í•œ ì •ë³´ê°€ í•„ìš”í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œëŠ” êµ¬ì„± ë§µê³¼ ì‹œí¬ë¦¿ì„ ì‚¬ìš©í•˜ì—¬ ì‘ìš© í”„ë¡œê·¸ë¨ë³„ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  podë¡œ ì£¼ì…í•˜ì—¬ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eê·¸ë ‡ë‹¤ë©´ êµ¬ì„± ë§µì´ë‚˜ ì‹œí¬ë¦¿ì˜ ê°’ì„ ì—…ë°ì´íŠ¸í–ˆì„ ë•ŒëŠ” ì–´ë–¨ê¹Œìš”? ìµœì‹  ê°’ì„ ë°˜ì˜í•˜ë ¤ë©´ podë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ì•¼í•©ë‹ˆë‹¤, ë§ì£ ? ë˜ëŠ” ë¡¤ì•„ì›ƒì„ ë‹¤ì‹œ ì‹œì‘í•˜ì—¬ ìƒˆë¡œìš´ podë¥¼ ìƒì„±í•˜ê²Œ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ì œ ìƒìƒí•´ë³´ì„¸ìš”. ê³µí†µ configmap ë˜ëŠ” secretì„ ì‚¬ìš©í•˜ëŠ” ìˆ˜ë°± ê°œì˜ ë°°í¬ê°€ ìˆê³  ê·¸ ê°’ì„ ì—…ë°ì´íŠ¸í•˜ê³  ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ìµœì‹  ê°’ì´ë¼ëŠ” ê²ƒì„ í™•ì‹¤í•˜ê²Œ í•´ì•¼í•œë‹¤ê³  ê°€ì •í•´ë³´ì„¸ìš”.\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eì €í¬ëŠ” AWS Secrets Managerì— ë¹„ë°€ì„ ì €ì¥í•˜ê³ , Kubernetes Secrets Store CSI Driverë¥¼ ìœ„í•´ AWS Secrets ë° êµ¬ì„± ì œê³µì(ASCP)ë¡œë¶€í„° Kubernetes Secretsë¥¼ ìƒì„±í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eì´ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ì—ì„œëŠ” Secret ë˜ëŠ” ConfigMapì´ ì—…ë°ì´íŠ¸ë  ë•Œ Kubernetes ë°°í¬ë¥¼ ìë™ìœ¼ë¡œ ë¡¤ì•„ì›ƒ ë° ë‹¤ì‹œ ì‹œì‘í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003ch1\u003eì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨:\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated_0.png\" alt=\"Architecture Diagram\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003ch2\u003eì‹œì‘í•´ ë´…ì‹œë‹¤!\u003c/h2\u003e\n\u003ch3\u003eì¤€ë¹„ë¬¼:\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eEKS í´ëŸ¬ìŠ¤í„°\u003c/li\u003e\n\u003cli\u003eEKSë¥¼ ìœ„í•œ OIDC ì œê³µì êµ¬ì„± í•„ìš”\u003c/li\u003e\n\u003cli\u003eKubectl\u003c/li\u003e\n\u003cli\u003eAWS CLI\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eë‹¨ê³„ 1: ASCPë¥¼ ìœ„í•œ IAM ì—­í•  ë° ì •ì±… ìƒì„±\u003c/h3\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eASCP(Amazon EKS Security Token Service)ëŠ” Amazon EKS íŒŒë“œ IDë¥¼ ê²€ìƒ‰í•˜ì—¬ IAM ì—­í• ë¡œ êµí™˜í•©ë‹ˆë‹¤. í•´ë‹¹ IAM ì—­í• ì— ëŒ€í•œ IAM ì •ì±…ì—ì„œ ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤. ASCPê°€ IAM ì—­í• ì„ ê°€ì •í•˜ë©´ ê¶Œí•œì„ ë¶€ì—¬ë°›ì€ ì‹œí¬ë¦¿ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆëŠ” IAM ì—­í• ê³¼ ì—°ê²°ë˜ì§€ ì•ŠëŠ” í•œ ì‹œí¬ë¦¿ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIAM ì •ì±… ë¬¸ì„œ ì‘ì„±\n\"secrets_policy\"ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ ë§Œë“¤ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•˜ì‹­ì‹œì˜¤.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e{\n    \u003cspan class=\"hljs-string\"\u003e\"Version\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"2012-10-17\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"Statement\"\u003c/span\u003e: [\n        {\n            \u003cspan class=\"hljs-string\"\u003e\"Action\"\u003c/span\u003e: [\n                \u003cspan class=\"hljs-string\"\u003e\"secretsmanager:DescribeSecret\"\u003c/span\u003e,\n                \u003cspan class=\"hljs-string\"\u003e\"secretsmanager:GetSecretValue\"\u003c/span\u003e\n            ],\n            \u003cspan class=\"hljs-string\"\u003e\"Effect\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Allow\"\u003c/span\u003e,\n            \u003cspan class=\"hljs-string\"\u003e\"Resource\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"*\"\u003c/span\u003e\n        }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ IAM ì •ì±…ì„ ë§Œë“­ë‹ˆë‹¤.\nIAM ì •ì±…ì„ IAM ì—­í• ì— ì—°ê²°í•  ë•Œ policy ARNì„ ë©”ëª¨í•˜ì‹­ì‹œì˜¤.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eaws iam create-policy \\\n    --policy-name my-secret-manager-policy \\\n    --policy-\u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003efile\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//secrets_policy\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003eIAM ì—­í• ì— ì‹ ë¢° ì •ì±… ìƒì„±í•˜ê¸°\n\"trust_policy\"ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•˜ì„¸ìš”. ì˜¬ë°”ë¥¸ ê°’ìœ¼ë¡œ ëŒ€ì²´í•´ì•¼ í•©ë‹ˆë‹¤. \u003ccode\u003eSERVICE_ACCOUNT_NAME\u003c/code\u003eì€ ì„ì˜ë¡œ ì§€ì •í•  ìˆ˜ ìˆì§€ë§Œ Kubernetesì—ì„œ ì‹¤ì œ ì„œë¹„ìŠ¤ ê³„ì •ì„ ìƒì„±í•  ë•Œ ë™ì¼í•œ ì´ë¦„ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e{\n  \u003cspan class=\"hljs-string\"\u003e\"Version\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"2012-10-17\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"Statement\"\u003c/span\u003e: [\n    {\n      \u003cspan class=\"hljs-string\"\u003e\"Effect\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Allow\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\"Action\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"sts:AssumeRoleWithWebIdentity\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\"Principal\"\u003c/span\u003e: {\n        \u003cspan class=\"hljs-string\"\u003e\"Federated\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"arn:aws:iam::\u0026#x3C;AWS_ACCOUNT_ID\u003e:oidc-provider/oidc.eks.\u0026#x3C;AWS_REGION\u003e.amazonaws.com/id/\u0026#x3C;OIDC_ID\u003e\"\u003c/span\u003e\n      },\n      \u003cspan class=\"hljs-string\"\u003e\"Condition\"\u003c/span\u003e: {\n        \u003cspan class=\"hljs-string\"\u003e\"StringEquals\"\u003c/span\u003e: {\n          \u003cspan class=\"hljs-string\"\u003e\"oidc.eks.\u0026#x3C;AWS_REGION\u003e.amazonaws.com/id/\u0026#x3C;OIDC_ID\u003e:aud\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"sts.amazonaws.com\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"oidc.eks.\u0026#x3C;AWS_REGION\u003e.amazonaws.com/id/\u0026#x3C;OIDC_ID\u003e:sub\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"system:serviceaccount:\u0026#x3C;K8S_NAMESPACE\u003e:\u0026#x3C;SERVICE_ACCOUNT_NAME\u003e\"\u003c/span\u003e\n        }\n      }\n    }\n  ]\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003eë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ IAM ì—­í• ì„ ë§Œë“œì„¸ìš”.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eaws iam create-role --role-name my-secret-manager-role --assume-role-policy-\u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003efile\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//trust_policy\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"5\"\u003e\n\u003cli\u003eAttach IAM policy to IAM Role\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eaws iam attach-role-policy --policy-arn \u0026#x3C;your_policy_arn\u003e --role-name my-secret-manager-role\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eìš°ë¦¬ëŠ” í•„ìš”í•œ ëª¨ë“  IAM ì—­í• ê³¼ ì •ì±…ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003ch1\u003eë‹¨ê³„ 2: ASCP ì„¤ì¹˜ ë° êµ¬ì„±\u003c/h1\u003e\n\u003cp\u003eì´ì œ 2ê°œì˜ Helm ì°¨íŠ¸ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAWS Secrets and Configuration Provider (ASCP) ì°¨íŠ¸ ì„¤ì¹˜\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# \u003cspan class=\"hljs-variable constant_\"\u003eASCP\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHelm\u003c/span\u003e ì°¨íŠ¸ ë¦¬í¬ì§€í† ë¦¬ ì¶”ê°€\nhelm repo add aws-secrets-manager \u003cspan class=\"hljs-attr\"\u003ehttps\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//aws.github.io/secrets-store-csi-driver-provider-aws\u003c/span\u003e\n\n# \u003cspan class=\"hljs-variable constant_\"\u003eASCP\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHelm\u003c/span\u003e ì°¨íŠ¸ ì„¤ì¹˜\nhelm install -n kube-system secrets-provider-aws aws-secrets-manager/secrets-store-csi-driver-provider-aws\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eSecrets Store CSI Driver ì°¨íŠ¸ ì„¤ì¹˜\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003eSecrets Store CSI Driver ì°¨íŠ¸ë¥¼ ìœ„í•œ helm ë ˆí¬ì§€í† ë¦¬ ì¶”ê°€\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# \u003cspan class=\"hljs-title class_\"\u003eSecrets\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eStore\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eCSI\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDriver\u003c/span\u003e ì°¨íŠ¸ ë ˆí¬ì§€í† ë¦¬ ì¶”ê°€\nhelm repo add secrets-store-csi-driver \u003cspan class=\"hljs-attr\"\u003ehttps\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//kubernetes-sigs.github.io/secrets-store-csi-driver/charts\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eê¸°ë³¸ê°’ í™•ì¸\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003ch1\u003eê¸°ë³¸ ê°’ ê°€ì ¸ì˜¤ê¸°\u003c/h1\u003e\n\u003cp\u003ehelm show values secrets-store-csi-driver/secrets-store-csi-driver \u003e secrets-store-csi-driver.yaml\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003esecrets-store-csi-driver.yaml íŒŒì¼ì—ì„œ ë‹¤ìŒ ê°’ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eK8S Secrets ë™ê¸°í™”ì— í•„ìš”í•œ RBAC ì—­í•  ë° ë°”ì¸ë”© ì„¤ì¹˜ ì—¬ë¶€\u003c/h2\u003e\n\u003cp\u003esyncSecret:\nenabled: true\u003c/p\u003e\n\u003ch2\u003eì‹œí¬ë¦¿ ë¡œí…Œì´ì…˜ ê¸°ëŠ¥ í™œì„±í™” [ì•ŒíŒŒ]\u003c/h2\u003e\n\u003cp\u003eenableSecretRotation: true\u003c/p\u003e\n\u003cp\u003eìœ„ì˜ êµ¬ì„±ì€ \"secrets-store-csi-driver\"ê°€ AWS Secret Managerì—ì„œ ìµœì‹  ê°’ì„ ê°€ì ¸ì™€ í•´ë‹¹ ê°’ì„ Kubernetes Secrets ê°ì²´ì— ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eíšŒì „-íˆ¬í‘œ-ê°„ê²©ì€ ê¸°ë³¸ì ìœ¼ë¡œ 2ë¶„ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì§€ë§Œ, ì†ì„± rotationPollIntervalì„ ì„¤ì •í•¨ìœ¼ë¡œì¨ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eHelm ì°¨íŠ¸ ì„¤ì¹˜\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# \u003cspan class=\"hljs-title class_\"\u003eHelm\u003c/span\u003e ì°¨íŠ¸ ì„¤ì¹˜\nhelm install -n kube-system csi-secrets-store secrets-store-csi-driver/secrets-store-csi-driver -f secrets-store-csi-driver.\u003cspan class=\"hljs-property\"\u003eyaml\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eë‹¨ê³„ 3: AWS Secret Managerì— í…ŒìŠ¤íŠ¸ ì‹œí¬ë¦¿ ìƒì„±\u003c/h1\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eAWS Secret Managerì—ì„œ í…ŒìŠ¤íŠ¸ ì‹œí¬ë¦¿ì„ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eaws secretsmanager create-secret \\\n    --name my-test-secret \\\n    --description \u003cspan class=\"hljs-string\"\u003e\"CLIë¡œ ìƒì„±í•œ ë‚´ í…ŒìŠ¤íŠ¸ ì‹œí¬ë¦¿.\"\u003c/span\u003e \\\n    --secret-string \u003cspan class=\"hljs-string\"\u003e\"{\\\"user\\\":\\\"my-user\\\",\\\"password\\\":\\\"ì˜ˆì‹œ-ë¹„ë°€ë²ˆí˜¸\\\"}\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eë‹¨ê³„ 4: Kubernetes ServiceAccount ìƒì„±\u003c/h1\u003e\n\u003cp\u003eì´ì œ IAM ì—­í• ì„ ê°€ì •í•  ìˆ˜ ìˆë„ë¡ íŒŒë“œì— í—ˆìš©í•˜ëŠ” ServiceAccountë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ServiceAccountëŠ” K8s ë°°í¬ì—ì„œ ì‚¬ìš©ë  ê²ƒì…ë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eserviceaccount.yamlì´ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ ìƒì„±í•´ì£¼ì„¸ìš”.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003eapiVersion:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ev1\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003ekind:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eServiceAccount\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003emetadata:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;your_service_account_name\u003e\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e# ì´ ì´ë¦„ì€ IAM ì‹ ë¢° ì •ì±…ì„ ë§Œë“¤ ë•Œ ì§€ì •í•œ ì´ë¦„ê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eannotations:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eeks.amazonaws.com/role-arn:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;IAM_ROLE_ARN\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ K8sì—ì„œ ì„œë¹„ìŠ¤ ê³„ì •ì„ ìƒì„±í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ekubectl apply -f serviceaccount.yaml\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003ch1\u003eë‹¨ê³„ 5: í…ŒìŠ¤íŠ¸ ê°ì²´ ìƒì„±í•˜ê¸°\u003c/h1\u003e\n\u003cp\u003eì´ì œ í•„ìš”í•œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ë°°í¬í–ˆìŠµë‹ˆë‹¤. ì´ì œ í…ŒìŠ¤íŠ¸ ê°ì²´ë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eì´ë¦„ì´ â€œmy-test-secret-manifest.yamlâ€ì¸ íŒŒì¼ ìƒì„±\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e---\n\u003cspan class=\"hljs-attr\"\u003eapiVersion\u003c/span\u003e: secrets-store.\u003cspan class=\"hljs-property\"\u003ecsi\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ex\u003c/span\u003e-k8s.\u003cspan class=\"hljs-property\"\u003eio\u003c/span\u003e/v1\n\u003cspan class=\"hljs-attr\"\u003ekind\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eSecretProviderClass\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003emetadata\u003c/span\u003e:\n  \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: aws-secrets-provider\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e\n\u003cspan class=\"hljs-title class_\"\u003espec\u003c/span\u003e:\n  \u003cspan class=\"hljs-attr\"\u003eprovider\u003c/span\u003e: aws\n  \u003cspan class=\"hljs-attr\"\u003esecretObjects\u003c/span\u003e:\n    - \u003cspan class=\"hljs-attr\"\u003esecretName\u003c/span\u003e: my-test-k8s-secret\n      \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eOpaque\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003edata\u003c/span\u003e:\n        - \u003cspan class=\"hljs-attr\"\u003eobjectName\u003c/span\u003e: user\n          \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e: user\n        - \u003cspan class=\"hljs-attr\"\u003eobjectName\u003c/span\u003e: password\n          \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e: password\n  \u003cspan class=\"hljs-attr\"\u003eparameters\u003c/span\u003e:\n    \u003cspan class=\"hljs-attr\"\u003eobjects\u003c/span\u003e: |\n      - \u003cspan class=\"hljs-attr\"\u003eobjectName\u003c/span\u003e: \u003cspan class=\"hljs-attr\"\u003earn\u003c/span\u003e:\u003cspan class=\"hljs-attr\"\u003eaws\u003c/span\u003e:\u003cspan class=\"hljs-attr\"\u003esecretsmanager\u003c/span\u003e:\u0026#x3C;\u003cspan class=\"hljs-variable constant_\"\u003eAWS_REGION\u003c/span\u003e\u003e:\u0026#x3C;\u003cspan class=\"hljs-variable constant_\"\u003eAWS_ACCOUNT_ID\u003c/span\u003e\u003e:\u003cspan class=\"hljs-attr\"\u003esecret\u003c/span\u003e:my-test-secret\n        \u003cspan class=\"hljs-attr\"\u003ejmesPath\u003c/span\u003e:\n          - \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: user\n            \u003cspan class=\"hljs-attr\"\u003eobjectAlias\u003c/span\u003e: user\n          - \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: password\n            \u003cspan class=\"hljs-attr\"\u003eobjectAlias\u003c/span\u003e: password\n---\n\u003cspan class=\"hljs-attr\"\u003eapiVersion\u003c/span\u003e: apps/v1\n\u003cspan class=\"hljs-attr\"\u003ekind\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eDeployment\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003emetadata\u003c/span\u003e:\n  \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: secret-rotation-test-ubuntu-deployment\n  \u003cspan class=\"hljs-attr\"\u003elabels\u003c/span\u003e:\n    \u003cspan class=\"hljs-attr\"\u003eapp\u003c/span\u003e: ubuntu\n\u003cspan class=\"hljs-attr\"\u003espec\u003c/span\u003e:\n  \u003cspan class=\"hljs-attr\"\u003ereplicas\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eselector\u003c/span\u003e:\n    \u003cspan class=\"hljs-attr\"\u003ematchLabels\u003c/span\u003e:\n      \u003cspan class=\"hljs-attr\"\u003eapp\u003c/span\u003e: ubuntu\n  \u003cspan class=\"hljs-attr\"\u003etemplate\u003c/span\u003e:\n    \u003cspan class=\"hljs-attr\"\u003emetadata\u003c/span\u003e:\n      \u003cspan class=\"hljs-attr\"\u003elabels\u003c/span\u003e:\n        \u003cspan class=\"hljs-attr\"\u003eapp\u003c/span\u003e: ubuntu\n    \u003cspan class=\"hljs-attr\"\u003espec\u003c/span\u003e:\n      \u003cspan class=\"hljs-attr\"\u003eserviceAccountName\u003c/span\u003e: \u0026#x3C;your_service_account_name\u003e # ì´ ì´ë¦„ì€ ë‹¨ê³„ \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003eì—ì„œ ë§Œë“  ì„œë¹„ìŠ¤ ê³„ì • ì´ë¦„ê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤\n      \u003cspan class=\"hljs-attr\"\u003evolumes\u003c/span\u003e:\n      - \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: mount-secrets-access\n        \u003cspan class=\"hljs-attr\"\u003ecsi\u003c/span\u003e:\n          \u003cspan class=\"hljs-attr\"\u003edriver\u003c/span\u003e: secrets-store.\u003cspan class=\"hljs-property\"\u003ecsi\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ek8s\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eio\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ereadOnly\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003evolumeAttributes\u003c/span\u003e:\n            \u003cspan class=\"hljs-attr\"\u003esecretProviderClass\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"aws-secrets-providerclass\"\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003econtainers\u003c/span\u003e:\n      - \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: ubuntu\n        \u003cspan class=\"hljs-attr\"\u003eimage\u003c/span\u003e: ubuntu\n        \u003cspan class=\"hljs-attr\"\u003ecommand\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\"sleep\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"123456\"\u003c/span\u003e]\n        \u003cspan class=\"hljs-attr\"\u003eenv\u003c/span\u003e:\n        - \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-variable constant_\"\u003eUSER\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003evalueFrom\u003c/span\u003e:\n            \u003cspan class=\"hljs-attr\"\u003esecretKeyRef\u003c/span\u003e:\n              \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: my-test-k8s-secret\n              \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e: user\n        - \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-variable constant_\"\u003ePASSWORD\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003evalueFrom\u003c/span\u003e:\n            \u003cspan class=\"hljs-attr\"\u003esecretKeyRef\u003c/span\u003e:\n              \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: my-test-k8s-secret\n              \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e: password\n        \u003cspan class=\"hljs-attr\"\u003evolumeMounts\u003c/span\u003e:\n        - \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: mount-secrets-access\n          \u003cspan class=\"hljs-attr\"\u003emountPath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"/mnt/aws-secrets\"\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ereadOnly\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003emanifestë¥¼ ì ìš©í•˜ì‹­ì‹œì˜¤\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003ekubectl apply -f my-test-secret-manifest.\u003cspan class=\"hljs-property\"\u003eyaml\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003eë‹¤ìŒ ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë©ë‹ˆë‹¤.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003eSecretProviderClass ë¦¬ì†ŒìŠ¤ - AWS Secret Managerì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ K8s Secretë¥¼ ìƒì„±í•©ë‹ˆë‹¤\u003c/li\u003e\n\u003cli\u003eë³¼ë¥¨ ë§ˆìš´íŠ¸ê°€ ìˆëŠ” ë°°í¬ - SecretProviderClassë¥¼ ë³¼ë¥¨ìœ¼ë¡œ ë§ˆìš´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤\u003c/li\u003e\n\u003cli\u003eKubernetes Secret - íŒŒë“œ ë‚´ì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¡œ ì£¼ì…ë©ë‹ˆë‹¤\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eì•„ë˜ ë‹¤ì´ì–´ê·¸ë¨ì€ YAMLì„ ì ìš©í•  ë•Œ ë’·ë‹¨ì—ì„œ ë¬´ìŠ¨ ì¼ì´ ë²Œì–´ì§€ëŠ”ì§€ ì˜ ì‹œê°í™”í•œ ê²ƒì…ë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated_1.png\" alt=\"ë‹¤ì´ì–´ê·¸ë¨\"\u003e\u003c/p\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003eëª¨ë“  ê²ƒì´ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# \u003cspan class=\"hljs-title class_\"\u003eSecretProviderClass\u003c/span\u003e í™•ì¸\nkubectl get \u003cspan class=\"hljs-title class_\"\u003eSecretProviderClass\u003c/span\u003e aws-secrets-providerclass -o yaml\n\n# ë°°í¬ í™•ì¸\nkubectl get deploy secret-rotation-test-ubuntu-deployment -o yaml\n\n# \u003cspan class=\"hljs-title class_\"\u003ePod\u003c/span\u003e í™•ì¸\nkubectl get po \u0026#x3C;pod_name\u003e -o yaml\n\n# \u003cspan class=\"hljs-title class_\"\u003eSecret\u003c/span\u003e ê°€ì ¸ì˜¤ê¸°\nkubectl get secret my-test-k8s-secret -o yaml\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003ch1\u003eë‹¨ê³„ 6: Reloader ì„¤ì¹˜í•˜ê¸°\u003c/h1\u003e\n\u003cp\u003eReloaderëŠ” ConfigMapê³¼ Secretì˜ ë³€ê²½ ì‚¬í•­ì„ ê°ì§€í•˜ê³  ê´€ë ¨ëœ DeploymentConfig, Deployment, DaemonSet, StatefulSet ë° Rolloutê³¼ í•¨ê»˜ Podì˜ ë¡¤ë§ ì—…ê·¸ë ˆì´ë“œë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eReloader Helm Repo ì¶”ê°€\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# \u003cspan class=\"hljs-title class_\"\u003eHelm\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eRepo\u003c/span\u003e ì¶”ê°€\nhelm repo add stakater \u003cspan class=\"hljs-attr\"\u003ehttps\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//stakater.github.io/stakater-charts\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eê¸°ë³¸ê°’ ê°€ì ¸ì˜¤ê¸°\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# ê¸°ë³¸ê°’ ê°€ì ¸ì˜¤ê¸°\nhelm show values stakater/reloader \u003e reloader.\u003cspan class=\"hljs-property\"\u003eyaml\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003ereloader.yaml íŒŒì¼ ì—…ë°ì´íŠ¸í•˜ê¸°\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-attr\"\u003ereloader\u003c/span\u003e:\n  # ë¦¬ë”ì‹­ ì„ ì¶œì„ í™œì„±í™”í•˜ë ¤ë©´ \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003eë¡œ ì„¤ì •í•˜ì—¬ ì—¬ëŸ¬ ë ˆí”Œë¦¬ì¹´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n  \u003cspan class=\"hljs-attr\"\u003eenableHA\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edeployment\u003c/span\u003e:\n    # ì—¬ëŸ¬ ë ˆí”Œë¦¬ì¹´ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ reloader.\u003cspan class=\"hljs-property\"\u003eenableHA\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003eë¡œ ì„¤ì •í•©ë‹ˆë‹¤.\n    \u003cspan class=\"hljs-attr\"\u003ereplicas\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003eHelm ì°¨íŠ¸ ì„¤ì¹˜\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# \u003cspan class=\"hljs-title class_\"\u003eHelm\u003c/span\u003e ì°¨íŠ¸ ì„¤ì¹˜\nhelm install reloader -f reloader.\u003cspan class=\"hljs-property\"\u003eyaml\u003c/span\u003e stakater/reloader -n kube-system\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eë‹¨ê³„ 7: Secret ì—…ë°ì´íŠ¸ë¡œ í…ŒìŠ¤íŠ¸í•˜ê¸°\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eReloaderëŠ” ì£¼ì„ì— ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤.\nê¸°ë³¸ ì£¼ì„ reloader.stakater.com/autoëŠ” ì£¼ìš” ë©”íƒ€ë°ì´í„°ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì•„ë˜ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ë°°í¬ì— ì£¼ì„ì„ ì¶”ê°€í•˜ì„¸ìš”.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# ë°°í¬ ì£¼ì„ ì¶”ê°€\nkubectl annotate deployment secret-rotation-test-ubuntu-deployment \u003cspan class=\"hljs-string\"\u003e\"reloader.stakater.com/auto=true\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eë˜ëŠ” ë‹¤ìŒ ë¸”ë¡ìœ¼ë¡œ ë°°í¬ íŒŒì¼ì„ í¸ì§‘í•˜ê³  ì ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-attr\"\u003emetadata\u003c/span\u003e:\n  \u003cspan class=\"hljs-attr\"\u003eannotations\u003c/span\u003e:\n    reloader.\u003cspan class=\"hljs-property\"\u003estakater\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ecom\u003c/span\u003e/\u003cspan class=\"hljs-attr\"\u003eauto\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eAWS Secret Managerì—ì„œ ì‹œí¬ë¦¿ ì—…ë°ì´íŠ¸í•˜ê¸°\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eaws secretsmanager put-secret-value \\\n      --secret-id my-test-secret \\\n      --secret-string \u003cspan class=\"hljs-string\"\u003e\"{\\\"user\\\":\\\"diegor\\\",\\\"password\\\":\\\"SAMPLE-PASSWORD\\\"}\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003eí•œ ë²ˆ ì‹œí¬ë¦¿ì´ AWS ì‹œí¬ë¦¿ ìŠ¤í† ì–´ csi ë“œë¼ì´ë²„ì— ì—…ë°ì´íŠ¸ë˜ë©´ K8s ì‹œí¬ë¦¿ì´ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤. K8s ì‹œí¬ë¦¿ì´ ì—…ë°ì´íŠ¸ë˜ë©´ Reloaderê°€ ë¡¤ì•„ì›ƒì„ ë‹¤ì‹œ ì‹œì‘í•˜ë„ë¡ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# K8s ì‹œí¬ë¦¿ì„ í™•ì¸í•˜ì„¸ìš”. ìƒˆë¡œìš´ ê°’ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.\nkubectl get secret my-test-k8s-secret -o yaml\n\n# \u003cspan class=\"hljs-title class_\"\u003ePod\u003c/span\u003eë¥¼ í™•ì¸í•˜ì„¸ìš”. ëª‡ ì´ˆ ì „ì— ì‹œì‘ë˜ì—ˆì–´ì•¼ í•©ë‹ˆë‹¤.\nkubectl get po\n\n# \u003cspan class=\"hljs-title class_\"\u003eReloader\u003c/span\u003e íŒŸì˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.\nkubectl logs \u0026#x3C;reloader-pod-name\u003e -n kube-system\n\n# \u003cspan class=\"hljs-title class_\"\u003ePod\u003c/span\u003eë¡œ ì‹¤í–‰ í›„ ìƒˆë¡œìš´ ê°’ì„ í™•ì¸í•˜ì„¸ìš”.\nkubectl exec -it \u0026#x3C;pod_name\u003e -- bash\n\n# \u003cspan class=\"hljs-title class_\"\u003ePod\u003c/span\u003eì— ë“¤ì–´ê°„ í›„ \u003cspan class=\"hljs-string\"\u003e`env`\u003c/span\u003e ëª…ë ¹ì„ ì‹¤í–‰í•˜ì„¸ìš”. \u003cspan class=\"hljs-title class_\"\u003ePod\u003c/span\u003eì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eë‹¨ê³„ 8: ConfigMap ì—…ë°ì´íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.\u003c/h1\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\"my-test-cm-manifest.yaml\" íŒŒì¼ì„ ìƒì„±í•´ì£¼ì„¸ìš”.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-meta\"\u003e---\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eapiVersion:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ev1\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003ekind:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eConfigMap\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003emetadata:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emy-test-k8s-cm\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003edata:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003emyvalue:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Hello World\"\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edrink:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecoffee\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e---\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eapiVersion:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eapps/v1\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003ekind:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eDeployment\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003emetadata:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ereloader-poc-ubuntu-deployment\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003elabels:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eapp:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eannotations:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ereloader.stakater.com/auto:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"true\"\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003espec:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ereplicas:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eselector:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ematchLabels:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eapp:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003etemplate:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003emetadata:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003elabels:\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eapp:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003espec:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003econtainers:\u003c/span\u003e\n        \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ecommand:\u003c/span\u003e [\u003cspan class=\"hljs-string\"\u003e\"sleep\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"123456\"\u003c/span\u003e]\n          \u003cspan class=\"hljs-attr\"\u003eenv:\u003c/span\u003e\n            \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eDRINK\u003c/span\u003e\n              \u003cspan class=\"hljs-attr\"\u003evalueFrom:\u003c/span\u003e\n                \u003cspan class=\"hljs-attr\"\u003econfigMapKeyRef:\u003c/span\u003e\n                  \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emy-test-k8s-cm\u003c/span\u003e\n                  \u003cspan class=\"hljs-attr\"\u003ekey:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edrink\u003c/span\u003e\n            \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eMYVALUE\u003c/span\u003e\n              \u003cspan class=\"hljs-attr\"\u003evalueFrom:\u003c/span\u003e\n                \u003cspan class=\"hljs-attr\"\u003econfigMapKeyRef:\u003c/span\u003e\n                  \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emy-test-k8s-cm\u003c/span\u003e\n                  \u003cspan class=\"hljs-attr\"\u003ekey:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emyvalue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì ìš©\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ekubectl apply -f my-test-cm-manifest.yaml\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003emy-test-cm-manifest.yaml íŒŒì¼ì—ì„œ configmapì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-meta\"\u003e---\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eapiVersion:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ev1\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003ekind:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eConfigMap\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003emetadata:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emy-test-k8s-cm\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003edata:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003emyvalue:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"ì•ˆë…•í•˜ì„¸ìš”\"\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edrink:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eì°¨\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003eíŒŒì¼ì„ ë‹¤ì‹œ ì ìš©í•˜ì„¸ìš”.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-string\"\u003ekubectl\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eapply\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e-f\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emy-test-cm-manifest.yaml\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003col start=\"5\"\u003e\n\u003cli\u003eí™•ì¸\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# \u003cspan class=\"hljs-title class_\"\u003eConfigMap\u003c/span\u003e í™•ì¸\nkubectl get cm my-test-k8s-cm -o yaml\n\n# \u003cspan class=\"hljs-title class_\"\u003ePod\u003c/span\u003e í™•ì¸\nkubectl get po\n\n# \u003cspan class=\"hljs-title class_\"\u003ePod\u003c/span\u003eì— ì ‘ì†í•˜ì—¬ ìƒˆ ê°’ í™•ì¸\nkubectl exec -it \u0026#x3C;pod_name\u003e -- bash\n\n# \u003cspan class=\"hljs-title class_\"\u003ePod\u003c/span\u003eì— ë“¤ì–´ê°„ í›„ \u003cspan class=\"hljs-string\"\u003e`env`\u003c/span\u003e ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ \u003cspan class=\"hljs-title class_\"\u003ePod\u003c/span\u003e ë‚´ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ê°€ ì¶œë ¥ë©ë‹ˆë‹¤\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eì¶•í•˜í•©ë‹ˆë‹¤!!! secret-store-csi-driverì™€ reloaderë¥¼ ì„±ê³µì ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eê°ì‚¬í•©ë‹ˆë‹¤!!!\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003ch2\u003eì°¸ê³  ìë£Œ:\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.aws.amazon.com/secretsmanager/latest/userguide/integrating_csi_driver.html\" rel=\"nofollow\" target=\"_blank\"\u003eAWS ê³µì‹ ë¬¸ì„œ - CSI ë“œë¼ì´ë²„ í†µí•©\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.bootlabstech.com/aws-secrets-manager-in-kubernetes-secret-rotation-and-reloader\" rel=\"nofollow\" target=\"_blank\"\u003eBootlabs ê¸°ìˆ  ë¸”ë¡œê·¸ - AWS Secrets Manager in Kubernetes ì‹œí¬ë¦¿ íšŒì „ê³¼ ë¦¬ë¡œë”\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://secrets-store-csi-driver.sigs.k8s.io/topics/secret-auto-rotation\" rel=\"nofollow\" target=\"_blank\"\u003eSecrets Store CSI ë“œë¼ì´ë²„ ê³µì‹ í™ˆí˜ì´ì§€ - ì‹œí¬ë¦¿ ìë™ íšŒì „\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/kubernetes-sigs/secrets-store-csi-driver/blob/main/charts/secrets-store-csi-driver/values.yaml\" rel=\"nofollow\" target=\"_blank\"\u003eSecrets Store CSI ë“œë¼ì´ë²„ ì°¨íŠ¸ ê°’ ì„¤ì • íŒŒì¼\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/stakater/Reloader/tree/master\" rel=\"nofollow\" target=\"_blank\"\u003eReloader GitHub ì €ì¥ì†Œ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/stakater/Reloader/blob/master/docs/Verify-Reloader-Working.md\" rel=\"nofollow\" target=\"_blank\"\u003eReloader ì‘ë™ í™•ì¸ ë¬¸ì„œ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/stakater/Reloader/blob/master/docs/How-it-works.md\" rel=\"nofollow\" target=\"_blank\"\u003eReloader ì‘ë™ ë°©ì‹ ë¬¸ì„œ\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eê°„ë‹¨íˆ ë§í•˜ìë©´ ğŸš€\u003c/h1\u003e\n\u003cp\u003eIn Plain English ì»¤ë®¤ë‹ˆí‹°ì˜ ì¼ì›ì´ ë˜ì–´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ê³„ì† ì°¸ì—¬í•´ ì£¼ì„¸ìš”:\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eì‘ê°€ì—ê²Œ ë°•ìˆ˜ë¥¼ ë³´ë‚´ê³  íŒ”ë¡œìš°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš” ï¸ğŸ‘ï¸ï¸\u003c/li\u003e\n\u003cli\u003eíŒ”ë¡œìš°í•˜ê¸°: X | LinkedIn | YouTube | Discord | Newsletter\u003c/li\u003e\n\u003cli\u003eë‹¤ë¥¸ í”Œë«í¼ì—ì„œ ì €í¬ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”: Stackademic | CoFeed | Venture | Cubed\u003c/li\u003e\n\u003cli\u003eì•Œê³ ë¦¬ì¦˜ ì½˜í…ì¸ ë¥¼ ë‹¤ë¤„ì•¼ í•˜ëŠ” ë¸”ë¡œê·¸ í”Œë«í¼ì— ì§€ì³¤ë‚˜ìš”? Differë¥¼ ì‹œë„í•´ë³´ì„¸ìš”\u003c/li\u003e\n\u003cli\u003ePlainEnglish.ioì—ì„œ ë” ë§ì€ ì½˜í…ì¸ ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-19-KubernetesAutoRestartDeploymentswhenK8sConfigMaporSecretisUpdated"},"buildId":"bb_yO9GbCvdfc_n71SfUf","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>