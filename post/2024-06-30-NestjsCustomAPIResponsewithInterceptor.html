<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>Interceptor를 사용한 Nestjs 사용자 정의 API 응답 방법 | ui-station</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://ui-station.github.io///post/2024-06-30-NestjsCustomAPIResponsewithInterceptor" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="Interceptor를 사용한 Nestjs 사용자 정의 API 응답 방법 | ui-station" data-gatsby-head="true"/><meta property="og:title" content="Interceptor를 사용한 Nestjs 사용자 정의 API 응답 방법 | ui-station" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-30-NestjsCustomAPIResponsewithInterceptor_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://ui-station.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://ui-station.github.io///post/2024-06-30-NestjsCustomAPIResponsewithInterceptor" data-gatsby-head="true"/><meta name="twitter:title" content="Interceptor를 사용한 Nestjs 사용자 정의 API 응답 방법 | ui-station" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-30-NestjsCustomAPIResponsewithInterceptor_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | ui-station" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-30 22:30" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BHFR6GTH9P"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-BHFR6GTH9P');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-70e5ce89f3d962ac.js" defer=""></script><script src="/_next/static/wfHLuDA3kTGBYfaM5IGXk/_buildManifest.js" defer=""></script><script src="/_next/static/wfHLuDA3kTGBYfaM5IGXk/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UI STATION</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">Interceptor를 사용한 Nestjs 사용자 정의 API 응답 방법</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="Interceptor를 사용한 Nestjs 사용자 정의 API 응답 방법" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UI STATION</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 30, 2024</span><span class="posts_reading_time__f7YPP">5<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-30-NestjsCustomAPIResponsewithInterceptor&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<img src="/assets/img/2024-06-30-NestjsCustomAPIResponsewithInterceptor_0.png">
<p>이전 미디엄 스토리(Nest.js 구조화된 API 응답)에서는 새로운 유형을 정의하고 class-validator 및 다국어 패키지와 호환성을 보장하여 API 응답 구조를 사용자 정의하는 방법을 탐색했습니다. 이 글에서는 인터셉터를 사용하여 사용자 지정 API 응답을 정의하는 방법에 대해 다룰 것입니다.</p>
<h1>인터셉터란?</h1>
<img src="/assets/img/2024-06-30-NestjsCustomAPIResponsewithInterceptor_1.png">
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>NestJS에서 interceptor는 컨트롤러에 도달하기 전에 요청을 변환하거나 클라이언트로 전송되기 전에 응답을 변환할 수 있는 미들웨어입니다. 이것은 로깅, 실행 시간 측정, 데이터 변환, 예외 처리, 인증 및 권한 관리에 사용됩니다. Interceptors는 응용 프로그램에 교차하는 관심사를 추가하는 유연한 방법을 제공합니다.</p>
<h1>커스텀 API 응답</h1>
<p>Interceptor를 사용하면 요청을 감싸고 처리되기 전후에 수정할 수 있습니다. 이 연습에서는 API 응답에 <code>timestamp</code>, <code>path</code>, <code>version</code> 등과 같은 추가 필드를 추가할 것입니다.</p>
<h1>API 응답을 처리하기 위한 Interceptor 정의</h1>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>API 응답을 사용자 정의하는 인터셉터를 정의하는 방법을 안내해 드릴게요:</p>
<ol>
<li>필요한 모듈과 데코레이터 가져오기:
먼저 NestJS와 RxJS에서 필요한 모듈과 데코레이터를 가져오세요.</li>
</ol>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span>, <span class="hljs-title class_">NestInterceptor</span>, <span class="hljs-title class_">ExecutionContext</span>, <span class="hljs-title class_">CallHandler</span>, <span class="hljs-title class_">HttpException</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Observable</span>, throwError } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;
<span class="hljs-keyword">import</span> { catchError, map } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/operators'</span>;
</code></pre>
<ol start="2">
<li>CustomResponseInterceptor 클래스 생성:
CustomResponseInterceptor 클래스를 정의하고 NestInterceptor 인터페이스를 구현하세요.</li>
</ol>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-typescript"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomResponseInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NestInterceptor</span> {

<span class="hljs-number">3.</span> **<span class="hljs-string">`intercept`</span> 메서드 구현**:
<span class="hljs-string">`intercept`</span> 메서드 내에서 요청과 응답 객체에 액세스합니다. 응답에서 상태 코드를 가져옵니다.

<span class="hljs-title function_">intercept</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">ExecutionContext</span>, <span class="hljs-attr">next</span>: <span class="hljs-title class_">CallHandler</span>): <span class="hljs-title class_">Observable</span>&#x3C;<span class="hljs-built_in">any</span>> {
  <span class="hljs-keyword">const</span> request = context.<span class="hljs-title function_">switchToHttp</span>().<span class="hljs-title function_">getRequest</span>();
  <span class="hljs-keyword">const</span> response = context.<span class="hljs-title function_">switchToHttp</span>().<span class="hljs-title function_">getResponse</span>();
  <span class="hljs-keyword">const</span> statusCode = response.<span class="hljs-property">statusCode</span>;
}

<span class="hljs-number">4.</span> 응답 및 오류 처리:
<span class="hljs-title class_">RxJS</span>를 사용하여 next.<span class="hljs-title function_">handle</span>()의 결과를 처리합니다. 데이터를 사용자 정의 응답 형식으로 변환합니다. 사용자 지정 오류 응답을 생성하여 오류를 처리합니다.
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"><span class="hljs-keyword">return</span> next.<span class="hljs-title function_">handle</span>().<span class="hljs-title function_">pipe</span>(
   <span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">data</span> =></span> ({
     statusCode,
     <span class="hljs-attr">message</span>: statusCode >= <span class="hljs-number">400</span> ? <span class="hljs-string">'Error'</span> : <span class="hljs-string">'Success'</span>,
     <span class="hljs-attr">error</span>: statusCode >= <span class="hljs-number">400</span> ? response.<span class="hljs-property">message</span> : <span class="hljs-literal">null</span>,
     <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
     <span class="hljs-attr">version</span>: <span class="hljs-string">'v2'</span>,
     <span class="hljs-attr">path</span>: request.<span class="hljs-property">url</span>,
     data,
   })),
   <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">err</span> =></span> {
     <span class="hljs-keyword">const</span> statusCode = err <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HttpException</span> ? err.<span class="hljs-title function_">getStatus</span>() : <span class="hljs-number">500</span>;
     <span class="hljs-keyword">const</span> errorResponse = {
       statusCode,
       <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span> || <span class="hljs-string">'Internal server error'</span>,
       <span class="hljs-attr">error</span>: err.<span class="hljs-property">name</span> || <span class="hljs-string">'Error'</span>,
       <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
       <span class="hljs-attr">version</span>: <span class="hljs-string">'v2'</span>,
       <span class="hljs-attr">path</span>: request.<span class="hljs-property">url</span>,
       <span class="hljs-attr">data</span>: {},
     };
     <span class="hljs-keyword">return</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-function">() =></span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpException</span>(errorResponse, statusCode));
   })
);
}
</code></pre>
<h1>전역적으로 인터셉터 적용하기</h1>
<p>이 인터셉터를 전역적으로 적용하려면 <code>main.ts</code> 파일에 추가하실 수 있습니다:</p>
<ol>
<li>필요한 모듈과 인터셉터 가져오기:
<code>@nestjs/core</code>에서 <code>NestFactory</code>를 가져오고 <code>CustomResponseInterceptor</code> 클래스를 가져옵니다.</li>
</ol>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NestFactory</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/core'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.module'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CustomResponseInterceptor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./common/interceptors/custom-response.interceptor'</span>;
</code></pre>
<ol start="2">
<li>NestJS 애플리케이션 생성:
NestJS 애플리케이션을 생성하고 전역 인터셉터를 사용합니다.</li>
</ol>
<pre><code class="hljs language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"></span>) {
 <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NestFactory</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">AppModule</span>);
 app.<span class="hljs-title function_">useGlobalInterceptors</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomResponseInterceptor</span>());
 <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);
}
<span class="hljs-title function_">bootstrap</span>();
</code></pre>
<p>이 설정을 통해 NestJS 애플리케이션의 모든 API 응답이 인터셉터에서 정의된 사용자 정의 형식을 따르게 됩니다. 이러한 방식으로 응답을 구조화함으로써, 클라이언트가 사용할 일관되고 명확한 API 응답 형식을 제공할 수 있습니다.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Interceptor를 사용한 Nestjs 사용자 정의 API 응답 방법","description":"","date":"2024-06-30 22:30","slug":"2024-06-30-NestjsCustomAPIResponsewithInterceptor","content":"\n\n\u003cimg src=\"/assets/img/2024-06-30-NestjsCustomAPIResponsewithInterceptor_0.png\" /\u003e\n\n이전 미디엄 스토리(Nest.js 구조화된 API 응답)에서는 새로운 유형을 정의하고 class-validator 및 다국어 패키지와 호환성을 보장하여 API 응답 구조를 사용자 정의하는 방법을 탐색했습니다. 이 글에서는 인터셉터를 사용하여 사용자 지정 API 응답을 정의하는 방법에 대해 다룰 것입니다.\n\n# 인터셉터란?\n\n\u003cimg src=\"/assets/img/2024-06-30-NestjsCustomAPIResponsewithInterceptor_1.png\" /\u003e\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nNestJS에서 interceptor는 컨트롤러에 도달하기 전에 요청을 변환하거나 클라이언트로 전송되기 전에 응답을 변환할 수 있는 미들웨어입니다. 이것은 로깅, 실행 시간 측정, 데이터 변환, 예외 처리, 인증 및 권한 관리에 사용됩니다. Interceptors는 응용 프로그램에 교차하는 관심사를 추가하는 유연한 방법을 제공합니다.\n\n# 커스텀 API 응답\n\nInterceptor를 사용하면 요청을 감싸고 처리되기 전후에 수정할 수 있습니다. 이 연습에서는 API 응답에 `timestamp`, `path`, `version` 등과 같은 추가 필드를 추가할 것입니다.\n\n# API 응답을 처리하기 위한 Interceptor 정의\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nAPI 응답을 사용자 정의하는 인터셉터를 정의하는 방법을 안내해 드릴게요:\n\n1. 필요한 모듈과 데코레이터 가져오기:\n먼저 NestJS와 RxJS에서 필요한 모듈과 데코레이터를 가져오세요.\n\n```js\nimport { Injectable, NestInterceptor, ExecutionContext, CallHandler, HttpException } from '@nestjs/common';\nimport { Observable, throwError } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n```\n\n2. CustomResponseInterceptor 클래스 생성:\nCustomResponseInterceptor 클래스를 정의하고 NestInterceptor 인터페이스를 구현하세요.\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```typescript\n@Injectable()\nexport class CustomResponseInterceptor implements NestInterceptor {\n\n3. **`intercept` 메서드 구현**:\n`intercept` 메서드 내에서 요청과 응답 객체에 액세스합니다. 응답에서 상태 코드를 가져옵니다.\n\nintercept(context: ExecutionContext, next: CallHandler): Observable\u003cany\u003e {\n  const request = context.switchToHttp().getRequest();\n  const response = context.switchToHttp().getResponse();\n  const statusCode = response.statusCode;\n}\n\n4. 응답 및 오류 처리:\nRxJS를 사용하여 next.handle()의 결과를 처리합니다. 데이터를 사용자 정의 응답 형식으로 변환합니다. 사용자 지정 오류 응답을 생성하여 오류를 처리합니다.\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nreturn next.handle().pipe(\n   map(data =\u003e ({\n     statusCode,\n     message: statusCode \u003e= 400 ? 'Error' : 'Success',\n     error: statusCode \u003e= 400 ? response.message : null,\n     timestamp: Date.now(),\n     version: 'v2',\n     path: request.url,\n     data,\n   })),\n   catchError(err =\u003e {\n     const statusCode = err instanceof HttpException ? err.getStatus() : 500;\n     const errorResponse = {\n       statusCode,\n       message: err.message || 'Internal server error',\n       error: err.name || 'Error',\n       timestamp: Date.now(),\n       version: 'v2',\n       path: request.url,\n       data: {},\n     };\n     return throwError(() =\u003e new HttpException(errorResponse, statusCode));\n   })\n);\n}\n```\n\n# 전역적으로 인터셉터 적용하기\n\n이 인터셉터를 전역적으로 적용하려면 `main.ts` 파일에 추가하실 수 있습니다:\n\n1. 필요한 모듈과 인터셉터 가져오기:\n`@nestjs/core`에서 `NestFactory`를 가져오고 `CustomResponseInterceptor` 클래스를 가져옵니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nimport { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\nimport { CustomResponseInterceptor } from './common/interceptors/custom-response.interceptor';\n```\n\n2. NestJS 애플리케이션 생성:\nNestJS 애플리케이션을 생성하고 전역 인터셉터를 사용합니다.\n\n```js\nasync function bootstrap() {\n const app = await NestFactory.create(AppModule);\n app.useGlobalInterceptors(new CustomResponseInterceptor());\n await app.listen(3000);\n}\nbootstrap();\n```\n\n이 설정을 통해 NestJS 애플리케이션의 모든 API 응답이 인터셉터에서 정의된 사용자 정의 형식을 따르게 됩니다. 이러한 방식으로 응답을 구조화함으로써, 클라이언트가 사용할 일관되고 명확한 API 응답 형식을 제공할 수 있습니다.","ogImage":{"url":"/assets/img/2024-06-30-NestjsCustomAPIResponsewithInterceptor_0.png"},"coverImage":"/assets/img/2024-06-30-NestjsCustomAPIResponsewithInterceptor_0.png","tag":["Tech"],"readingTime":5},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cimg src=\"/assets/img/2024-06-30-NestjsCustomAPIResponsewithInterceptor_0.png\"\u003e\n\u003cp\u003e이전 미디엄 스토리(Nest.js 구조화된 API 응답)에서는 새로운 유형을 정의하고 class-validator 및 다국어 패키지와 호환성을 보장하여 API 응답 구조를 사용자 정의하는 방법을 탐색했습니다. 이 글에서는 인터셉터를 사용하여 사용자 지정 API 응답을 정의하는 방법에 대해 다룰 것입니다.\u003c/p\u003e\n\u003ch1\u003e인터셉터란?\u003c/h1\u003e\n\u003cimg src=\"/assets/img/2024-06-30-NestjsCustomAPIResponsewithInterceptor_1.png\"\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eNestJS에서 interceptor는 컨트롤러에 도달하기 전에 요청을 변환하거나 클라이언트로 전송되기 전에 응답을 변환할 수 있는 미들웨어입니다. 이것은 로깅, 실행 시간 측정, 데이터 변환, 예외 처리, 인증 및 권한 관리에 사용됩니다. Interceptors는 응용 프로그램에 교차하는 관심사를 추가하는 유연한 방법을 제공합니다.\u003c/p\u003e\n\u003ch1\u003e커스텀 API 응답\u003c/h1\u003e\n\u003cp\u003eInterceptor를 사용하면 요청을 감싸고 처리되기 전후에 수정할 수 있습니다. 이 연습에서는 API 응답에 \u003ccode\u003etimestamp\u003c/code\u003e, \u003ccode\u003epath\u003c/code\u003e, \u003ccode\u003eversion\u003c/code\u003e 등과 같은 추가 필드를 추가할 것입니다.\u003c/p\u003e\n\u003ch1\u003eAPI 응답을 처리하기 위한 Interceptor 정의\u003c/h1\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eAPI 응답을 사용자 정의하는 인터셉터를 정의하는 방법을 안내해 드릴게요:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e필요한 모듈과 데코레이터 가져오기:\n먼저 NestJS와 RxJS에서 필요한 모듈과 데코레이터를 가져오세요.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eInjectable\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eNestInterceptor\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eExecutionContext\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eCallHandler\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eHttpException\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@nestjs/common'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eObservable\u003c/span\u003e, throwError } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'rxjs'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { catchError, map } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'rxjs/operators'\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eCustomResponseInterceptor 클래스 생성:\nCustomResponseInterceptor 클래스를 정의하고 NestInterceptor 인터페이스를 구현하세요.\u003c/li\u003e\n\u003c/ol\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-meta\"\u003e@Injectable\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomResponseInterceptor\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eNestInterceptor\u003c/span\u003e {\n\n\u003cspan class=\"hljs-number\"\u003e3.\u003c/span\u003e **\u003cspan class=\"hljs-string\"\u003e`intercept`\u003c/span\u003e 메서드 구현**:\n\u003cspan class=\"hljs-string\"\u003e`intercept`\u003c/span\u003e 메서드 내에서 요청과 응답 객체에 액세스합니다. 응답에서 상태 코드를 가져옵니다.\n\n\u003cspan class=\"hljs-title function_\"\u003eintercept\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003econtext\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eExecutionContext\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003enext\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eCallHandler\u003c/span\u003e): \u003cspan class=\"hljs-title class_\"\u003eObservable\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e request = context.\u003cspan class=\"hljs-title function_\"\u003eswitchToHttp\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003egetRequest\u003c/span\u003e();\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e response = context.\u003cspan class=\"hljs-title function_\"\u003eswitchToHttp\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003egetResponse\u003c/span\u003e();\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e statusCode = response.\u003cspan class=\"hljs-property\"\u003estatusCode\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-number\"\u003e4.\u003c/span\u003e 응답 및 오류 처리:\n\u003cspan class=\"hljs-title class_\"\u003eRxJS\u003c/span\u003e를 사용하여 next.\u003cspan class=\"hljs-title function_\"\u003ehandle\u003c/span\u003e()의 결과를 처리합니다. 데이터를 사용자 정의 응답 형식으로 변환합니다. 사용자 지정 오류 응답을 생성하여 오류를 처리합니다.\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e next.\u003cspan class=\"hljs-title function_\"\u003ehandle\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003epipe\u003c/span\u003e(\n   \u003cspan class=\"hljs-title function_\"\u003emap\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003edata\u003c/span\u003e =\u003e\u003c/span\u003e ({\n     statusCode,\n     \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: statusCode \u003e= \u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e'Error'\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e'Success'\u003c/span\u003e,\n     \u003cspan class=\"hljs-attr\"\u003eerror\u003c/span\u003e: statusCode \u003e= \u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e ? response.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e : \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e,\n     \u003cspan class=\"hljs-attr\"\u003etimestamp\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003enow\u003c/span\u003e(),\n     \u003cspan class=\"hljs-attr\"\u003eversion\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'v2'\u003c/span\u003e,\n     \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: request.\u003cspan class=\"hljs-property\"\u003eurl\u003c/span\u003e,\n     data,\n   })),\n   \u003cspan class=\"hljs-title function_\"\u003ecatchError\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e =\u003e\u003c/span\u003e {\n     \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e statusCode = err \u003cspan class=\"hljs-keyword\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHttpException\u003c/span\u003e ? err.\u003cspan class=\"hljs-title function_\"\u003egetStatus\u003c/span\u003e() : \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e;\n     \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e errorResponse = {\n       statusCode,\n       \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: err.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e || \u003cspan class=\"hljs-string\"\u003e'Internal server error'\u003c/span\u003e,\n       \u003cspan class=\"hljs-attr\"\u003eerror\u003c/span\u003e: err.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e || \u003cspan class=\"hljs-string\"\u003e'Error'\u003c/span\u003e,\n       \u003cspan class=\"hljs-attr\"\u003etimestamp\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003enow\u003c/span\u003e(),\n       \u003cspan class=\"hljs-attr\"\u003eversion\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'v2'\u003c/span\u003e,\n       \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: request.\u003cspan class=\"hljs-property\"\u003eurl\u003c/span\u003e,\n       \u003cspan class=\"hljs-attr\"\u003edata\u003c/span\u003e: {},\n     };\n     \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ethrowError\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHttpException\u003c/span\u003e(errorResponse, statusCode));\n   })\n);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e전역적으로 인터셉터 적용하기\u003c/h1\u003e\n\u003cp\u003e이 인터셉터를 전역적으로 적용하려면 \u003ccode\u003emain.ts\u003c/code\u003e 파일에 추가하실 수 있습니다:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e필요한 모듈과 인터셉터 가져오기:\n\u003ccode\u003e@nestjs/core\u003c/code\u003e에서 \u003ccode\u003eNestFactory\u003c/code\u003e를 가져오고 \u003ccode\u003eCustomResponseInterceptor\u003c/code\u003e 클래스를 가져옵니다.\u003c/li\u003e\n\u003c/ol\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eNestFactory\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@nestjs/core'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eAppModule\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./app.module'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eCustomResponseInterceptor\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./common/interceptors/custom-response.interceptor'\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eNestJS 애플리케이션 생성:\nNestJS 애플리케이션을 생성하고 전역 인터셉터를 사용합니다.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ebootstrap\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eNestFactory\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreate\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAppModule\u003c/span\u003e);\n app.\u003cspan class=\"hljs-title function_\"\u003euseGlobalInterceptors\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCustomResponseInterceptor\u003c/span\u003e());\n \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e app.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n}\n\u003cspan class=\"hljs-title function_\"\u003ebootstrap\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 설정을 통해 NestJS 애플리케이션의 모든 API 응답이 인터셉터에서 정의된 사용자 정의 형식을 따르게 됩니다. 이러한 방식으로 응답을 구조화함으로써, 클라이언트가 사용할 일관되고 명확한 API 응답 형식을 제공할 수 있습니다.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-30-NestjsCustomAPIResponsewithInterceptor"},"buildId":"wfHLuDA3kTGBYfaM5IGXk","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>