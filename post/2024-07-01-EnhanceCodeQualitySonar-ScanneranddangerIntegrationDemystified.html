<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>코드 품질 향상 Sonar-Scanner와 danger 통합 방법  | ui-station</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://ui-station.github.io///post/2024-07-01-EnhanceCodeQualitySonar-ScanneranddangerIntegrationDemystified" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="코드 품질 향상 Sonar-Scanner와 danger 통합 방법  | ui-station" data-gatsby-head="true"/><meta property="og:title" content="코드 품질 향상 Sonar-Scanner와 danger 통합 방법  | ui-station" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-07-01-EnhanceCodeQualitySonar-ScanneranddangerIntegrationDemystified_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://ui-station.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://ui-station.github.io///post/2024-07-01-EnhanceCodeQualitySonar-ScanneranddangerIntegrationDemystified" data-gatsby-head="true"/><meta name="twitter:title" content="코드 품질 향상 Sonar-Scanner와 danger 통합 방법  | ui-station" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-07-01-EnhanceCodeQualitySonar-ScanneranddangerIntegrationDemystified_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | ui-station" data-gatsby-head="true"/><meta name="article:published_time" content="2024-07-01 16:21" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BHFR6GTH9P"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-BHFR6GTH9P');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-70e5ce89f3d962ac.js" defer=""></script><script src="/_next/static/wOkGEDZCvEs3S_XaNsdwr/_buildManifest.js" defer=""></script><script src="/_next/static/wOkGEDZCvEs3S_XaNsdwr/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">UI STATION</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">코드 품질 향상 Sonar-Scanner와 danger 통합 방법 </h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="코드 품질 향상 Sonar-Scanner와 danger 통합 방법 " loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">UI STATION</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jul 1, 2024</span><span class="posts_reading_time__f7YPP">11<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-07-01-EnhanceCodeQualitySonar-ScanneranddangerIntegrationDemystified&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>이전 게시물 중 하나에서는 npm 피어 종속성 충돌을 해결하는 방법에 대해 이야기했습니다 [1]. 이번에는 코드 문제에 대한 자세한 보고서를 생성하는 방법에 대해 이야기하려고 합니다. 특히 SonarQube를 통합하고 자동화된 코드 리뷰를 위해 danger를 활용하는 방법에 대해 논의하겠습니다.</p>
<h2>1. Sonar-Scanner</h2>
<p>SonarQube Scanner (sonar-scanner)는 여러 프로그래밍 언어에 걸쳐 코드 품질 및 보안을 분석하는 도구입니다. Jenkins와 Maven과 같은 CI/CD 도구와 원활하게 통합되어 코드 문제에 대한 자세한 보고서를 제공하고 유지 관리성을 향상시키며 최상의 코딩 관행을 준수하는 것을 보장합니다.</p>
<p>다음은 sonar-scanner를 사용하는 예시입니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js">sonar-scanner
      -<span class="hljs-title class_">Dsonar</span>.<span class="hljs-property">projectKey</span>=$sonarQubeProjectKey
      -<span class="hljs-title class_">Dsonar</span>.<span class="hljs-property">login</span>=$sonarQubeToken
      -<span class="hljs-title class_">Dsonar</span>.<span class="hljs-property">sourceEncoding</span>=<span class="hljs-variable constant_">UTF</span>-<span class="hljs-number">8</span>
      -<span class="hljs-title class_">Dsonar</span>.<span class="hljs-property">sources</span>=$npmSonarQubeSources
      -<span class="hljs-title class_">Dsonar</span>.<span class="hljs-property">tests</span>=$npmSonarQubeTests
      -<span class="hljs-title class_">Dsonar</span>.<span class="hljs-property">exclusions</span>=$npmSonarQubeExclusions
      -<span class="hljs-title class_">Dsonar</span>.<span class="hljs-property">test</span>.<span class="hljs-property">inclusions</span>=$npmSonarQubeTestInclusions
      -<span class="hljs-title class_">Dsonar</span>.<span class="hljs-property">typescript</span>.<span class="hljs-property">lcov</span>.<span class="hljs-property">reportPaths</span>=$npmSonarQubeLcovReportPath
      -<span class="hljs-title class_">Dcom</span>.<span class="hljs-property">itestra</span>.<span class="hljs-property">cloneview</span>.<span class="hljs-property">enabled</span>=<span class="hljs-literal">false</span>
</code></pre>
<p><img src="/assets/img/2024-07-01-EnhanceCodeQualitySonar-ScanneranddangerIntegrationDemystified_0.png" alt="Enhance Code Quality"></p>
<h2>1.1 Nx 프로젝트 설정하기</h2>
<p>Nx를 사용할 때는 다음 값들로 플레이스홀더를 채울 수 있습니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"><span class="hljs-comment">// configuration with nx</span>
npmSonarQubeSources = <span class="hljs-string">'apps,libs'</span>
npmSonarQubeTests = <span class="hljs-string">'apps,libs'</span>
npmSonarQubeExclusions = <span class="hljs-string">'**/node_modules/**,**/*-api/**,**/test-setup.ts'</span>
npmSonarQubeTestInclusions = <span class="hljs-string">'**/*.spec.ts'</span>
npmSonarQubeLcovReportPath = <span class="hljs-string">'coverage/lcov.info'</span>
</code></pre>
<p>여러 라이브러리 및/또는 애플리케이션이 구성되어 있으므로 커버리지 보고서를 단일 파일로 병합해야 합니다. 이 집계된 결과는 SonarQube로 전송할 수 있습니다.</p>
<p>다음 코드[2]를 사용하여 이를 달성할 수 있습니다. 그러나 최신 glob 버전과 호환되기 위해 일부 수정이 필요합니다. 다음 코드 조각은 이를 어떻게 수정해야 하는지 보여줍니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> { glob } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'glob'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">const</span> getLcovFiles = <span class="hljs-keyword">function</span> (<span class="hljs-params">src</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =></span> {
        <span class="hljs-title function_">glob</span>(<span class="hljs-string">`<span class="hljs-subst">${src}</span>/**/lcov.info`</span>)
            .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =></span> <span class="hljs-title function_">resolve</span>(result))
            .<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =></span> <span class="hljs-title function_">resolve</span>([]));
    });
};

(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getLcovFiles</span>(<span class="hljs-string">'coverage'</span>);
    <span class="hljs-keyword">const</span> mergedReport = files.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">mergedReport, currFile</span>) =></span> (mergedReport += fs.<span class="hljs-title function_">readFileSync</span>(currFile)), <span class="hljs-string">''</span>);

    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">writeFile</span>(path.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'./coverage/lcov.info'</span>), mergedReport, <span class="hljs-function">(<span class="hljs-params">err</span>) =></span> {
        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'파일이 저장되었습니다!'</span>);
    });
})();
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>위의 스크립트를 사용하려면 해야 할 일은 glob를 의존성으로 추가하는 것 뿐입니다.</p>
<pre><code class="hljs language-js">npm install glob --save
</code></pre>
<h2>1.2. 기타 유형의 프로젝트 설정</h2>
<p>Nx 없이도 다음 값을 사용하여 자리 표시자를 채울 수 있습니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"><span class="hljs-comment">// nxnpmSonarQubeSources = 'src'이라는 설정 없이</span>
npmSonarQubeTests = <span class="hljs-string">'src'</span>
npmSonarQubeExclusions = <span class="hljs-string">'**/node_modules/**,**/*-api/**'</span>
npmSonarQubeTestInclusions = <span class="hljs-string">'**/*.spec.ts'</span>
npmSonarQubeLcovReportPath = <span class="hljs-string">'coverage/lcov.info'</span>
</code></pre>
<h2>1.3 Jest 설정</h2>
<p>jest를 사용할 때 (karma 대신) jest와 함께 nx를 사용하면, coverageReports 옵션을 lcov로 설정하여 쉽게 커버리지 보고서를 생성할 수 있습니다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// package.json 내의 스크립트</span>

<span class="hljs-string">"coverage:merge"</span>: <span class="hljs-string">"node merge-coverage.js"</span>,
<span class="hljs-string">"test"</span>: <span class="hljs-string">"nx run-many --all --target=test --code-coverage --coverageReporters=lcov --parallel=2 --runInBand &#x26;&#x26; npm run coverage:merge"</span>,
<span class="hljs-string">"test:ci"</span>: <span class="hljs-string">"npm run test"</span>
</code></pre>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>아래는 사용할 수 있는 jest.config의 예시입니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-attr">displayName</span>: <span class="hljs-string">'common'</span>,
    <span class="hljs-attr">preset</span>: <span class="hljs-string">'../../../jest.preset.js'</span>,
    <span class="hljs-attr">setupFilesAfterEnv</span>: [<span class="hljs-string">'&#x3C;rootDir>/src/test-setup.ts'</span>],
    <span class="hljs-attr">coverageDirectory</span>: <span class="hljs-string">'../../../coverage/libs/common'</span>,
    <span class="hljs-attr">transform</span>: {
        <span class="hljs-string">'^.+\\.(ts|mjs|js|html)$'</span>: [
            <span class="hljs-string">'jest-preset-angular'</span>,
            {
                <span class="hljs-attr">tsconfig</span>: <span class="hljs-string">'&#x3C;rootDir>/tsconfig.spec.json'</span>,
                <span class="hljs-attr">stringifyContentPathRegex</span>: <span class="hljs-string">'\\.(html|svg)$'</span>,
            },
        ],
    },
    <span class="hljs-attr">transformIgnorePatterns</span>: [<span class="hljs-string">'node_modules/(?!.*\\.mjs$|@datorama/akita)'</span>],
    <span class="hljs-attr">snapshotSerializers</span>: [
        <span class="hljs-string">'jest-preset-angular/build/serializers/no-ng-attributes'</span>,
        <span class="hljs-string">'jest-preset-angular/build/serializers/ng-snapshot'</span>,
        <span class="hljs-string">'jest-preset-angular/build/serializers/html-comment'</span>,
    ],
    <span class="hljs-attr">moduleNameMapper</span>: {
        <span class="hljs-string">'^lodash-es$'</span>: <span class="hljs-string">'lodash'</span>,
    },
};
</code></pre>
<h2>1.4 Karma 설정</h2>
<p>그러나 jest 대신 karma를 사용할 경우, 각 karma.conf 파일에 lcovonly를 리포터로 포함해야 합니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">() =></span> {
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">basePath</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">frameworks</span>: [<span class="hljs-string">'jasmine'</span>, <span class="hljs-string">'@angular-devkit/build-angular'</span>],
        <span class="hljs-attr">plugins</span>: [
            <span class="hljs-built_in">require</span>(<span class="hljs-string">'karma-jasmine'</span>),
            <span class="hljs-built_in">require</span>(<span class="hljs-string">'karma-chrome-launcher'</span>),
            <span class="hljs-built_in">require</span>(<span class="hljs-string">'karma-jasmine-html-reporter'</span>),
            <span class="hljs-built_in">require</span>(<span class="hljs-string">'karma-coverage-istanbul-reporter'</span>),
            <span class="hljs-built_in">require</span>(<span class="hljs-string">'@angular-devkit/build-angular/plugins/karma'</span>),
        ],
        <span class="hljs-attr">client</span>: {
            <span class="hljs-attr">clearContext</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 브라우저에서 Jasmine Spec Runner 출력을 보이게 유지</span>
        },
        <span class="hljs-attr">jasmineHtmlReporter</span>: {
            <span class="hljs-attr">suppressAll</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 중복된 추적을 제거</span>
        },
        <span class="hljs-attr">coverageIstanbulReporter</span>: {
            <span class="hljs-attr">dir</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>).<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'../../../coverage/common″'</span>),
            <span class="hljs-attr">reports</span>: [<span class="hljs-string">'html'</span>, <span class="hljs-string">'lcovonly'</span>],
            <span class="hljs-attr">fixWebpackSourcePaths</span>: <span class="hljs-literal">true</span>,
        },
        <span class="hljs-attr">reporters</span>: [<span class="hljs-string">'progress'</span>, <span class="hljs-string">'kjhtml'</span>, <span class="hljs-string">'coverage-istanbul'</span>],
        ...
}
</code></pre>
<p>그리고 코드 커버리지 옵션이 package.json에 설정되어야 합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-string">"test"</span>: <span class="hljs-string">"ng test"</span>,
<span class="hljs-string">"test:ci"</span>: <span class="hljs-string">"npm run test -- --watch false --code-coverage=true"</span>,
</code></pre>
<h2>2. Danger</h2>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>TypeScript 프로젝트에서는 danger 의존성을 사용하여 eslint 규칙을 확인하여 코드 리뷰를 자동화합니다. 이는 pull request 에서 linting 문제를 자동으로 식별하여 코드 품질을 유지하는 데 도움이 됩니다. danger 를 통합하려면 Dangerfile 을 설정하여 규칙과 검사를 정의하고 일관된 코딩 표준을 유지하며 리뷰 프로세스를 간소화해야 합니다.</p>
<p>다음은 Dangerfile 을 구성할 수 있는 예시입니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> {danger, fail, schedule, warn} <span class="hljs-keyword">from</span> <span class="hljs-string">'danger'</span>;
<span class="hljs-keyword">import</span> {istanbulCoverage} <span class="hljs-keyword">from</span> <span class="hljs-string">'danger-plugin-istanbul-coverage'</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">ESLint</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'eslint'</span>;

<span class="hljs-comment">// 코드 커버리지 확인</span>
<span class="hljs-title function_">schedule</span>(<span class="hljs-title function_">istanbulCoverage</span>({
    <span class="hljs-attr">entrySortMethod</span>: <span class="hljs-string">'least-coverage'</span>,
    <span class="hljs-attr">numberOfEntries</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">coveragePath</span>: {<span class="hljs-attr">path</span>: <span class="hljs-string">'./coverage/lcov.info'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'lcov'</span>},
    <span class="hljs-attr">reportFileSet</span>: <span class="hljs-string">'createdOrModified'</span>,
    <span class="hljs-attr">reportMode</span>: <span class="hljs-string">'warn'</span>,
    <span class="hljs-attr">threshold</span>: {
        <span class="hljs-attr">statements</span>: <span class="hljs-number">80</span>,
        <span class="hljs-attr">branches</span>: <span class="hljs-number">80</span>,
        <span class="hljs-attr">functions</span>: <span class="hljs-number">80</span>,
        <span class="hljs-attr">lines</span>: <span class="hljs-number">80</span>
    }
}));

<span class="hljs-keyword">const</span> enum <span class="hljs-title class_">EslintSeverity</span> {
    <span class="hljs-variable constant_">WARNING</span> = <span class="hljs-number">1</span>,
    <span class="hljs-variable constant_">ERROR</span> = <span class="hljs-number">2</span>
}

<span class="hljs-comment">// ESLint 규칙 검사</span>
<span class="hljs-title function_">schedule</span>(<span class="hljs-keyword">async</span> () => {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> filesToLint = danger.<span class="hljs-property">git</span>.<span class="hljs-property">created_files</span>.<span class="hljs-title function_">concat</span>(danger.<span class="hljs-property">git</span>.<span class="hljs-property">modified_files</span>);
        <span class="hljs-keyword">const</span> eslint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ESLint</span>({});

        <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> eslint.<span class="hljs-title function_">lintFiles</span>(filesToLint);

        results.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">{filePath, messages}</span>) =></span> {
            messages.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">message</span> =></span> {
                <span class="hljs-keyword">if</span> (message.<span class="hljs-property">fatal</span>) {
                    <span class="hljs-title function_">warn</span>(<span class="hljs-string">`Fatal error linting <span class="hljs-subst">${filePath}</span> with eslint.`</span>);
                    <span class="hljs-keyword">return</span>;
                }

                <span class="hljs-comment">// 무시된 파일 건너뛰기</span>
                <span class="hljs-keyword">if</span> (message.<span class="hljs-property">severity</span> === <span class="hljs-title class_">EslintSeverity</span>.<span class="hljs-property">WARNING</span> &#x26;&#x26; (message.<span class="hljs-property">message</span> || <span class="hljs-string">''</span>).<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'File ignored'</span>)) {
                    <span class="hljs-keyword">return</span>;
                }

                <span class="hljs-keyword">const</span> fn = <span class="hljs-title function_">reporterFor</span>(message.<span class="hljs-property">severity</span>);

                <span class="hljs-title function_">fn</span>(<span class="hljs-string">`<span class="hljs-subst">${filePath}</span> line <span class="hljs-subst">${message.line}</span> – <span class="hljs-subst">${message.message}</span> (<span class="hljs-subst">${message.ruleId}</span>)`</span>);
            });
        });
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
    }
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">reporterFor</span>(<span class="hljs-params">severity: number</span>): <span class="hljs-function">(<span class="hljs-params">message: string</span>) =></span> <span class="hljs-keyword">void</span> {
    <span class="hljs-keyword">switch</span> (severity) {
        <span class="hljs-keyword">case</span> <span class="hljs-title class_">EslintSeverity</span>.<span class="hljs-property">WARNING</span>:
            <span class="hljs-keyword">return</span> warn;
        <span class="hljs-keyword">case</span> <span class="hljs-title class_">EslintSeverity</span>.<span class="hljs-property">ERROR</span>:
            <span class="hljs-keyword">return</span> fail;
        <span class="hljs-attr">default</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-function">() =></span> { <span class="hljs-comment">/* 아무것도 수행하지 않음 */</span>
            };
    }
}
</code></pre>
<p>danger 및 코드 커버리지 도구를 사용하려면 danger 및 danger-plugin-istanbul-coverage가 모두 의존성으로 추가되어야 합니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-js"><span class="hljs-comment">// 일부 구버전</span>
<span class="hljs-string">"danger"</span>: <span class="hljs-string">"10.5.3"</span>,
<span class="hljs-string">"danger-plugin-istanbul-coverage"</span>: <span class="hljs-string">"^1.6.2"</span>,
</code></pre>
<p>그리고 다음 스크립트를 package.json에 추가할 수 있습니다.</p>
<pre><code class="hljs language-js"><span class="hljs-string">"danger:ci"</span>: <span class="hljs-string">"danger ci"</span>,
<span class="hljs-string">"danger:local"</span>: <span class="hljs-string">"danger local"</span>
</code></pre>
<p>Gitlab과 함께 danger를 통합하려면 다음 스크립트를 CI/CD 파이프라인에 사용할 수 있습니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<pre><code class="hljs language-bash"><span class="hljs-built_in">export</span> DANGER_GITLAB_HOST=<span class="hljs-variable">${dangerGitlabHost}</span>
<span class="hljs-built_in">export</span> DANGER_GITLAB_API_BASE_URL=<span class="hljs-variable">${dangerGitlabApiBaseUrl}</span>
                        
git branch temp_<span class="hljs-variable">${BRANCH_NAME}</span>
git checkout -b <span class="hljs-variable">${dangerBaseBranch}</span>
git checkout temp_<span class="hljs-variable">${BRANCH_NAME}</span>
npm run danger:<span class="hljs-built_in">local</span> -- --base <span class="hljs-variable">${dangerBaseBranch}</span>

<span class="hljs-built_in">export</span> NODE_TLS_REJECT_UNAUTHORIZED=0
npm run danger:ci
<span class="hljs-built_in">export</span> NODE_TLS_REJECT_UNAUTHORIZED=1
</code></pre>
<h2>마무리</h2>
<p>저는 SonarScanner를 Nx 및 다양한 유형의 프로젝트에 구성하는 방법과 Jest와 Karma를 사용하여 테스팅하는 방법의 차이점을 강조했습니다. 각 도구의 구체적인 구성 및 모범 사례를 예를 통해 설명하여 개발자들이 테스트 및 코드 품질 전략에 대해 정보를 얻고 결정하는 데 도움이 되기를 바라며 이 비교를 제공했습니다.</p>
<p>게다가, danger의 사용법을 보여주고 이를 CI/CD 파이프라인에 통합하는 방법을 설명했습니다. danger는 eslint 규칙을 강제로 적용하여 코드 리뷰를 자동화하고 일관된 코딩 표준을 유지하며 리뷰 프로세스를 간소화하기 위해 PR에서 이슈를 플래그 처리함으로써 개발자들을 도와줍니다.</p>
<!-- ui-station 사각형 -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4877378276818686" data-ad-slot="7249294152" data-ad-format="auto" data-full-width-responsive="true"></ins></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h1>링크</h1>
<p>[1] <a href="https://medium.com/@robert.maiersilldorff/resolving-npm-peer-dependency-conflicts-70d67f4ca7dc" rel="nofollow" target="_blank">https://medium.com/@robert.maiersilldorff/resolving-npm-peer-dependency-conflicts-70d67f4ca7dc</a></p>
<p>[2] <a href="https://yonatankra.com/how-to-create-a-workspace-coverage-report-in-nrwl-nx-monorepo/" rel="nofollow" target="_blank">https://yonatankra.com/how-to-create-a-workspace-coverage-report-in-nrwl-nx-monorepo/</a></p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"코드 품질 향상 Sonar-Scanner와 danger 통합 방법 ","description":"","date":"2024-07-01 16:21","slug":"2024-07-01-EnhanceCodeQualitySonar-ScanneranddangerIntegrationDemystified","content":"\n\n이전 게시물 중 하나에서는 npm 피어 종속성 충돌을 해결하는 방법에 대해 이야기했습니다 [1]. 이번에는 코드 문제에 대한 자세한 보고서를 생성하는 방법에 대해 이야기하려고 합니다. 특히 SonarQube를 통합하고 자동화된 코드 리뷰를 위해 danger를 활용하는 방법에 대해 논의하겠습니다.\n\n## 1. Sonar-Scanner\n\nSonarQube Scanner (sonar-scanner)는 여러 프로그래밍 언어에 걸쳐 코드 품질 및 보안을 분석하는 도구입니다. Jenkins와 Maven과 같은 CI/CD 도구와 원활하게 통합되어 코드 문제에 대한 자세한 보고서를 제공하고 유지 관리성을 향상시키며 최상의 코딩 관행을 준수하는 것을 보장합니다.\n\n다음은 sonar-scanner를 사용하는 예시입니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nsonar-scanner\n      -Dsonar.projectKey=$sonarQubeProjectKey\n      -Dsonar.login=$sonarQubeToken\n      -Dsonar.sourceEncoding=UTF-8\n      -Dsonar.sources=$npmSonarQubeSources\n      -Dsonar.tests=$npmSonarQubeTests\n      -Dsonar.exclusions=$npmSonarQubeExclusions\n      -Dsonar.test.inclusions=$npmSonarQubeTestInclusions\n      -Dsonar.typescript.lcov.reportPaths=$npmSonarQubeLcovReportPath\n      -Dcom.itestra.cloneview.enabled=false\n```\n\n![Enhance Code Quality](/assets/img/2024-07-01-EnhanceCodeQualitySonar-ScanneranddangerIntegrationDemystified_0.png)\n\n## 1.1 Nx 프로젝트 설정하기\n\nNx를 사용할 때는 다음 값들로 플레이스홀더를 채울 수 있습니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n// configuration with nx\nnpmSonarQubeSources = 'apps,libs'\nnpmSonarQubeTests = 'apps,libs'\nnpmSonarQubeExclusions = '**/node_modules/**,**/*-api/**,**/test-setup.ts'\nnpmSonarQubeTestInclusions = '**/*.spec.ts'\nnpmSonarQubeLcovReportPath = 'coverage/lcov.info'\n```\n\n여러 라이브러리 및/또는 애플리케이션이 구성되어 있으므로 커버리지 보고서를 단일 파일로 병합해야 합니다. 이 집계된 결과는 SonarQube로 전송할 수 있습니다.\n\n다음 코드[2]를 사용하여 이를 달성할 수 있습니다. 그러나 최신 glob 버전과 호환되기 위해 일부 수정이 필요합니다. 다음 코드 조각은 이를 어떻게 수정해야 하는지 보여줍니다.\n\n```js\nconst { glob } = require('glob');\nconst fs = require('fs');\nconst path = require('path');\n\nconst getLcovFiles = function (src) {\n    return new Promise((resolve) =\u003e {\n        glob(`${src}/**/lcov.info`)\n            .then((result) =\u003e resolve(result))\n            .catch(() =\u003e resolve([]));\n    });\n};\n\n(async function () {\n    const files = await getLcovFiles('coverage');\n    const mergedReport = files.reduce((mergedReport, currFile) =\u003e (mergedReport += fs.readFileSync(currFile)), '');\n\n    await fs.writeFile(path.resolve('./coverage/lcov.info'), mergedReport, (err) =\u003e {\n        if (err) throw err;\n        console.log('파일이 저장되었습니다!');\n    });\n})();\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n위의 스크립트를 사용하려면 해야 할 일은 glob를 의존성으로 추가하는 것 뿐입니다.\n\n```js\nnpm install glob --save\n```\n\n## 1.2. 기타 유형의 프로젝트 설정\n\nNx 없이도 다음 값을 사용하여 자리 표시자를 채울 수 있습니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\r\n// nxnpmSonarQubeSources = 'src'이라는 설정 없이\r\nnpmSonarQubeTests = 'src'\r\nnpmSonarQubeExclusions = '**/node_modules/**,**/*-api/**'\r\nnpmSonarQubeTestInclusions = '**/*.spec.ts'\r\nnpmSonarQubeLcovReportPath = 'coverage/lcov.info'\r\n```\r\n\r\n## 1.3 Jest 설정\r\n\r\njest를 사용할 때 (karma 대신) jest와 함께 nx를 사용하면, coverageReports 옵션을 lcov로 설정하여 쉽게 커버리지 보고서를 생성할 수 있습니다.\r\n\r\n```js\r\n// package.json 내의 스크립트\r\n\r\n\"coverage:merge\": \"node merge-coverage.js\",\r\n\"test\": \"nx run-many --all --target=test --code-coverage --coverageReporters=lcov --parallel=2 --runInBand \u0026\u0026 npm run coverage:merge\",\r\n\"test:ci\": \"npm run test\"\r\n```\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n아래는 사용할 수 있는 jest.config의 예시입니다.\n\n```js\nexport default {\n    displayName: 'common',\n    preset: '../../../jest.preset.js',\n    setupFilesAfterEnv: ['\u003crootDir\u003e/src/test-setup.ts'],\n    coverageDirectory: '../../../coverage/libs/common',\n    transform: {\n        '^.+\\\\.(ts|mjs|js|html)$': [\n            'jest-preset-angular',\n            {\n                tsconfig: '\u003crootDir\u003e/tsconfig.spec.json',\n                stringifyContentPathRegex: '\\\\.(html|svg)$',\n            },\n        ],\n    },\n    transformIgnorePatterns: ['node_modules/(?!.*\\\\.mjs$|@datorama/akita)'],\n    snapshotSerializers: [\n        'jest-preset-angular/build/serializers/no-ng-attributes',\n        'jest-preset-angular/build/serializers/ng-snapshot',\n        'jest-preset-angular/build/serializers/html-comment',\n    ],\n    moduleNameMapper: {\n        '^lodash-es$': 'lodash',\n    },\n};\n```\n\n## 1.4 Karma 설정\n\n그러나 jest 대신 karma를 사용할 경우, 각 karma.conf 파일에 lcovonly를 리포터로 포함해야 합니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\nmodule.exports = () =\u003e {\n    return {\n        basePath: '',\n        frameworks: ['jasmine', '@angular-devkit/build-angular'],\n        plugins: [\n            require('karma-jasmine'),\n            require('karma-chrome-launcher'),\n            require('karma-jasmine-html-reporter'),\n            require('karma-coverage-istanbul-reporter'),\n            require('@angular-devkit/build-angular/plugins/karma'),\n        ],\n        client: {\n            clearContext: false, // 브라우저에서 Jasmine Spec Runner 출력을 보이게 유지\n        },\n        jasmineHtmlReporter: {\n            suppressAll: true, // 중복된 추적을 제거\n        },\n        coverageIstanbulReporter: {\n            dir: require('path').join(__dirname, '../../../coverage/common″'),\n            reports: ['html', 'lcovonly'],\n            fixWebpackSourcePaths: true,\n        },\n        reporters: ['progress', 'kjhtml', 'coverage-istanbul'],\n        ...\n}\n```\n\n그리고 코드 커버리지 옵션이 package.json에 설정되어야 합니다.\n\n```js\n\"test\": \"ng test\",\n\"test:ci\": \"npm run test -- --watch false --code-coverage=true\",\n```\n\n## 2. Danger\n\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\nTypeScript 프로젝트에서는 danger 의존성을 사용하여 eslint 규칙을 확인하여 코드 리뷰를 자동화합니다. 이는 pull request 에서 linting 문제를 자동으로 식별하여 코드 품질을 유지하는 데 도움이 됩니다. danger 를 통합하려면 Dangerfile 을 설정하여 규칙과 검사를 정의하고 일관된 코딩 표준을 유지하며 리뷰 프로세스를 간소화해야 합니다.\n\n다음은 Dangerfile 을 구성할 수 있는 예시입니다.\n\n```js\nimport {danger, fail, schedule, warn} from 'danger';\nimport {istanbulCoverage} from 'danger-plugin-istanbul-coverage';\nimport {ESLint} from 'eslint';\n\n// 코드 커버리지 확인\nschedule(istanbulCoverage({\n    entrySortMethod: 'least-coverage',\n    numberOfEntries: 30,\n    coveragePath: {path: './coverage/lcov.info', type: 'lcov'},\n    reportFileSet: 'createdOrModified',\n    reportMode: 'warn',\n    threshold: {\n        statements: 80,\n        branches: 80,\n        functions: 80,\n        lines: 80\n    }\n}));\n\nconst enum EslintSeverity {\n    WARNING = 1,\n    ERROR = 2\n}\n\n// ESLint 규칙 검사\nschedule(async () =\u003e {\n    try {\n        const filesToLint = danger.git.created_files.concat(danger.git.modified_files);\n        const eslint = new ESLint({});\n\n        const results = await eslint.lintFiles(filesToLint);\n\n        results.forEach(({filePath, messages}) =\u003e {\n            messages.forEach(message =\u003e {\n                if (message.fatal) {\n                    warn(`Fatal error linting ${filePath} with eslint.`);\n                    return;\n                }\n\n                // 무시된 파일 건너뛰기\n                if (message.severity === EslintSeverity.WARNING \u0026\u0026 (message.message || '').startsWith('File ignored')) {\n                    return;\n                }\n\n                const fn = reporterFor(message.severity);\n\n                fn(`${filePath} line ${message.line} – ${message.message} (${message.ruleId})`);\n            });\n        });\n    } catch (error) {\n        console.error(error);\n    }\n});\n\nfunction reporterFor(severity: number): (message: string) =\u003e void {\n    switch (severity) {\n        case EslintSeverity.WARNING:\n            return warn;\n        case EslintSeverity.ERROR:\n            return fail;\n        default:\n            return () =\u003e { /* 아무것도 수행하지 않음 */\n            };\n    }\n}\n```\n\ndanger 및 코드 커버리지 도구를 사용하려면 danger 및 danger-plugin-istanbul-coverage가 모두 의존성으로 추가되어야 합니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```js\n// 일부 구버전\n\"danger\": \"10.5.3\",\n\"danger-plugin-istanbul-coverage\": \"^1.6.2\",\n```\n\n그리고 다음 스크립트를 package.json에 추가할 수 있습니다.\n\n```js\n\"danger:ci\": \"danger ci\",\n\"danger:local\": \"danger local\"\n```\n\nGitlab과 함께 danger를 통합하려면 다음 스크립트를 CI/CD 파이프라인에 사용할 수 있습니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n```bash\nexport DANGER_GITLAB_HOST=${dangerGitlabHost}\nexport DANGER_GITLAB_API_BASE_URL=${dangerGitlabApiBaseUrl}\n                        \ngit branch temp_${BRANCH_NAME}\ngit checkout -b ${dangerBaseBranch}\ngit checkout temp_${BRANCH_NAME}\nnpm run danger:local -- --base ${dangerBaseBranch}\n\nexport NODE_TLS_REJECT_UNAUTHORIZED=0\nnpm run danger:ci\nexport NODE_TLS_REJECT_UNAUTHORIZED=1\n```\n\n## 마무리\n\n저는 SonarScanner를 Nx 및 다양한 유형의 프로젝트에 구성하는 방법과 Jest와 Karma를 사용하여 테스팅하는 방법의 차이점을 강조했습니다. 각 도구의 구체적인 구성 및 모범 사례를 예를 통해 설명하여 개발자들이 테스트 및 코드 품질 전략에 대해 정보를 얻고 결정하는 데 도움이 되기를 바라며 이 비교를 제공했습니다.\n\n게다가, danger의 사용법을 보여주고 이를 CI/CD 파이프라인에 통합하는 방법을 설명했습니다. danger는 eslint 규칙을 강제로 적용하여 코드 리뷰를 자동화하고 일관된 코딩 표준을 유지하며 리뷰 프로세스를 간소화하기 위해 PR에서 이슈를 플래그 처리함으로써 개발자들을 도와줍니다.\n\n\u003c!-- ui-station 사각형 --\u003e\n\u003cins class=\"adsbygoogle\"\nstyle=\"display:block\"\ndata-ad-client=\"ca-pub-4877378276818686\"\ndata-ad-slot=\"7249294152\"\ndata-ad-format=\"auto\"\ndata-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\n# 링크\n\n[1] \u003chttps://medium.com/@robert.maiersilldorff/resolving-npm-peer-dependency-conflicts-70d67f4ca7dc\u003e  \n\n[2] \u003chttps://yonatankra.com/how-to-create-a-workspace-coverage-report-in-nrwl-nx-monorepo/\u003e  ","ogImage":{"url":"/assets/img/2024-07-01-EnhanceCodeQualitySonar-ScanneranddangerIntegrationDemystified_0.png"},"coverImage":"/assets/img/2024-07-01-EnhanceCodeQualitySonar-ScanneranddangerIntegrationDemystified_0.png","tag":["Tech"],"readingTime":11},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e이전 게시물 중 하나에서는 npm 피어 종속성 충돌을 해결하는 방법에 대해 이야기했습니다 [1]. 이번에는 코드 문제에 대한 자세한 보고서를 생성하는 방법에 대해 이야기하려고 합니다. 특히 SonarQube를 통합하고 자동화된 코드 리뷰를 위해 danger를 활용하는 방법에 대해 논의하겠습니다.\u003c/p\u003e\n\u003ch2\u003e1. Sonar-Scanner\u003c/h2\u003e\n\u003cp\u003eSonarQube Scanner (sonar-scanner)는 여러 프로그래밍 언어에 걸쳐 코드 품질 및 보안을 분석하는 도구입니다. Jenkins와 Maven과 같은 CI/CD 도구와 원활하게 통합되어 코드 문제에 대한 자세한 보고서를 제공하고 유지 관리성을 향상시키며 최상의 코딩 관행을 준수하는 것을 보장합니다.\u003c/p\u003e\n\u003cp\u003e다음은 sonar-scanner를 사용하는 예시입니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003esonar-scanner\n      -\u003cspan class=\"hljs-title class_\"\u003eDsonar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eprojectKey\u003c/span\u003e=$sonarQubeProjectKey\n      -\u003cspan class=\"hljs-title class_\"\u003eDsonar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elogin\u003c/span\u003e=$sonarQubeToken\n      -\u003cspan class=\"hljs-title class_\"\u003eDsonar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esourceEncoding\u003c/span\u003e=\u003cspan class=\"hljs-variable constant_\"\u003eUTF\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e\n      -\u003cspan class=\"hljs-title class_\"\u003eDsonar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esources\u003c/span\u003e=$npmSonarQubeSources\n      -\u003cspan class=\"hljs-title class_\"\u003eDsonar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003etests\u003c/span\u003e=$npmSonarQubeTests\n      -\u003cspan class=\"hljs-title class_\"\u003eDsonar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexclusions\u003c/span\u003e=$npmSonarQubeExclusions\n      -\u003cspan class=\"hljs-title class_\"\u003eDsonar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003etest\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003einclusions\u003c/span\u003e=$npmSonarQubeTestInclusions\n      -\u003cspan class=\"hljs-title class_\"\u003eDsonar\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003etypescript\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elcov\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ereportPaths\u003c/span\u003e=$npmSonarQubeLcovReportPath\n      -\u003cspan class=\"hljs-title class_\"\u003eDcom\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eitestra\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ecloneview\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eenabled\u003c/span\u003e=\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-07-01-EnhanceCodeQualitySonar-ScanneranddangerIntegrationDemystified_0.png\" alt=\"Enhance Code Quality\"\u003e\u003c/p\u003e\n\u003ch2\u003e1.1 Nx 프로젝트 설정하기\u003c/h2\u003e\n\u003cp\u003eNx를 사용할 때는 다음 값들로 플레이스홀더를 채울 수 있습니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// configuration with nx\u003c/span\u003e\nnpmSonarQubeSources = \u003cspan class=\"hljs-string\"\u003e'apps,libs'\u003c/span\u003e\nnpmSonarQubeTests = \u003cspan class=\"hljs-string\"\u003e'apps,libs'\u003c/span\u003e\nnpmSonarQubeExclusions = \u003cspan class=\"hljs-string\"\u003e'**/node_modules/**,**/*-api/**,**/test-setup.ts'\u003c/span\u003e\nnpmSonarQubeTestInclusions = \u003cspan class=\"hljs-string\"\u003e'**/*.spec.ts'\u003c/span\u003e\nnpmSonarQubeLcovReportPath = \u003cspan class=\"hljs-string\"\u003e'coverage/lcov.info'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e여러 라이브러리 및/또는 애플리케이션이 구성되어 있으므로 커버리지 보고서를 단일 파일로 병합해야 합니다. 이 집계된 결과는 SonarQube로 전송할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e다음 코드[2]를 사용하여 이를 달성할 수 있습니다. 그러나 최신 glob 버전과 호환되기 위해 일부 수정이 필요합니다. 다음 코드 조각은 이를 어떻게 수정해야 하는지 보여줍니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { glob } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'glob'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e getLcovFiles = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003esrc\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve\u003c/span\u003e) =\u003e\u003c/span\u003e {\n        \u003cspan class=\"hljs-title function_\"\u003eglob\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`\u003cspan class=\"hljs-subst\"\u003e${src}\u003c/span\u003e/**/lcov.info`\u003c/span\u003e)\n            .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresult\u003c/span\u003e) =\u003e\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eresolve\u003c/span\u003e(result))\n            .\u003cspan class=\"hljs-title function_\"\u003ecatch\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eresolve\u003c/span\u003e([]));\n    });\n};\n\n(\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e files = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetLcovFiles\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'coverage'\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e mergedReport = files.\u003cspan class=\"hljs-title function_\"\u003ereduce\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003emergedReport, currFile\u003c/span\u003e) =\u003e\u003c/span\u003e (mergedReport += fs.\u003cspan class=\"hljs-title function_\"\u003ereadFileSync\u003c/span\u003e(currFile)), \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e fs.\u003cspan class=\"hljs-title function_\"\u003ewriteFile\u003c/span\u003e(path.\u003cspan class=\"hljs-title function_\"\u003eresolve\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./coverage/lcov.info'\u003c/span\u003e), mergedReport, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) =\u003e\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n        \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'파일이 저장되었습니다!'\u003c/span\u003e);\n    });\n})();\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e위의 스크립트를 사용하려면 해야 할 일은 glob를 의존성으로 추가하는 것 뿐입니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003enpm install glob --save\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e1.2. 기타 유형의 프로젝트 설정\u003c/h2\u003e\n\u003cp\u003eNx 없이도 다음 값을 사용하여 자리 표시자를 채울 수 있습니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// nxnpmSonarQubeSources = 'src'이라는 설정 없이\u003c/span\u003e\r\nnpmSonarQubeTests = \u003cspan class=\"hljs-string\"\u003e'src'\u003c/span\u003e\r\nnpmSonarQubeExclusions = \u003cspan class=\"hljs-string\"\u003e'**/node_modules/**,**/*-api/**'\u003c/span\u003e\r\nnpmSonarQubeTestInclusions = \u003cspan class=\"hljs-string\"\u003e'**/*.spec.ts'\u003c/span\u003e\r\nnpmSonarQubeLcovReportPath = \u003cspan class=\"hljs-string\"\u003e'coverage/lcov.info'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e1.3 Jest 설정\u003c/h2\u003e\n\u003cp\u003ejest를 사용할 때 (karma 대신) jest와 함께 nx를 사용하면, coverageReports 옵션을 lcov로 설정하여 쉽게 커버리지 보고서를 생성할 수 있습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// package.json 내의 스크립트\u003c/span\u003e\r\n\r\n\u003cspan class=\"hljs-string\"\u003e\"coverage:merge\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"node merge-coverage.js\"\u003c/span\u003e,\r\n\u003cspan class=\"hljs-string\"\u003e\"test\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"nx run-many --all --target=test --code-coverage --coverageReporters=lcov --parallel=2 --runInBand \u0026#x26;\u0026#x26; npm run coverage:merge\"\u003c/span\u003e,\r\n\u003cspan class=\"hljs-string\"\u003e\"test:ci\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"npm run test\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003e아래는 사용할 수 있는 jest.config의 예시입니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n    \u003cspan class=\"hljs-attr\"\u003edisplayName\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'common'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003epreset\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'../../../jest.preset.js'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003esetupFilesAfterEnv\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'\u0026#x3C;rootDir\u003e/src/test-setup.ts'\u003c/span\u003e],\n    \u003cspan class=\"hljs-attr\"\u003ecoverageDirectory\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'../../../coverage/libs/common'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003etransform\u003c/span\u003e: {\n        \u003cspan class=\"hljs-string\"\u003e'^.+\\\\.(ts|mjs|js|html)$'\u003c/span\u003e: [\n            \u003cspan class=\"hljs-string\"\u003e'jest-preset-angular'\u003c/span\u003e,\n            {\n                \u003cspan class=\"hljs-attr\"\u003etsconfig\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'\u0026#x3C;rootDir\u003e/tsconfig.spec.json'\u003c/span\u003e,\n                \u003cspan class=\"hljs-attr\"\u003estringifyContentPathRegex\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'\\\\.(html|svg)$'\u003c/span\u003e,\n            },\n        ],\n    },\n    \u003cspan class=\"hljs-attr\"\u003etransformIgnorePatterns\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'node_modules/(?!.*\\\\.mjs$|@datorama/akita)'\u003c/span\u003e],\n    \u003cspan class=\"hljs-attr\"\u003esnapshotSerializers\u003c/span\u003e: [\n        \u003cspan class=\"hljs-string\"\u003e'jest-preset-angular/build/serializers/no-ng-attributes'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'jest-preset-angular/build/serializers/ng-snapshot'\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e'jest-preset-angular/build/serializers/html-comment'\u003c/span\u003e,\n    ],\n    \u003cspan class=\"hljs-attr\"\u003emoduleNameMapper\u003c/span\u003e: {\n        \u003cspan class=\"hljs-string\"\u003e'^lodash-es$'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'lodash'\u003c/span\u003e,\n    },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e1.4 Karma 설정\u003c/h2\u003e\n\u003cp\u003e그러나 jest 대신 karma를 사용할 경우, 각 karma.conf 파일에 lcovonly를 리포터로 포함해야 합니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr\"\u003ebasePath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eframeworks\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'jasmine'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'@angular-devkit/build-angular'\u003c/span\u003e],\n        \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\n            \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'karma-jasmine'\u003c/span\u003e),\n            \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'karma-chrome-launcher'\u003c/span\u003e),\n            \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'karma-jasmine-html-reporter'\u003c/span\u003e),\n            \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'karma-coverage-istanbul-reporter'\u003c/span\u003e),\n            \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'@angular-devkit/build-angular/plugins/karma'\u003c/span\u003e),\n        ],\n        \u003cspan class=\"hljs-attr\"\u003eclient\u003c/span\u003e: {\n            \u003cspan class=\"hljs-attr\"\u003eclearContext\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 브라우저에서 Jasmine Spec Runner 출력을 보이게 유지\u003c/span\u003e\n        },\n        \u003cspan class=\"hljs-attr\"\u003ejasmineHtmlReporter\u003c/span\u003e: {\n            \u003cspan class=\"hljs-attr\"\u003esuppressAll\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// 중복된 추적을 제거\u003c/span\u003e\n        },\n        \u003cspan class=\"hljs-attr\"\u003ecoverageIstanbulReporter\u003c/span\u003e: {\n            \u003cspan class=\"hljs-attr\"\u003edir\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejoin\u003c/span\u003e(__dirname, \u003cspan class=\"hljs-string\"\u003e'../../../coverage/common″'\u003c/span\u003e),\n            \u003cspan class=\"hljs-attr\"\u003ereports\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'html'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'lcovonly'\u003c/span\u003e],\n            \u003cspan class=\"hljs-attr\"\u003efixWebpackSourcePaths\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        },\n        \u003cspan class=\"hljs-attr\"\u003ereporters\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'progress'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'kjhtml'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'coverage-istanbul'\u003c/span\u003e],\n        ...\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e그리고 코드 커버리지 옵션이 package.json에 설정되어야 합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-string\"\u003e\"test\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"ng test\"\u003c/span\u003e,\n\u003cspan class=\"hljs-string\"\u003e\"test:ci\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"npm run test -- --watch false --code-coverage=true\"\u003c/span\u003e,\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e2. Danger\u003c/h2\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cp\u003eTypeScript 프로젝트에서는 danger 의존성을 사용하여 eslint 규칙을 확인하여 코드 리뷰를 자동화합니다. 이는 pull request 에서 linting 문제를 자동으로 식별하여 코드 품질을 유지하는 데 도움이 됩니다. danger 를 통합하려면 Dangerfile 을 설정하여 규칙과 검사를 정의하고 일관된 코딩 표준을 유지하며 리뷰 프로세스를 간소화해야 합니다.\u003c/p\u003e\n\u003cp\u003e다음은 Dangerfile 을 구성할 수 있는 예시입니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e {danger, fail, schedule, warn} \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'danger'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e {istanbulCoverage} \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'danger-plugin-istanbul-coverage'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e {\u003cspan class=\"hljs-title class_\"\u003eESLint\u003c/span\u003e} \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'eslint'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 코드 커버리지 확인\u003c/span\u003e\n\u003cspan class=\"hljs-title function_\"\u003eschedule\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003eistanbulCoverage\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003eentrySortMethod\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'least-coverage'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003enumberOfEntries\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ecoveragePath\u003c/span\u003e: {\u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'./coverage/lcov.info'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'lcov'\u003c/span\u003e},\n    \u003cspan class=\"hljs-attr\"\u003ereportFileSet\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'createdOrModified'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ereportMode\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'warn'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ethreshold\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003estatements\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003ebranches\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003efunctions\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003elines\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e\n    }\n}));\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e enum \u003cspan class=\"hljs-title class_\"\u003eEslintSeverity\u003c/span\u003e {\n    \u003cspan class=\"hljs-variable constant_\"\u003eWARNING\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    \u003cspan class=\"hljs-variable constant_\"\u003eERROR\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// ESLint 규칙 검사\u003c/span\u003e\n\u003cspan class=\"hljs-title function_\"\u003eschedule\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e () =\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e filesToLint = danger.\u003cspan class=\"hljs-property\"\u003egit\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ecreated_files\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003econcat\u003c/span\u003e(danger.\u003cspan class=\"hljs-property\"\u003egit\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003emodified_files\u003c/span\u003e);\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e eslint = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eESLint\u003c/span\u003e({});\n\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e results = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e eslint.\u003cspan class=\"hljs-title function_\"\u003elintFiles\u003c/span\u003e(filesToLint);\n\n        results.\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003e{filePath, messages}\u003c/span\u003e) =\u003e\u003c/span\u003e {\n            messages.\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003emessage\u003c/span\u003e =\u003e\u003c/span\u003e {\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (message.\u003cspan class=\"hljs-property\"\u003efatal\u003c/span\u003e) {\n                    \u003cspan class=\"hljs-title function_\"\u003ewarn\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`Fatal error linting \u003cspan class=\"hljs-subst\"\u003e${filePath}\u003c/span\u003e with eslint.`\u003c/span\u003e);\n                    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n                }\n\n                \u003cspan class=\"hljs-comment\"\u003e// 무시된 파일 건너뛰기\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (message.\u003cspan class=\"hljs-property\"\u003eseverity\u003c/span\u003e === \u003cspan class=\"hljs-title class_\"\u003eEslintSeverity\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eWARNING\u003c/span\u003e \u0026#x26;\u0026#x26; (message.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e || \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003estartsWith\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'File ignored'\u003c/span\u003e)) {\n                    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n                }\n\n                \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fn = \u003cspan class=\"hljs-title function_\"\u003ereporterFor\u003c/span\u003e(message.\u003cspan class=\"hljs-property\"\u003eseverity\u003c/span\u003e);\n\n                \u003cspan class=\"hljs-title function_\"\u003efn\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`\u003cspan class=\"hljs-subst\"\u003e${filePath}\u003c/span\u003e line \u003cspan class=\"hljs-subst\"\u003e${message.line}\u003c/span\u003e – \u003cspan class=\"hljs-subst\"\u003e${message.message}\u003c/span\u003e (\u003cspan class=\"hljs-subst\"\u003e${message.ruleId}\u003c/span\u003e)`\u003c/span\u003e);\n            });\n        });\n    } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n        \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(error);\n    }\n});\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ereporterFor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eseverity: number\u003c/span\u003e): \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003emessage: string\u003c/span\u003e) =\u003e\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eswitch\u003c/span\u003e (severity) {\n        \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eEslintSeverity\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eWARNING\u003c/span\u003e:\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e warn;\n        \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eEslintSeverity\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eERROR\u003c/span\u003e:\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e fail;\n        \u003cspan class=\"hljs-attr\"\u003edefault\u003c/span\u003e:\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e { \u003cspan class=\"hljs-comment\"\u003e/* 아무것도 수행하지 않음 */\u003c/span\u003e\n            };\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003edanger 및 코드 커버리지 도구를 사용하려면 danger 및 danger-plugin-istanbul-coverage가 모두 의존성으로 추가되어야 합니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 일부 구버전\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003e\"danger\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"10.5.3\"\u003c/span\u003e,\n\u003cspan class=\"hljs-string\"\u003e\"danger-plugin-istanbul-coverage\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"^1.6.2\"\u003c/span\u003e,\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e그리고 다음 스크립트를 package.json에 추가할 수 있습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-string\"\u003e\"danger:ci\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"danger ci\"\u003c/span\u003e,\n\u003cspan class=\"hljs-string\"\u003e\"danger:local\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"danger local\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eGitlab과 함께 danger를 통합하려면 다음 스크립트를 CI/CD 파이프라인에 사용할 수 있습니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e DANGER_GITLAB_HOST=\u003cspan class=\"hljs-variable\"\u003e${dangerGitlabHost}\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e DANGER_GITLAB_API_BASE_URL=\u003cspan class=\"hljs-variable\"\u003e${dangerGitlabApiBaseUrl}\u003c/span\u003e\n                        \ngit branch temp_\u003cspan class=\"hljs-variable\"\u003e${BRANCH_NAME}\u003c/span\u003e\ngit checkout -b \u003cspan class=\"hljs-variable\"\u003e${dangerBaseBranch}\u003c/span\u003e\ngit checkout temp_\u003cspan class=\"hljs-variable\"\u003e${BRANCH_NAME}\u003c/span\u003e\nnpm run danger:\u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e -- --base \u003cspan class=\"hljs-variable\"\u003e${dangerBaseBranch}\u003c/span\u003e\n\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e NODE_TLS_REJECT_UNAUTHORIZED=0\nnpm run danger:ci\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e NODE_TLS_REJECT_UNAUTHORIZED=1\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e마무리\u003c/h2\u003e\n\u003cp\u003e저는 SonarScanner를 Nx 및 다양한 유형의 프로젝트에 구성하는 방법과 Jest와 Karma를 사용하여 테스팅하는 방법의 차이점을 강조했습니다. 각 도구의 구체적인 구성 및 모범 사례를 예를 통해 설명하여 개발자들이 테스트 및 코드 품질 전략에 대해 정보를 얻고 결정하는 데 도움이 되기를 바라며 이 비교를 제공했습니다.\u003c/p\u003e\n\u003cp\u003e게다가, danger의 사용법을 보여주고 이를 CI/CD 파이프라인에 통합하는 방법을 설명했습니다. danger는 eslint 규칙을 강제로 적용하여 코드 리뷰를 자동화하고 일관된 코딩 표준을 유지하며 리뷰 프로세스를 간소화하기 위해 PR에서 이슈를 플래그 처리함으로써 개발자들을 도와줍니다.\u003c/p\u003e\n\u003c!-- ui-station 사각형 --\u003e\n\u003cp\u003e\u003cins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-4877378276818686\" data-ad-slot=\"7249294152\" data-ad-format=\"auto\" data-full-width-responsive=\"true\"\u003e\u003c/ins\u003e\u003c/p\u003e\n\u003cscript\u003e\n(adsbygoogle = window.adsbygoogle || []).push({});\n\u003c/script\u003e\n\u003ch1\u003e링크\u003c/h1\u003e\n\u003cp\u003e[1] \u003ca href=\"https://medium.com/@robert.maiersilldorff/resolving-npm-peer-dependency-conflicts-70d67f4ca7dc\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://medium.com/@robert.maiersilldorff/resolving-npm-peer-dependency-conflicts-70d67f4ca7dc\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e[2] \u003ca href=\"https://yonatankra.com/how-to-create-a-workspace-coverage-report-in-nrwl-nx-monorepo/\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://yonatankra.com/how-to-create-a-workspace-coverage-report-in-nrwl-nx-monorepo/\u003c/a\u003e\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-07-01-EnhanceCodeQualitySonar-ScanneranddangerIntegrationDemystified"},"buildId":"wOkGEDZCvEs3S_XaNsdwr","isFallback":false,"gsp":true,"scriptLoader":[{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4877378276818686","strategy":"lazyOnload","crossOrigin":"anonymous"}]}</script></body></html>